(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const _ of g.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&a(_)}).observe(document,{childList:!0,subtree:!0});function t(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function a(d){if(d.ep)return;d.ep=!0;const g=t(d);fetch(d.href,g)}})();var Ml=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qy(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function rI(l){if(l.__esModule)return l;var e=l.default;if(typeof e=="function"){var t=function a(){return this instanceof a?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(l).forEach(function(a){var d=Object.getOwnPropertyDescriptor(l,a);Object.defineProperty(t,a,d.get?d:{enumerable:!0,get:function(){return l[a]}})}),t}var WE={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.5.1/LICENSE.txt
 */(function(l,e){(function(t,a){l.exports=a()})(Ml,function(){var t={},a={};function d(_,c,I){if(a[_]=I,_==="index"){var P="var sharedModule = {}; ("+a.shared+")(sharedModule); ("+a.worker+")(sharedModule);",F={};return a.shared(F),a.index(t,F),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([P],{type:"text/javascript"}))),t}}d("shared",["exports"],function(_){function c(r,n,o,p){return new(o||(o=Promise))(function(b,M){function A(U){try{O(p.next(U))}catch(W){M(W)}}function R(U){try{O(p.throw(U))}catch(W){M(W)}}function O(U){var W;U.done?b(U.value):(W=U.value,W instanceof o?W:new o(function(Y){Y(W)})).then(A,R)}O((p=p.apply(r,n||[])).next())})}function I(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var P=F;function F(r,n){this.x=r,this.y=n}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,n){return this.clone()._rotateAround(r,n)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var n=r.x-this.x,o=r.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,n){return Math.atan2(this.x*n-this.y*r,this.x*r+this.y*n)},_matMult:function(r){var n=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=n,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var n=Math.cos(r),o=Math.sin(r),p=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=p,this},_rotateAround:function(r,n){var o=Math.cos(r),p=Math.sin(r),b=n.y+p*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-p*(this.y-n.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(r){return r instanceof F?r:Array.isArray(r)?new F(r[0],r[1]):r};var D=I(P),N=G;function G(r,n,o,p){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=n,this.p2x=o,this.p2y=p}G.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,n){if(n===void 0&&(n=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,p=0;p<8;p++){var b=this.sampleCurveX(o)-r;if(Math.abs(b)<n)return o;var M=this.sampleCurveDerivativeX(o);if(Math.abs(M)<1e-6)break;o-=b/M}var A=0,R=1;for(o=r,p=0;p<20&&(b=this.sampleCurveX(o),!(Math.abs(b-r)<n));p++)r>b?A=o:R=o,o=.5*(R-A)+A;return o},solve:function(r,n){return this.sampleCurveY(this.solveCurveX(r,n))}};var Z=I(N);let re,$;function X(){return re==null&&(re=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),re}function me(){if($==null&&($=!1,X())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let p=0;p<5*5;p++){const b=4*p;n.fillStyle=`rgb(${b},${b+1},${b+2})`,n.fillRect(p%5,Math.floor(p/5),1,1)}const o=n.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&o[p]!==p){$=!0;break}}}return $||!1}function le(r,n,o,p){const b=new Z(r,n,o,p);return M=>b.solve(M)}const ye=le(.25,.1,.25,1);function Le(r,n,o){return Math.min(o,Math.max(n,r))}function Me(r,n,o){const p=o-n,b=((r-n)%p+p)%p+n;return b===n?o:b}function Te(r,...n){for(const o of n)for(const p in o)r[p]=o[p];return r}let We=1;function de(r,n,o){const p={};for(const b in r)p[b]=n.call(this,r[b],b,r);return p}function be(r,n,o){const p={};for(const b in r)n.call(this,r[b],b,r)&&(p[b]=r[b]);return p}function Oe(r){return Array.isArray(r)?r.map(Oe):typeof r=="object"&&r?de(r,Oe):r}const vt={};function st(r){vt[r]||(typeof console<"u"&&console.warn(r),vt[r]=!0)}function Je(r,n,o){return(o.y-r.y)*(n.x-r.x)>(n.y-r.y)*(o.x-r.x)}function mt(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let gt=null;function wt(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Jt(r,n,o,p,b){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const M=new VideoFrame(r,{timestamp:0});try{const A=M==null?void 0:M.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const R=A.startsWith("BGR"),O=new Uint8ClampedArray(p*b*4);if(yield M.copyTo(O,function(U,W,Y,ee,ae){const he=4*Math.max(-W,0),_e=(Math.max(0,Y)-Y)*ee*4+he,Ce=4*ee,Ne=Math.max(0,W),nt=Math.max(0,Y);return{rect:{x:Ne,y:nt,width:Math.min(U.width,W+ee)-Ne,height:Math.min(U.height,Y+ae)-nt},layout:[{offset:_e,stride:Ce}]}}(r,n,o,p,b)),R)for(let U=0;U<O.length;U+=4){const W=O[U];O[U]=O[U+2],O[U+2]=W}return O}finally{M.close()}})}let Tt,jt;const Cn="AbortError";function jn(){return new Error(Cn)}const ht={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ft(r){return ht.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const mn="global-dispatcher";class cn extends Error{constructor(n,o,p,b){super(`AJAXError: ${o} (${n}): ${p}`),this.status=n,this.statusText=o,this.url=p,this.body=b}}const qe=()=>mt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wn=function(r,n){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const p=Ft(r.url);if(p)return p(r,n);if(mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:mn},n)}if(!(/^file:/.test(o=r.url)||/^file:/.test(qe())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,b){return c(this,void 0,void 0,function*(){const M=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:qe(),signal:b.signal});p.type!=="json"||M.headers.has("Accept")||M.headers.set("Accept","application/json");const A=yield fetch(M);if(!A.ok){const U=yield A.blob();throw new cn(A.status,A.statusText,p.url,U)}let R;R=p.type==="arrayBuffer"||p.type==="image"?A.arrayBuffer():p.type==="json"?A.json():A.text();const O=yield R;if(b.signal.aborted)throw jn();return{data:O,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(r,n);if(mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:mn},n)}var o;return function(p,b){return new Promise((M,A)=>{var R;const O=new XMLHttpRequest;O.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(O.responseType="arraybuffer");for(const U in p.headers)O.setRequestHeader(U,p.headers[U]);p.type==="json"&&(O.responseType="text",!((R=p.headers)===null||R===void 0)&&R.Accept||O.setRequestHeader("Accept","application/json")),O.withCredentials=p.credentials==="include",O.onerror=()=>{A(new Error(O.statusText))},O.onload=()=>{if(!b.signal.aborted)if((O.status>=200&&O.status<300||O.status===0)&&O.response!==null){let U=O.response;if(p.type==="json")try{U=JSON.parse(O.response)}catch(W){return void A(W)}M({data:U,cacheControl:O.getResponseHeader("Cache-Control"),expires:O.getResponseHeader("Expires")})}else{const U=new Blob([O.response],{type:O.getResponseHeader("Content-Type")});A(new cn(O.status,O.statusText,p.url,U))}},b.signal.addEventListener("abort",()=>{O.abort(),A(jn())}),O.send(p.body)})}(r,n)};function bn(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const n=new URL(r),o=window.location;return n.protocol===o.protocol&&n.host===o.host}function nn(r,n,o){o[r]&&o[r].indexOf(n)!==-1||(o[r]=o[r]||[],o[r].push(n))}function ne(r,n,o){if(o&&o[r]){const p=o[r].indexOf(n);p!==-1&&o[r].splice(p,1)}}class ui{constructor(n,o={}){Te(this,o),this.type=n}}class Gn extends ui{constructor(n,o={}){super("error",Te({error:n},o))}}class Kn{on(n,o){return this._listeners=this._listeners||{},nn(n,o,this._listeners),this}off(n,o){return ne(n,o,this._listeners),ne(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},nn(n,o,this._oneTimeListeners),this):new Promise(p=>this.once(n,p))}fire(n,o){typeof n=="string"&&(n=new ui(n,o||{}));const p=n.type;if(this.listens(p)){n.target=this;const b=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const R of b)R.call(this,n);const M=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const R of M)ne(p,R,this._oneTimeListeners),R.call(this,n);const A=this._eventedParent;A&&(Te(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(n))}else n instanceof Gn&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var Ze={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const hi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qn(r,n){const o={};for(const p in r)p!=="ref"&&(o[p]=r[p]);return hi.forEach(p=>{p in n&&(o[p]=n[p])}),o}function ut(r,n){if(Array.isArray(r)){if(!Array.isArray(n)||r.length!==n.length)return!1;for(let o=0;o<r.length;o++)if(!ut(r[o],n[o]))return!1;return!0}if(typeof r=="object"&&r!==null&&n!==null){if(typeof n!="object"||Object.keys(r).length!==Object.keys(n).length)return!1;for(const o in r)if(!ut(r[o],n[o]))return!1;return!0}return r===n}function Pe(r,n){r.push(n)}function pe(r,n,o){Pe(o,{command:"addSource",args:[r,n[r]]})}function dt(r,n,o){Pe(n,{command:"removeSource",args:[r]}),o[r]=!0}function Ut(r,n,o,p){dt(r,o,p),pe(r,n,o)}function St(r,n,o){let p;for(p in r[o])if(Object.prototype.hasOwnProperty.call(r[o],p)&&p!=="data"&&!ut(r[o][p],n[o][p]))return!1;for(p in n[o])if(Object.prototype.hasOwnProperty.call(n[o],p)&&p!=="data"&&!ut(r[o][p],n[o][p]))return!1;return!0}function Lt(r,n,o,p,b,M){r=r||{},n=n||{};for(const A in r)Object.prototype.hasOwnProperty.call(r,A)&&(ut(r[A],n[A])||o.push({command:M,args:[p,A,n[A],b]}));for(const A in n)Object.prototype.hasOwnProperty.call(n,A)&&!Object.prototype.hasOwnProperty.call(r,A)&&(ut(r[A],n[A])||o.push({command:M,args:[p,A,n[A],b]}))}function Dn(r){return r.id}function an(r,n){return r[n.id]=n,r}class $e{constructor(n,o,p,b){this.message=(n?`${n}: `:"")+p,b&&(this.identifier=b),o!=null&&o.__line__&&(this.line=o.__line__)}}function On(r,...n){for(const o of n)for(const p in o)r[p]=o[p];return r}class Mt extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class Rt{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[p,b]of o)this.bindings[p]=b}concat(n){return new Rt(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Qn={kind:"null"},bt={kind:"number"},zt={kind:"string"},xt={kind:"boolean"},Fn={kind:"color"},fi={kind:"object"},Be={kind:"value"},Ht={kind:"collator"},Ct={kind:"formatted"},It={kind:"padding"},Yt={kind:"resolvedImage"},Se={kind:"variableAnchorOffsetCollection"};function te(r,n){return{kind:"array",itemType:r,N:n}}function ie(r){if(r.kind==="array"){const n=ie(r.itemType);return typeof r.N=="number"?`array<${n}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${n}>`}return r.kind}const fe=[Qn,bt,zt,xt,Fn,Ct,fi,te(Be),It,Yt,Se];function ce(r,n){if(n.kind==="error")return null;if(r.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!ce(r.itemType,n.itemType))&&(typeof r.N!="number"||r.N===n.N))return null}else{if(r.kind===n.kind)return null;if(r.kind==="value"){for(const o of fe)if(!ce(o,n))return null}}return`Expected ${ie(r)} but found ${ie(n)} instead.`}function Ve(r,n){return n.some(o=>o.kind===r.kind)}function Xe(r,n){return n.some(o=>o==="null"?r===null:o==="array"?Array.isArray(r):o==="object"?r&&!Array.isArray(r)&&typeof r=="object":o===typeof r)}function et(r,n){return r.kind==="array"&&n.kind==="array"?r.itemType.kind===n.itemType.kind&&typeof r.N=="number":r.kind===n.kind}const Fe=.96422,_t=.82521,Pt=4/29,ct=6/29,Xt=3*ct*ct,yn=ct*ct*ct,An=Math.PI/180,Hn=180/Math.PI;function di(r){return(r%=360)<0&&(r+=360),r}function kn([r,n,o,p]){let b,M;const A=Li((.2225045*(r=Mi(r))+.7168786*(n=Mi(n))+.0606169*(o=Mi(o)))/1);r===n&&n===o?b=M=A:(b=Li((.4360747*r+.3850649*n+.1430804*o)/Fe),M=Li((.0139322*r+.0971045*n+.7141733*o)/_t));const R=116*A-16;return[R<0?0:R,500*(b-A),200*(A-M),p]}function Mi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Li(r){return r>yn?Math.pow(r,1/3):r/Xt+Pt}function ve([r,n,o,p]){let b=(r+16)/116,M=isNaN(n)?b:b+n/500,A=isNaN(o)?b:b-o/200;return b=1*it(b),M=Fe*it(M),A=_t*it(A),[Ge(3.1338561*M-1.6168667*b-.4906146*A),Ge(-.9787684*M+1.9161415*b+.033454*A),Ge(.0719453*M-.2289914*b+1.4052427*A),p]}function Ge(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function it(r){return r>ct?r*r*r:Xt*(r-Pt)}function at(r){return parseInt(r.padEnd(2,r),16)/255}function Qe(r,n){return Dt(n?r/100:r,0,1)}function Dt(r,n,o){return Math.min(Math.max(n,r),o)}function en(r){return!r.some(Number.isNaN)}const Sn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(n,o,p,b=1,M=!0){this.r=n,this.g=o,this.b=p,this.a=b,M||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[n,o,p,b]))}static parse(n){if(n instanceof qt)return n;if(typeof n!="string")return;const o=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=Sn[p];if(b){const[A,R,O]=b;return[A/255,R/255,O/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const A=p.length<6?1:2;let R=1;return[at(p.slice(R,R+=A)),at(p.slice(R,R+=A)),at(p.slice(R,R+=A)),at(p.slice(R,R+A)||"ff")]}if(p.startsWith("rgb")){const A=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[R,O,U,W,Y,ee,ae,he,_e,Ce,Ne,nt]=A,ke=[W||" ",ae||" ",Ce].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const tt=[U,ee,_e].join(""),pt=tt==="%%%"?100:tt===""?255:0;if(pt){const Wt=[Dt(+O/pt,0,1),Dt(+Y/pt,0,1),Dt(+he/pt,0,1),Ne?Qe(+Ne,nt):1];if(en(Wt))return Wt}}return}}const M=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[A,R,O,U,W,Y,ee,ae,he]=M,_e=[O||" ",W||" ",ee].join("");if(_e==="  "||_e==="  /"||_e===",,"||_e===",,,"){const Ce=[+R,Dt(+U,0,100),Dt(+Y,0,100),ae?Qe(+ae,he):1];if(en(Ce))return function([Ne,nt,ke,tt]){function pt(Wt){const hn=(Wt+Ne/30)%12,rn=nt*Math.min(ke,1-ke);return ke-rn*Math.max(-1,Math.min(hn-3,9-hn,1))}return Ne=di(Ne),nt/=100,ke/=100,[pt(0),pt(8),pt(4),tt]}(Ce)}}}(n);return o?new qt(...o,!1):void 0}get rgb(){const{r:n,g:o,b:p,a:b}=this,M=b||1/0;return this.overwriteGetter("rgb",[n/M,o/M,p/M,b])}get hcl(){return this.overwriteGetter("hcl",function(n){const[o,p,b,M]=kn(n),A=Math.sqrt(p*p+b*b);return[Math.round(1e4*A)?di(Math.atan2(b,p)*Hn):NaN,A,o,M]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kn(this.rgb))}overwriteGetter(n,o){return Object.defineProperty(this,n,{value:o}),o}toString(){const[n,o,p,b]=this.rgb;return`rgba(${[n,o,p].map(M=>Math.round(255*M)).join(",")},${b})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class zn{constructor(n,o,p){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Un{constructor(n,o,p,b,M){this.text=n,this.image=o,this.scale=p,this.fontStack=b,this.textColor=M}}class En{constructor(n){this.sections=n}static fromString(n){return new En([new Un(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof En?n:En.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Jn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Jn)return n;if(typeof n=="number")return new Jn([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const o of n)if(typeof o!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Jn(n)}}toString(){return JSON.stringify(this.values)}}const Qi=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Yn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Yn)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let o=0;o<n.length;o+=2){const p=n[o],b=n[o+1];if(typeof p!="string"||!Qi.has(p)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new Yn(n)}}toString(){return JSON.stringify(this.values)}}class bi{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new bi({name:n,available:!1}):null}}function pi(r,n,o,p){return typeof r=="number"&&r>=0&&r<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[r,n,o,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[r,n,o,p]:[r,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof qt||r instanceof zn||r instanceof En||r instanceof Jn||r instanceof Yn||r instanceof bi)return!0;if(Array.isArray(r)){for(const n of r)if(!Tn(n))return!1;return!0}if(typeof r=="object"){for(const n in r)if(!Tn(r[n]))return!1;return!0}return!1}function oi(r){if(r===null)return Qn;if(typeof r=="string")return zt;if(typeof r=="boolean")return xt;if(typeof r=="number")return bt;if(r instanceof qt)return Fn;if(r instanceof zn)return Ht;if(r instanceof En)return Ct;if(r instanceof Jn)return It;if(r instanceof Yn)return Se;if(r instanceof bi)return Yt;if(Array.isArray(r)){const n=r.length;let o;for(const p of r){const b=oi(p);if(o){if(o===b)continue;o=Be;break}o=b}return te(o||Be,n)}return fi}function si(r){const n=typeof r;return r===null?"":n==="string"||n==="number"||n==="boolean"?String(r):r instanceof qt||r instanceof En||r instanceof Jn||r instanceof Yn||r instanceof bi?r.toString():JSON.stringify(r)}class wr{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Tn(n[1]))return o.error("invalid value");const p=n[1];let b=oi(p);const M=o.expectedType;return b.kind!=="array"||b.N!==0||!M||M.kind!=="array"||typeof M.N=="number"&&M.N!==0||(b=M),new wr(b,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const _r={string:zt,number:bt,boolean:xt,object:fi};class Gr{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let p,b=1;const M=n[0];if(M==="array"){let R,O;if(n.length>2){const U=n[1];if(typeof U!="string"||!(U in _r)||U==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);R=_r[U],b++}else R=Be;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);O=n[2],b++}p=te(R,O)}else{if(!_r[M])throw new Error(`Types doesn't contain name = ${M}`);p=_r[M]}const A=[];for(;b<n.length;b++){const R=o.parse(n[b],b,Be);if(!R)return null;A.push(R)}return new Gr(p,A)}evaluate(n){for(let o=0;o<this.args.length;o++){const p=this.args[o].evaluate(n);if(!ce(this.type,oi(p)))return p;if(o===this.args.length-1)throw new Fi(`Expected value to be of type ${ie(this.type)}, but found ${ie(oi(p))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const ki={"to-boolean":xt,"to-color":Fn,"to-number":bt,"to-string":zt};class Hi{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const p=n[0];if(!ki[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&n.length!==2)return o.error("Expected one argument.");const b=ki[p],M=[];for(let A=1;A<n.length;A++){const R=o.parse(n[A],A,Be);if(!R)return null;M.push(R)}return new Hi(b,M)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let o,p;for(const b of this.args){if(o=b.evaluate(n),p=null,o instanceof qt)return o;if(typeof o=="string"){const M=n.parseColor(o);if(M)return M}else if(Array.isArray(o)&&(p=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:pi(o[0],o[1],o[2],o[3]),!p))return new qt(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Fi(p||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const p of this.args){o=p.evaluate(n);const b=Jn.parse(o);if(b)return b}throw new Fi(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const p of this.args){o=p.evaluate(n);const b=Yn.parse(o);if(b)return b}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const p of this.args){if(o=p.evaluate(n),o===null)return 0;const b=Number(o);if(!isNaN(b))return b}throw new Fi(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return En.fromString(si(this.args[0].evaluate(n)));case"resolvedImage":return bi.fromString(si(this.args[0].evaluate(n)));default:return si(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const ss=["Unknown","Point","LineString","Polygon"];class Ir{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ss[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=qt.parse(n)),o}}class Nr{constructor(n,o,p=[],b,M=new Rt,A=[]){this.registry=n,this.path=p,this.key=p.map(R=>`[${R}]`).join(""),this.scope=M,this.errors=A,this.expectedType=b,this._isConstant=o}parse(n,o,p,b,M={}){return o?this.concat(o,p,b)._parse(n,M):this._parse(n,M)}_parse(n,o){function p(b,M,A){return A==="assert"?new Gr(M,[b]):A==="coerce"?new Hi(M,[b]):b}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=n[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const M=this.registry[b];if(M){let A=M.parse(n,this);if(!A)return null;if(this.expectedType){const R=this.expectedType,O=A.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||O.kind!=="value")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string")if(R.kind!=="padding"||O.kind!=="value"&&O.kind!=="number"&&O.kind!=="array")if(R.kind!=="variableAnchorOffsetCollection"||O.kind!=="value"&&O.kind!=="array"){if(this.checkSubtype(R,O))return null}else A=p(A,R,o.typeAnnotation||"coerce");else A=p(A,R,o.typeAnnotation||"coerce");else A=p(A,R,o.typeAnnotation||"coerce");else A=p(A,R,o.typeAnnotation||"assert")}if(!(A instanceof wr)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const R=new Ir;try{A=new wr(A.type,A.evaluate(R))}catch(O){return this.error(O.message),null}}return A}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,p){const b=typeof n=="number"?this.path.concat(n):this.path,M=p?this.scope.concat(p):this.scope;return new Nr(this.registry,this._isConstant,b,o||null,M,this.errors)}error(n,...o){const p=`${this.key}${o.map(b=>`[${b}]`).join("")}`;this.errors.push(new Mt(p,n))}checkSubtype(n,o){const p=ce(n,o);return p&&this.error(p),p}}class yi{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const p=[];for(let M=1;M<n.length-1;M+=2){const A=n[M];if(typeof A!="string")return o.error(`Expected string, but found ${typeof A} instead.`,M);if(/[^a-zA-Z0-9_]/.test(A))return o.error("Variable names must contain only alphanumeric characters or '_'.",M);const R=o.parse(n[M+1],M+1);if(!R)return null;p.push([A,R])}const b=o.parse(n[n.length-1],n.length-1,o.expectedType,p);return b?new yi(p,b):null}outputDefined(){return this.result.outputDefined()}}class wa{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const p=n[1];return o.scope.has(p)?new wa(p,o.scope.get(p)):o.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Ru{constructor(n,o,p){this.type=n,this.index=o,this.input=p}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=o.parse(n[1],1,bt),b=o.parse(n[2],2,te(o.expectedType||Be));return p&&b?new Ru(b.type.itemType,p,b):null}evaluate(n){const o=this.index.evaluate(n),p=this.input.evaluate(n);if(o<0)throw new Fi(`Array index out of bounds: ${o} < 0.`);if(o>=p.length)throw new Fi(`Array index out of bounds: ${o} > ${p.length-1}.`);if(o!==Math.floor(o))throw new Fi(`Array index must be an integer, but found ${o} instead.`);return p[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Co{constructor(n,o){this.type=xt,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=o.parse(n[1],1,Be),b=o.parse(n[2],2,Be);return p&&b?Ve(p.type,[xt,zt,bt,Qn,Be])?new Co(p,b):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(p.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!p)return!1;if(!Xe(o,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${ie(oi(o))} instead.`);if(!Xe(p,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${ie(oi(p))} instead.`);return p.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class ao{constructor(n,o,p){this.type=bt,this.needle=n,this.haystack=o,this.fromIndex=p}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=o.parse(n[1],1,Be),b=o.parse(n[2],2,Be);if(!p||!b)return null;if(!Ve(p.type,[xt,zt,bt,Qn,Be]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ie(p.type)} instead`);if(n.length===4){const M=o.parse(n[3],3,bt);return M?new ao(p,b,M):null}return new ao(p,b)}evaluate(n){const o=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!Xe(o,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${ie(oi(o))} instead.`);if(!Xe(p,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${ie(oi(p))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(n);return p.indexOf(o,b)}return p.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class sa{constructor(n,o,p,b,M,A){this.inputType=n,this.type=o,this.input=p,this.cases=b,this.outputs=M,this.otherwise=A}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let p,b;o.expectedType&&o.expectedType.kind!=="value"&&(b=o.expectedType);const M={},A=[];for(let U=2;U<n.length-1;U+=2){let W=n[U];const Y=n[U+1];Array.isArray(W)||(W=[W]);const ee=o.concat(U);if(W.length===0)return ee.error("Expected at least one branch label.");for(const he of W){if(typeof he!="number"&&typeof he!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof he=="number"&&Math.floor(he)!==he)return ee.error("Numeric branch labels must be integer values.");if(p){if(ee.checkSubtype(p,oi(he)))return null}else p=oi(he);if(M[String(he)]!==void 0)return ee.error("Branch labels must be unique.");M[String(he)]=A.length}const ae=o.parse(Y,U,b);if(!ae)return null;b=b||ae.type,A.push(ae)}const R=o.parse(n[1],1,Be);if(!R)return null;const O=o.parse(n[n.length-1],n.length-1,b);return O?R.type.kind!=="value"&&o.concat(1).checkSubtype(p,R.type)?null:new sa(p,b,R,M,A,O):null}evaluate(n){const o=this.input.evaluate(n);return(oi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(n,o,p){this.type=n,this.branches=o,this.otherwise=p}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const b=[];for(let A=1;A<n.length-1;A+=2){const R=o.parse(n[A],A,xt);if(!R)return null;const O=o.parse(n[A+1],A+1,p);if(!O)return null;b.push([R,O]),p=p||O.type}const M=o.parse(n[n.length-1],n.length-1,p);if(!M)return null;if(!p)throw new Error("Can't infer output type");return new aa(p,b,M)}evaluate(n){for(const[o,p]of this.branches)if(o.evaluate(n))return p.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,p]of this.branches)n(o),n(p);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class Jo{constructor(n,o,p,b){this.type=n,this.input=o,this.beginIndex=p,this.endIndex=b}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=o.parse(n[1],1,Be),b=o.parse(n[2],2,bt);if(!p||!b)return null;if(!Ve(p.type,[te(Be),zt,Be]))return o.error(`Expected first argument to be of type array or string, but found ${ie(p.type)} instead`);if(n.length===4){const M=o.parse(n[3],3,bt);return M?new Jo(p.type,p,b,M):null}return new Jo(p.type,p,b)}evaluate(n){const o=this.input.evaluate(n),p=this.beginIndex.evaluate(n);if(!Xe(o,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${ie(oi(o))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(n);return o.slice(p,b)}return o.slice(p)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function oo(r,n){const o=r.length-1;let p,b,M=0,A=o,R=0;for(;M<=A;)if(R=Math.floor((M+A)/2),p=r[R],b=r[R+1],p<=n){if(R===o||n<b)return R;M=R+1}else{if(!(p>n))throw new Fi("Input is not a number.");A=R-1}return 0}class Ro{constructor(n,o,p){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[b,M]of p)this.labels.push(b),this.outputs.push(M)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const p=o.parse(n[1],1,bt);if(!p)return null;const b=[];let M=null;o.expectedType&&o.expectedType.kind!=="value"&&(M=o.expectedType);for(let A=1;A<n.length;A+=2){const R=A===1?-1/0:n[A],O=n[A+1],U=A,W=A+1;if(typeof R!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(b.length&&b[b.length-1][0]>=R)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const Y=o.parse(O,W,M);if(!Y)return null;M=M||Y.type,b.push([R,Y])}return new Ro(M,p,b)}evaluate(n){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(n);const b=this.input.evaluate(n);if(b<=o[0])return p[0].evaluate(n);const M=o.length;return b>=o[M-1]?p[M-1].evaluate(n):p[oo(o,b)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Dl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var er=Sa;function Sa(r,n,o,p){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=n,this.p2x=o,this.p2y=p}Sa.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,n){if(n===void 0&&(n=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,p=0;p<8;p++){var b=this.sampleCurveX(o)-r;if(Math.abs(b)<n)return o;var M=this.sampleCurveDerivativeX(o);if(Math.abs(M)<1e-6)break;o-=b/M}var A=0,R=1;for(o=r,p=0;p<20&&(b=this.sampleCurveX(o),!(Math.abs(b-r)<n));p++)r>b?A=o:R=o,o=.5*(R-A)+A;return o},solve:function(r,n){return this.sampleCurveY(this.solveCurveX(r,n))}};var Sc=Dl(er);function oa(r,n,o){return r+o*(n-r)}function Qr(r,n,o){return r.map((p,b)=>oa(p,n[b],o))}const sr={number:oa,color:function(r,n,o,p="rgb"){switch(p){case"rgb":{const[b,M,A,R]=Qr(r.rgb,n.rgb,o);return new qt(b,M,A,R,!1)}case"hcl":{const[b,M,A,R]=r.hcl,[O,U,W,Y]=n.hcl;let ee,ae;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?ee=NaN:(ee=O,A!==1&&A!==0||(ae=U)):(ee=b,W!==1&&W!==0||(ae=M));else{let nt=O-b;O>b&&nt>180?nt-=360:O<b&&b-O>180&&(nt+=360),ee=b+o*nt}const[he,_e,Ce,Ne]=function([nt,ke,tt,pt]){return nt=isNaN(nt)?0:nt*An,ve([tt,Math.cos(nt)*ke,Math.sin(nt)*ke,pt])}([ee,ae??oa(M,U,o),oa(A,W,o),oa(R,Y,o)]);return new qt(he,_e,Ce,Ne,!1)}case"lab":{const[b,M,A,R]=ve(Qr(r.lab,n.lab,o));return new qt(b,M,A,R,!1)}}},array:Qr,padding:function(r,n,o){return new Jn(Qr(r.values,n.values,o))},variableAnchorOffsetCollection:function(r,n,o){const p=r.values,b=n.values;if(p.length!==b.length)throw new Fi(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${n.toString()}`);const M=[];for(let A=0;A<p.length;A+=2){if(p[A]!==b[A])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${p[A]}, to[${A}]: ${b[A]}`);M.push(p[A]);const[R,O]=p[A+1],[U,W]=b[A+1];M.push([oa(R,U,o),oa(O,W,o)])}return new Yn(M)}};class Hr{constructor(n,o,p,b,M){this.type=n,this.operator=o,this.interpolation=p,this.input=b,this.labels=[],this.outputs=[];for(const[A,R]of M)this.labels.push(A),this.outputs.push(R)}static interpolationFactor(n,o,p,b){let M=0;if(n.name==="exponential")M=Qo(o,n.base,p,b);else if(n.name==="linear")M=Qo(o,1,p,b);else if(n.name==="cubic-bezier"){const A=n.controlPoints;M=new Sc(A[0],A[1],A[2],A[3]).solve(Qo(o,1,p,b))}return M}static parse(n,o){let[p,b,M,...A]=n;if(!Array.isArray(b)||b.length===0)return o.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const U=b[1];if(typeof U!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:U}}else{if(b[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const U=b.slice(1);if(U.length!==4||U.some(W=>typeof W!="number"||W<0||W>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:U}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(M=o.parse(M,2,bt),!M)return null;const R=[];let O=null;p==="interpolate-hcl"||p==="interpolate-lab"?O=Fn:o.expectedType&&o.expectedType.kind!=="value"&&(O=o.expectedType);for(let U=0;U<A.length;U+=2){const W=A[U],Y=A[U+1],ee=U+3,ae=U+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(R.length&&R[R.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const he=o.parse(Y,ae,O);if(!he)return null;O=O||he.type,R.push([W,he])}return et(O,bt)||et(O,Fn)||et(O,It)||et(O,Se)||et(O,te(bt))?new Hr(O,p,b,M,R):o.error(`Type ${ie(O)} is not interpolatable.`)}evaluate(n){const o=this.labels,p=this.outputs;if(o.length===1)return p[0].evaluate(n);const b=this.input.evaluate(n);if(b<=o[0])return p[0].evaluate(n);const M=o.length;if(b>=o[M-1])return p[M-1].evaluate(n);const A=oo(o,b),R=Hr.interpolationFactor(this.interpolation,b,o[A],o[A+1]),O=p[A].evaluate(n),U=p[A+1].evaluate(n);switch(this.operator){case"interpolate":return sr[this.type.kind](O,U,R);case"interpolate-hcl":return sr.color(O,U,R,"hcl");case"interpolate-lab":return sr.color(O,U,R,"lab")}}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Qo(r,n,o,p){const b=p-o,M=r-o;return b===0?0:n===1?M/b:(Math.pow(n,M)-1)/(Math.pow(n,b)-1)}class Nl{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let p=null;const b=o.expectedType;b&&b.kind!=="value"&&(p=b);const M=[];for(const R of n.slice(1)){const O=o.parse(R,1+M.length,p,void 0,{typeAnnotation:"omit"});if(!O)return null;p=p||O.type,M.push(O)}if(!p)throw new Error("No output type");const A=b&&M.some(R=>ce(b,R.type));return new Nl(A?Be:p,M)}evaluate(n){let o,p=null,b=0;for(const M of this.args)if(b++,p=M.evaluate(n),p&&p instanceof bi&&!p.available&&(o||(o=p.name),p=null,b===this.args.length&&(p=o)),p!==null)break;return p}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function Pu(r,n){return r==="=="||r==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function el(r,n,o,p){return p.compare(n,o)===0}function Ea(r,n,o){const p=r!=="=="&&r!=="!=";return class qE{constructor(M,A,R){this.type=xt,this.lhs=M,this.rhs=A,this.collator=R,this.hasUntypedArgument=M.type.kind==="value"||A.type.kind==="value"}static parse(M,A){if(M.length!==3&&M.length!==4)return A.error("Expected two or three arguments.");const R=M[0];let O=A.parse(M[1],1,Be);if(!O)return null;if(!Pu(R,O.type))return A.concat(1).error(`"${R}" comparisons are not supported for type '${ie(O.type)}'.`);let U=A.parse(M[2],2,Be);if(!U)return null;if(!Pu(R,U.type))return A.concat(2).error(`"${R}" comparisons are not supported for type '${ie(U.type)}'.`);if(O.type.kind!==U.type.kind&&O.type.kind!=="value"&&U.type.kind!=="value")return A.error(`Cannot compare types '${ie(O.type)}' and '${ie(U.type)}'.`);p&&(O.type.kind==="value"&&U.type.kind!=="value"?O=new Gr(U.type,[O]):O.type.kind!=="value"&&U.type.kind==="value"&&(U=new Gr(O.type,[U])));let W=null;if(M.length===4){if(O.type.kind!=="string"&&U.type.kind!=="string"&&O.type.kind!=="value"&&U.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(W=A.parse(M[3],3,Ht),!W)return null}return new qE(O,U,W)}evaluate(M){const A=this.lhs.evaluate(M),R=this.rhs.evaluate(M);if(p&&this.hasUntypedArgument){const O=oi(A),U=oi(R);if(O.kind!==U.kind||O.kind!=="string"&&O.kind!=="number")throw new Fi(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${O.kind}, ${U.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const O=oi(A),U=oi(R);if(O.kind!=="string"||U.kind!=="string")return n(M,A,R)}return this.collator?o(M,A,R,this.collator.evaluate(M)):n(M,A,R)}eachChild(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)}outputDefined(){return!0}}}const Lu=Ea("==",function(r,n,o){return n===o},el),Ai=Ea("!=",function(r,n,o){return n!==o},function(r,n,o,p){return!el(0,n,o,p)}),la=Ea("<",function(r,n,o){return n<o},function(r,n,o,p){return p.compare(n,o)<0}),Ol=Ea(">",function(r,n,o){return n>o},function(r,n,o,p){return p.compare(n,o)>0}),ku=Ea("<=",function(r,n,o){return n<=o},function(r,n,o,p){return p.compare(n,o)<=0}),zi=Ea(">=",function(r,n,o){return n>=o},function(r,n,o,p){return p.compare(n,o)>=0});class Di{constructor(n,o,p){this.type=Ht,this.locale=p,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const p=n[1];if(typeof p!="object"||Array.isArray(p))return o.error("Collator options argument must be an object.");const b=o.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,xt);if(!b)return null;const M=o.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,xt);if(!M)return null;let A=null;return p.locale&&(A=o.parse(p.locale,1,zt),!A)?null:new Di(b,M,A)}evaluate(n){return new zn(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Wr{constructor(n,o,p,b,M){this.type=zt,this.number=n,this.locale=o,this.currency=p,this.minFractionDigits=b,this.maxFractionDigits=M}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const p=o.parse(n[1],1,bt);if(!p)return null;const b=n[2];if(typeof b!="object"||Array.isArray(b))return o.error("NumberFormat options argument must be an object.");let M=null;if(b.locale&&(M=o.parse(b.locale,1,zt),!M))return null;let A=null;if(b.currency&&(A=o.parse(b.currency,1,zt),!A))return null;let R=null;if(b["min-fraction-digits"]&&(R=o.parse(b["min-fraction-digits"],1,bt),!R))return null;let O=null;return b["max-fraction-digits"]&&(O=o.parse(b["max-fraction-digits"],1,bt),!O)?null:new Wr(p,M,A,R,O)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class tl{constructor(n){this.type=Ct,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const p=n[1];if(!Array.isArray(p)&&typeof p=="object")return o.error("First argument must be an image or text section.");const b=[];let M=!1;for(let A=1;A<=n.length-1;++A){const R=n[A];if(M&&typeof R=="object"&&!Array.isArray(R)){M=!1;let O=null;if(R["font-scale"]&&(O=o.parse(R["font-scale"],1,bt),!O))return null;let U=null;if(R["text-font"]&&(U=o.parse(R["text-font"],1,te(zt)),!U))return null;let W=null;if(R["text-color"]&&(W=o.parse(R["text-color"],1,Fn),!W))return null;const Y=b[b.length-1];Y.scale=O,Y.font=U,Y.textColor=W}else{const O=o.parse(n[A],1,Be);if(!O)return null;const U=O.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");M=!0,b.push({content:O,scale:null,font:null,textColor:null})}}return new tl(b)}evaluate(n){return new En(this.sections.map(o=>{const p=o.content.evaluate(n);return oi(p)===Yt?new Un("",p,null,null,null):new Un(si(p),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}}class nl{constructor(n){this.type=Yt,this.input=n}static parse(n,o){if(n.length!==2)return o.error("Expected two arguments.");const p=o.parse(n[1],1,zt);return p?new nl(p):o.error("No image name provided.")}evaluate(n){const o=this.input.evaluate(n),p=bi.fromString(o);return p&&n.availableImages&&(p.available=n.availableImages.indexOf(o)>-1),p}eachChild(n){n(this.input)}outputDefined(){return!1}}class Fl{constructor(n){this.type=bt,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=o.parse(n[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ie(p.type)} instead.`):new Fl(p):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Fi(`Expected value to be of type string or array, but found ${ie(oi(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ws=8192;function Du(r,n){const o=(180+r[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,b=Math.pow(2,n.z);return[Math.round(o*b*Ws),Math.round(p*b*Ws)]}function za(r,n){const o=Math.pow(2,n.z);return[(b=(r[0]/Ws+n.x)/o,360*b-180),(p=(r[1]/Ws+n.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,b}function ti(r,n){r[0]=Math.min(r[0],n[0]),r[1]=Math.min(r[1],n[1]),r[2]=Math.max(r[2],n[0]),r[3]=Math.max(r[3],n[1])}function ar(r,n){return!(r[0]<=n[0]||r[2]>=n[2]||r[1]<=n[1]||r[3]>=n[3])}function Nu(r,n,o){const p=r[0]-n[0],b=r[1]-n[1],M=r[0]-o[0],A=r[1]-o[1];return p*A-M*b==0&&p*M<=0&&b*A<=0}function yr(r,n,o,p){return(b=[p[0]-o[0],p[1]-o[1]])[0]*(M=[n[0]-r[0],n[1]-r[1]])[1]-b[1]*M[0]!=0&&!(!Ou(r,n,o,p)||!Ou(o,p,r,n));var b,M}function lo(r,n,o){for(const p of o)for(let b=0;b<p.length-1;++b)if(yr(r,n,p[b],p[b+1]))return!0;return!1}function Ba(r,n,o=!1){let p=!1;for(const R of n)for(let O=0;O<R.length-1;O++){if(Nu(r,R[O],R[O+1]))return o;(M=R[O])[1]>(b=r)[1]!=(A=R[O+1])[1]>b[1]&&b[0]<(A[0]-M[0])*(b[1]-M[1])/(A[1]-M[1])+M[0]&&(p=!p)}var b,M,A;return p}function qr(r,n){for(const o of n)if(Ba(r,o))return!0;return!1}function zl(r,n){for(const o of r)if(!Ba(o,n))return!1;for(let o=0;o<r.length-1;++o)if(lo(r[o],r[o+1],n))return!1;return!0}function uo(r,n){for(const o of n)if(zl(r,o))return!0;return!1}function Ou(r,n,o,p){const b=p[0]-o[0],M=p[1]-o[1],A=(r[0]-o[0])*M-b*(r[1]-o[1]),R=(n[0]-o[0])*M-b*(n[1]-o[1]);return A>0&&R<0||A<0&&R>0}function ys(r,n,o){const p=[];for(let b=0;b<r.length;b++){const M=[];for(let A=0;A<r[b].length;A++){const R=Du(r[b][A],o);ti(n,R),M.push(R)}p.push(M)}return p}function Bl(r,n,o){const p=[];for(let b=0;b<r.length;b++){const M=ys(r[b],n,o);p.push(M)}return p}function Fu(r,n,o,p){if(r[0]<o[0]||r[0]>o[2]){const b=.5*p;let M=r[0]-o[0]>b?-p:o[0]-r[0]>b?p:0;M===0&&(M=r[0]-o[2]>b?-p:o[2]-r[0]>b?p:0),r[0]+=M}ti(n,r)}function us(r,n,o,p){const b=Math.pow(2,p.z)*Ws,M=[p.x*Ws,p.y*Ws],A=[];for(const R of r)for(const O of R){const U=[O.x+M[0],O.y+M[1]];Fu(U,n,o,b),A.push(U)}return A}function Ec(r,n,o,p){const b=Math.pow(2,p.z)*Ws,M=[p.x*Ws,p.y*Ws],A=[];for(const O of r){const U=[];for(const W of O){const Y=[W.x+M[0],W.y+M[1]];ti(n,Y),U.push(Y)}A.push(U)}if(n[2]-n[0]<=b/2){(R=n)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const O of A)for(const U of O)Fu(U,n,o,b)}var R;return A}class Or{constructor(n,o){this.type=xt,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Tn(n[1])){const p=n[1];if(p.type==="FeatureCollection"){const b=[];for(const M of p.features){const{type:A,coordinates:R}=M.geometry;A==="Polygon"&&b.push(R),A==="MultiPolygon"&&b.push(...R)}if(b.length)return new Or(p,{type:"MultiPolygon",coordinates:b})}else if(p.type==="Feature"){const b=p.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Or(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Or(p,p)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,p){const b=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const R=ys(p.coordinates,M,A),O=us(o.geometry(),b,M,A);if(!ar(b,M))return!1;for(const U of O)if(!Ba(U,R))return!1}if(p.type==="MultiPolygon"){const R=Bl(p.coordinates,M,A),O=us(o.geometry(),b,M,A);if(!ar(b,M))return!1;for(const U of O)if(!qr(U,R))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,p){const b=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],A=o.canonicalID();if(p.type==="Polygon"){const R=ys(p.coordinates,M,A),O=Ec(o.geometry(),b,M,A);if(!ar(b,M))return!1;for(const U of O)if(!zl(U,R))return!1}if(p.type==="MultiPolygon"){const R=Bl(p.coordinates,M,A),O=Ec(o.geometry(),b,M,A);if(!ar(b,M))return!1;for(const U of O)if(!uo(U,R))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Tc=class{constructor(r=[],n=Mc){if(this.data=r,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:n,compare:o}=this,p=n[r];for(;r>0;){const b=r-1>>1,M=n[b];if(o(p,M)>=0)break;n[r]=M,r=b}n[r]=p}_down(r){const{data:n,compare:o}=this,p=this.length>>1,b=n[r];for(;r<p;){let M=1+(r<<1),A=n[M];const R=M+1;if(R<this.length&&o(n[R],A)<0&&(M=R,A=n[R]),o(A,b)>=0)break;n[r]=A,r=M}n[r]=b}};function Mc(r,n){return r<n?-1:r>n?1:0}function Ua(r,n,o,p,b){qs(r,n,o,p||r.length-1,b||or)}function qs(r,n,o,p,b){for(;p>o;){if(p-o>600){var M=p-o+1,A=n-o+1,R=Math.log(M),O=.5*Math.exp(2*R/3),U=.5*Math.sqrt(R*O*(M-O)/M)*(A-M/2<0?-1:1);qs(r,n,Math.max(o,Math.floor(n-A*O/M+U)),Math.min(p,Math.floor(n+(M-A)*O/M+U)),b)}var W=r[n],Y=o,ee=p;for(Cr(r,o,n),b(r[p],W)>0&&Cr(r,o,p);Y<ee;){for(Cr(r,Y,ee),Y++,ee--;b(r[Y],W)<0;)Y++;for(;b(r[ee],W)>0;)ee--}b(r[o],W)===0?Cr(r,o,ee):Cr(r,++ee,p),ee<=n&&(o=ee+1),n<=ee&&(p=ee-1)}}function Cr(r,n,o){var p=r[n];r[n]=r[o],r[o]=p}function or(r,n){return r<n?-1:r>n?1:0}function Ls(r,n){if(r.length<=1)return[r];const o=[];let p,b;for(const M of r){const A=Bu(M);A!==0&&(M.area=Math.abs(A),b===void 0&&(b=A<0),b===A<0?(p&&o.push(p),p=[M]):p.push(M))}if(p&&o.push(p),n>1)for(let M=0;M<o.length;M++)o[M].length<=n||(Ua(o[M],n,1,o[M].length-1,zu),o[M]=o[M].slice(0,n));return o}function zu(r,n){return n.area-r.area}function Bu(r){let n=0;for(let o,p,b=0,M=r.length,A=M-1;b<M;A=b++)o=r[b],p=r[A],n+=(p.x-o.x)*(o.y+p.y);return n}const il=1/298.257223563,Ul=il*(2-il),Uu=Math.PI/180;class vs{constructor(n){const o=6378.137*Uu*1e3,p=Math.cos(n*Uu),b=1/(1-Ul*(1-p*p)),M=Math.sqrt(b);this.kx=o*M*p,this.ky=o*M*b*(1-Ul)}distance(n,o){const p=this.wrap(n[0]-o[0])*this.kx,b=(n[1]-o[1])*this.ky;return Math.sqrt(p*p+b*b)}pointOnLine(n,o){let p,b,M,A,R=1/0;for(let O=0;O<n.length-1;O++){let U=n[O][0],W=n[O][1],Y=this.wrap(n[O+1][0]-U)*this.kx,ee=(n[O+1][1]-W)*this.ky,ae=0;Y===0&&ee===0||(ae=(this.wrap(o[0]-U)*this.kx*Y+(o[1]-W)*this.ky*ee)/(Y*Y+ee*ee),ae>1?(U=n[O+1][0],W=n[O+1][1]):ae>0&&(U+=Y/this.kx*ae,W+=ee/this.ky*ae)),Y=this.wrap(o[0]-U)*this.kx,ee=(o[1]-W)*this.ky;const he=Y*Y+ee*ee;he<R&&(R=he,p=U,b=W,M=O,A=ae)}return{point:[p,b],index:M,t:Math.max(0,Math.min(1,A))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Vl(r,n){return n[0]-r[0]}function Rr(r){return r[1]-r[0]+1}function Fr(r,n){return r[1]>=r[0]&&r[1]<n}function rl(r,n){if(r[0]>r[1])return[null,null];const o=Rr(r);if(n){if(o===2)return[r,null];const b=Math.floor(o/2);return[[r[0],r[0]+b],[r[0]+b,r[1]]]}if(o===1)return[r,null];const p=Math.floor(o/2)-1;return[[r[0],r[0]+p],[r[0]+p+1,r[1]]]}function sl(r,n){if(!Fr(n,r.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let p=n[0];p<=n[1];++p)ti(o,r[p]);return o}function al(r){const n=[1/0,1/0,-1/0,-1/0];for(const o of r)for(const p of o)ti(n,p);return n}function ol(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function co(r,n,o){if(!ol(r)||!ol(n))return NaN;let p=0,b=0;return r[2]<n[0]&&(p=n[0]-r[2]),r[0]>n[2]&&(p=r[0]-n[2]),r[1]>n[3]&&(b=r[1]-n[3]),r[3]<n[1]&&(b=n[1]-r[3]),o.distance([0,0],[p,b])}function Wi(r,n,o){const p=o.pointOnLine(n,r);return o.distance(r,p.point)}function Vu(r,n,o,p,b){const M=Math.min(Wi(r,[o,p],b),Wi(n,[o,p],b)),A=Math.min(Wi(o,[r,n],b),Wi(p,[r,n],b));return Math.min(M,A)}function ai(r,n,o,p,b){if(!Fr(n,r.length)||!Fr(p,o.length))return 1/0;let M=1/0;for(let A=n[0];A<n[1];++A){const R=r[A],O=r[A+1];for(let U=p[0];U<p[1];++U){const W=o[U],Y=o[U+1];if(yr(R,O,W,Y))return 0;M=Math.min(M,Vu(R,O,W,Y,b))}}return M}function ll(r,n,o,p,b){if(!Fr(n,r.length)||!Fr(p,o.length))return NaN;let M=1/0;for(let A=n[0];A<=n[1];++A)for(let R=p[0];R<=p[1];++R)if(M=Math.min(M,b.distance(r[A],o[R])),M===0)return M;return M}function tr(r,n,o){if(Ba(r,n,!0))return 0;let p=1/0;for(const b of n){const M=b[0],A=b[b.length-1];if(M!==A&&(p=Math.min(p,Wi(r,[A,M],o)),p===0))return p;const R=o.pointOnLine(b,r);if(p=Math.min(p,o.distance(r,R.point)),p===0)return p}return p}function $i(r,n,o,p){if(!Fr(n,r.length))return NaN;for(let M=n[0];M<=n[1];++M)if(Ba(r[M],o,!0))return 0;let b=1/0;for(let M=n[0];M<n[1];++M){const A=r[M],R=r[M+1];for(const O of o)for(let U=0,W=O.length,Y=W-1;U<W;Y=U++){const ee=O[Y],ae=O[U];if(yr(A,R,ee,ae))return 0;b=Math.min(b,Vu(A,R,ee,ae,p))}}return b}function $r(r,n){for(const o of r)for(const p of o)if(Ba(p,n,!0))return!0;return!1}function Gl(r,n,o,p=1/0){const b=al(r),M=al(n);if(p!==1/0&&co(b,M,o)>=p)return p;if(ar(b,M)){if($r(r,n))return 0}else if($r(n,r))return 0;let A=1/0;for(const R of r)for(let O=0,U=R.length,W=U-1;O<U;W=O++){const Y=R[W],ee=R[O];for(const ae of n)for(let he=0,_e=ae.length,Ce=_e-1;he<_e;Ce=he++){const Ne=ae[Ce],nt=ae[he];if(yr(Y,ee,Ne,nt))return 0;A=Math.min(A,Vu(Y,ee,Ne,nt,o))}}return A}function Va(r,n,o,p,b,M){if(!M)return;const A=co(sl(p,M),b,o);A<n&&r.push([A,M,[0,0]])}function ul(r,n,o,p,b,M,A){if(!M||!A)return;const R=co(sl(p,M),sl(b,A),o);R<n&&r.push([R,M,A])}function Po(r,n,o,p,b=1/0){let M=Math.min(p.distance(r[0],o[0][0]),b);if(M===0)return M;const A=new Tc([[0,[0,r.length-1],[0,0]]],Vl),R=al(o);for(;A.length>0;){const O=A.pop();if(O[0]>=M)continue;const U=O[1],W=n?50:100;if(Rr(U)<=W){if(!Fr(U,r.length))return NaN;if(n){const Y=$i(r,U,o,p);if(isNaN(Y)||Y===0)return Y;M=Math.min(M,Y)}else for(let Y=U[0];Y<=U[1];++Y){const ee=tr(r[Y],o,p);if(M=Math.min(M,ee),M===0)return 0}}else{const Y=rl(U,n);Va(A,M,p,r,R,Y[0]),Va(A,M,p,r,R,Y[1])}}return M}function Hl(r,n,o,p,b,M=1/0){let A=Math.min(M,b.distance(r[0],o[0]));if(A===0)return A;const R=new Tc([[0,[0,r.length-1],[0,o.length-1]]],Vl);for(;R.length>0;){const O=R.pop();if(O[0]>=A)continue;const U=O[1],W=O[2],Y=n?50:100,ee=p?50:100;if(Rr(U)<=Y&&Rr(W)<=ee){if(!Fr(U,r.length)&&Fr(W,o.length))return NaN;let ae;if(n&&p)ae=ai(r,U,o,W,b),A=Math.min(A,ae);else if(n&&!p){const he=r.slice(U[0],U[1]+1);for(let _e=W[0];_e<=W[1];++_e)if(ae=Wi(o[_e],he,b),A=Math.min(A,ae),A===0)return A}else if(!n&&p){const he=o.slice(W[0],W[1]+1);for(let _e=U[0];_e<=U[1];++_e)if(ae=Wi(r[_e],he,b),A=Math.min(A,ae),A===0)return A}else ae=ll(r,U,o,W,b),A=Math.min(A,ae)}else{const ae=rl(U,n),he=rl(W,p);ul(R,A,b,r,o,ae[0],he[0]),ul(R,A,b,r,o,ae[0],he[1]),ul(R,A,b,r,o,ae[1],he[0]),ul(R,A,b,r,o,ae[1],he[1])}}return A}function Gu(r){return r.type==="MultiPolygon"?r.coordinates.map(n=>({type:"Polygon",coordinates:n})):r.type==="MultiLineString"?r.coordinates.map(n=>({type:"LineString",coordinates:n})):r.type==="MultiPoint"?r.coordinates.map(n=>({type:"Point",coordinates:n})):[r]}class Ga{constructor(n,o){this.type=bt,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Tn(n[1])){const p=n[1];if(p.type==="FeatureCollection")return new Ga(p,p.features.map(b=>Gu(b.geometry)).flat());if(p.type==="Feature")return new Ga(p,Gu(p.geometry));if("type"in p&&"coordinates"in p)return new Ga(p,Gu(p))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,p){const b=o.geometry(),M=b.flat().map(O=>za([O.x,O.y],o.canonical));if(b.length===0)return NaN;const A=new vs(M[0][1]);let R=1/0;for(const O of p){switch(O.type){case"Point":R=Math.min(R,Hl(M,!1,[O.coordinates],!1,A,R));break;case"LineString":R=Math.min(R,Hl(M,!1,O.coordinates,!0,A,R));break;case"Polygon":R=Math.min(R,Po(M,!1,O.coordinates,A,R))}if(R===0)return R}return R}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,p){const b=o.geometry(),M=b.flat().map(O=>za([O.x,O.y],o.canonical));if(b.length===0)return NaN;const A=new vs(M[0][1]);let R=1/0;for(const O of p){switch(O.type){case"Point":R=Math.min(R,Hl(M,!0,[O.coordinates],!1,A,R));break;case"LineString":R=Math.min(R,Hl(M,!0,O.coordinates,!0,A,R));break;case"Polygon":R=Math.min(R,Po(M,!0,O.coordinates,A,R))}if(R===0)return R}return R}(n,this.geometries);if(n.geometryType()==="Polygon")return function(o,p){const b=o.geometry();if(b.length===0||b[0].length===0)return NaN;const M=Ls(b,0).map(O=>O.map(U=>U.map(W=>za([W.x,W.y],o.canonical)))),A=new vs(M[0][0][0][1]);let R=1/0;for(const O of p)for(const U of M){switch(O.type){case"Point":R=Math.min(R,Po([O.coordinates],!1,U,A,R));break;case"LineString":R=Math.min(R,Po(O.coordinates,!0,U,A,R));break;case"Polygon":R=Math.min(R,Gl(U,O.coordinates,A,R))}if(R===0)return R}return R}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ho={"==":Lu,"!=":Ai,">":Ol,"<":la,">=":zi,"<=":ku,array:Gr,at:Ru,boolean:Gr,case:aa,coalesce:Nl,collator:Di,format:tl,image:nl,in:Co,"index-of":ao,interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:Fl,let:yi,literal:wr,match:sa,number:Gr,"number-format":Wr,object:Gr,slice:Jo,step:Ro,string:Gr,"to-boolean":Hi,"to-color":Hi,"to-number":Hi,"to-string":Hi,var:wa,within:Or,distance:Ga};class xs{constructor(n,o,p,b){this.name=n,this.type=o,this._evaluate=p,this.args=b}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,o){const p=n[0],b=xs.definitions[p];if(!b)return o.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const M=Array.isArray(b)?b[0]:b.type,A=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,R=A.filter(([U])=>!Array.isArray(U)||U.length===n.length-1);let O=null;for(const[U,W]of R){O=new Nr(o.registry,Lo,o.path,null,o.scope);const Y=[];let ee=!1;for(let ae=1;ae<n.length;ae++){const he=n[ae],_e=Array.isArray(U)?U[ae-1]:U.type,Ce=O.parse(he,1+Y.length,_e);if(!Ce){ee=!0;break}Y.push(Ce)}if(!ee)if(Array.isArray(U)&&U.length!==Y.length)O.error(`Expected ${U.length} arguments, but found ${Y.length} instead.`);else{for(let ae=0;ae<Y.length;ae++){const he=Array.isArray(U)?U[ae]:U.type,_e=Y[ae];O.concat(ae+1).checkSubtype(he,_e.type)}if(O.errors.length===0)return new xs(p,M,W,Y)}}if(R.length===1)o.errors.push(...O.errors);else{const U=(R.length?R:A).map(([Y])=>{return ee=Y,Array.isArray(ee)?`(${ee.map(ie).join(", ")})`:`(${ie(ee.type)}...)`;var ee}).join(" | "),W=[];for(let Y=1;Y<n.length;Y++){const ee=o.parse(n[Y],1+W.length);if(!ee)return null;W.push(ie(ee.type))}o.error(`Expected arguments of type ${U}, but found (${W.join(", ")}) instead.`)}return null}static register(n,o){xs.definitions=o;for(const p in o)n[p]=xs}}function Ha(r,[n,o,p,b]){n=n.evaluate(r),o=o.evaluate(r),p=p.evaluate(r);const M=b?b.evaluate(r):1,A=pi(n,o,p,M);if(A)throw new Fi(A);return new qt(n/255,o/255,p/255,M,!1)}function Wl(r,n){return r in n}function ql(r,n){const o=n[r];return o===void 0?null:o}function ua(r){return{type:r}}function Lo(r){if(r instanceof wa)return Lo(r.boundExpression);if(r instanceof xs&&r.name==="error"||r instanceof Di||r instanceof Or||r instanceof Ga)return!1;const n=r instanceof Hi||r instanceof Gr;let o=!0;return r.eachChild(p=>{o=n?o&&Lo(p):o&&p instanceof wr}),!!o&&$s(r)&&ko(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function $s(r){if(r instanceof xs&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Or||r instanceof Ga)return!1;let n=!0;return r.eachChild(o=>{n&&!$s(o)&&(n=!1)}),n}function Ta(r){if(r instanceof xs&&r.name==="feature-state")return!1;let n=!0;return r.eachChild(o=>{n&&!Ta(o)&&(n=!1)}),n}function ko(r,n){if(r instanceof xs&&n.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(p=>{o&&!ko(p,n)&&(o=!1)}),o}function Ac(r){return{result:"success",value:r}}function fo(r){return{result:"error",value:r}}function bs(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function ws(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function po(r){return!!r.expression&&r.expression.interpolated}function ci(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function cl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Hu(r){return r}function Ss(r,n){const o=n.type==="color",p=r.stops&&typeof r.stops[0][0]=="object",b=p||!(p||r.property!==void 0),M=r.type||(po(n)?"exponential":"interval");if(o||n.type==="padding"){const W=o?qt.parse:Jn.parse;(r=On({},r)).stops&&(r.stops=r.stops.map(Y=>[Y[0],W(Y[1])])),r.default=W(r.default?r.default:n.default)}if(r.colorSpace&&(A=r.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var A;let R,O,U;if(M==="exponential")R=u;else if(M==="interval")R=s;else if(M==="categorical"){R=S,O=Object.create(null);for(const W of r.stops)O[W[0]]=W[1];U=typeof r.stops[0][0]}else{if(M!=="identity")throw new Error(`Unknown function type "${M}"`);R=f}if(p){const W={},Y=[];for(let he=0;he<r.stops.length;he++){const _e=r.stops[he],Ce=_e[0].zoom;W[Ce]===void 0&&(W[Ce]={zoom:Ce,type:r.type,property:r.property,default:r.default,stops:[]},Y.push(Ce)),W[Ce].stops.push([_e[0].value,_e[1]])}const ee=[];for(const he of Y)ee.push([W[he].zoom,Ss(W[he],n)]);const ae={name:"linear"};return{kind:"composite",interpolationType:ae,interpolationFactor:Hr.interpolationFactor.bind(void 0,ae),zoomStops:ee.map(he=>he[0]),evaluate:({zoom:he},_e)=>u({stops:ee,base:r.base},n,he).evaluate(he,_e)}}if(b){const W=M==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:W,interpolationFactor:Hr.interpolationFactor.bind(void 0,W),zoomStops:r.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>R(r,n,Y,O,U)}}return{kind:"source",evaluate(W,Y){const ee=Y&&Y.properties?Y.properties[r.property]:void 0;return ee===void 0?es(r.default,n.default):R(r,n,ee,O,U)}}}function es(r,n,o){return r!==void 0?r:n!==void 0?n:o!==void 0?o:void 0}function S(r,n,o,p,b){return es(typeof o===b?p[o]:void 0,r.default,n.default)}function s(r,n,o){if(ci(o)!=="number")return es(r.default,n.default);const p=r.stops.length;if(p===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[p-1][0])return r.stops[p-1][1];const b=oo(r.stops.map(M=>M[0]),o);return r.stops[b][1]}function u(r,n,o){const p=r.base!==void 0?r.base:1;if(ci(o)!=="number")return es(r.default,n.default);const b=r.stops.length;if(b===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[b-1][0])return r.stops[b-1][1];const M=oo(r.stops.map(W=>W[0]),o),A=function(W,Y,ee,ae){const he=ae-ee,_e=W-ee;return he===0?0:Y===1?_e/he:(Math.pow(Y,_e)-1)/(Math.pow(Y,he)-1)}(o,p,r.stops[M][0],r.stops[M+1][0]),R=r.stops[M][1],O=r.stops[M+1][1],U=sr[n.type]||Hu;return typeof R.evaluate=="function"?{evaluate(...W){const Y=R.evaluate.apply(void 0,W),ee=O.evaluate.apply(void 0,W);if(Y!==void 0&&ee!==void 0)return U(Y,ee,A,r.colorSpace)}}:U(R,O,A,r.colorSpace)}function f(r,n,o){switch(n.type){case"color":o=qt.parse(o);break;case"formatted":o=En.fromString(o.toString());break;case"resolvedImage":o=bi.fromString(o.toString());break;case"padding":o=Jn.parse(o);break;default:ci(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0)}return es(o,r.default,n.default)}xs.register(ho,{error:[{kind:"error"},[zt],(r,[n])=>{throw new Fi(n.evaluate(r))}],typeof:[zt,[Be],(r,[n])=>ie(oi(n.evaluate(r)))],"to-rgba":[te(bt,4),[Fn],(r,[n])=>{const[o,p,b,M]=n.evaluate(r).rgb;return[255*o,255*p,255*b,M]}],rgb:[Fn,[bt,bt,bt],Ha],rgba:[Fn,[bt,bt,bt,bt],Ha],has:{type:xt,overloads:[[[zt],(r,[n])=>Wl(n.evaluate(r),r.properties())],[[zt,fi],(r,[n,o])=>Wl(n.evaluate(r),o.evaluate(r))]]},get:{type:Be,overloads:[[[zt],(r,[n])=>ql(n.evaluate(r),r.properties())],[[zt,fi],(r,[n,o])=>ql(n.evaluate(r),o.evaluate(r))]]},"feature-state":[Be,[zt],(r,[n])=>ql(n.evaluate(r),r.featureState||{})],properties:[fi,[],r=>r.properties()],"geometry-type":[zt,[],r=>r.geometryType()],id:[Be,[],r=>r.id()],zoom:[bt,[],r=>r.globals.zoom],"heatmap-density":[bt,[],r=>r.globals.heatmapDensity||0],"line-progress":[bt,[],r=>r.globals.lineProgress||0],accumulated:[Be,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[bt,ua(bt),(r,n)=>{let o=0;for(const p of n)o+=p.evaluate(r);return o}],"*":[bt,ua(bt),(r,n)=>{let o=1;for(const p of n)o*=p.evaluate(r);return o}],"-":{type:bt,overloads:[[[bt,bt],(r,[n,o])=>n.evaluate(r)-o.evaluate(r)],[[bt],(r,[n])=>-n.evaluate(r)]]},"/":[bt,[bt,bt],(r,[n,o])=>n.evaluate(r)/o.evaluate(r)],"%":[bt,[bt,bt],(r,[n,o])=>n.evaluate(r)%o.evaluate(r)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(r,[n,o])=>Math.pow(n.evaluate(r),o.evaluate(r))],sqrt:[bt,[bt],(r,[n])=>Math.sqrt(n.evaluate(r))],log10:[bt,[bt],(r,[n])=>Math.log(n.evaluate(r))/Math.LN10],ln:[bt,[bt],(r,[n])=>Math.log(n.evaluate(r))],log2:[bt,[bt],(r,[n])=>Math.log(n.evaluate(r))/Math.LN2],sin:[bt,[bt],(r,[n])=>Math.sin(n.evaluate(r))],cos:[bt,[bt],(r,[n])=>Math.cos(n.evaluate(r))],tan:[bt,[bt],(r,[n])=>Math.tan(n.evaluate(r))],asin:[bt,[bt],(r,[n])=>Math.asin(n.evaluate(r))],acos:[bt,[bt],(r,[n])=>Math.acos(n.evaluate(r))],atan:[bt,[bt],(r,[n])=>Math.atan(n.evaluate(r))],min:[bt,ua(bt),(r,n)=>Math.min(...n.map(o=>o.evaluate(r)))],max:[bt,ua(bt),(r,n)=>Math.max(...n.map(o=>o.evaluate(r)))],abs:[bt,[bt],(r,[n])=>Math.abs(n.evaluate(r))],round:[bt,[bt],(r,[n])=>{const o=n.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[bt,[bt],(r,[n])=>Math.floor(n.evaluate(r))],ceil:[bt,[bt],(r,[n])=>Math.ceil(n.evaluate(r))],"filter-==":[xt,[zt,Be],(r,[n,o])=>r.properties()[n.value]===o.value],"filter-id-==":[xt,[Be],(r,[n])=>r.id()===n.value],"filter-type-==":[xt,[zt],(r,[n])=>r.geometryType()===n.value],"filter-<":[xt,[zt,Be],(r,[n,o])=>{const p=r.properties()[n.value],b=o.value;return typeof p==typeof b&&p<b}],"filter-id-<":[xt,[Be],(r,[n])=>{const o=r.id(),p=n.value;return typeof o==typeof p&&o<p}],"filter->":[xt,[zt,Be],(r,[n,o])=>{const p=r.properties()[n.value],b=o.value;return typeof p==typeof b&&p>b}],"filter-id->":[xt,[Be],(r,[n])=>{const o=r.id(),p=n.value;return typeof o==typeof p&&o>p}],"filter-<=":[xt,[zt,Be],(r,[n,o])=>{const p=r.properties()[n.value],b=o.value;return typeof p==typeof b&&p<=b}],"filter-id-<=":[xt,[Be],(r,[n])=>{const o=r.id(),p=n.value;return typeof o==typeof p&&o<=p}],"filter->=":[xt,[zt,Be],(r,[n,o])=>{const p=r.properties()[n.value],b=o.value;return typeof p==typeof b&&p>=b}],"filter-id->=":[xt,[Be],(r,[n])=>{const o=r.id(),p=n.value;return typeof o==typeof p&&o>=p}],"filter-has":[xt,[Be],(r,[n])=>n.value in r.properties()],"filter-has-id":[xt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[xt,[te(zt)],(r,[n])=>n.value.indexOf(r.geometryType())>=0],"filter-id-in":[xt,[te(Be)],(r,[n])=>n.value.indexOf(r.id())>=0],"filter-in-small":[xt,[zt,te(Be)],(r,[n,o])=>o.value.indexOf(r.properties()[n.value])>=0],"filter-in-large":[xt,[zt,te(Be)],(r,[n,o])=>function(p,b,M,A){for(;M<=A;){const R=M+A>>1;if(b[R]===p)return!0;b[R]>p?A=R-1:M=R+1}return!1}(r.properties()[n.value],o.value,0,o.value.length-1)],all:{type:xt,overloads:[[[xt,xt],(r,[n,o])=>n.evaluate(r)&&o.evaluate(r)],[ua(xt),(r,n)=>{for(const o of n)if(!o.evaluate(r))return!1;return!0}]]},any:{type:xt,overloads:[[[xt,xt],(r,[n,o])=>n.evaluate(r)||o.evaluate(r)],[ua(xt),(r,n)=>{for(const o of n)if(o.evaluate(r))return!0;return!1}]]},"!":[xt,[xt],(r,[n])=>!n.evaluate(r)],"is-supported-script":[xt,[zt],(r,[n])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(n.evaluate(r))}],upcase:[zt,[zt],(r,[n])=>n.evaluate(r).toUpperCase()],downcase:[zt,[zt],(r,[n])=>n.evaluate(r).toLowerCase()],concat:[zt,ua(Be),(r,n)=>n.map(o=>si(o.evaluate(r))).join("")],"resolved-locale":[zt,[Ht],(r,[n])=>n.evaluate(r).resolvedLocale()]});class v{constructor(n,o){var p;this.expression=n,this._warningHistory={},this._evaluator=new Ir,this._defaultValue=o?(p=o).type==="color"&&cl(p.default)?new qt(0,0,0,0):p.type==="color"?qt.parse(p.default)||null:p.type==="padding"?Jn.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Yn.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,p,b,M,A){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=p,this._evaluator.canonical=b,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(n,o,p,b,M,A){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=p||null,this._evaluator.canonical=b,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=A||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function C(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ho}function B(r,n){const o=new Nr(ho,Lo,[],n?function(b){const M={color:Fn,string:zt,number:bt,enum:zt,boolean:xt,formatted:Ct,padding:It,resolvedImage:Yt,variableAnchorOffsetCollection:Se};return b.type==="array"?te(M[b.value]||Be,b.length):M[b.type]}(n):void 0),p=o.parse(r,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Ac(new v(p,n)):fo(o.errors)}class j{constructor(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!Ta(o.expression)}evaluateWithoutErrorHandling(n,o,p,b,M,A){return this._styleExpression.evaluateWithoutErrorHandling(n,o,p,b,M,A)}evaluate(n,o,p,b,M,A){return this._styleExpression.evaluate(n,o,p,b,M,A)}}class Q{constructor(n,o,p,b){this.kind=n,this.zoomStops=p,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Ta(o.expression),this.interpolationType=b}evaluateWithoutErrorHandling(n,o,p,b,M,A){return this._styleExpression.evaluateWithoutErrorHandling(n,o,p,b,M,A)}evaluate(n,o,p,b,M,A){return this._styleExpression.evaluate(n,o,p,b,M,A)}interpolationFactor(n,o,p){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,n,o,p):0}}function xe(r,n){const o=B(r,n);if(o.result==="error")return o;const p=o.value.expression,b=$s(p);if(!b&&!bs(n))return fo([new Mt("","data expressions not supported")]);const M=ko(p,["zoom"]);if(!M&&!ws(n))return fo([new Mt("","zoom expressions not supported")]);const A=je(p);return A||M?A instanceof Mt?fo([A]):A instanceof Hr&&!po(n)?fo([new Mt("",'"interpolate" expressions cannot be used with this property')]):Ac(A?new Q(b?"camera":"composite",o.value,A.labels,A instanceof Hr?A.interpolation:void 0):new j(b?"constant":"source",o.value)):fo([new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ue{constructor(n,o){this._parameters=n,this._specification=o,On(this,Ss(this._parameters,this._specification))}static deserialize(n){return new Ue(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function je(r){let n=null;if(r instanceof yi)n=je(r.result);else if(r instanceof Nl){for(const o of r.args)if(n=je(o),n)break}else(r instanceof Ro||r instanceof Hr)&&r.input instanceof xs&&r.input.name==="zoom"&&(n=r);return n instanceof Mt||r.eachChild(o=>{const p=je(o);p instanceof Mt?n=p:!n&&p?n=new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&p&&n!==p&&(n=new Mt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Et(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const n of r.slice(1))if(!Et(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Zt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Nt(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Et(r)||(r=fn(r));const n=B(r,Zt);if(n.result==="error")throw new Error(n.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,p,b)=>n.value.evaluate(o,p,{},b),needGeometry:Nn(r)}}function Rn(r,n){return r<n?-1:r>n?1:0}function Nn(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let n=1;n<r.length;n++)if(Nn(r[n]))return!0;return!1}function fn(r){if(!r)return!0;const n=r[0];return r.length<=1?n!=="any":n==="=="?Ii(r[1],r[2],"=="):n==="!="?zr(Ii(r[1],r[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ii(r[1],r[2],n):n==="any"?(o=r.slice(1),["any"].concat(o.map(fn))):n==="all"?["all"].concat(r.slice(1).map(fn)):n==="none"?["all"].concat(r.slice(1).map(fn).map(zr)):n==="in"?Bi(r[1],r.slice(2)):n==="!in"?zr(Bi(r[1],r.slice(2))):n==="has"?vr(r[1]):n!=="!has"||zr(vr(r[1]));var o}function Ii(r,n,o){switch(r){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,r,n]}}function Bi(r,n){if(n.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",r,["literal",n.sort(Rn)]]:["filter-in-small",r,["literal",n]]}}function vr(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function zr(r){return["!",r]}function Es(r){const n=typeof r;if(n==="number"||n==="boolean"||n==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let b="[";for(const M of r)b+=`${Es(M)},`;return`${b}]`}const o=Object.keys(r).sort();let p="{";for(let b=0;b<o.length;b++)p+=`${JSON.stringify(o[b])}:${Es(r[o[b]])},`;return`${p}}`}function Xs(r){let n="";for(const o of hi)n+=`/${Es(r[o])}`;return n}function js(r){const n=r.value;return n?[new $e(r.key,n,"constants have been deprecated as of v8")]:[]}function mi(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function cs(r){if(Array.isArray(r))return r.map(cs);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const n={};for(const o in r)n[o]=cs(r[o]);return n}return mi(r)}function Sr(r){const n=r.key,o=r.value,p=r.valueSpec||{},b=r.objectElementValidators||{},M=r.style,A=r.styleSpec,R=r.validateSpec;let O=[];const U=ci(o);if(U!=="object")return[new $e(n,o,`object expected, ${U} found`)];for(const W in o){const Y=W.split(".")[0],ee=p[Y]||p["*"];let ae;if(b[Y])ae=b[Y];else if(p[Y])ae=R;else if(b["*"])ae=b["*"];else{if(!p["*"]){O.push(new $e(n,o[W],`unknown property "${W}"`));continue}ae=R}O=O.concat(ae({key:(n&&`${n}.`)+W,value:o[W],valueSpec:ee,style:M,styleSpec:A,object:o,objectKey:W,validateSpec:R},o))}for(const W in p)b[W]||p[W].required&&p[W].default===void 0&&o[W]===void 0&&O.push(new $e(n,o,`missing required property "${W}"`));return O}function Wa(r){const n=r.value,o=r.valueSpec,p=r.style,b=r.styleSpec,M=r.key,A=r.arrayElementValidator||r.validateSpec;if(ci(n)!=="array")return[new $e(M,n,`array expected, ${ci(n)} found`)];if(o.length&&n.length!==o.length)return[new $e(M,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new $e(M,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let R={type:o.value,values:o.values};b.$version<7&&(R.function=o.function),ci(o.value)==="object"&&(R=o.value);let O=[];for(let U=0;U<n.length;U++)O=O.concat(A({array:n,arrayIndex:U,value:n[U],valueSpec:R,validateSpec:r.validateSpec,style:p,styleSpec:b,key:`${M}[${U}]`}));return O}function mo(r){const n=r.key,o=r.value,p=r.valueSpec;let b=ci(o);return b==="number"&&o!=o&&(b="NaN"),b!=="number"?[new $e(n,o,`number expected, ${b} found`)]:"minimum"in p&&o<p.minimum?[new $e(n,o,`${o} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&o>p.maximum?[new $e(n,o,`${o} is greater than the maximum value ${p.maximum}`)]:[]}function Do(r){const n=r.valueSpec,o=mi(r.value.type);let p,b,M,A={};const R=o!=="categorical"&&r.value.property===void 0,O=!R,U=ci(r.value.stops)==="array"&&ci(r.value.stops[0])==="array"&&ci(r.value.stops[0][0])==="object",W=Sr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(ae){if(o==="identity")return[new $e(ae.key,ae.value,'identity function may not have a "stops" property')];let he=[];const _e=ae.value;return he=he.concat(Wa({key:ae.key,value:_e,valueSpec:ae.valueSpec,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:Y})),ci(_e)==="array"&&_e.length===0&&he.push(new $e(ae.key,_e,"array must have at least one stop")),he},default:function(ae){return ae.validateSpec({key:ae.key,value:ae.value,valueSpec:n,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec})}}});return o==="identity"&&R&&W.push(new $e(r.key,r.value,'missing required property "property"')),o==="identity"||r.value.stops||W.push(new $e(r.key,r.value,'missing required property "stops"')),o==="exponential"&&r.valueSpec.expression&&!po(r.valueSpec)&&W.push(new $e(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(O&&!bs(r.valueSpec)?W.push(new $e(r.key,r.value,"property functions not supported")):R&&!ws(r.valueSpec)&&W.push(new $e(r.key,r.value,"zoom functions not supported"))),o!=="categorical"&&!U||r.value.property!==void 0||W.push(new $e(r.key,r.value,'"property" property is required')),W;function Y(ae){let he=[];const _e=ae.value,Ce=ae.key;if(ci(_e)!=="array")return[new $e(Ce,_e,`array expected, ${ci(_e)} found`)];if(_e.length!==2)return[new $e(Ce,_e,`array length 2 expected, length ${_e.length} found`)];if(U){if(ci(_e[0])!=="object")return[new $e(Ce,_e,`object expected, ${ci(_e[0])} found`)];if(_e[0].zoom===void 0)return[new $e(Ce,_e,"object stop key must have zoom")];if(_e[0].value===void 0)return[new $e(Ce,_e,"object stop key must have value")];if(M&&M>mi(_e[0].zoom))return[new $e(Ce,_e[0].zoom,"stop zoom values must appear in ascending order")];mi(_e[0].zoom)!==M&&(M=mi(_e[0].zoom),b=void 0,A={}),he=he.concat(Sr({key:`${Ce}[0]`,value:_e[0],valueSpec:{zoom:{}},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:mo,value:ee}}))}else he=he.concat(ee({key:`${Ce}[0]`,value:_e[0],valueSpec:{},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec},_e));return C(cs(_e[1]))?he.concat([new $e(`${Ce}[1]`,_e[1],"expressions are not allowed in function stops.")]):he.concat(ae.validateSpec({key:`${Ce}[1]`,value:_e[1],valueSpec:n,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec}))}function ee(ae,he){const _e=ci(ae.value),Ce=mi(ae.value),Ne=ae.value!==null?ae.value:he;if(p){if(_e!==p)return[new $e(ae.key,Ne,`${_e} stop domain type must match previous stop domain type ${p}`)]}else p=_e;if(_e!=="number"&&_e!=="string"&&_e!=="boolean")return[new $e(ae.key,Ne,"stop domain value must be a number, string, or boolean")];if(_e!=="number"&&o!=="categorical"){let nt=`number expected, ${_e} found`;return bs(n)&&o===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(ae.key,Ne,nt)]}return o!=="categorical"||_e!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?o!=="categorical"&&_e==="number"&&b!==void 0&&Ce<b?[new $e(ae.key,Ne,"stop domain values must appear in ascending order")]:(b=Ce,o==="categorical"&&Ce in A?[new $e(ae.key,Ne,"stop domain values must be unique")]:(A[Ce]=!0,[])):[new $e(ae.key,Ne,`integer expected, found ${Ce}`)]}}function ks(r){const n=(r.expressionContext==="property"?xe:B)(cs(r.value),r.valueSpec);if(n.result==="error")return n.value.map(p=>new $e(`${r.key}${p.key}`,r.value,p.message));const o=n.value.expression||n.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!o.outputDefined())return[new $e(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ta(o))return[new $e(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ta(o))return[new $e(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ko(o,["zoom","feature-state"]))return[new $e(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!$s(o))return[new $e(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $l(r){const n=r.key,o=r.value,p=r.valueSpec,b=[];return Array.isArray(p.values)?p.values.indexOf(mi(o))===-1&&b.push(new $e(n,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(mi(o))===-1&&b.push(new $e(n,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),b}function go(r){return Et(cs(r.value))?ks(On({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ma(r)}function Ma(r){const n=r.value,o=r.key;if(ci(n)!=="array")return[new $e(o,n,`array expected, ${ci(n)} found`)];const p=r.styleSpec;let b,M=[];if(n.length<1)return[new $e(o,n,"filter array must have at least 1 element")];switch(M=M.concat($l({key:`${o}[0]`,value:n[0],valueSpec:p.filter_operator,style:r.style,styleSpec:r.styleSpec})),mi(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&mi(n[1])==="$type"&&M.push(new $e(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&M.push(new $e(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(b=ci(n[1]),b!=="string"&&M.push(new $e(`${o}[1]`,n[1],`string expected, ${b} found`)));for(let A=2;A<n.length;A++)b=ci(n[A]),mi(n[1])==="$type"?M=M.concat($l({key:`${o}[${A}]`,value:n[A],valueSpec:p.geometry_type,style:r.style,styleSpec:r.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new $e(`${o}[${A}]`,n[A],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let A=1;A<n.length;A++)M=M.concat(Ma({key:`${o}[${A}]`,value:n[A],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":b=ci(n[1]),n.length!==2?M.push(new $e(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):b!=="string"&&M.push(new $e(`${o}[1]`,n[1],`string expected, ${b} found`))}return M}function Xl(r,n){const o=r.key,p=r.validateSpec,b=r.style,M=r.styleSpec,A=r.value,R=r.objectKey,O=M[`${n}_${r.layerType}`];if(!O)return[];const U=R.match(/^(.*)-transition$/);if(n==="paint"&&U&&O[U[1]]&&O[U[1]].transition)return p({key:o,value:A,valueSpec:M.transition,style:b,styleSpec:M});const W=r.valueSpec||O[R];if(!W)return[new $e(o,A,`unknown property "${R}"`)];let Y;if(ci(A)==="string"&&bs(W)&&!W.tokens&&(Y=/^{([^}]+)}$/.exec(A)))return[new $e(o,A,`"${R}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const ee=[];return r.layerType==="symbol"&&(R==="text-field"&&b&&!b.glyphs&&ee.push(new $e(o,A,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&cl(cs(A))&&mi(A.type)==="identity"&&ee.push(new $e(o,A,'"text-font" does not support identity functions'))),ee.concat(p({key:r.key,value:A,valueSpec:W,style:b,styleSpec:M,expressionContext:"property",propertyType:n,propertyKey:R}))}function Sh(r){return Xl(r,"paint")}function Eh(r){return Xl(r,"layout")}function Th(r){let n=[];const o=r.value,p=r.key,b=r.style,M=r.styleSpec;o.type||o.ref||n.push(new $e(p,o,'either "type" or "ref" is required'));let A=mi(o.type);const R=mi(o.ref);if(o.id){const O=mi(o.id);for(let U=0;U<r.arrayIndex;U++){const W=b.layers[U];mi(W.id)===O&&n.push(new $e(p,o.id,`duplicate layer id "${o.id}", previously used at line ${W.id.__line__}`))}}if("ref"in o){let O;["type","source","source-layer","filter","layout"].forEach(U=>{U in o&&n.push(new $e(p,o[U],`"${U}" is prohibited for ref layers`))}),b.layers.forEach(U=>{mi(U.id)===R&&(O=U)}),O?O.ref?n.push(new $e(p,o.ref,"ref cannot reference another ref layer")):A=mi(O.type):n.push(new $e(p,o.ref,`ref layer "${R}" not found`))}else if(A!=="background")if(o.source){const O=b.sources&&b.sources[o.source],U=O&&mi(O.type);O?U==="vector"&&A==="raster"?n.push(new $e(p,o.source,`layer "${o.id}" requires a raster source`)):U!=="raster-dem"&&A==="hillshade"?n.push(new $e(p,o.source,`layer "${o.id}" requires a raster-dem source`)):U==="raster"&&A!=="raster"?n.push(new $e(p,o.source,`layer "${o.id}" requires a vector source`)):U!=="vector"||o["source-layer"]?U==="raster-dem"&&A!=="hillshade"?n.push(new $e(p,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!o.paint||!o.paint["line-gradient"]||U==="geojson"&&O.lineMetrics||n.push(new $e(p,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new $e(p,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new $e(p,o.source,`source "${o.source}" not found`))}else n.push(new $e(p,o,'missing required property "source"'));return n=n.concat(Sr({key:p,value:o,valueSpec:M.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${p}.type`,value:o.type,valueSpec:M.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:o,objectKey:"type"}),filter:go,layout:O=>Sr({layer:o,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":U=>Eh(On({layerType:A},U))}}),paint:O=>Sr({layer:o,key:O.key,value:O.value,style:O.style,styleSpec:O.styleSpec,validateSpec:O.validateSpec,objectElementValidators:{"*":U=>Sh(On({layerType:A},U))}})}})),n}function ca(r){const n=r.value,o=r.key,p=ci(n);return p!=="string"?[new $e(o,n,`string expected, ${p} found`)]:[]}const jl={promoteId:function({key:r,value:n}){if(ci(n)==="string")return ca({key:r,value:n});{const o=[];for(const p in n)o.push(...ca({key:`${r}.${p}`,value:n[p]}));return o}}};function Ic(r){const n=r.value,o=r.key,p=r.styleSpec,b=r.style,M=r.validateSpec;if(!n.type)return[new $e(o,n,'"type" is required')];const A=mi(n.type);let R;switch(A){case"vector":case"raster":return R=Sr({key:o,value:n,valueSpec:p[`source_${A.replace("-","_")}`],style:r.style,styleSpec:p,objectElementValidators:jl,validateSpec:M}),R;case"raster-dem":return R=function(O){var U;const W=(U=O.sourceName)!==null&&U!==void 0?U:"",Y=O.value,ee=O.styleSpec,ae=ee.source_raster_dem,he=O.style;let _e=[];const Ce=ci(Y);if(Y===void 0)return _e;if(Ce!=="object")return _e.push(new $e("source_raster_dem",Y,`object expected, ${Ce} found`)),_e;const Ne=mi(Y.encoding)==="custom",nt=["redFactor","greenFactor","blueFactor","baseShift"],ke=O.value.encoding?`"${O.value.encoding}"`:"Default";for(const tt in Y)!Ne&&nt.includes(tt)?_e.push(new $e(tt,Y[tt],`In "${W}": "${tt}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):ae[tt]?_e=_e.concat(O.validateSpec({key:tt,value:Y[tt],valueSpec:ae[tt],validateSpec:O.validateSpec,style:he,styleSpec:ee})):_e.push(new $e(tt,Y[tt],`unknown property "${tt}"`));return _e}({sourceName:o,value:n,style:r.style,styleSpec:p,validateSpec:M}),R;case"geojson":if(R=Sr({key:o,value:n,valueSpec:p.source_geojson,style:b,styleSpec:p,validateSpec:M,objectElementValidators:jl}),n.cluster)for(const O in n.clusterProperties){const[U,W]=n.clusterProperties[O],Y=typeof U=="string"?[U,["accumulated"],["get",O]]:U;R.push(...ks({key:`${o}.${O}.map`,value:W,validateSpec:M,expressionContext:"cluster-map"})),R.push(...ks({key:`${o}.${O}.reduce`,value:Y,validateSpec:M,expressionContext:"cluster-reduce"}))}return R;case"video":return Sr({key:o,value:n,valueSpec:p.source_video,style:b,validateSpec:M,styleSpec:p});case"image":return Sr({key:o,value:n,valueSpec:p.source_image,style:b,validateSpec:M,styleSpec:p});case"canvas":return[new $e(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $l({key:`${o}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:M,styleSpec:p})}}function Mh(r){const n=r.value,o=r.styleSpec,p=o.light,b=r.style;let M=[];const A=ci(n);if(n===void 0)return M;if(A!=="object")return M=M.concat([new $e("light",n,`object expected, ${A} found`)]),M;for(const R in n){const O=R.match(/^(.*)-transition$/);M=M.concat(O&&p[O[1]]&&p[O[1]].transition?r.validateSpec({key:R,value:n[R],valueSpec:o.transition,validateSpec:r.validateSpec,style:b,styleSpec:o}):p[R]?r.validateSpec({key:R,value:n[R],valueSpec:p[R],validateSpec:r.validateSpec,style:b,styleSpec:o}):[new $e(R,n[R],`unknown property "${R}"`)])}return M}function Ah(r){const n=r.value,o=r.styleSpec,p=o.sky,b=r.style,M=ci(n);if(n===void 0)return[];if(M!=="object")return[new $e("sky",n,`object expected, ${M} found`)];let A=[];for(const R in n)A=A.concat(p[R]?r.validateSpec({key:R,value:n[R],valueSpec:p[R],style:b,styleSpec:o}):[new $e(R,n[R],`unknown property "${R}"`)]);return A}function Ih(r){const n=r.value,o=r.styleSpec,p=o.terrain,b=r.style;let M=[];const A=ci(n);if(n===void 0)return M;if(A!=="object")return M=M.concat([new $e("terrain",n,`object expected, ${A} found`)]),M;for(const R in n)M=M.concat(p[R]?r.validateSpec({key:R,value:n[R],valueSpec:p[R],validateSpec:r.validateSpec,style:b,styleSpec:o}):[new $e(R,n[R],`unknown property "${R}"`)]);return M}function Ch(r){let n=[];const o=r.value,p=r.key;if(Array.isArray(o)){const b=[],M=[];for(const A in o)o[A].id&&b.includes(o[A].id)&&n.push(new $e(p,o,`all the sprites' ids must be unique, but ${o[A].id} is duplicated`)),b.push(o[A].id),o[A].url&&M.includes(o[A].url)&&n.push(new $e(p,o,`all the sprites' URLs must be unique, but ${o[A].url} is duplicated`)),M.push(o[A].url),n=n.concat(Sr({key:`${p}[${A}]`,value:o[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return n}return ca({key:p,value:o})}const Pr={"*":()=>[],array:Wa,boolean:function(r){const n=r.value,o=r.key,p=ci(n);return p!=="boolean"?[new $e(o,n,`boolean expected, ${p} found`)]:[]},number:mo,color:function(r){const n=r.key,o=r.value,p=ci(o);return p!=="string"?[new $e(n,o,`color expected, ${p} found`)]:qt.parse(String(o))?[]:[new $e(n,o,`color expected, "${o}" found`)]},constants:js,enum:$l,filter:go,function:Do,layer:Th,object:Sr,source:Ic,light:Mh,sky:Ah,terrain:Ih,projection:function(r){const n=r.value,o=r.styleSpec,p=o.projection,b=r.style,M=ci(n);if(n===void 0)return[];if(M!=="object")return[new $e("projection",n,`object expected, ${M} found`)];let A=[];for(const R in n)A=A.concat(p[R]?r.validateSpec({key:R,value:n[R],valueSpec:p[R],style:b,styleSpec:o}):[new $e(R,n[R],`unknown property "${R}"`)]);return A},string:ca,formatted:function(r){return ca(r).length===0?[]:ks(r)},resolvedImage:function(r){return ca(r).length===0?[]:ks(r)},padding:function(r){const n=r.key,o=r.value;if(ci(o)==="array"){if(o.length<1||o.length>4)return[new $e(n,o,`padding requires 1 to 4 values; ${o.length} values found`)];const p={type:"number"};let b=[];for(let M=0;M<o.length;M++)b=b.concat(r.validateSpec({key:`${n}[${M}]`,value:o[M],validateSpec:r.validateSpec,valueSpec:p}));return b}return mo({key:n,value:o,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const n=r.key,o=r.value,p=ci(o),b=r.styleSpec;if(p!=="array"||o.length<1||o.length%2!=0)return[new $e(n,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let M=[];for(let A=0;A<o.length;A+=2)M=M.concat($l({key:`${n}[${A}]`,value:o[A],valueSpec:b.layout_symbol["text-anchor"]})),M=M.concat(Wa({key:`${n}[${A+1}]`,value:o[A+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:b}));return M},sprite:Ch};function Br(r){const n=r.value,o=r.valueSpec,p=r.styleSpec;return r.validateSpec=Br,o.expression&&cl(mi(n))?Do(r):o.expression&&C(cs(n))?ks(r):o.type&&Pr[o.type]?Pr[o.type](r):Sr(On({},r,{valueSpec:o.type?p[o.type]:o}))}function Sf(r){const n=r.value,o=r.key,p=ca(r);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new $e(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new $e(o,n,'"glyphs" url must include a "{range}" token'))),p}function ha(r,n=Ze){let o=[];return o=o.concat(Br({key:"",value:r,valueSpec:n.$root,styleSpec:n,style:r,validateSpec:Br,objectElementValidators:{glyphs:Sf,"*":()=>[]}})),r.constants&&(o=o.concat(js({key:"constants",value:r.constants,style:r,styleSpec:n,validateSpec:Br}))),Rh(o)}function fa(r){return function(n){return r({...n,validateSpec:Br})}}function Rh(r){return[].concat(r).sort((n,o)=>n.line-o.line)}function Zs(r){return function(...n){return Rh(r.apply(this,n))}}ha.source=Zs(fa(Ic)),ha.sprite=Zs(fa(Ch)),ha.glyphs=Zs(fa(Sf)),ha.light=Zs(fa(Mh)),ha.sky=Zs(fa(Ah)),ha.terrain=Zs(fa(Ih)),ha.layer=Zs(fa(Th)),ha.filter=Zs(fa(go)),ha.paintProperty=Zs(fa(Sh)),ha.layoutProperty=Zs(fa(Eh));const Ys=ha,Ph=Ys.light,No=Ys.sky,Wu=Ys.paintProperty,qu=Ys.layoutProperty;function Zl(r,n){let o=!1;if(n&&n.length)for(const p of n)r.fire(new Gn(new Error(p.message))),o=!0;return o}class Aa{constructor(n,o,p){const b=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const A=new Int32Array(this.arrayBuffer);n=A[0],this.d=(o=A[1])+2*(p=A[2]);for(let O=0;O<this.d*this.d;O++){const U=A[3+O],W=A[3+O+1];b.push(U===W?null:A.subarray(U,W))}const R=A[3+b.length+1];this.keys=A.subarray(A[3+b.length],R),this.bboxes=A.subarray(R),this.insert=this._insertReadonly}else{this.d=o+2*p;for(let A=0;A<this.d*this.d;A++)b.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=p,this.scale=o/n,this.uid=0;const M=p/o*n;this.min=-M,this.max=n+M}insert(n,o,p,b,M){this._forEachCell(o,p,b,M,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(M)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,o,p,b,M,A){this.cells[M].push(A)}query(n,o,p,b,M){const A=this.min,R=this.max;if(n<=A&&o<=A&&R<=p&&R<=b&&!M)return Array.prototype.slice.call(this.keys);{const O=[];return this._forEachCell(n,o,p,b,this._queryCell,O,{},M),O}}_queryCell(n,o,p,b,M,A,R,O){const U=this.cells[M];if(U!==null){const W=this.keys,Y=this.bboxes;for(let ee=0;ee<U.length;ee++){const ae=U[ee];if(R[ae]===void 0){const he=4*ae;(O?O(Y[he+0],Y[he+1],Y[he+2],Y[he+3]):n<=Y[he+2]&&o<=Y[he+3]&&p>=Y[he+0]&&b>=Y[he+1])?(R[ae]=!0,A.push(W[ae])):R[ae]=!1}}}}_forEachCell(n,o,p,b,M,A,R,O){const U=this._convertToCellCoord(n),W=this._convertToCellCoord(o),Y=this._convertToCellCoord(p),ee=this._convertToCellCoord(b);for(let ae=U;ae<=Y;ae++)for(let he=W;he<=ee;he++){const _e=this.d*he+ae;if((!O||O(this._convertFromCellCoord(ae),this._convertFromCellCoord(he),this._convertFromCellCoord(ae+1),this._convertFromCellCoord(he+1)))&&M.call(this,n,o,p,b,_e,A,R,O))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,o=3+this.cells.length+1+1;let p=0;for(let A=0;A<this.cells.length;A++)p+=this.cells[A].length;const b=new Int32Array(o+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let M=o;for(let A=0;A<n.length;A++){const R=n[A];b[3+A]=M,b.set(R,M),M+=R.length}return b[3+n.length]=M,b.set(this.keys,M),M+=this.keys.length,b[3+n.length+1]=M,b.set(this.bboxes,M),M+=this.bboxes.length,b.buffer}static serialize(n,o){const p=n.toArrayBuffer();return o&&o.push(p),{buffer:p}}static deserialize(n){return new Aa(n.buffer)}}const qa={};function pn(r,n,o={}){if(qa[r])throw new Error(`${r} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:r,writeable:!1}),qa[r]={klass:n,omit:o.omit||[],shallow:o.shallow||[]}}pn("Object",Object),pn("TransferableGridIndex",Aa),pn("Color",qt),pn("Error",Error),pn("AJAXError",cn),pn("ResolvedImage",bi),pn("StylePropertyFunction",Ue),pn("StyleExpression",v,{omit:["_evaluator"]}),pn("ZoomDependentExpression",Q),pn("ZoomConstantExpression",j),pn("CompoundExpression",xs,{omit:["_evaluate"]});for(const r in ho)ho[r]._classRegistryKey||pn(`Expression_${r}`,ho[r]);function Ef(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Lh(r){return r.$name||r.constructor._classRegistryKey}function Tf(r){return!function(n){if(n===null||typeof n!="object")return!1;const o=Lh(n);return!(!o||o==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Ef(r)||wt(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Oo(r,n){if(Tf(r))return(Ef(r)||wt(r))&&n&&n.push(r),ArrayBuffer.isView(r)&&n&&n.push(r.buffer),r instanceof ImageData&&n&&n.push(r.data.buffer),r;if(Array.isArray(r)){const M=[];for(const A of r)M.push(Oo(A,n));return M}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const o=Lh(r);if(!o)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!qa[o])throw new Error(`${o} is not registered.`);const{klass:p}=qa[o],b=p.serialize?p.serialize(r,n):{};if(p.serialize){if(n&&b===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const M in r){if(!r.hasOwnProperty(M)||qa[o].omit.indexOf(M)>=0)continue;const A=r[M];b[M]=qa[o].shallow.indexOf(M)>=0?A:Oo(A,n)}r instanceof Error&&(b.message=r.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(b.$name=o),b}function Ds(r){if(Tf(r))return r;if(Array.isArray(r))return r.map(Ds);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const n=Lh(r)||"Object";if(!qa[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:o}=qa[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(r);const p=Object.create(o.prototype);for(const b of Object.keys(r)){if(b==="$name")continue;const M=r[b];p[b]=qa[n].shallow.indexOf(b)>=0?M:Ds(M)}return p}class kh{constructor(){this.first=!0}update(n,o){const p=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=p,!0))}}const se={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Fo(r){for(const n of r)if(vi(n.charCodeAt(0)))return!0;return!1}function Cc(r){for(const n of r)if(!Ks(n.charCodeAt(0)))return!1;return!0}function Ks(r){return!(se.Arabic(r)||se["Arabic Supplement"](r)||se["Arabic Extended-A"](r)||se["Arabic Presentation Forms-A"](r)||se["Arabic Presentation Forms-B"](r))}function vi(r){return!(r!==746&&r!==747&&(r<4352||!(se["Bopomofo Extended"](r)||se.Bopomofo(r)||se["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||se["CJK Compatibility Ideographs"](r)||se["CJK Compatibility"](r)||se["CJK Radicals Supplement"](r)||se["CJK Strokes"](r)||!(!se["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||se["CJK Unified Ideographs Extension A"](r)||se["CJK Unified Ideographs"](r)||se["Enclosed CJK Letters and Months"](r)||se["Hangul Compatibility Jamo"](r)||se["Hangul Jamo Extended-A"](r)||se["Hangul Jamo Extended-B"](r)||se["Hangul Jamo"](r)||se["Hangul Syllables"](r)||se.Hiragana(r)||se["Ideographic Description Characters"](r)||se.Kanbun(r)||se["Kangxi Radicals"](r)||se["Katakana Phonetic Extensions"](r)||se.Katakana(r)&&r!==12540||!(!se["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!se["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||se["Unified Canadian Aboriginal Syllabics"](r)||se["Unified Canadian Aboriginal Syllabics Extended"](r)||se["Vertical Forms"](r)||se["Yijing Hexagram Symbols"](r)||se["Yi Syllables"](r)||se["Yi Radicals"](r))))}function Mf(r){return!(vi(r)||function(n){return!!(se["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||se["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||se["Letterlike Symbols"](n)||se["Number Forms"](n)||se["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||se["Control Pictures"](n)&&n!==9251||se["Optical Character Recognition"](n)||se["Enclosed Alphanumerics"](n)||se["Geometric Shapes"](n)||se["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||se["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||se["CJK Symbols and Punctuation"](n)||se.Katakana(n)||se["Private Use Area"](n)||se["CJK Compatibility Forms"](n)||se["Small Form Variants"](n)||se["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(r))}function zo(r){return r>=1424&&r<=2303||se["Arabic Presentation Forms-A"](r)||se["Arabic Presentation Forms-B"](r)}function Af(r,n){return!(!n&&zo(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||se.Khmer(r))}function _o(r){for(const n of r)if(zo(n.charCodeAt(0)))return!0;return!1}const Bo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class nr{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kh,this.transition={})}isSupportedScript(n){return function(o,p){for(const b of o)if(!Af(b.charCodeAt(0),p))return!1;return!0}(n,Bo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,o=n-Math.floor(n),p=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*o}}}class Rc{constructor(n,o){this.property=n,this.value=o,this.expression=function(p,b){if(cl(p))return new Ue(p,b);if(C(p)){const M=xe(p,b);if(M.result==="error")throw new Error(M.value.map(A=>`${A.key}: ${A.message}`).join(", "));return M.value}{let M=p;return b.type==="color"&&typeof p=="string"?M=qt.parse(p):b.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(M=Yn.parse(p)):M=Jn.parse(p),{kind:"constant",evaluate:()=>M}}}(o===void 0?n.specification.default:o,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,p){return this.property.possiblyEvaluate(this,n,o,p)}}class Yl{constructor(n){this.property=n,this.value=new Rc(n,void 0)}transitioned(n,o){return new $a(this.property,this.value,o,Te({},n.transition,this.transition),n.now)}untransitioned(){return new $a(this.property,this.value,null,{},0)}}class Kl{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Oe(this._values[n].value.value)}setValue(n,o){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Yl(this._values[n].property)),this._values[n].value=new Rc(this._values[n].property,o===null?void 0:Oe(o))}getTransition(n){return Oe(this._values[n].transition)}setTransition(n,o){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Yl(this._values[n].property)),this._values[n].transition=Oe(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(n[o]=p);const b=this.getTransition(o);b!==void 0&&(n[`${o}-transition`]=b)}return n}transitioned(n,o){const p=new Dh(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].transitioned(n,o._values[b]);return p}untransitioned(){const n=new Dh(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class $a{constructor(n,o,p,b,M){this.property=n,this.value=o,this.begin=M+b.delay||0,this.end=this.begin+b.duration||0,n.specification.transition&&(b.delay||b.duration)&&(this.prior=p)}possiblyEvaluate(n,o,p){const b=n.now||0,M=this.value.possiblyEvaluate(n,o,p),A=this.prior;if(A){if(b>this.end)return this.prior=null,M;if(this.value.isDataDriven())return this.prior=null,M;if(b<this.begin)return A.possiblyEvaluate(n,o,p);{const R=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(n,o,p),M,function(O){if(O<=0)return 0;if(O>=1)return 1;const U=O*O,W=U*O;return 4*(O<.5?W:3*(O-U)+W-.75)}(R))}}return M}}class Dh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,p){const b=new Pc(this._properties);for(const M of Object.keys(this._values))b._values[M]=this._values[M].possiblyEvaluate(n,o,p);return b}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class $u{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return Oe(this._values[n].value)}setValue(n,o){this._values[n]=new Rc(this._values[n].property,o===null?void 0:Oe(o))}serialize(){const n={};for(const o of Object.keys(this._values)){const p=this.getValue(o);p!==void 0&&(n[o]=p)}return n}possiblyEvaluate(n,o,p){const b=new Pc(this._properties);for(const M of Object.keys(this._values))b._values[M]=this._values[M].possiblyEvaluate(n,o,p);return b}}class Xa{constructor(n,o,p){this.property=n,this.value=o,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,p,b){return this.property.evaluate(this.value,this.parameters,n,o,p,b)}}class Pc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class In{constructor(n){this.specification=n}possiblyEvaluate(n,o){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(o)}interpolate(n,o,p){const b=sr[this.specification.type];return b?b(n,o,p):n}}class Pn{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,p,b){return new Xa(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},p,b)}:n.expression,o)}interpolate(n,o,p){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Xa(this,{kind:"constant",value:void 0},n.parameters);const b=sr[this.specification.type];if(b){const M=b(n.value.value,o.value.value,p);return new Xa(this,{kind:"constant",value:M},n.parameters)}return n}evaluate(n,o,p,b,M,A){return n.kind==="constant"?n.value:n.evaluate(o,p,b,M,A)}}class T extends Pn{possiblyEvaluate(n,o,p,b){if(n.value===void 0)return new Xa(this,{kind:"constant",value:void 0},o);if(n.expression.kind==="constant"){const M=n.expression.evaluate(o,null,{},p,b),A=n.property.specification.type==="resolvedImage"&&typeof M!="string"?M.name:M,R=this._calculate(A,A,A,o);return new Xa(this,{kind:"constant",value:R},o)}if(n.expression.kind==="camera"){const M=this._calculate(n.expression.evaluate({zoom:o.zoom-1}),n.expression.evaluate({zoom:o.zoom}),n.expression.evaluate({zoom:o.zoom+1}),o);return new Xa(this,{kind:"constant",value:M},o)}return new Xa(this,n.expression,o)}evaluate(n,o,p,b,M,A){if(n.kind==="source"){const R=n.evaluate(o,p,b,M,A);return this._calculate(R,R,R,o)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(o.zoom)-1},p,b),n.evaluate({zoom:Math.floor(o.zoom)},p,b),n.evaluate({zoom:Math.floor(o.zoom)+1},p,b),o):n.value}_calculate(n,o,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:p,to:o}}interpolate(n){return n}}class i{constructor(n){this.specification=n}possiblyEvaluate(n,o,p,b){if(n.value!==void 0){if(n.expression.kind==="constant"){const M=n.expression.evaluate(o,null,{},p,b);return this._calculate(M,M,M,o)}return this._calculate(n.expression.evaluate(new nr(Math.floor(o.zoom-1),o)),n.expression.evaluate(new nr(Math.floor(o.zoom),o)),n.expression.evaluate(new nr(Math.floor(o.zoom+1),o)),o)}}_calculate(n,o,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:p,to:o}}interpolate(n){return n}}class h{constructor(n){this.specification=n}possiblyEvaluate(n,o,p,b){return!!n.expression.evaluate(o,null,{},p,b)}interpolate(){return!1}}class y{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in n){const p=n[o];p.specification.overridable&&this.overridableProperties.push(o);const b=this.defaultPropertyValues[o]=new Rc(p,void 0),M=this.defaultTransitionablePropertyValues[o]=new Yl(p);this.defaultTransitioningPropertyValues[o]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=b.possiblyEvaluate({})}}}pn("DataDrivenProperty",Pn),pn("DataConstantProperty",In),pn("CrossFadedDataDrivenProperty",T),pn("CrossFadedProperty",i),pn("ColorRampProperty",h);const x="-transition";class E extends Kn{constructor(n,o){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),o.layout&&(this._unevaluatedLayout=new $u(o.layout)),o.paint)){this._transitionablePaint=new Kl(o.paint);for(const p in n.paint)this.setPaintProperty(p,n.paint[p],{validate:!1});for(const p in n.layout)this.setLayoutProperty(p,n.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pc(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o,p={}){o!=null&&this._validate(qu,`layers.${this.id}.layout.${n}`,n,o,p)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,o):this.visibility=o)}getPaintProperty(n){return n.endsWith(x)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,p={}){if(o!=null&&this._validate(Wu,`layers.${this.id}.paint.${n}`,n,o,p))return!1;if(n.endsWith(x))return this._transitionablePaint.setTransition(n.slice(0,-11),o||void 0),!1;{const b=this._transitionablePaint._values[n],M=b.property.specification["property-type"]==="cross-faded-data-driven",A=b.value.isDataDriven(),R=b.value;this._transitionablePaint.setValue(n,o),this._handleSpecialPaintPropertyUpdate(n);const O=this._transitionablePaint._values[n].value;return O.isDataDriven()||A||M||this._handleOverridablePaintPropertyUpdate(n,R,O)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,o,p){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),be(n,(o,p)=>!(o===void 0||p==="layout"&&!Object.keys(o).length||p==="paint"&&!Object.keys(o).length))}_validate(n,o,p,b,M={}){return(!M||M.validate!==!1)&&Zl(this,n.call(Ys,{key:o,layerType:this.type,objectKey:p,value:b,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof Xa&&bs(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const k={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class z{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class V{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function H(r,n=1){let o=0,p=0;return{members:r.map(b=>{const M=k[b.type].BYTES_PER_ELEMENT,A=o=J(o,Math.max(n,M)),R=b.components||1;return p=Math.max(p,M),o+=M*R,{name:b.name,type:b.type,components:R,offset:A}}),size:J(o,Math.max(p,n)),alignment:n}}function J(r,n){return Math.ceil(r/n)*n}class K extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const p=this.length;return this.resize(p+1),this.emplace(p,n,o)}emplace(n,o,p){const b=2*n;return this.int16[b+0]=o,this.int16[b+1]=p,n}}K.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",K);class ue extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,p)}emplace(n,o,p,b){const M=3*n;return this.int16[M+0]=o,this.int16[M+1]=p,this.int16[M+2]=b,n}}ue.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",ue);class ge extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b){const M=this.length;return this.resize(M+1),this.emplace(M,n,o,p,b)}emplace(n,o,p,b,M){const A=4*n;return this.int16[A+0]=o,this.int16[A+1]=p,this.int16[A+2]=b,this.int16[A+3]=M,n}}ge.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",ge);class Ee extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,o,p,b,M,A)}emplace(n,o,p,b,M,A,R){const O=6*n;return this.int16[O+0]=o,this.int16[O+1]=p,this.int16[O+2]=b,this.int16[O+3]=M,this.int16[O+4]=A,this.int16[O+5]=R,n}}Ee.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",Ee);class Re extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,o,p,b,M,A)}emplace(n,o,p,b,M,A,R){const O=4*n,U=8*n;return this.int16[O+0]=o,this.int16[O+1]=p,this.uint8[U+4]=b,this.uint8[U+5]=M,this.uint8[U+6]=A,this.uint8[U+7]=R,n}}Re.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",Re);class Ie extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const p=this.length;return this.resize(p+1),this.emplace(p,n,o)}emplace(n,o,p){const b=2*n;return this.float32[b+0]=o,this.float32[b+1]=p,n}}Ie.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",Ie);class De extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A,R,O,U,W){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,o,p,b,M,A,R,O,U,W)}emplace(n,o,p,b,M,A,R,O,U,W,Y){const ee=10*n;return this.uint16[ee+0]=o,this.uint16[ee+1]=p,this.uint16[ee+2]=b,this.uint16[ee+3]=M,this.uint16[ee+4]=A,this.uint16[ee+5]=R,this.uint16[ee+6]=O,this.uint16[ee+7]=U,this.uint16[ee+8]=W,this.uint16[ee+9]=Y,n}}De.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",De);class He extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A,R,O,U,W,Y,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,n,o,p,b,M,A,R,O,U,W,Y,ee)}emplace(n,o,p,b,M,A,R,O,U,W,Y,ee,ae){const he=12*n;return this.int16[he+0]=o,this.int16[he+1]=p,this.int16[he+2]=b,this.int16[he+3]=M,this.uint16[he+4]=A,this.uint16[he+5]=R,this.uint16[he+6]=O,this.uint16[he+7]=U,this.int16[he+8]=W,this.int16[he+9]=Y,this.int16[he+10]=ee,this.int16[he+11]=ae,n}}He.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",He);class Ae extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,p){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,p)}emplace(n,o,p,b){const M=3*n;return this.float32[M+0]=o,this.float32[M+1]=p,this.float32[M+2]=b,n}}Ae.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",Ae);class Ke extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}Ke.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",Ke);class rt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A,R,O,U){const W=this.length;return this.resize(W+1),this.emplace(W,n,o,p,b,M,A,R,O,U)}emplace(n,o,p,b,M,A,R,O,U,W){const Y=10*n,ee=5*n;return this.int16[Y+0]=o,this.int16[Y+1]=p,this.int16[Y+2]=b,this.int16[Y+3]=M,this.int16[Y+4]=A,this.int16[Y+5]=R,this.uint32[ee+3]=O,this.uint16[Y+8]=U,this.uint16[Y+9]=W,n}}rt.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",rt);class ft extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,o,p,b,M,A)}emplace(n,o,p,b,M,A,R){const O=6*n;return this.int16[O+0]=o,this.int16[O+1]=p,this.int16[O+2]=b,this.int16[O+3]=M,this.int16[O+4]=A,this.int16[O+5]=R,n}}ft.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",ft);class kt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M){const A=this.length;return this.resize(A+1),this.emplace(A,n,o,p,b,M)}emplace(n,o,p,b,M,A){const R=4*n,O=8*n;return this.float32[R+0]=o,this.float32[R+1]=p,this.float32[R+2]=b,this.int16[O+6]=M,this.int16[O+7]=A,n}}kt.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",kt);class Gt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,o,p,b,M,A)}emplace(n,o,p,b,M,A,R){const O=16*n,U=4*n,W=8*n;return this.uint8[O+0]=o,this.uint8[O+1]=p,this.float32[U+1]=b,this.float32[U+2]=M,this.int16[W+6]=A,this.int16[W+7]=R,n}}Gt.prototype.bytesPerElement=16,pn("StructArrayLayout2ub2f2i16",Gt);class ln extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,p){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,p)}emplace(n,o,p,b){const M=3*n;return this.uint16[M+0]=o,this.uint16[M+1]=p,this.uint16[M+2]=b,n}}ln.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",ln);class on extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne){const nt=this.length;return this.resize(nt+1),this.emplace(nt,n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne)}emplace(n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne,nt){const ke=24*n,tt=12*n,pt=48*n;return this.int16[ke+0]=o,this.int16[ke+1]=p,this.uint16[ke+2]=b,this.uint16[ke+3]=M,this.uint32[tt+2]=A,this.uint32[tt+3]=R,this.uint32[tt+4]=O,this.uint16[ke+10]=U,this.uint16[ke+11]=W,this.uint16[ke+12]=Y,this.float32[tt+7]=ee,this.float32[tt+8]=ae,this.uint8[pt+36]=he,this.uint8[pt+37]=_e,this.uint8[pt+38]=Ce,this.uint32[tt+10]=Ne,this.int16[ke+22]=nt,n}}on.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",on);class Ot extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne,nt,ke,tt,pt,Wt,hn,rn,un,sn,wn,_n){const dn=this.length;return this.resize(dn+1),this.emplace(dn,n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne,nt,ke,tt,pt,Wt,hn,rn,un,sn,wn,_n)}emplace(n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he,_e,Ce,Ne,nt,ke,tt,pt,Wt,hn,rn,un,sn,wn,_n,dn){const At=32*n,Ln=16*n;return this.int16[At+0]=o,this.int16[At+1]=p,this.int16[At+2]=b,this.int16[At+3]=M,this.int16[At+4]=A,this.int16[At+5]=R,this.int16[At+6]=O,this.int16[At+7]=U,this.uint16[At+8]=W,this.uint16[At+9]=Y,this.uint16[At+10]=ee,this.uint16[At+11]=ae,this.uint16[At+12]=he,this.uint16[At+13]=_e,this.uint16[At+14]=Ce,this.uint16[At+15]=Ne,this.uint16[At+16]=nt,this.uint16[At+17]=ke,this.uint16[At+18]=tt,this.uint16[At+19]=pt,this.uint16[At+20]=Wt,this.uint16[At+21]=hn,this.uint16[At+22]=rn,this.uint32[Ln+12]=un,this.float32[Ln+13]=sn,this.float32[Ln+14]=wn,this.uint16[At+30]=_n,this.uint16[At+31]=dn,n}}Ot.prototype.bytesPerElement=64,pn("StructArrayLayout8i15ui1ul2f2ui64",Ot);class Kt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Kt.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",Kt);class gn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,p){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,p)}emplace(n,o,p,b){const M=3*n;return this.uint16[6*n+0]=o,this.float32[M+1]=p,this.float32[M+2]=b,n}}gn.prototype.bytesPerElement=12,pn("StructArrayLayout1ui2f12",gn);class $n extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,p){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,p)}emplace(n,o,p,b){const M=4*n;return this.uint32[2*n+0]=o,this.uint16[M+2]=p,this.uint16[M+3]=b,n}}$n.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",$n);class Qt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const p=this.length;return this.resize(p+1),this.emplace(p,n,o)}emplace(n,o,p){const b=2*n;return this.uint16[b+0]=o,this.uint16[b+1]=p,n}}Qt.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",Qt);class tn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}tn.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",tn);class Vn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,p,b){const M=this.length;return this.resize(M+1),this.emplace(M,n,o,p,b)}emplace(n,o,p,b,M){const A=4*n;return this.float32[A+0]=o,this.float32[A+1]=p,this.float32[A+2]=b,this.float32[A+3]=M,n}}Vn.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",Vn);class lr extends z{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new D(this.anchorPointX,this.anchorPointY)}}lr.prototype.size=20;class ei extends rt{get(n){return new lr(this,n)}}pn("CollisionBoxArray",ei);class gi extends z{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}gi.prototype.size=48;class ir extends on{get(n){return new gi(this,n)}}pn("PlacedSymbolArray",ir);class Ni extends z{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ni.prototype.size=64;class Js extends Ot{get(n){return new Ni(this,n)}}pn("SymbolInstanceArray",Js);class rr extends Kt{getoffsetX(n){return this.float32[1*n+0]}}pn("GlyphOffsetArray",rr);class xr extends ue{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}pn("SymbolLineVertexArray",xr);class as extends z{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}as.prototype.size=12;class Xr extends gn{get(n){return new as(this,n)}}pn("TextAnchorOffsetArray",Xr);class Er extends z{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Er.prototype.size=8;class da extends $n{get(n){return new Er(this,n)}}pn("FeatureIndexArray",da);class Lr extends K{}class Jl extends K{}class Ql extends K{}class hl extends Ee{}class Lc extends Re{}class Xu extends Ie{}class os extends De{}class Ts extends He{}class yo extends Ae{}class eu extends Ke{}class hs extends ft{}class Ur extends Gt{}class ts extends ln{}class pr extends Qt{}const Uo=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:kc}=Uo;class jr{constructor(n=[]){this.segments=n}prepareSegment(n,o,p,b){let M=this.segments[this.segments.length-1];return n>jr.MAX_VERTEX_ARRAY_LENGTH&&st(`Max vertices per segment is ${jr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!M||M.vertexLength+n>jr.MAX_VERTEX_ARRAY_LENGTH||M.sortKey!==b)&&(M={vertexOffset:o.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},b!==void 0&&(M.sortKey=b),this.segments.push(M)),M}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,p,b){return new jr([{vertexOffset:n,primitiveOffset:o,vertexLength:p,primitiveLength:b,vaos:{},sortKey:0}])}}function If(r,n){return 256*(r=Le(Math.floor(r),0,255))+Le(Math.floor(n),0,255)}jr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",jr);const Dc=H([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ju={exports:{}},ja={exports:{}};ja.exports=function(r,n){var o,p,b,M,A,R,O,U;for(p=r.length-(o=3&r.length),b=n,A=3432918353,R=461845907,U=0;U<p;)O=255&r.charCodeAt(U)|(255&r.charCodeAt(++U))<<8|(255&r.charCodeAt(++U))<<16|(255&r.charCodeAt(++U))<<24,++U,b=27492+(65535&(M=5*(65535&(b=(b^=O=(65535&(O=(O=(65535&O)*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(O=0,o){case 3:O^=(255&r.charCodeAt(U+2))<<16;case 2:O^=(255&r.charCodeAt(U+1))<<8;case 1:b^=O=(65535&(O=(O=(65535&(O^=255&r.charCodeAt(U)))*A+(((O>>>16)*A&65535)<<16)&4294967295)<<15|O>>>17))*R+(((O>>>16)*R&65535)<<16)&4294967295}return b^=r.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Cf=ja.exports,Zu={exports:{}};Zu.exports=function(r,n){for(var o,p=r.length,b=n^p,M=0;p>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24))+((1540483477*(o>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),p-=4,++M;switch(p){case 3:b^=(255&r.charCodeAt(M+2))<<16;case 2:b^=(255&r.charCodeAt(M+1))<<8;case 1:b=1540483477*(65535&(b^=255&r.charCodeAt(M)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var Nc=Cf,Oc=Zu.exports;ju.exports=Nc,ju.exports.murmur3=Nc,ju.exports.murmur2=Oc;var Yu=I(ju.exports);class vo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,o,p,b){this.ids.push(Wm(n)),this.positions.push(o,p,b)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=Wm(n);let p=0,b=this.ids.length-1;for(;p<b;){const A=p+b>>1;this.ids[A]>=o?b=A:p=A+1}const M=[];for(;this.ids[p]===o;)M.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return M}static serialize(n,o){const p=new Float64Array(n.ids),b=new Uint32Array(n.positions);return Rf(p,b,0,p.length-1),o&&o.push(p.buffer,b.buffer),{ids:p,positions:b}}static deserialize(n){const o=new vo;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o}}function Wm(r){const n=+r;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Yu(String(r))}function Rf(r,n,o,p){for(;o<p;){const b=r[o+p>>1];let M=o-1,A=p+1;for(;;){do M++;while(r[M]<b);do A--;while(r[A]>b);if(M>=A)break;Nh(r,M,A),Nh(n,3*M,3*A),Nh(n,3*M+1,3*A+1),Nh(n,3*M+2,3*A+2)}A-o<p-A?(Rf(r,n,o,A),o=A+1):(Rf(r,n,A+1,p),p=A)}}function Nh(r,n,o){const p=r[n];r[n]=r[o],r[o]=p}pn("FeaturePositionMap",vo);class Ku{constructor(n,o){this.gl=n.gl,this.location=o}}class Oh extends Ku{constructor(n,o){super(n,o),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class qm extends Ku{constructor(n,o){super(n,o),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Pf extends Ku{constructor(n,o){super(n,o),this.current=qt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const $m=new Float32Array(16);function Fh(r){return[If(255*r.r,255*r.g),If(255*r.b,255*r.a)]}class zh{constructor(n,o,p){this.value=n,this.uniformNames=o.map(b=>`u_${b}`),this.type=p}setUniform(n,o,p){n.set(p.constantOr(this.value))}getBinding(n,o,p){return this.type==="color"?new Pf(n,o):new Oh(n,o)}}class tu{constructor(n,o){this.uniformNames=o.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=n.tlbr}setUniform(n,o,p,b){const M=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;M&&n.set(M)}getBinding(n,o,p){return p.substr(0,9)==="u_pattern"?new qm(n,o):new Oh(n,o)}}class ri{constructor(n,o,p,b){this.expression=n,this.type=p,this.maxValue=0,this.paintVertexAttributes=o.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(n,o,p,b,M){const A=this.paintVertexArray.length,R=this.expression.evaluate(new nr(0),o,{},b,[],M);this.paintVertexArray.resize(n),this._setPaintValue(A,n,R)}updatePaintArray(n,o,p,b){const M=this.expression.evaluate({zoom:0},p,b);this._setPaintValue(n,o,M)}_setPaintValue(n,o,p){if(this.type==="color"){const b=Fh(p);for(let M=n;M<o;M++)this.paintVertexArray.emplace(M,b[0],b[1])}else{for(let b=n;b<o;b++)this.paintVertexArray.emplace(b,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xo{constructor(n,o,p,b,M,A){this.expression=n,this.uniformNames=o.map(R=>`u_${R}_t`),this.type=p,this.useIntegerZoom=b,this.zoom=M,this.maxValue=0,this.paintVertexAttributes=o.map(R=>({name:`a_${R}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(n,o,p,b,M){const A=this.expression.evaluate(new nr(this.zoom),o,{},b,[],M),R=this.expression.evaluate(new nr(this.zoom+1),o,{},b,[],M),O=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(O,n,A,R)}updatePaintArray(n,o,p,b){const M=this.expression.evaluate({zoom:this.zoom},p,b),A=this.expression.evaluate({zoom:this.zoom+1},p,b);this._setPaintValue(n,o,M,A)}_setPaintValue(n,o,p,b){if(this.type==="color"){const M=Fh(p),A=Fh(b);for(let R=n;R<o;R++)this.paintVertexArray.emplace(R,M[0],M[1],A[0],A[1])}else{for(let M=n;M<o;M++)this.paintVertexArray.emplace(M,p,b);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(b))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,b=Le(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(b)}getBinding(n,o,p){return new Oh(n,o)}}class nu{constructor(n,o,p,b,M,A){this.expression=n,this.type=o,this.useIntegerZoom=p,this.zoom=b,this.layerId=A,this.zoomInPaintVertexArray=new M,this.zoomOutPaintVertexArray=new M}populatePaintArray(n,o,p){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(b,n,o.patterns&&o.patterns[this.layerId],p)}updatePaintArray(n,o,p,b,M){this._setPaintValues(n,o,p.patterns&&p.patterns[this.layerId],M)}_setPaintValues(n,o,p,b){if(!b||!p)return;const{min:M,mid:A,max:R}=p,O=b[M],U=b[A],W=b[R];if(O&&U&&W)for(let Y=n;Y<o;Y++)this.zoomInPaintVertexArray.emplace(Y,U.tl[0],U.tl[1],U.br[0],U.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],U.pixelRatio,O.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,U.tl[0],U.tl[1],U.br[0],U.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],U.pixelRatio,W.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Dc.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Dc.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fc{constructor(n,o,p){this.binders={},this._buffers=[];const b=[];for(const M in n.paint._values){if(!p(M))continue;const A=n.paint.get(M);if(!(A instanceof Xa&&bs(A.property.specification)))continue;const R=tv(M,n.type),O=A.value,U=A.property.specification.type,W=A.property.useIntegerZoom,Y=A.property.specification["property-type"],ee=Y==="cross-faded"||Y==="cross-faded-data-driven";if(O.kind==="constant")this.binders[M]=ee?new tu(O.value,R):new zh(O.value,R,U),b.push(`/u_${M}`);else if(O.kind==="source"||ee){const ae=Xm(M,U,"source");this.binders[M]=ee?new nu(O,U,W,o,ae,n.id):new ri(O,R,U,ae),b.push(`/a_${M}`)}else{const ae=Xm(M,U,"composite");this.binders[M]=new xo(O,R,U,W,o,ae),b.push(`/z_${M}`)}}this.cacheKey=b.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof ri||o instanceof xo?o.maxValue:0}populatePaintArrays(n,o,p,b,M){for(const A in this.binders){const R=this.binders[A];(R instanceof ri||R instanceof xo||R instanceof nu)&&R.populatePaintArray(n,o,p,b,M)}}setConstantPatternPositions(n,o){for(const p in this.binders){const b=this.binders[p];b instanceof tu&&b.setConstantPatternPositions(n,o)}}updatePaintArrays(n,o,p,b,M){let A=!1;for(const R in n){const O=o.getPositions(R);for(const U of O){const W=p.feature(U.index);for(const Y in this.binders){const ee=this.binders[Y];if((ee instanceof ri||ee instanceof xo||ee instanceof nu)&&ee.expression.isStateDependent===!0){const ae=b.paint.get(Y);ee.expression=ae.value,ee.updatePaintArray(U.start,U.end,W,n[R],M),A=!0}}}}return A}defines(){const n=[];for(const o in this.binders){const p=this.binders[o];(p instanceof zh||p instanceof tu)&&n.push(...p.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof ri||p instanceof xo)for(let b=0;b<p.paintVertexAttributes.length;b++)n.push(p.paintVertexAttributes[b].name);else if(p instanceof nu)for(let b=0;b<Dc.members.length;b++)n.push(Dc.members[b].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const p=this.binders[o];if(p instanceof zh||p instanceof tu||p instanceof xo)for(const b of p.uniformNames)n.push(b)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,o){const p=[];for(const b in this.binders){const M=this.binders[b];if(M instanceof zh||M instanceof tu||M instanceof xo){for(const A of M.uniformNames)if(o[A]){const R=M.getBinding(n,o[A],A);p.push({name:A,property:b,binding:R})}}}return p}setUniforms(n,o,p,b){for(const{name:M,property:A,binding:R}of o)this.binders[A].setUniform(R,b,p.get(A),M)}updatePaintBuffers(n){this._buffers=[];for(const o in this.binders){const p=this.binders[o];if(n&&p instanceof nu){const b=n.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(p instanceof ri||p instanceof xo)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(n){for(const o in this.binders){const p=this.binders[o];(p instanceof ri||p instanceof xo||p instanceof nu)&&p.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof ri||o instanceof xo||o instanceof nu)&&o.destroy()}}}class iu{constructor(n,o,p=()=>!0){this.programConfigurations={};for(const b of n)this.programConfigurations[b.id]=new Fc(b,o,p);this.needsUpload=!1,this._featureMap=new vo,this._bufferOffset=0}populatePaintArrays(n,o,p,b,M,A){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(n,o,b,M,A);o.id!==void 0&&this._featureMap.add(o.id,p,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,p,b){for(const M of p)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(n,this._featureMap,o,M,b)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function tv(r,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${n}-`,"").replace(/-/g,"_")]}function Xm(r,n,o){const p={color:{source:Ie,composite:Vn},number:{source:Kt,composite:Ie}},b=function(M){return{"line-pattern":{source:os,composite:os},"fill-pattern":{source:os,composite:os},"fill-extrusion-pattern":{source:os,composite:os}}[M]}(r);return b&&b[o]||p[n][o]}pn("ConstantBinder",zh),pn("CrossFadedConstantBinder",tu),pn("SourceExpressionBinder",ri),pn("CrossFadedCompositeBinder",nu),pn("CompositeExpressionBinder",xo),pn("ProgramConfiguration",Fc,{omit:["_buffers"]}),pn("ProgramConfigurationSet",iu);const Ui=8192,dp=Math.pow(2,14)-1,Bh=-dp-1;function fl(r){const n=Ui/r.extent,o=r.loadGeometry();for(let p=0;p<o.length;p++){const b=o[p];for(let M=0;M<b.length;M++){const A=b[M],R=Math.round(A.x*n),O=Math.round(A.y*n);A.x=Le(R,Bh,dp),A.y=Le(O,Bh,dp),(R<A.x||R>A.x+1||O<A.y||O>A.y+1)&&st("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function ru(r,n){return{type:r.type,id:r.id,properties:r.properties,geometry:n?fl(r):[]}}function Uh(r,n,o,p,b){r.emplaceBack(2*n+(p+1)/2,2*o+(b+1)/2)}class Qs{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Jl,this.indexArray=new ts,this.segments=new jr,this.programConfigurations=new iu(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,p){const b=this.layers[0],M=[];let A=null,R=!1;b.type==="circle"&&(A=b.layout.get("circle-sort-key"),R=!A.isConstant());for(const{feature:O,id:U,index:W,sourceLayerIndex:Y}of n){const ee=this.layers[0]._featureFilter.needGeometry,ae=ru(O,ee);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),ae,p))continue;const he=R?A.evaluate(ae,{},p):void 0,_e={id:U,properties:O.properties,type:O.type,sourceLayerIndex:Y,index:W,geometry:ee?ae.geometry:fl(O),patterns:{},sortKey:he};M.push(_e)}R&&M.sort((O,U)=>O.sortKey-U.sortKey);for(const O of M){const{geometry:U,index:W,sourceLayerIndex:Y}=O,ee=n[W].feature;this.addFeature(O,U,W,p),o.featureIndex.insert(ee,U,W,Y,this.index)}}update(n,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,kc),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,p,b){for(const M of o)for(const A of M){const R=A.x,O=A.y;if(R<0||R>=Ui||O<0||O>=Ui)continue;const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),W=U.vertexLength;Uh(this.layoutVertexArray,R,O,-1,-1),Uh(this.layoutVertexArray,R,O,1,-1),Uh(this.layoutVertexArray,R,O,1,1),Uh(this.layoutVertexArray,R,O,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+3,W+2),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{},b)}}function dl(r,n){for(let o=0;o<r.length;o++)if(Ia(n,r[o]))return!0;for(let o=0;o<n.length;o++)if(Ia(r,n[o]))return!0;return!!kf(r,n)}function pp(r,n,o){return!!Ia(r,n)||!!Df(n,r,o)}function mp(r,n){if(r.length===1)return Of(n,r[0]);for(let o=0;o<n.length;o++){const p=n[o];for(let b=0;b<p.length;b++)if(Ia(r,p[b]))return!0}for(let o=0;o<r.length;o++)if(Of(n,r[o]))return!0;for(let o=0;o<n.length;o++)if(kf(r,n[o]))return!0;return!1}function Lf(r,n,o){if(r.length>1){if(kf(r,n))return!0;for(let p=0;p<n.length;p++)if(Df(n[p],r,o))return!0}for(let p=0;p<r.length;p++)if(Df(r[p],n,o))return!0;return!1}function kf(r,n){if(r.length===0||n.length===0)return!1;for(let o=0;o<r.length-1;o++){const p=r[o],b=r[o+1];for(let M=0;M<n.length-1;M++)if(gp(p,b,n[M],n[M+1]))return!0}return!1}function gp(r,n,o,p){return Je(r,o,p)!==Je(n,o,p)&&Je(r,n,o)!==Je(r,n,p)}function Df(r,n,o){const p=o*o;if(n.length===1)return r.distSqr(n[0])<p;for(let b=1;b<n.length;b++)if(Nf(r,n[b-1],n[b])<p)return!0;return!1}function Nf(r,n,o){const p=n.distSqr(o);if(p===0)return r.distSqr(n);const b=((r.x-n.x)*(o.x-n.x)+(r.y-n.y)*(o.y-n.y))/p;return r.distSqr(b<0?n:b>1?o:o.sub(n)._mult(b)._add(n))}function Of(r,n){let o,p,b,M=!1;for(let A=0;A<r.length;A++){o=r[A];for(let R=0,O=o.length-1;R<o.length;O=R++)p=o[R],b=o[O],p.y>n.y!=b.y>n.y&&n.x<(b.x-p.x)*(n.y-p.y)/(b.y-p.y)+p.x&&(M=!M)}return M}function Ia(r,n){let o=!1;for(let p=0,b=r.length-1;p<r.length;b=p++){const M=r[p],A=r[b];M.y>n.y!=A.y>n.y&&n.x<(A.x-M.x)*(n.y-M.y)/(A.y-M.y)+M.x&&(o=!o)}return o}function nv(r,n,o){const p=o[0],b=o[2];if(r.x<p.x&&n.x<p.x||r.x>b.x&&n.x>b.x||r.y<p.y&&n.y<p.y||r.y>b.y&&n.y>b.y)return!1;const M=Je(r,n,o[0]);return M!==Je(r,n,o[1])||M!==Je(r,n,o[2])||M!==Je(r,n,o[3])}function Za(r,n,o){const p=n.paint.get(r).value;return p.kind==="constant"?p.value:o.programConfigurations.get(n.id).getMaxValue(r)}function Vh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Gh(r,n,o,p,b){if(!n[0]&&!n[1])return r;const M=D.convert(n)._mult(b);o==="viewport"&&M._rotate(-p);const A=[];for(let R=0;R<r.length;R++)A.push(r[R].sub(M));return A}let Ff,jm;pn("CircleBucket",Qs,{omit:["layers"]});var iv={get paint(){return jm=jm||new y({"circle-radius":new Pn(Ze.paint_circle["circle-radius"]),"circle-color":new Pn(Ze.paint_circle["circle-color"]),"circle-blur":new Pn(Ze.paint_circle["circle-blur"]),"circle-opacity":new Pn(Ze.paint_circle["circle-opacity"]),"circle-translate":new In(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new In(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(Ze.paint_circle["circle-stroke-opacity"])})},get layout(){return Ff=Ff||new y({"circle-sort-key":new Pn(Ze.layout_circle["circle-sort-key"])})}},Ns=1e-6,Ju=typeof Float32Array<"u"?Float32Array:Array;function zf(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zm(r,n,o){var p=n[0],b=n[1],M=n[2],A=n[3],R=n[4],O=n[5],U=n[6],W=n[7],Y=n[8],ee=n[9],ae=n[10],he=n[11],_e=n[12],Ce=n[13],Ne=n[14],nt=n[15],ke=o[0],tt=o[1],pt=o[2],Wt=o[3];return r[0]=ke*p+tt*R+pt*Y+Wt*_e,r[1]=ke*b+tt*O+pt*ee+Wt*Ce,r[2]=ke*M+tt*U+pt*ae+Wt*Ne,r[3]=ke*A+tt*W+pt*he+Wt*nt,r[4]=(ke=o[4])*p+(tt=o[5])*R+(pt=o[6])*Y+(Wt=o[7])*_e,r[5]=ke*b+tt*O+pt*ee+Wt*Ce,r[6]=ke*M+tt*U+pt*ae+Wt*Ne,r[7]=ke*A+tt*W+pt*he+Wt*nt,r[8]=(ke=o[8])*p+(tt=o[9])*R+(pt=o[10])*Y+(Wt=o[11])*_e,r[9]=ke*b+tt*O+pt*ee+Wt*Ce,r[10]=ke*M+tt*U+pt*ae+Wt*Ne,r[11]=ke*A+tt*W+pt*he+Wt*nt,r[12]=(ke=o[12])*p+(tt=o[13])*R+(pt=o[14])*Y+(Wt=o[15])*_e,r[13]=ke*b+tt*O+pt*ee+Wt*Ce,r[14]=ke*M+tt*U+pt*ae+Wt*Ne,r[15]=ke*A+tt*W+pt*he+Wt*nt,r}Math.hypot||(Math.hypot=function(){for(var r=0,n=arguments.length;n--;)r+=arguments[n]*arguments[n];return Math.sqrt(r)});var zc,Ym=Zm;function Ms(r,n,o){var p=n[0],b=n[1],M=n[2],A=n[3];return r[0]=o[0]*p+o[4]*b+o[8]*M+o[12]*A,r[1]=o[1]*p+o[5]*b+o[9]*M+o[13]*A,r[2]=o[2]*p+o[6]*b+o[10]*M+o[14]*A,r[3]=o[3]*p+o[7]*b+o[11]*M+o[15]*A,r}zc=new Ju(4),Ju!=Float32Array&&(zc[0]=0,zc[1]=0,zc[2]=0,zc[3]=0);class Vo extends E{constructor(n){super(n,iv)}createBucket(n){return new Qs(n)}queryRadius(n){const o=n;return Za("circle-radius",this,o)+Za("circle-stroke-width",this,o)+Vh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,o,p,b,M,A,R,O){const U=Gh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,R),W=this.paint.get("circle-radius").evaluate(o,p)+this.paint.get("circle-stroke-width").evaluate(o,p),Y=this.paint.get("circle-pitch-alignment")==="map",ee=Y?U:function(he,_e){return he.map(Ce=>Km(Ce,_e))}(U,O),ae=Y?W*R:W;for(const he of b)for(const _e of he){const Ce=Y?_e:Km(_e,O);let Ne=ae;const nt=Ms([],[_e.x,_e.y,0,1],O);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ne*=nt[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ne*=A.cameraToCenterDistance/nt[3]),pp(ee,Ce,Ne))return!0}return!1}}function Km(r,n){const o=Ms([],[r.x,r.y,0,1],n);return new D(o[0]/o[3],o[1]/o[3])}class Jm extends Qs{}let Hh;pn("HeatmapBucket",Jm,{omit:["layers"]});var Bc={get paint(){return Hh=Hh||new y({"heatmap-radius":new Pn(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new h(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(Ze.paint_heatmap["heatmap-opacity"])})}};function Bf(r,{width:n,height:o},p,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==n*o*p)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${n*o*p}`)}else b=new Uint8Array(n*o*p);return r.width=n,r.height=o,r.data=b,r}function _p(r,{width:n,height:o},p){if(n===r.width&&o===r.height)return;const b=Bf({},{width:n,height:o},p);yp(r,b,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,n),height:Math.min(r.height,o)},p),r.width=n,r.height=o,r.data=b.data}function yp(r,n,o,p,b,M){if(b.width===0||b.height===0)return n;if(b.width>r.width||b.height>r.height||o.x>r.width-b.width||o.y>r.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>n.width||b.height>n.height||p.x>n.width-b.width||p.y>n.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const A=r.data,R=n.data;if(A===R)throw new Error("srcData equals dstData, so image is already copied");for(let O=0;O<b.height;O++){const U=((o.y+O)*r.width+o.x)*M,W=((p.y+O)*n.width+p.x)*M;for(let Y=0;Y<b.width*M;Y++)R[W+Y]=A[U+Y]}return n}class Uc{constructor(n,o){Bf(this,n,1,o)}resize(n){_p(this,n,1)}clone(){return new Uc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,p,b,M){yp(n,o,p,b,M,1)}}class fs{constructor(n,o){Bf(this,n,4,o)}resize(n){_p(this,n,4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,p,b,M){yp(n,o,p,b,M,4)}}function Vc(r){const n={},o=r.resolution||256,p=r.clips?r.clips.length:1,b=r.image||new fs({width:o,height:p});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const M=(A,R,O)=>{n[r.evaluationKey]=O;const U=r.expression.evaluate(n);b.data[A+R+0]=Math.floor(255*U.r/U.a),b.data[A+R+1]=Math.floor(255*U.g/U.a),b.data[A+R+2]=Math.floor(255*U.b/U.a),b.data[A+R+3]=Math.floor(255*U.a)};if(r.clips)for(let A=0,R=0;A<p;++A,R+=4*o)for(let O=0,U=0;O<o;O++,U+=4){const W=O/(o-1),{start:Y,end:ee}=r.clips[A];M(R,U,Y*(1-W)+ee*W)}else for(let A=0,R=0;A<o;A++,R+=4)M(0,R,A/(o-1));return b}pn("AlphaImage",Uc),pn("RGBAImage",fs);class rv extends E{createBucket(n){return new Jm(n)}constructor(n){super(n,Bc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let vp;var Qm={get paint(){return vp=vp||new y({"hillshade-illumination-direction":new In(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(Ze.paint_hillshade["hillshade-accent-color"])})}};class Uf extends E{constructor(n){super(n,Qm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const eg=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:Vf}=eg;function Gf(r,n,o=2){const p=n&&n.length,b=p?n[0]*o:r.length;let M=Wh(r,0,b,o,!0);const A=[];if(!M||M.next===M.prev)return A;let R,O,U;if(p&&(M=function(W,Y,ee,ae){const he=[];for(let _e=0,Ce=Y.length;_e<Ce;_e++){const Ne=Wh(W,Y[_e]*ae,_e<Ce-1?Y[_e+1]*ae:W.length,ae,!1);Ne===Ne.next&&(Ne.steiner=!0),he.push(av(Ne))}he.sort(ng);for(let _e=0;_e<he.length;_e++)ee=pl(he[_e],ee);return ee}(r,n,M,o)),r.length>80*o){R=1/0,O=1/0;let W=-1/0,Y=-1/0;for(let ee=o;ee<b;ee+=o){const ae=r[ee],he=r[ee+1];ae<R&&(R=ae),he<O&&(O=he),ae>W&&(W=ae),he>Y&&(Y=he)}U=Math.max(W-R,Y-O),U=U!==0?32767/U:0}return Gc(M,A,o,R,O,U,0),A}function Wh(r,n,o,p,b){let M;if(b===function(A,R,O,U){let W=0;for(let Y=R,ee=O-U;Y<O;Y+=U)W+=(A[ee]-A[Y])*(A[Y+1]+A[ee+1]),ee=Y;return W}(r,n,o,p)>0)for(let A=n;A<o;A+=p)M=Zn(A/p|0,r[A],r[A+1],M);else for(let A=o-p;A>=n;A-=p)M=Zn(A/p|0,r[A],r[A+1],M);return M&&Ya(M,M.next)&&(au(M),M=M.next),M}function Qu(r,n){if(!r)return r;n||(n=r);let o,p=r;do if(o=!1,p.steiner||!Ya(p,p.next)&&kr(p.prev,p,p.next)!==0)p=p.next;else{if(au(p),p=n=p.prev,p===p.next)break;o=!0}while(o||p!==n);return n}function Gc(r,n,o,p,b,M,A){if(!r)return;!A&&M&&function(O,U,W,Y){let ee=O;do ee.z===0&&(ee.z=Wf(ee.x,ee.y,U,W,Y)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==O);ee.prevZ.nextZ=null,ee.prevZ=null,function(ae){let he,_e=1;do{let Ce,Ne=ae;ae=null;let nt=null;for(he=0;Ne;){he++;let ke=Ne,tt=0;for(let Wt=0;Wt<_e&&(tt++,ke=ke.nextZ,ke);Wt++);let pt=_e;for(;tt>0||pt>0&&ke;)tt!==0&&(pt===0||!ke||Ne.z<=ke.z)?(Ce=Ne,Ne=Ne.nextZ,tt--):(Ce=ke,ke=ke.nextZ,pt--),nt?nt.nextZ=Ce:ae=Ce,Ce.prevZ=nt,nt=Ce;Ne=ke}nt.nextZ=null,_e*=2}while(he>1)}(ee)}(r,p,b,M);let R=r;for(;r.prev!==r.next;){const O=r.prev,U=r.next;if(M?tg(r,p,b,M):Hf(r))n.push(O.i,r.i,U.i),au(r),r=U.next,R=U.next;else if((r=U)===R){A?A===1?Gc(r=xp(Qu(r),n),n,o,p,b,M,2):A===2&&sv(r,n,o,p,b,M):Gc(Qu(r),n,o,p,b,M,1);break}}}function Hf(r){const n=r.prev,o=r,p=r.next;if(kr(n,o,p)>=0)return!1;const b=n.x,M=o.x,A=p.x,R=n.y,O=o.y,U=p.y,W=b<M?b<A?b:A:M<A?M:A,Y=R<O?R<U?R:U:O<U?O:U,ee=b>M?b>A?b:A:M>A?M:A,ae=R>O?R>U?R:U:O>U?O:U;let he=p.next;for(;he!==n;){if(he.x>=W&&he.x<=ee&&he.y>=Y&&he.y<=ae&&ec(b,R,M,O,A,U,he.x,he.y)&&kr(he.prev,he,he.next)>=0)return!1;he=he.next}return!0}function tg(r,n,o,p){const b=r.prev,M=r,A=r.next;if(kr(b,M,A)>=0)return!1;const R=b.x,O=M.x,U=A.x,W=b.y,Y=M.y,ee=A.y,ae=R<O?R<U?R:U:O<U?O:U,he=W<Y?W<ee?W:ee:Y<ee?Y:ee,_e=R>O?R>U?R:U:O>U?O:U,Ce=W>Y?W>ee?W:ee:Y>ee?Y:ee,Ne=Wf(ae,he,n,o,p),nt=Wf(_e,Ce,n,o,p);let ke=r.prevZ,tt=r.nextZ;for(;ke&&ke.z>=Ne&&tt&&tt.z<=nt;){if(ke.x>=ae&&ke.x<=_e&&ke.y>=he&&ke.y<=Ce&&ke!==b&&ke!==A&&ec(R,W,O,Y,U,ee,ke.x,ke.y)&&kr(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,tt.x>=ae&&tt.x<=_e&&tt.y>=he&&tt.y<=Ce&&tt!==b&&tt!==A&&ec(R,W,O,Y,U,ee,tt.x,tt.y)&&kr(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;ke&&ke.z>=Ne;){if(ke.x>=ae&&ke.x<=_e&&ke.y>=he&&ke.y<=Ce&&ke!==b&&ke!==A&&ec(R,W,O,Y,U,ee,ke.x,ke.y)&&kr(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;tt&&tt.z<=nt;){if(tt.x>=ae&&tt.x<=_e&&tt.y>=he&&tt.y<=Ce&&tt!==b&&tt!==A&&ec(R,W,O,Y,U,ee,tt.x,tt.y)&&kr(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function xp(r,n){let o=r;do{const p=o.prev,b=o.next.next;!Ya(p,b)&&qf(p,o,o.next,b)&&su(p,b)&&su(b,p)&&(n.push(p.i,o.i,b.i),au(o),au(o.next),o=r=b),o=o.next}while(o!==r);return Qu(o)}function sv(r,n,o,p,b,M){let A=r;do{let R=A.next.next;for(;R!==A.prev;){if(A.i!==R.i&&ov(A,R)){let O=tc(A,R);return A=Qu(A,A.next),O=Qu(O,O.next),Gc(A,n,o,p,b,M,0),void Gc(O,n,o,p,b,M,0)}R=R.next}A=A.next}while(A!==r)}function ng(r,n){return r.x-n.x}function pl(r,n){const o=function(b,M){let A=M;const R=b.x,O=b.y;let U,W=-1/0;do{if(O<=A.y&&O>=A.next.y&&A.next.y!==A.y){const _e=A.x+(O-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(_e<=R&&_e>W&&(W=_e,U=A.x<A.next.x?A:A.next,_e===R))return U}A=A.next}while(A!==M);if(!U)return null;const Y=U,ee=U.x,ae=U.y;let he=1/0;A=U;do{if(R>=A.x&&A.x>=ee&&R!==A.x&&ec(O<ae?R:W,O,ee,ae,O<ae?W:R,O,A.x,A.y)){const _e=Math.abs(O-A.y)/(R-A.x);su(A,b)&&(_e<he||_e===he&&(A.x>U.x||A.x===U.x&&ig(U,A)))&&(U=A,he=_e)}A=A.next}while(A!==Y);return U}(r,n);if(!o)return n;const p=tc(o,r);return Qu(p,p.next),Qu(o,o.next)}function ig(r,n){return kr(r.prev,r,n.prev)<0&&kr(n.next,r,r.next)<0}function Wf(r,n,o,p,b){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*b|0)|r<<8))|r<<4))|r<<2))|r<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-p)*b|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function av(r){let n=r,o=r;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==r);return o}function ec(r,n,o,p,b,M,A,R){return(b-A)*(n-R)>=(r-A)*(M-R)&&(r-A)*(p-R)>=(o-A)*(n-R)&&(o-A)*(M-R)>=(b-A)*(p-R)}function ov(r,n){return r.next.i!==n.i&&r.prev.i!==n.i&&!function(o,p){let b=o;do{if(b.i!==o.i&&b.next.i!==o.i&&b.i!==p.i&&b.next.i!==p.i&&qf(b,b.next,o,p))return!0;b=b.next}while(b!==o);return!1}(r,n)&&(su(r,n)&&su(n,r)&&function(o,p){let b=o,M=!1;const A=(o.x+p.x)/2,R=(o.y+p.y)/2;do b.y>R!=b.next.y>R&&b.next.y!==b.y&&A<(b.next.x-b.x)*(R-b.y)/(b.next.y-b.y)+b.x&&(M=!M),b=b.next;while(b!==o);return M}(r,n)&&(kr(r.prev,r,n.prev)||kr(r,n.prev,n))||Ya(r,n)&&kr(r.prev,r,r.next)>0&&kr(n.prev,n,n.next)>0)}function kr(r,n,o){return(n.y-r.y)*(o.x-n.x)-(n.x-r.x)*(o.y-n.y)}function Ya(r,n){return r.x===n.x&&r.y===n.y}function qf(r,n,o,p){const b=Wc(kr(r,n,o)),M=Wc(kr(r,n,p)),A=Wc(kr(o,p,r)),R=Wc(kr(o,p,n));return b!==M&&A!==R||!(b!==0||!Hc(r,o,n))||!(M!==0||!Hc(r,p,n))||!(A!==0||!Hc(o,r,p))||!(R!==0||!Hc(o,n,p))}function Hc(r,n,o){return n.x<=Math.max(r.x,o.x)&&n.x>=Math.min(r.x,o.x)&&n.y<=Math.max(r.y,o.y)&&n.y>=Math.min(r.y,o.y)}function Wc(r){return r>0?1:r<0?-1:0}function su(r,n){return kr(r.prev,r,r.next)<0?kr(r,n,r.next)>=0&&kr(r,r.prev,n)>=0:kr(r,n,r.prev)<0||kr(r,r.next,n)<0}function tc(r,n){const o=qh(r.i,r.x,r.y),p=qh(n.i,n.x,n.y),b=r.next,M=n.prev;return r.next=n,n.prev=r,o.next=b,b.prev=o,p.next=o,o.prev=p,M.next=p,p.prev=M,p}function Zn(r,n,o,p){const b=qh(r,n,o);return p?(b.next=p.next,b.prev=p,p.next.prev=b,p.next=b):(b.prev=b,b.next=b),b}function au(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function qh(r,n,o){return{i:r,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ml(r,n,o){const p=o.patternDependencies;let b=!1;for(const M of n){const A=M.paint.get(`${r}-pattern`);A.isConstant()||(b=!0);const R=A.constantOr(null);R&&(b=!0,p[R.to]=!0,p[R.from]=!0)}return b}function bp(r,n,o,p,b){const M=b.patternDependencies;for(const A of n){const R=A.paint.get(`${r}-pattern`).value;if(R.kind!=="constant"){let O=R.evaluate({zoom:p-1},o,{},b.availableImages),U=R.evaluate({zoom:p},o,{},b.availableImages),W=R.evaluate({zoom:p+1},o,{},b.availableImages);O=O&&O.name?O.name:O,U=U&&U.name?U.name:U,W=W&&W.name?W.name:W,M[O]=!0,M[U]=!0,M[W]=!0,o.patterns[A.id]={min:O,mid:U,max:W}}}return o}class $h{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ql,this.indexArray=new ts,this.indexArray2=new pr,this.programConfigurations=new iu(n.layers,n.zoom),this.segments=new jr,this.segments2=new jr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,p){this.hasPattern=ml("fill",this.layers,o);const b=this.layers[0].layout.get("fill-sort-key"),M=!b.isConstant(),A=[];for(const{feature:R,id:O,index:U,sourceLayerIndex:W}of n){const Y=this.layers[0]._featureFilter.needGeometry,ee=ru(R,Y);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),ee,p))continue;const ae=M?b.evaluate(ee,{},p,o.availableImages):void 0,he={id:O,properties:R.properties,type:R.type,sourceLayerIndex:W,index:U,geometry:Y?ee.geometry:fl(R),patterns:{},sortKey:ae};A.push(he)}M&&A.sort((R,O)=>R.sortKey-O.sortKey);for(const R of A){const{geometry:O,index:U,sourceLayerIndex:W}=R;if(this.hasPattern){const Y=bp("fill",this.layers,R,this.zoom,o);this.patternFeatures.push(Y)}else this.addFeature(R,O,U,p,{});o.featureIndex.insert(n[U].feature,O,U,W,this.index)}}update(n,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,p)}addFeatures(n,o,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,p,b,M){for(const A of Ls(o,500)){let R=0;for(const ae of A)R+=ae.length;const O=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray),U=O.vertexLength,W=[],Y=[];for(const ae of A){if(ae.length===0)continue;ae!==A[0]&&Y.push(W.length/2);const he=this.segments2.prepareSegment(ae.length,this.layoutVertexArray,this.indexArray2),_e=he.vertexLength;this.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),this.indexArray2.emplaceBack(_e+ae.length-1,_e),W.push(ae[0].x),W.push(ae[0].y);for(let Ce=1;Ce<ae.length;Ce++)this.layoutVertexArray.emplaceBack(ae[Ce].x,ae[Ce].y),this.indexArray2.emplaceBack(_e+Ce-1,_e+Ce),W.push(ae[Ce].x),W.push(ae[Ce].y);he.vertexLength+=ae.length,he.primitiveLength+=ae.length}const ee=Gf(W,Y);for(let ae=0;ae<ee.length;ae+=3)this.indexArray.emplaceBack(U+ee[ae],U+ee[ae+1],U+ee[ae+2]);O.vertexLength+=R,O.primitiveLength+=ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,M,b)}}let wp,As;pn("FillBucket",$h,{omit:["layers","patternFeatures"]});var lv={get paint(){return As=As||new y({"fill-antialias":new In(Ze.paint_fill["fill-antialias"]),"fill-opacity":new Pn(Ze.paint_fill["fill-opacity"]),"fill-color":new Pn(Ze.paint_fill["fill-color"]),"fill-outline-color":new Pn(Ze.paint_fill["fill-outline-color"]),"fill-translate":new In(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new In(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new T(Ze.paint_fill["fill-pattern"])})},get layout(){return wp=wp||new y({"fill-sort-key":new Pn(Ze.layout_fill["fill-sort-key"])})}};class uv extends E{constructor(n){super(n,lv)}recalculate(n,o){super.recalculate(n,o);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new $h(n)}queryRadius(){return Vh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,o,p,b,M,A,R){return mp(Gh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,R),b)}isTileClipped(){return!0}}const rg=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),cv=H([{name:"a_centroid",components:2,type:"Int16"}],4),{members:sg}=rg;var ou={},hv=P,ag=pa;function pa(r,n,o,p,b){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=p,this._values=b,r.readFields(ea,this,n)}function ea(r,n,o){r==1?n.id=o.readVarint():r==2?function(p,b){for(var M=p.readVarint()+p.pos;p.pos<M;){var A=b._keys[p.readVarint()],R=b._values[p.readVarint()];b.properties[A]=R}}(o,n):r==3?n.type=o.readVarint():r==4&&(n._geometry=o.pos)}function Sp(r){for(var n,o,p=0,b=0,M=r.length,A=M-1;b<M;A=b++)p+=((o=r[A]).x-(n=r[b]).x)*(n.y+o.y);return p}pa.types=["Unknown","Point","LineString","Polygon"],pa.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var n,o=r.readVarint()+r.pos,p=1,b=0,M=0,A=0,R=[];r.pos<o;){if(b<=0){var O=r.readVarint();p=7&O,b=O>>3}if(b--,p===1||p===2)M+=r.readSVarint(),A+=r.readSVarint(),p===1&&(n&&R.push(n),n=[]),n.push(new hv(M,A));else{if(p!==7)throw new Error("unknown command "+p);n&&n.push(n[0].clone())}}return n&&R.push(n),R},pa.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var n=r.readVarint()+r.pos,o=1,p=0,b=0,M=0,A=1/0,R=-1/0,O=1/0,U=-1/0;r.pos<n;){if(p<=0){var W=r.readVarint();o=7&W,p=W>>3}if(p--,o===1||o===2)(b+=r.readSVarint())<A&&(A=b),b>R&&(R=b),(M+=r.readSVarint())<O&&(O=M),M>U&&(U=M);else if(o!==7)throw new Error("unknown command "+o)}return[A,O,R,U]},pa.prototype.toGeoJSON=function(r,n,o){var p,b,M=this.extent*Math.pow(2,o),A=this.extent*r,R=this.extent*n,O=this.loadGeometry(),U=pa.types[this.type];function W(ae){for(var he=0;he<ae.length;he++){var _e=ae[he];ae[he]=[360*(_e.x+A)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(_e.y+R)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(p=0;p<O.length;p++)Y[p]=O[p][0];W(O=Y);break;case 2:for(p=0;p<O.length;p++)W(O[p]);break;case 3:for(O=function(ae){var he=ae.length;if(he<=1)return[ae];for(var _e,Ce,Ne=[],nt=0;nt<he;nt++){var ke=Sp(ae[nt]);ke!==0&&(Ce===void 0&&(Ce=ke<0),Ce===ke<0?(_e&&Ne.push(_e),_e=[ae[nt]]):_e.push(ae[nt]))}return _e&&Ne.push(_e),Ne}(O),p=0;p<O.length;p++)for(b=0;b<O[p].length;b++)W(O[p][b])}O.length===1?O=O[0]:U="Multi"+U;var ee={type:"Feature",geometry:{type:U,coordinates:O},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var fv=ag,$f=og;function og(r,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(dv,this,n),this.length=this._features.length}function dv(r,n,o){r===15?n.version=o.readVarint():r===1?n.name=o.readString():r===5?n.extent=o.readVarint():r===2?n._features.push(o.pos):r===3?n._keys.push(o.readString()):r===4&&n._values.push(function(p){for(var b=null,M=p.readVarint()+p.pos;p.pos<M;){var A=p.readVarint()>>3;b=A===1?p.readString():A===2?p.readFloat():A===3?p.readDouble():A===4?p.readVarint64():A===5?p.readVarint():A===6?p.readSVarint():A===7?p.readBoolean():null}return b}(o))}og.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var n=this._pbf.readVarint()+this._pbf.pos;return new fv(this._pbf,n,this.extent,this._keys,this._values)};var Xh=$f;function lg(r,n,o){if(r===3){var p=new Xh(o,o.readVarint()+o.pos);p.length&&(n[p.name]=p)}}ou.VectorTile=function(r,n){this.layers=r.readFields(lg,{},n)},ou.VectorTileFeature=ag,ou.VectorTileLayer=$f;const ug=ou.VectorTileFeature.types,Ep=Math.pow(2,13);function jh(r,n,o,p,b,M,A,R){r.emplaceBack(n,o,2*Math.floor(p*Ep)+A,b*Ep*2,M*Ep*2,Math.round(R))}class Tp{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new hl,this.centroidVertexArray=new Lr,this.indexArray=new ts,this.programConfigurations=new iu(n.layers,n.zoom),this.segments=new jr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,p){this.features=[],this.hasPattern=ml("fill-extrusion",this.layers,o);for(const{feature:b,id:M,index:A,sourceLayerIndex:R}of n){const O=this.layers[0]._featureFilter.needGeometry,U=ru(b,O);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),U,p))continue;const W={id:M,sourceLayerIndex:R,index:A,geometry:O?U.geometry:fl(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(bp("fill-extrusion",this.layers,W,this.zoom,o)):this.addFeature(W,W.geometry,A,p,{}),o.featureIndex.insert(b,W.geometry,A,R,this.index,!0)}}addFeatures(n,o,p){for(const b of this.features){const{geometry:M}=b;this.addFeature(b,M,b.index,o,p)}}update(n,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sg),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,cv.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,o,p,b,M){for(const A of Ls(o,500)){const R={x:0,y:0,vertexCount:0};let O=0;for(const he of A)O+=he.length;let U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const he of A){if(he.length===0||cg(he))continue;let _e=0;for(let Ce=0;Ce<he.length;Ce++){const Ne=he[Ce];if(Ce>=1){const nt=he[Ce-1];if(!pv(Ne,nt)){U.vertexLength+4>jr.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=Ne.sub(nt)._perp()._unit(),tt=nt.dist(Ne);_e+tt>32768&&(_e=0),jh(this.layoutVertexArray,Ne.x,Ne.y,ke.x,ke.y,0,0,_e),jh(this.layoutVertexArray,Ne.x,Ne.y,ke.x,ke.y,0,1,_e),R.x+=2*Ne.x,R.y+=2*Ne.y,R.vertexCount+=2,_e+=tt,jh(this.layoutVertexArray,nt.x,nt.y,ke.x,ke.y,0,0,_e),jh(this.layoutVertexArray,nt.x,nt.y,ke.x,ke.y,0,1,_e),R.x+=2*nt.x,R.y+=2*nt.y,R.vertexCount+=2;const pt=U.vertexLength;this.indexArray.emplaceBack(pt,pt+2,pt+1),this.indexArray.emplaceBack(pt+1,pt+2,pt+3),U.vertexLength+=4,U.primitiveLength+=2}}}}if(U.vertexLength+O>jr.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),ug[n.type]!=="Polygon")continue;const W=[],Y=[],ee=U.vertexLength;for(const he of A)if(he.length!==0){he!==A[0]&&Y.push(W.length/2);for(let _e=0;_e<he.length;_e++){const Ce=he[_e];jh(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),R.x+=Ce.x,R.y+=Ce.y,R.vertexCount+=1,W.push(Ce.x),W.push(Ce.y)}}const ae=Gf(W,Y);for(let he=0;he<ae.length;he+=3)this.indexArray.emplaceBack(ee+ae[he],ee+ae[he+2],ee+ae[he+1]);U.primitiveLength+=ae.length/3,U.vertexLength+=O;for(let he=0;he<R.vertexCount;he++){const _e=Math.floor(R.x/R.vertexCount),Ce=Math.floor(R.y/R.vertexCount);this.centroidVertexArray.emplaceBack(_e,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,M,b)}}function pv(r,n){return r.x===n.x&&(r.x<0||r.x>Ui)||r.y===n.y&&(r.y<0||r.y>Ui)}function cg(r){return r.every(n=>n.x<0)||r.every(n=>n.x>Ui)||r.every(n=>n.y<0)||r.every(n=>n.y>Ui)}let Mp;pn("FillExtrusionBucket",Tp,{omit:["layers","features"]});var mv={get paint(){return Mp=Mp||new y({"fill-extrusion-opacity":new In(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new T(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ap extends E{constructor(n){super(n,mv)}createBucket(n){return new Tp(n)}queryRadius(){return Vh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,o,p,b,M,A,R,O){const U=Gh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,R),W=this.paint.get("fill-extrusion-height").evaluate(o,p),Y=this.paint.get("fill-extrusion-base").evaluate(o,p),ee=function(he,_e,Ce,Ne){const nt=[];for(const ke of he){const tt=[ke.x,ke.y,0,1];Ms(tt,tt,_e),nt.push(new D(tt[0]/tt[3],tt[1]/tt[3]))}return nt}(U,O),ae=function(he,_e,Ce,Ne){const nt=[],ke=[],tt=Ne[8]*_e,pt=Ne[9]*_e,Wt=Ne[10]*_e,hn=Ne[11]*_e,rn=Ne[8]*Ce,un=Ne[9]*Ce,sn=Ne[10]*Ce,wn=Ne[11]*Ce;for(const _n of he){const dn=[],At=[];for(const Ln of _n){const Mn=Ln.x,Xn=Ln.y,Zi=Ne[0]*Mn+Ne[4]*Xn+Ne[12],Xi=Ne[1]*Mn+Ne[5]*Xn+Ne[13],ns=Ne[2]*Mn+Ne[6]*Xn+Ne[14],Ja=Ne[3]*Mn+Ne[7]*Xn+Ne[15],ps=ns+Wt,Mr=Ja+hn,zs=Zi+rn,ms=Xi+un,Bs=ns+sn,mr=Ja+wn,is=new D((Zi+tt)/Mr,(Xi+pt)/Mr);is.z=ps/Mr,dn.push(is);const Is=new D(zs/mr,ms/mr);Is.z=Bs/mr,At.push(Is)}nt.push(dn),ke.push(At)}return[nt,ke]}(b,Y,W,O);return function(he,_e,Ce){let Ne=1/0;mp(Ce,_e)&&(Ne=$c(Ce,_e[0]));for(let nt=0;nt<_e.length;nt++){const ke=_e[nt],tt=he[nt];for(let pt=0;pt<ke.length-1;pt++){const Wt=ke[pt],hn=[Wt,ke[pt+1],tt[pt+1],tt[pt],Wt];dl(Ce,hn)&&(Ne=Math.min(Ne,$c(Ce,hn)))}}return Ne!==1/0&&Ne}(ae[0],ae[1],ee)}}function qc(r,n){return r.x*n.x+r.y*n.y}function $c(r,n){if(r.length===1){let o=0;const p=n[o++];let b;for(;!b||p.equals(b);)if(b=n[o++],!b)return 1/0;for(;o<n.length;o++){const M=n[o],A=r[0],R=b.sub(p),O=M.sub(p),U=A.sub(p),W=qc(R,R),Y=qc(R,O),ee=qc(O,O),ae=qc(U,R),he=qc(U,O),_e=W*ee-Y*Y,Ce=(ee*ae-Y*he)/_e,Ne=(W*he-Y*ae)/_e,nt=p.z*(1-Ce-Ne)+b.z*Ce+M.z*Ne;if(isFinite(nt))return nt}return 1/0}{let o=1/0;for(const p of n)o=Math.min(o,p.z);return o}}const Ip=H([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hg}=Ip,fg=H([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Xf}=fg,dg=ou.VectorTileFeature.types,Go=Math.cos(Math.PI/180*37.5),lu=Math.pow(2,14)/.5;class Cp{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Lc,this.layoutVertexArray2=new Xu,this.indexArray=new ts,this.programConfigurations=new iu(n.layers,n.zoom),this.segments=new jr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,p){this.hasPattern=ml("line",this.layers,o);const b=this.layers[0].layout.get("line-sort-key"),M=!b.isConstant(),A=[];for(const{feature:R,id:O,index:U,sourceLayerIndex:W}of n){const Y=this.layers[0]._featureFilter.needGeometry,ee=ru(R,Y);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),ee,p))continue;const ae=M?b.evaluate(ee,{},p):void 0,he={id:O,properties:R.properties,type:R.type,sourceLayerIndex:W,index:U,geometry:Y?ee.geometry:fl(R),patterns:{},sortKey:ae};A.push(he)}M&&A.sort((R,O)=>R.sortKey-O.sortKey);for(const R of A){const{geometry:O,index:U,sourceLayerIndex:W}=R;if(this.hasPattern){const Y=bp("line",this.layers,R,this.zoom,o);this.patternFeatures.push(Y)}else this.addFeature(R,O,U,p,{});o.featureIndex.insert(n[U].feature,O,U,W,this.index)}}update(n,o,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,p)}addFeatures(n,o,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,o,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,Xf)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,hg),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,p,b,M){const A=this.layers[0].layout,R=A.get("line-join").evaluate(n,{}),O=A.get("line-cap"),U=A.get("line-miter-limit"),W=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const Y of o)this.addLine(Y,n,R,O,U,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,M,b)}addLine(n,o,p,b,M,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ne=0;Ne<n.length-1;Ne++)this.totalDistance+=n[Ne].dist(n[Ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=dg[o.type]==="Polygon";let O=n.length;for(;O>=2&&n[O-1].equals(n[O-2]);)O--;let U=0;for(;U<O-1&&n[U].equals(n[U+1]);)U++;if(O<(R?3:2))return;p==="bevel"&&(M=1.05);const W=this.overscaling<=16?15*Ui/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let ee,ae,he,_e,Ce;this.e1=this.e2=-1,R&&(ee=n[O-2],Ce=n[U].sub(ee)._unit()._perp());for(let Ne=U;Ne<O;Ne++){if(he=Ne===O-1?R?n[U+1]:void 0:n[Ne+1],he&&n[Ne].equals(he))continue;Ce&&(_e=Ce),ee&&(ae=ee),ee=n[Ne],Ce=he?he.sub(ee)._unit()._perp():_e,_e=_e||Ce;let nt=_e.add(Ce);nt.x===0&&nt.y===0||nt._unit();const ke=_e.x*Ce.x+_e.y*Ce.y,tt=nt.x*Ce.x+nt.y*Ce.y,pt=tt!==0?1/tt:1/0,Wt=2*Math.sqrt(2-2*tt),hn=tt<Go&&ae&&he,rn=_e.x*Ce.y-_e.y*Ce.x>0;if(hn&&Ne>U){const wn=ee.dist(ae);if(wn>2*W){const _n=ee.sub(ee.sub(ae)._mult(W/wn)._round());this.updateDistance(ae,_n),this.addCurrentVertex(_n,_e,0,0,Y),ae=_n}}const un=ae&&he;let sn=un?p:R?"butt":b;if(un&&sn==="round"&&(pt<A?sn="miter":pt<=2&&(sn="fakeround")),sn==="miter"&&pt>M&&(sn="bevel"),sn==="bevel"&&(pt>2&&(sn="flipbevel"),pt<M&&(sn="miter")),ae&&this.updateDistance(ae,ee),sn==="miter")nt._mult(pt),this.addCurrentVertex(ee,nt,0,0,Y);else if(sn==="flipbevel"){if(pt>100)nt=Ce.mult(-1);else{const wn=pt*_e.add(Ce).mag()/_e.sub(Ce).mag();nt._perp()._mult(wn*(rn?-1:1))}this.addCurrentVertex(ee,nt,0,0,Y),this.addCurrentVertex(ee,nt.mult(-1),0,0,Y)}else if(sn==="bevel"||sn==="fakeround"){const wn=-Math.sqrt(pt*pt-1),_n=rn?wn:0,dn=rn?0:wn;if(ae&&this.addCurrentVertex(ee,_e,_n,dn,Y),sn==="fakeround"){const At=Math.round(180*Wt/Math.PI/20);for(let Ln=1;Ln<At;Ln++){let Mn=Ln/At;if(Mn!==.5){const Zi=Mn-.5;Mn+=Mn*Zi*(Mn-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Zi*Zi+(.848013+ke*(.215638*ke-1.06021)))}const Xn=Ce.sub(_e)._mult(Mn)._add(_e)._unit()._mult(rn?-1:1);this.addHalfVertex(ee,Xn.x,Xn.y,!1,rn,0,Y)}}he&&this.addCurrentVertex(ee,Ce,-_n,-dn,Y)}else if(sn==="butt")this.addCurrentVertex(ee,nt,0,0,Y);else if(sn==="square"){const wn=ae?1:-1;this.addCurrentVertex(ee,nt,wn,wn,Y)}else sn==="round"&&(ae&&(this.addCurrentVertex(ee,_e,0,0,Y),this.addCurrentVertex(ee,_e,1,1,Y,!0)),he&&(this.addCurrentVertex(ee,Ce,-1,-1,Y,!0),this.addCurrentVertex(ee,Ce,0,0,Y)));if(hn&&Ne<O-1){const wn=ee.dist(he);if(wn>2*W){const _n=ee.add(he.sub(ee)._mult(W/wn)._round());this.updateDistance(ee,_n),this.addCurrentVertex(_n,Ce,0,0,Y),ee=_n}}}}addCurrentVertex(n,o,p,b,M,A=!1){const R=o.y*b-o.x,O=-o.y-o.x*b;this.addHalfVertex(n,o.x+o.y*p,o.y-o.x*p,A,!1,p,M),this.addHalfVertex(n,R,O,A,!0,-b,M),this.distance>lu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,o,p,b,M,A))}addHalfVertex({x:n,y:o},p,b,M,A,R,O){const U=.5*(this.lineClips?this.scaledDistance*(lu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(M?1:0),(o<<1)+(A?1:0),Math.round(63*p)+128,Math.round(63*b)+128,1+(R===0?0:R<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const W=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,W),O.primitiveLength++),A?this.e2=W:this.e1=W}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}let Rp,pg;pn("LineBucket",Cp,{omit:["layers","patternFeatures"]});var mg={get paint(){return pg=pg||new y({"line-opacity":new Pn(Ze.paint_line["line-opacity"]),"line-color":new Pn(Ze.paint_line["line-color"]),"line-translate":new In(Ze.paint_line["line-translate"]),"line-translate-anchor":new In(Ze.paint_line["line-translate-anchor"]),"line-width":new Pn(Ze.paint_line["line-width"]),"line-gap-width":new Pn(Ze.paint_line["line-gap-width"]),"line-offset":new Pn(Ze.paint_line["line-offset"]),"line-blur":new Pn(Ze.paint_line["line-blur"]),"line-dasharray":new i(Ze.paint_line["line-dasharray"]),"line-pattern":new T(Ze.paint_line["line-pattern"]),"line-gradient":new h(Ze.paint_line["line-gradient"])})},get layout(){return Rp=Rp||new y({"line-cap":new In(Ze.layout_line["line-cap"]),"line-join":new Pn(Ze.layout_line["line-join"]),"line-miter-limit":new In(Ze.layout_line["line-miter-limit"]),"line-round-limit":new In(Ze.layout_line["line-round-limit"]),"line-sort-key":new Pn(Ze.layout_line["line-sort-key"])})}};class gv extends Pn{possiblyEvaluate(n,o){return o=new nr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,p,b){return o=Te({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,p,b)}}let jf;class _v extends E{constructor(n){super(n,mg),this.gradientVersion=0,jf||(jf=new gv(mg.paint.properties["line-width"].specification),jf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const o=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(o)&&o._styleExpression.expression instanceof Ro,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,o){super.recalculate(n,o),this.paint._values["line-floorwidth"]=jf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Cp(n)}queryRadius(n){const o=n,p=gg(Za("line-width",this,o),Za("line-gap-width",this,o)),b=Za("line-offset",this,o);return p/2+Math.abs(b)+Vh(this.paint.get("line-translate"))}queryIntersectsFeature(n,o,p,b,M,A,R){const O=Gh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,R),U=R/2*gg(this.paint.get("line-width").evaluate(o,p),this.paint.get("line-gap-width").evaluate(o,p)),W=this.paint.get("line-offset").evaluate(o,p);return W&&(b=function(Y,ee){const ae=[];for(let he=0;he<Y.length;he++){const _e=Y[he],Ce=[];for(let Ne=0;Ne<_e.length;Ne++){const nt=_e[Ne-1],ke=_e[Ne],tt=_e[Ne+1],pt=Ne===0?new D(0,0):ke.sub(nt)._unit()._perp(),Wt=Ne===_e.length-1?new D(0,0):tt.sub(ke)._unit()._perp(),hn=pt._add(Wt)._unit(),rn=hn.x*Wt.x+hn.y*Wt.y;rn!==0&&hn._mult(1/rn),Ce.push(hn._mult(ee)._add(ke))}ae.push(Ce)}return ae}(b,W*R)),function(Y,ee,ae){for(let he=0;he<ee.length;he++){const _e=ee[he];if(Y.length>=3){for(let Ce=0;Ce<_e.length;Ce++)if(Ia(Y,_e[Ce]))return!0}if(Lf(Y,_e,ae))return!0}return!1}(O,b,U)}isTileClipped(){return!0}}function gg(r,n){return n>0?n+2*r:r}const yv=H([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vv=H([{name:"a_projected_pos",components:3,type:"Float32"}],4);H([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xv=H([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);H([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _g=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bv=H([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yg(r,n,o){return r.sections.forEach(p=>{p.text=function(b,M,A){const R=M.layout.get("text-transform").evaluate(A,{});return R==="uppercase"?b=b.toLocaleUpperCase():R==="lowercase"&&(b=b.toLocaleLowerCase()),Bo.applyArabicShaping&&(b=Bo.applyArabicShaping(b)),b}(p.text,n,o)}),r}H([{name:"triangle",components:3,type:"Uint16"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),H([{type:"Float32",name:"offsetX"}]),H([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),H([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Xc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Vr=24,vg=qi,xg=function(r,n,o,p,b){var M,A,R=8*b-p-1,O=(1<<R)-1,U=O>>1,W=-7,Y=b-1,ee=-1,ae=r[n+Y];for(Y+=ee,M=ae&(1<<-W)-1,ae>>=-W,W+=R;W>0;M=256*M+r[n+Y],Y+=ee,W-=8);for(A=M&(1<<-W)-1,M>>=-W,W+=p;W>0;A=256*A+r[n+Y],Y+=ee,W-=8);if(M===0)M=1-U;else{if(M===O)return A?NaN:1/0*(ae?-1:1);A+=Math.pow(2,p),M-=U}return(ae?-1:1)*A*Math.pow(2,M-p)},bg=function(r,n,o,p,b,M){var A,R,O,U=8*M-b-1,W=(1<<U)-1,Y=W>>1,ee=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=0,he=1,_e=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(R=isNaN(n)?1:0,A=W):(A=Math.floor(Math.log(n)/Math.LN2),n*(O=Math.pow(2,-A))<1&&(A--,O*=2),(n+=A+Y>=1?ee/O:ee*Math.pow(2,1-Y))*O>=2&&(A++,O/=2),A+Y>=W?(R=0,A=W):A+Y>=1?(R=(n*O-1)*Math.pow(2,b),A+=Y):(R=n*Math.pow(2,Y-1)*Math.pow(2,b),A=0));b>=8;r[o+ae]=255&R,ae+=he,R/=256,b-=8);for(A=A<<b|R,U+=b;U>0;r[o+ae]=255&A,ae+=he,A/=256,U-=8);r[o+ae-he]|=128*_e};function qi(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}qi.Varint=0,qi.Fixed64=1,qi.Bytes=2,qi.Fixed32=5;var Pp=4294967296,wg=1/Pp,Sg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function gl(r){return r.type===qi.Bytes?r.readVarint()+r.pos:r.pos+1}function jc(r,n,o){return o?4294967296*n+(r>>>0):4294967296*(n>>>0)+(r>>>0)}function Eg(r,n,o){var p=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(p);for(var b=o.pos-1;b>=r;b--)o.buf[b+p]=o.buf[b]}function Ka(r,n){for(var o=0;o<r.length;o++)n.writeVarint(r[o])}function wv(r,n){for(var o=0;o<r.length;o++)n.writeSVarint(r[o])}function Sv(r,n){for(var o=0;o<r.length;o++)n.writeFloat(r[o])}function Ev(r,n){for(var o=0;o<r.length;o++)n.writeDouble(r[o])}function Tg(r,n){for(var o=0;o<r.length;o++)n.writeBoolean(r[o])}function Tv(r,n){for(var o=0;o<r.length;o++)n.writeFixed32(r[o])}function Mv(r,n){for(var o=0;o<r.length;o++)n.writeSFixed32(r[o])}function Av(r,n){for(var o=0;o<r.length;o++)n.writeFixed64(r[o])}function Iv(r,n){for(var o=0;o<r.length;o++)n.writeSFixed64(r[o])}function Zc(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+16777216*r[n+3]}function Yc(r,n,o){r[o]=n,r[o+1]=n>>>8,r[o+2]=n>>>16,r[o+3]=n>>>24}function Mg(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+(r[n+3]<<24)}qi.prototype={destroy:function(){this.buf=null},readFields:function(r,n,o){for(o=o||this.length;this.pos<o;){var p=this.readVarint(),b=p>>3,M=this.pos;this.type=7&p,r(b,n,this),this.pos===M&&this.skip(p)}return n},readMessage:function(r,n){return this.readFields(r,n,this.readVarint()+this.pos)},readFixed32:function(){var r=Zc(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Mg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Zc(this.buf,this.pos)+Zc(this.buf,this.pos+4)*Pp;return this.pos+=8,r},readSFixed64:function(){var r=Zc(this.buf,this.pos)+Mg(this.buf,this.pos+4)*Pp;return this.pos+=8,r},readFloat:function(){var r=xg(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=xg(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var n,o,p=this.buf;return n=127&(o=p[this.pos++]),o<128?n:(n|=(127&(o=p[this.pos++]))<<7,o<128?n:(n|=(127&(o=p[this.pos++]))<<14,o<128?n:(n|=(127&(o=p[this.pos++]))<<21,o<128?n:function(b,M,A){var R,O,U=A.buf;if(R=(112&(O=U[A.pos++]))>>4,O<128||(R|=(127&(O=U[A.pos++]))<<3,O<128)||(R|=(127&(O=U[A.pos++]))<<10,O<128)||(R|=(127&(O=U[A.pos++]))<<17,O<128)||(R|=(127&(O=U[A.pos++]))<<24,O<128)||(R|=(1&(O=U[A.pos++]))<<31,O<128))return jc(b,R,M);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=p[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,n=this.pos;return this.pos=r,r-n>=12&&Sg?function(o,p,b){return Sg.decode(o.subarray(p,b))}(this.buf,n,r):function(o,p,b){for(var M="",A=p;A<b;){var R,O,U,W=o[A],Y=null,ee=W>239?4:W>223?3:W>191?2:1;if(A+ee>b)break;ee===1?W<128&&(Y=W):ee===2?(192&(R=o[A+1]))==128&&(Y=(31&W)<<6|63&R)<=127&&(Y=null):ee===3?(O=o[A+2],(192&(R=o[A+1]))==128&&(192&O)==128&&((Y=(15&W)<<12|(63&R)<<6|63&O)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):ee===4&&(O=o[A+2],U=o[A+3],(192&(R=o[A+1]))==128&&(192&O)==128&&(192&U)==128&&((Y=(15&W)<<18|(63&R)<<12|(63&O)<<6|63&U)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,ee=1):Y>65535&&(Y-=65536,M+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),M+=String.fromCharCode(Y),A+=ee}return M}(this.buf,n,r)},readBytes:function(){var r=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,r);return this.pos=r,n},readPackedVarint:function(r,n){if(this.type!==qi.Bytes)return r.push(this.readVarint(n));var o=gl(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(n));return r},readPackedSVarint:function(r){if(this.type!==qi.Bytes)return r.push(this.readSVarint());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==qi.Bytes)return r.push(this.readBoolean());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==qi.Bytes)return r.push(this.readFloat());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==qi.Bytes)return r.push(this.readDouble());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==qi.Bytes)return r.push(this.readFixed32());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==qi.Bytes)return r.push(this.readSFixed32());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==qi.Bytes)return r.push(this.readFixed64());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==qi.Bytes)return r.push(this.readSFixed64());var n=gl(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed64());return r},skip:function(r){var n=7&r;if(n===qi.Varint)for(;this.buf[this.pos++]>127;);else if(n===qi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===qi.Fixed32)this.pos+=4;else{if(n!==qi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(r,n){this.writeVarint(r<<3|n)},realloc:function(r){for(var n=this.length||16;n<this.pos+r;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Yc(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Yc(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Yc(this.buf,-1&r,this.pos),Yc(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Yc(this.buf,-1&r,this.pos),Yc(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(n,o){var p,b;if(n>=0?(p=n%4294967296|0,b=n/4294967296|0):(b=~(-n/4294967296),4294967295^(p=~(-n%4294967296))?p=p+1|0:(p=0,b=b+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(M,A,R){R.buf[R.pos++]=127&M|128,M>>>=7,R.buf[R.pos++]=127&M|128,M>>>=7,R.buf[R.pos++]=127&M|128,M>>>=7,R.buf[R.pos++]=127&M|128,R.buf[R.pos]=127&(M>>>=7)}(p,0,o),function(M,A){var R=(7&M)<<4;A.buf[A.pos++]|=R|((M>>>=3)?128:0),M&&(A.buf[A.pos++]=127&M|((M>>>=7)?128:0),M&&(A.buf[A.pos++]=127&M|((M>>>=7)?128:0),M&&(A.buf[A.pos++]=127&M|((M>>>=7)?128:0),M&&(A.buf[A.pos++]=127&M|((M>>>=7)?128:0),M&&(A.buf[A.pos++]=127&M)))))}(b,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var n=this.pos;this.pos=function(p,b,M){for(var A,R,O=0;O<b.length;O++){if((A=b.charCodeAt(O))>55295&&A<57344){if(!R){A>56319||O+1===b.length?(p[M++]=239,p[M++]=191,p[M++]=189):R=A;continue}if(A<56320){p[M++]=239,p[M++]=191,p[M++]=189,R=A;continue}A=R-55296<<10|A-56320|65536,R=null}else R&&(p[M++]=239,p[M++]=191,p[M++]=189,R=null);A<128?p[M++]=A:(A<2048?p[M++]=A>>6|192:(A<65536?p[M++]=A>>12|224:(p[M++]=A>>18|240,p[M++]=A>>12&63|128),p[M++]=A>>6&63|128),p[M++]=63&A|128)}return M}(this.buf,r,this.pos);var o=this.pos-n;o>=128&&Eg(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),bg(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),bg(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var n=r.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,n){this.pos++;var o=this.pos;r(n,this);var p=this.pos-o;p>=128&&Eg(o,p,this),this.pos=o-1,this.writeVarint(p),this.pos+=p},writeMessage:function(r,n,o){this.writeTag(r,qi.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(r,n){n.length&&this.writeMessage(r,Ka,n)},writePackedSVarint:function(r,n){n.length&&this.writeMessage(r,wv,n)},writePackedBoolean:function(r,n){n.length&&this.writeMessage(r,Tg,n)},writePackedFloat:function(r,n){n.length&&this.writeMessage(r,Sv,n)},writePackedDouble:function(r,n){n.length&&this.writeMessage(r,Ev,n)},writePackedFixed32:function(r,n){n.length&&this.writeMessage(r,Tv,n)},writePackedSFixed32:function(r,n){n.length&&this.writeMessage(r,Mv,n)},writePackedFixed64:function(r,n){n.length&&this.writeMessage(r,Av,n)},writePackedSFixed64:function(r,n){n.length&&this.writeMessage(r,Iv,n)},writeBytesField:function(r,n){this.writeTag(r,qi.Bytes),this.writeBytes(n)},writeFixed32Field:function(r,n){this.writeTag(r,qi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(r,n){this.writeTag(r,qi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(r,n){this.writeTag(r,qi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(r,n){this.writeTag(r,qi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(r,n){this.writeTag(r,qi.Varint),this.writeVarint(n)},writeSVarintField:function(r,n){this.writeTag(r,qi.Varint),this.writeSVarint(n)},writeStringField:function(r,n){this.writeTag(r,qi.Bytes),this.writeString(n)},writeFloatField:function(r,n){this.writeTag(r,qi.Fixed32),this.writeFloat(n)},writeDoubleField:function(r,n){this.writeTag(r,qi.Fixed64),this.writeDouble(n)},writeBooleanField:function(r,n){this.writeVarintField(r,!!n)}};var Lp=I(vg);const kp=3;function Cv(r,n,o){r===1&&o.readMessage(Rv,n)}function Rv(r,n,o){if(r===3){const{id:p,bitmap:b,width:M,height:A,left:R,top:O,advance:U}=o.readMessage(Pv,{});n.push({id:p,bitmap:new Uc({width:M+2*kp,height:A+2*kp},b),metrics:{width:M,height:A,left:R,top:O,advance:U}})}}function Pv(r,n,o){r===1?n.id=o.readVarint():r===2?n.bitmap=o.readBytes():r===3?n.width=o.readVarint():r===4?n.height=o.readVarint():r===5?n.left=o.readSVarint():r===6?n.top=o.readSVarint():r===7&&(n.advance=o.readVarint())}const Ag=kp;function Ig(r){let n=0,o=0;for(const A of r)n+=A.w*A.h,o=Math.max(o,A.w);r.sort((A,R)=>R.h-A.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let b=0,M=0;for(const A of r)for(let R=p.length-1;R>=0;R--){const O=p[R];if(!(A.w>O.w||A.h>O.h)){if(A.x=O.x,A.y=O.y,M=Math.max(M,A.y+A.h),b=Math.max(b,A.x+A.w),A.w===O.w&&A.h===O.h){const U=p.pop();R<p.length&&(p[R]=U)}else A.h===O.h?(O.x+=A.w,O.w-=A.w):A.w===O.w?(O.y+=A.h,O.h-=A.h):(p.push({x:O.x+A.w,y:O.y,w:O.w-A.w,h:A.h}),O.y+=A.h,O.h-=A.h);break}}return{w:b,h:M,fill:n/(b*M)||0}}const ta=1;class Dp{constructor(n,{pixelRatio:o,version:p,stretchX:b,stretchY:M,content:A,textFitWidth:R,textFitHeight:O}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=b,this.stretchY=M,this.content=A,this.version=p,this.textFitWidth=R,this.textFitHeight=O}get tl(){return[this.paddedRect.x+ta,this.paddedRect.y+ta]}get br(){return[this.paddedRect.x+this.paddedRect.w-ta,this.paddedRect.y+this.paddedRect.h-ta]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ta)/this.pixelRatio,(this.paddedRect.h-2*ta)/this.pixelRatio]}}class Cg{constructor(n,o){const p={},b={};this.haveRenderCallbacks=[];const M=[];this.addImages(n,p,M),this.addImages(o,b,M);const{w:A,h:R}=Ig(M),O=new fs({width:A||1,height:R||1});for(const U in n){const W=n[U],Y=p[U].paddedRect;fs.copy(W.data,O,{x:0,y:0},{x:Y.x+ta,y:Y.y+ta},W.data)}for(const U in o){const W=o[U],Y=b[U].paddedRect,ee=Y.x+ta,ae=Y.y+ta,he=W.data.width,_e=W.data.height;fs.copy(W.data,O,{x:0,y:0},{x:ee,y:ae},W.data),fs.copy(W.data,O,{x:0,y:_e-1},{x:ee,y:ae-1},{width:he,height:1}),fs.copy(W.data,O,{x:0,y:0},{x:ee,y:ae+_e},{width:he,height:1}),fs.copy(W.data,O,{x:he-1,y:0},{x:ee-1,y:ae},{width:1,height:_e}),fs.copy(W.data,O,{x:0,y:0},{x:ee+he,y:ae},{width:1,height:_e})}this.image=O,this.iconPositions=p,this.patternPositions=b}addImages(n,o,p){for(const b in n){const M=n[b],A={x:0,y:0,w:M.data.width+2*ta,h:M.data.height+2*ta};p.push(A),o[b]=new Dp(A,M),M.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(n,o){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in n.updatedImages)this.patchUpdatedImage(this.iconPositions[p],n.getImage(p),o),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p),o)}patchUpdatedImage(n,o,p){if(!n||!o||n.version===o.version)return;n.version=o.version;const[b,M]=n.tl;p.update(o.data,void 0,{x:b,y:M})}}var uu;pn("ImagePosition",Dp),pn("ImageAtlas",Cg),_.ai=void 0,(uu=_.ai||(_.ai={}))[uu.none=0]="none",uu[uu.horizontal=1]="horizontal",uu[uu.vertical=2]="vertical",uu[uu.horizontalOnly=3]="horizontalOnly";const Zh=-17;class Yh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const p=new Yh;return p.scale=n||1,p.fontStack=o,p}static forImage(n){const o=new Yh;return o.imageName=n,o}}class Kc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const p=new Kc;for(let b=0;b<n.sections.length;b++){const M=n.sections[b];M.image?p.addImageSection(M):p.addTextSection(M,o)}return p}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let o="";for(let p=0;p<n.length;p++){const b=n.charCodeAt(p+1)||null,M=n.charCodeAt(p-1)||null;o+=b&&Mf(b)&&!Xc[n[p+1]]||M&&Mf(M)&&!Xc[n[p-1]]||!Xc[n[p]]?n[p]:Xc[n[p]]}return o}(this.text)}trim(){let n=0;for(let p=0;p<this.text.length&&Yf[this.text.charCodeAt(p)];p++)n++;let o=this.text.length;for(let p=this.text.length-1;p>=0&&p>=n&&Yf[this.text.charCodeAt(p)];p--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const p=new Kc;return p.text=this.text.substring(n,o),p.sectionIndex=this.sectionIndex.slice(n,o),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(Yh.forText(n.scale,n.fontStack||o));const p=this.sections.length-1;for(let b=0;b<n.text.length;++b)this.sectionIndex.push(p)}addImageSection(n){const o=n.image?n.image.name:"";if(o.length===0)return void st("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Yh.forImage(o)),this.sectionIndex.push(this.sections.length-1)):st("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zf(r,n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he){const _e=Kc.fromFeature(r,b);let Ce;Y===_.ai.vertical&&_e.verticalizePunctuation();const{processBidirectionalText:Ne,processStyledBidirectionalText:nt}=Bo;if(Ne&&_e.sections.length===1){Ce=[];const pt=Ne(_e.toString(),Op(_e,U,M,n,p,ae));for(const Wt of pt){const hn=new Kc;hn.text=Wt,hn.sections=_e.sections;for(let rn=0;rn<Wt.length;rn++)hn.sectionIndex.push(0);Ce.push(hn)}}else if(nt){Ce=[];const pt=nt(_e.text,_e.sectionIndex,Op(_e,U,M,n,p,ae));for(const Wt of pt){const hn=new Kc;hn.text=Wt[0],hn.sectionIndex=Wt[1],hn.sections=_e.sections,Ce.push(hn)}}else Ce=function(pt,Wt){const hn=[],rn=pt.text;let un=0;for(const sn of Wt)hn.push(pt.substring(un,sn)),un=sn;return un<rn.length&&hn.push(pt.substring(un,rn.length)),hn}(_e,Op(_e,U,M,n,p,ae));const ke=[],tt={positionedLines:ke,text:_e.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(pt,Wt,hn,rn,un,sn,wn,_n,dn,At,Ln,Mn){let Xn=0,Zi=Zh,Xi=0,ns=0;const Ja=_n==="right"?1:_n==="left"?0:.5;let ps=0;for(const mr of un){mr.trim();const is=mr.getMaxScale(),Is=(is-1)*Vr,gs={positionedGlyphs:[],lineOffset:0};pt.positionedLines[ps]=gs;const Vi=gs.positionedGlyphs;let ji=0;if(!mr.length()){Zi+=sn,++ps;continue}for(let na=0;na<mr.length();na++){const Ti=mr.getSection(na),Yi=mr.getSectionIndex(na),ur=mr.getCharCode(na);let ga=0,br=null,rc=null,Wo=null,qo=Vr;const Qa=!(dn===_.ai.horizontal||!Ln&&!vi(ur)||Ln&&(Yf[ur]||(Mr=ur,se.Arabic(Mr)||se["Arabic Supplement"](Mr)||se["Arabic Extended-A"](Mr)||se["Arabic Presentation Forms-A"](Mr)||se["Arabic Presentation Forms-B"](Mr))));if(Ti.imageName){const _a=rn[Ti.imageName];if(!_a)continue;Wo=Ti.imageName,pt.iconsInText=pt.iconsInText||!0,rc=_a.paddedRect;const rs=_a.displaySize;Ti.scale=Ti.scale*Vr/Mn,br={width:rs[0],height:rs[1],left:ta,top:-Ag,advance:Qa?rs[1]:rs[0]},ga=Is+(Vr-rs[1]*Ti.scale),qo=br.advance;const vl=Qa?rs[0]*Ti.scale-Vr*is:rs[1]*Ti.scale-Vr*is;vl>0&&vl>ji&&(ji=vl)}else{const _a=hn[Ti.fontStack],rs=_a&&_a[ur];if(rs&&rs.rect)rc=rs.rect,br=rs.metrics;else{const vl=Wt[Ti.fontStack],Qh=vl&&vl[ur];if(!Qh)continue;br=Qh.metrics}ga=(is-Ti.scale)*Vr}Qa?(pt.verticalizable=!0,Vi.push({glyph:ur,imageName:Wo,x:Xn,y:Zi+ga,vertical:Qa,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Yi,metrics:br,rect:rc}),Xn+=qo*Ti.scale+At):(Vi.push({glyph:ur,imageName:Wo,x:Xn,y:Zi+ga,vertical:Qa,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Yi,metrics:br,rect:rc}),Xn+=br.advance*Ti.scale+At)}Vi.length!==0&&(Xi=Math.max(Xn-At,Xi),Nv(Vi,0,Vi.length-1,Ja,ji)),Xn=0;const Ra=sn*is+ji;gs.lineOffset=Math.max(ji,Is),Zi+=Ra,ns=Math.max(Ra,ns),++ps}var Mr;const zs=Zi-Zh,{horizontalAlign:ms,verticalAlign:Bs}=Fp(wn);(function(mr,is,Is,gs,Vi,ji,Ra,na,Ti){const Yi=(is-Is)*Vi;let ur=0;ur=ji!==Ra?-na*gs-Zh:(-gs*Ti+.5)*Ra;for(const ga of mr)for(const br of ga.positionedGlyphs)br.x+=Yi,br.y+=ur})(pt.positionedLines,Ja,ms,Bs,Xi,ns,sn,zs,un.length),pt.top+=-Bs*zs,pt.bottom=pt.top+zs,pt.left+=-ms*Xi,pt.right=pt.left+Xi}(tt,n,o,p,Ce,A,R,O,Y,U,ee,he),!function(pt){for(const Wt of pt)if(Wt.positionedGlyphs.length!==0)return!1;return!0}(ke)&&tt}const Yf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},kv={40:!0};function Kf(r,n,o,p,b,M){if(n.imageName){const A=p[n.imageName];return A?A.displaySize[0]*n.scale*Vr/M+b:0}{const A=o[n.fontStack],R=A&&A[r];return R?R.metrics.advance*n.scale+b:0}}function Np(r,n,o,p){const b=Math.pow(r-n,2);return p?r<n?b/2:2*b:b+Math.abs(o)*o}function Dv(r,n,o){let p=0;return r===10&&(p-=1e4),o&&(p+=150),r!==40&&r!==65288||(p+=50),n!==41&&n!==65289||(p+=50),p}function Rg(r,n,o,p,b,M){let A=null,R=Np(n,o,b,M);for(const O of p){const U=Np(n-O.x,o,b,M)+O.badness;U<=R&&(A=O,R=U)}return{index:r,x:n,priorBreak:A,badness:R}}function Pg(r){return r?Pg(r.priorBreak).concat(r.index):[]}function Op(r,n,o,p,b,M){if(!r)return[];const A=[],R=function(Y,ee,ae,he,_e,Ce){let Ne=0;for(let nt=0;nt<Y.length();nt++){const ke=Y.getSection(nt);Ne+=Kf(Y.getCharCode(nt),ke,he,_e,ee,Ce)}return Ne/Math.max(1,Math.ceil(Ne/ae))}(r,n,o,p,b,M),O=r.text.indexOf("​")>=0;let U=0;for(let Y=0;Y<r.length();Y++){const ee=r.getSection(Y),ae=r.getCharCode(Y);if(Yf[ae]||(U+=Kf(ae,ee,p,b,n,M)),Y<r.length()-1){const he=!((W=ae)<11904||!(se["Bopomofo Extended"](W)||se.Bopomofo(W)||se["CJK Compatibility Forms"](W)||se["CJK Compatibility Ideographs"](W)||se["CJK Compatibility"](W)||se["CJK Radicals Supplement"](W)||se["CJK Strokes"](W)||se["CJK Symbols and Punctuation"](W)||se["CJK Unified Ideographs Extension A"](W)||se["CJK Unified Ideographs"](W)||se["Enclosed CJK Letters and Months"](W)||se["Halfwidth and Fullwidth Forms"](W)||se.Hiragana(W)||se["Ideographic Description Characters"](W)||se["Kangxi Radicals"](W)||se["Katakana Phonetic Extensions"](W)||se.Katakana(W)||se["Vertical Forms"](W)||se["Yi Radicals"](W)||se["Yi Syllables"](W)));(Lv[ae]||he||ee.imageName||Y!==r.length()-2&&kv[r.getCharCode(Y+1)])&&A.push(Rg(Y+1,U,R,A,Dv(ae,r.getCharCode(Y+1),he&&O),!1))}}var W;return Pg(Rg(r.length(),U,R,A,0,!0))}function Fp(r){let n=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function Nv(r,n,o,p,b){if(!p&&!b)return;const M=r[o],A=(r[o].x+M.metrics.advance*M.scale)*p;for(let R=n;R<=o;R++)r[R].x-=A,r[R].y+=b}function Ov(r,n,o){const{horizontalAlign:p,verticalAlign:b}=Fp(o),M=n[0]-r.displaySize[0]*p,A=n[1]-r.displaySize[1]*b;return{image:r,top:A,bottom:A+r.displaySize[1],left:M,right:M+r.displaySize[0]}}function Lg(r){var n,o;let p=r.left,b=r.top,M=r.right-p,A=r.bottom-b;const R=(n=r.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",O=(o=r.image.textFitHeight)!==null&&o!==void 0?o:"stretchOrShrink",U=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(O==="proportional"){if(R==="stretchOnly"&&M/A<U||R==="proportional"){const W=Math.ceil(A*U);p*=W/M,M=W}}else if(R==="proportional"&&O==="stretchOnly"&&U!==0&&M/A>U){const W=Math.ceil(M/U);b*=W/A,A=W}return{x1:p,y1:b,x2:p+M,y2:b+A}}function zp(r,n,o,p,b,M){const A=r.image;let R;if(A.content){const Ce=A.content,Ne=A.pixelRatio||1;R=[Ce[0]/Ne,Ce[1]/Ne,A.displaySize[0]-Ce[2]/Ne,A.displaySize[1]-Ce[3]/Ne]}const O=n.left*M,U=n.right*M;let W,Y,ee,ae;o==="width"||o==="both"?(ae=b[0]+O-p[3],Y=b[0]+U+p[1]):(ae=b[0]+(O+U-A.displaySize[0])/2,Y=ae+A.displaySize[0]);const he=n.top*M,_e=n.bottom*M;return o==="height"||o==="both"?(W=b[1]+he-p[0],ee=b[1]+_e+p[2]):(W=b[1]+(he+_e-A.displaySize[1])/2,ee=W+A.displaySize[1]),{image:A,top:W,right:Y,bottom:ee,left:ae,collisionPadding:R}}const Kh=255,Ca=128,cu=Kh*Ca;function kg(r,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new nr(r+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:b}=o;let M=0;for(;M<p.length&&p[M]<=r;)M++;M=Math.max(0,M-1);let A=M;for(;A<p.length&&p[A]<r+1;)A++;A=Math.min(p.length-1,A);const R=p[M],O=p[A];return o.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:O,interpolationType:b}:{kind:"camera",minZoom:R,maxZoom:O,minSize:o.evaluate(new nr(R)),maxSize:o.evaluate(new nr(O)),interpolationType:b}}}function Bp(r,n,o){let p="never";const b=r.get(n);return b?p=b:r.get(o)&&(p="always"),p}const Fv=ou.VectorTileFeature.types,zv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jf(r,n,o,p,b,M,A,R,O,U,W,Y,ee){const ae=R?Math.min(cu,Math.round(R[0])):0,he=R?Math.min(cu,Math.round(R[1])):0;r.emplaceBack(n,o,Math.round(32*p),Math.round(32*b),M,A,(ae<<1)+(O?1:0),he,16*U,16*W,256*Y,256*ee)}function Up(r,n,o){r.emplaceBack(n.x,n.y,o),r.emplaceBack(n.x,n.y,o),r.emplaceBack(n.x,n.y,o),r.emplaceBack(n.x,n.y,o)}function Bv(r){for(const n of r.sections)if(_o(n.text))return!0;return!1}class Vp{constructor(n){this.layoutVertexArray=new Ts,this.indexArray=new ts,this.programConfigurations=n,this.segments=new jr,this.dynamicLayoutVertexArray=new yo,this.opacityVertexArray=new eu,this.hasVisibleVertices=!1,this.placedSymbolArray=new ir}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,o,p,b){this.isEmpty()||(p&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,yv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,vv.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,zv,!0),this.opacityVertexBuffer.itemSize=1),(p||b)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pn("SymbolBuffers",Vp);class Gp{constructor(n,o,p){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new p,this.segments=new jr,this.collisionVertexArray=new Ur}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,xv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pn("CollisionBuffers",Gp);class Jc{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(A=>A.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zf([]),this.placementViewportMatrix=zf([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kg(this.zoom,o["text-size"]),this.iconSizeData=kg(this.zoom,o["icon-size"]);const p=this.layers[0].layout,b=p.get("symbol-sort-key"),M=p.get("symbol-z-order");this.canOverlap=Bp(p,"text-overlap","text-allow-overlap")!=="never"||Bp(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=M!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(M==="viewport-y"||M==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(A=>_.ai[A])),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=n.sourceID}createArrays(){this.text=new Vp(new iu(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Vp(new iu(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new rr,this.lineVertexArray=new xr,this.symbolInstances=new Js,this.textAnchorOffsets=new Xr}calculateGlyphDependencies(n,o,p,b,M){for(let A=0;A<n.length;A++)if(o[n.charCodeAt(A)]=!0,(p||b)&&M){const R=Xc[n.charAt(A)];R&&(o[R.charCodeAt(0)]=!0)}}populate(n,o,p){const b=this.layers[0],M=b.layout,A=M.get("text-font"),R=M.get("text-field"),O=M.get("icon-image"),U=(R.value.kind!=="constant"||R.value.value instanceof En&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),W=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,Y=M.get("symbol-sort-key");if(this.features=[],!U&&!W)return;const ee=o.iconDependencies,ae=o.glyphDependencies,he=o.availableImages,_e=new nr(this.zoom);for(const{feature:Ce,id:Ne,index:nt,sourceLayerIndex:ke}of n){const tt=b._featureFilter.needGeometry,pt=ru(Ce,tt);if(!b._featureFilter.filter(_e,pt,p))continue;let Wt,hn;if(tt||(pt.geometry=fl(Ce)),U){const un=b.getValueAndResolveTokens("text-field",pt,p,he),sn=En.factory(un),wn=this.hasRTLText=this.hasRTLText||Bv(sn);(!wn||Bo.getRTLTextPluginStatus()==="unavailable"||wn&&Bo.isParsed())&&(Wt=yg(sn,b,pt))}if(W){const un=b.getValueAndResolveTokens("icon-image",pt,p,he);hn=un instanceof bi?un:bi.fromString(un)}if(!Wt&&!hn)continue;const rn=this.sortFeaturesByKey?Y.evaluate(pt,{},p):void 0;if(this.features.push({id:Ne,text:Wt,icon:hn,index:nt,sourceLayerIndex:ke,geometry:pt.geometry,properties:Ce.properties,type:Fv[Ce.type],sortKey:rn}),hn&&(ee[hn.name]=!0),Wt){const un=A.evaluate(pt,{},p).join(","),sn=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ai.vertical)>=0;for(const wn of Wt.sections)if(wn.image)ee[wn.image.name]=!0;else{const _n=Fo(Wt.toString()),dn=wn.fontStack||un,At=ae[dn]=ae[dn]||{};this.calculateGlyphDependencies(wn.text,At,sn,this.allowVerticalPlacement,_n)}}}M.get("symbol-placement")==="line"&&(this.features=function(Ce){const Ne={},nt={},ke=[];let tt=0;function pt(un){ke.push(Ce[un]),tt++}function Wt(un,sn,wn){const _n=nt[un];return delete nt[un],nt[sn]=_n,ke[_n].geometry[0].pop(),ke[_n].geometry[0]=ke[_n].geometry[0].concat(wn[0]),_n}function hn(un,sn,wn){const _n=Ne[sn];return delete Ne[sn],Ne[un]=_n,ke[_n].geometry[0].shift(),ke[_n].geometry[0]=wn[0].concat(ke[_n].geometry[0]),_n}function rn(un,sn,wn){const _n=wn?sn[0][sn[0].length-1]:sn[0][0];return`${un}:${_n.x}:${_n.y}`}for(let un=0;un<Ce.length;un++){const sn=Ce[un],wn=sn.geometry,_n=sn.text?sn.text.toString():null;if(!_n){pt(un);continue}const dn=rn(_n,wn),At=rn(_n,wn,!0);if(dn in nt&&At in Ne&&nt[dn]!==Ne[At]){const Ln=hn(dn,At,wn),Mn=Wt(dn,At,ke[Ln].geometry);delete Ne[dn],delete nt[At],nt[rn(_n,ke[Mn].geometry,!0)]=Mn,ke[Ln].geometry=null}else dn in nt?Wt(dn,At,wn):At in Ne?hn(dn,At,wn):(pt(un),Ne[dn]=tt-1,nt[At]=tt-1)}return ke.filter(un=>un.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Ne)=>Ce.sortKey-Ne.sortKey)}update(n,o,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,p),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const p=this.lineVertexArray.length;if(n.segment!==void 0){let b=n.dist(o[n.segment+1]),M=n.dist(o[n.segment]);const A={};for(let R=n.segment+1;R<o.length;R++)A[R]={x:o[R].x,y:o[R].y,tileUnitDistanceFromAnchor:b},R<o.length-1&&(b+=o[R+1].dist(o[R]));for(let R=n.segment||0;R>=0;R--)A[R]={x:o[R].x,y:o[R].y,tileUnitDistanceFromAnchor:M},R>0&&(M+=o[R-1].dist(o[R]));for(let R=0;R<o.length;R++){const O=A[R];this.lineVertexArray.emplaceBack(O.x,O.y,O.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(n,o,p,b,M,A,R,O,U,W,Y,ee){const ae=n.indexArray,he=n.layoutVertexArray,_e=n.segments.prepareSegment(4*o.length,he,ae,this.canOverlap?A.sortKey:void 0),Ce=this.glyphOffsetArray.length,Ne=_e.vertexLength,nt=this.allowVerticalPlacement&&R===_.ai.vertical?Math.PI/2:0,ke=A.text&&A.text.sections;for(let tt=0;tt<o.length;tt++){const{tl:pt,tr:Wt,bl:hn,br:rn,tex:un,pixelOffsetTL:sn,pixelOffsetBR:wn,minFontScaleX:_n,minFontScaleY:dn,glyphOffset:At,isSDF:Ln,sectionIndex:Mn}=o[tt],Xn=_e.vertexLength,Zi=At[1];Jf(he,O.x,O.y,pt.x,Zi+pt.y,un.x,un.y,p,Ln,sn.x,sn.y,_n,dn),Jf(he,O.x,O.y,Wt.x,Zi+Wt.y,un.x+un.w,un.y,p,Ln,wn.x,sn.y,_n,dn),Jf(he,O.x,O.y,hn.x,Zi+hn.y,un.x,un.y+un.h,p,Ln,sn.x,wn.y,_n,dn),Jf(he,O.x,O.y,rn.x,Zi+rn.y,un.x+un.w,un.y+un.h,p,Ln,wn.x,wn.y,_n,dn),Up(n.dynamicLayoutVertexArray,O,nt),ae.emplaceBack(Xn,Xn+1,Xn+2),ae.emplaceBack(Xn+1,Xn+2,Xn+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),tt!==o.length-1&&Mn===o[tt+1].sectionIndex||n.programConfigurations.populatePaintArrays(he.length,A,A.index,{},ee,ke&&ke[Mn])}n.placedSymbolArray.emplaceBack(O.x,O.y,Ce,this.glyphOffsetArray.length-Ce,Ne,U,W,O.segment,p?p[0]:0,p?p[1]:0,b[0],b[1],R,0,!1,0,Y)}_addCollisionDebugVertex(n,o,p,b,M,A){return o.emplaceBack(0,0),n.emplaceBack(p.x,p.y,b,M,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(n,o,p,b,M,A,R){const O=M.segments.prepareSegment(4,M.layoutVertexArray,M.indexArray),U=O.vertexLength,W=M.layoutVertexArray,Y=M.collisionVertexArray,ee=R.anchorX,ae=R.anchorY;this._addCollisionDebugVertex(W,Y,A,ee,ae,new D(n,o)),this._addCollisionDebugVertex(W,Y,A,ee,ae,new D(p,o)),this._addCollisionDebugVertex(W,Y,A,ee,ae,new D(p,b)),this._addCollisionDebugVertex(W,Y,A,ee,ae,new D(n,b)),O.vertexLength+=4;const he=M.indexArray;he.emplaceBack(U,U+1),he.emplaceBack(U+1,U+2),he.emplaceBack(U+2,U+3),he.emplaceBack(U+3,U),O.primitiveLength+=4}addDebugCollisionBoxes(n,o,p,b){for(let M=n;M<o;M++){const A=this.collisionBoxArray.get(M);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,b?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gp(hs,_g.members,pr),this.iconCollisionBox=new Gp(hs,_g.members,pr);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(n,o,p,b,M,A,R,O,U){const W={};for(let Y=o;Y<p;Y++){const ee=n.get(Y);W.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},W.textFeatureIndex=ee.featureIndex;break}for(let Y=b;Y<M;Y++){const ee=n.get(Y);W.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},W.verticalTextFeatureIndex=ee.featureIndex;break}for(let Y=A;Y<R;Y++){const ee=n.get(Y);W.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},W.iconFeatureIndex=ee.featureIndex;break}for(let Y=O;Y<U;Y++){const ee=n.get(Y);W.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},W.verticalIconFeatureIndex=ee.featureIndex;break}return W}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const p=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,o){const p=n.placedSymbolArray.get(o),b=p.vertexStartIndex+4*p.numGlyphs;for(let M=p.vertexStartIndex;M<b;M+=4)n.indexArray.emplaceBack(M,M+1,M+2),n.indexArray.emplaceBack(M+1,M+2,M+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),p=Math.cos(n),b=[],M=[],A=[];for(let R=0;R<this.symbolInstances.length;++R){A.push(R);const O=this.symbolInstances.get(R);b.push(0|Math.round(o*O.anchorX+p*O.anchorY)),M.push(O.featureIndex)}return A.sort((R,O)=>b[R]-b[O]||M[O]-M[R]),A}addToSortKeyRanges(n,o){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===o?p.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const p=this.symbolInstances.get(o);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((b,M,A)=>{b>=0&&A.indexOf(b)===M&&this.addIndicesForPlacedSymbol(this.text,b)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Dg,Ng;pn("SymbolBucket",Jc,{omit:["layers","collisionBoxArray","features","compareText"]}),Jc.MAX_GLYPHS=65535,Jc.addDynamicAttributes=Up;var Hp={get paint(){return Ng=Ng||new y({"icon-opacity":new Pn(Ze.paint_symbol["icon-opacity"]),"icon-color":new Pn(Ze.paint_symbol["icon-color"]),"icon-halo-color":new Pn(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new In(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pn(Ze.paint_symbol["text-opacity"]),"text-color":new Pn(Ze.paint_symbol["text-color"],{runtimeType:Fn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Pn(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(Ze.paint_symbol["text-halo-blur"]),"text-translate":new In(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new In(Ze.paint_symbol["text-translate-anchor"])})},get layout(){return Dg=Dg||new y({"symbol-placement":new In(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new In(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(Ze.layout_symbol["icon-allow-overlap"]),"icon-overlap":new In(Ze.layout_symbol["icon-overlap"]),"icon-ignore-placement":new In(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(Ze.layout_symbol["icon-size"]),"icon-text-fit":new In(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(Ze.layout_symbol["icon-image"]),"icon-rotate":new Pn(Ze.layout_symbol["icon-rotate"]),"icon-padding":new Pn(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new In(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(Ze.layout_symbol["icon-offset"]),"icon-anchor":new Pn(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(Ze.layout_symbol["text-field"]),"text-font":new Pn(Ze.layout_symbol["text-font"]),"text-size":new Pn(Ze.layout_symbol["text-size"]),"text-max-width":new Pn(Ze.layout_symbol["text-max-width"]),"text-line-height":new In(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(Ze.layout_symbol["text-justify"]),"text-radial-offset":new Pn(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(Ze.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Pn(Ze.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Pn(Ze.layout_symbol["text-anchor"]),"text-max-angle":new In(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new In(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(Ze.layout_symbol["text-rotate"]),"text-padding":new In(Ze.layout_symbol["text-padding"]),"text-keep-upright":new In(Ze.layout_symbol["text-keep-upright"]),"text-transform":new Pn(Ze.layout_symbol["text-transform"]),"text-offset":new Pn(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new In(Ze.layout_symbol["text-allow-overlap"]),"text-overlap":new In(Ze.layout_symbol["text-overlap"]),"text-ignore-placement":new In(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new In(Ze.layout_symbol["text-optional"])})}};class Og{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Qn,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pn("FormatSectionOverride",Og,{omit:["defaultValue"]});class Qf extends E{constructor(n){super(n,Hp)}recalculate(n,o){if(super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const b=[];for(const M of p)b.indexOf(M)<0&&b.push(M);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,o,p,b){const M=this.layout.get(n).evaluate(o,{},p,b),A=this._unevaluatedLayout._values[n];return A.isDataDriven()||C(A.value)||!M?M:function(R,O){return O.replace(/{([^{}]+)}/g,(U,W)=>R&&W in R?String(R[W]):"")}(o.properties,M)}createBucket(n){return new Jc(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Hp.paint.overridableProperties){if(!Qf.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),p=new Og(o),b=new v(p,o.property.specification);let M=null;M=o.value.kind==="constant"||o.value.kind==="source"?new j("source",b):new Q("composite",b,o.value.zoomStops),this.paint._values[n]=new Xa(o.property,M,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,p){return!(!this.layout||o.isDataDriven()||p.isDataDriven())&&Qf.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const p=n.get("text-field"),b=Hp.paint.properties[o];let M=!1;const A=R=>{for(const O of R)if(b.overrides&&b.overrides.hasOverride(O))return void(M=!0)};if(p.value.kind==="constant"&&p.value.value instanceof En)A(p.value.value.sections);else if(p.value.kind==="source"){const R=U=>{M||(U instanceof wr&&oi(U.value)===Ct?A(U.value.sections):U instanceof tl?A(U.sections):U.eachChild(R))},O=p.value;O._styleExpression&&R(O._styleExpression.expression)}return M}}let Wp;var Fg={get paint(){return Wp=Wp||new y({"background-color":new In(Ze.paint_background["background-color"]),"background-pattern":new i(Ze.paint_background["background-pattern"]),"background-opacity":new In(Ze.paint_background["background-opacity"])})}};class Uv extends E{constructor(n){super(n,Fg)}}let zg;var Vv={get paint(){return zg=zg||new y({"raster-opacity":new In(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new In(Ze.paint_raster["raster-saturation"]),"raster-contrast":new In(Ze.paint_raster["raster-contrast"]),"raster-resampling":new In(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new In(Ze.paint_raster["raster-fade-duration"])})}};class Gv extends E{constructor(n){super(n,Vv)}}class ed extends E{constructor(n){super(n,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Hv{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qp=63710088e-1;class hu{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hu(Me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,p=this.lat*o,b=n.lat*o,M=Math.sin(p)*Math.sin(b)+Math.cos(p)*Math.cos(b)*Math.cos((n.lng-this.lng)*o);return qp*Math.acos(Math.min(M,1))}static convert(n){if(n instanceof hu)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new hu(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new hu(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Bg=2*Math.PI*qp;function Ug(r){return Bg*Math.cos(r*Math.PI/180)}function Vg(r){return(180+r)/360}function Gg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Hg(r,n){return r/Ug(n)}function $p(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class td{constructor(n,o,p=0){this.x=+n,this.y=+o,this.z=+p}static fromLngLat(n,o=0){const p=hu.convert(n);return new td(Vg(p.lng),Gg(p.lat),Hg(o,p.lat))}toLngLat(){return new hu(360*this.x-180,$p(this.y))}toAltitude(){return this.z*Ug($p(this.y))}meterInMercatorCoordinateUnits(){return 1/Bg*(n=$p(this.y),1/Math.cos(n*Math.PI/180));var n}}function Wg(r,n,o){var p=2*Math.PI*6378137/256/Math.pow(2,o);return[r*p-2*Math.PI*6378137/2,n*p-2*Math.PI*6378137/2]}class Qc{constructor(n,o,p){if(n<0||n>25||p<0||p>=Math.pow(2,n)||o<0||o>=Math.pow(2,n))throw new Error(`x=${o}, y=${p}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=o,this.y=p,this.key=eh(0,n,n,o,p)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o,p){const b=(A=this.y,R=this.z,O=Wg(256*(M=this.x),256*(A=Math.pow(2,R)-A-1),R),U=Wg(256*(M+1),256*(A+1),R),O[0]+","+O[1]+","+U[0]+","+U[1]);var M,A,R,O,U;const W=function(Y,ee,ae){let he,_e="";for(let Ce=Y;Ce>0;Ce--)he=1<<Ce-1,_e+=(ee&he?1:0)+(ae&he?2:0);return _e}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,W).replace(/{bbox-epsg-3857}/g,b)}isChildOf(n){const o=this.z-n.z;return o>0&&n.x===this.x>>o&&n.y===this.y>>o}getTilePoint(n){const o=Math.pow(2,this.z);return new D((n.x*o-this.x)*Ui,(n.y*o-this.y)*Ui)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qg{constructor(n,o){this.wrap=n,this.canonical=o,this.key=eh(n,o.z,o.z,o.x,o.y)}}class ma{constructor(n,o,p,b,M){if(n<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${p}`);this.overscaledZ=n,this.wrap=o,this.canonical=new Qc(p,+b,+M),this.key=eh(o,n,p,b,M)}clone(){return new ma(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-n;return n>this.canonical.z?new ma(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ma(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-n;return n>this.canonical.z?eh(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y):eh(this.wrap*+o,n,n,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new ma(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,p=2*this.canonical.x,b=2*this.canonical.y;return[new ma(o,this.wrap,o,p,b),new ma(o,this.wrap,o,p+1,b),new ma(o,this.wrap,o,p,b+1),new ma(o,this.wrap,o,p+1,b+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ma(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ma(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new td(n.x-this.wrap,n.y))}}function eh(r,n,o,p,b){(r*=2)<0&&(r=-1*r-1);const M=1<<o;return(M*M*r+M*b+p).toString(36)+o.toString(36)+n.toString(36)}pn("CanonicalTileID",Qc),pn("OverscaledTileID",ma,{omit:["posMatrix"]});class nd{constructor(n,o,p,b=1,M=1,A=1,R=0){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void st(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=o.height;const O=this.dim=o.height-2;switch(this.data=new Uint32Array(o.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=M,this.blueFactor=A,this.baseShift=R;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let U=0;U<O;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(O,U)]=this.data[this._idx(O-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,O)]=this.data[this._idx(U,O-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(O,-1)]=this.data[this._idx(O-1,0)],this.data[this._idx(-1,O)]=this.data[this._idx(0,O-1)],this.data[this._idx(O,O)]=this.data[this._idx(O-1,O-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let U=0;U<O;U++)for(let W=0;W<O;W++){const Y=this.get(U,W);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(n,o){const p=new Uint8Array(this.data.buffer),b=4*this._idx(n,o);return this.unpack(p[b],p[b+1],p[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}unpack(n,o,p){return n*this.redFactor+o*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new fs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,o,p){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let b=o*this.dim,M=o*this.dim+this.dim,A=p*this.dim,R=p*this.dim+this.dim;switch(o){case-1:b=M-1;break;case 1:M=b+1}switch(p){case-1:A=R-1;break;case 1:R=A+1}const O=-o*this.dim,U=-p*this.dim;for(let W=A;W<R;W++)for(let Y=b;Y<M;Y++)this.data[this._idx(Y,W)]=n.data[this._idx(Y+O,W+U)]}}pn("DEMData",nd);class Xp{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const p=n[o];this._stringToNumber[p]=o,this._numberToString[o]=p}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class jp{constructor(n,o,p,b,M){this.type="Feature",this._vectorTileFeature=n,n._z=o,n._x=p,n._y=b,this.properties=n.properties,this.id=M}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(n[o]=this[o]);return n}}class Zp{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Aa(Ui,16,0),this.grid3D=new Aa(Ui,16,0),this.featureIndexArray=new da,this.promoteId=o}insert(n,o,p,b,M,A){const R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,b,M);const O=A?this.grid3D:this.grid;for(let U=0;U<o.length;U++){const W=o[U],Y=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<W.length;ee++){const ae=W[ee];Y[0]=Math.min(Y[0],ae.x),Y[1]=Math.min(Y[1],ae.y),Y[2]=Math.max(Y[2],ae.x),Y[3]=Math.max(Y[3],ae.y)}Y[0]<Ui&&Y[1]<Ui&&Y[2]>=0&&Y[3]>=0&&O.insert(R,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ou.VectorTile(new Lp(this.rawTileData)).layers,this.sourceLayerCoder=new Xp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,o,p,b){this.loadVTLayers();const M=n.params||{},A=Ui/n.tileSize/n.scale,R=Nt(M.filter),O=n.queryGeometry,U=n.queryPadding*A,W=$g(O),Y=this.grid.query(W.minX-U,W.minY-U,W.maxX+U,W.maxY+U),ee=$g(n.cameraQueryGeometry),ae=this.grid3D.query(ee.minX-U,ee.minY-U,ee.maxX+U,ee.maxY+U,(Ce,Ne,nt,ke)=>function(tt,pt,Wt,hn,rn){for(const sn of tt)if(pt<=sn.x&&Wt<=sn.y&&hn>=sn.x&&rn>=sn.y)return!0;const un=[new D(pt,Wt),new D(pt,rn),new D(hn,rn),new D(hn,Wt)];if(tt.length>2){for(const sn of un)if(Ia(tt,sn))return!0}for(let sn=0;sn<tt.length-1;sn++)if(nv(tt[sn],tt[sn+1],un))return!0;return!1}(n.cameraQueryGeometry,Ce-U,Ne-U,nt+U,ke+U));for(const Ce of ae)Y.push(Ce);Y.sort(Wv);const he={};let _e;for(let Ce=0;Ce<Y.length;Ce++){const Ne=Y[Ce];if(Ne===_e)continue;_e=Ne;const nt=this.featureIndexArray.get(Ne);let ke=null;this.loadMatchingFeature(he,nt.bucketIndex,nt.sourceLayerIndex,nt.featureIndex,R,M.layers,M.availableImages,o,p,b,(tt,pt,Wt)=>(ke||(ke=fl(tt)),pt.queryIntersectsFeature(O,tt,Wt,ke,this.z,n.transform,A,n.pixelPosMatrix)))}return he}loadMatchingFeature(n,o,p,b,M,A,R,O,U,W,Y){const ee=this.bucketLayerIDs[o];if(A&&!function(Ce,Ne){for(let nt=0;nt<Ce.length;nt++)if(Ne.indexOf(Ce[nt])>=0)return!0;return!1}(A,ee))return;const ae=this.sourceLayerCoder.decode(p),he=this.vtLayers[ae].feature(b);if(M.needGeometry){const Ce=ru(he,!0);if(!M.filter(new nr(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!M.filter(new nr(this.tileID.overscaledZ),he))return;const _e=this.getId(he,ae);for(let Ce=0;Ce<ee.length;Ce++){const Ne=ee[Ce];if(A&&A.indexOf(Ne)<0)continue;const nt=O[Ne];if(!nt)continue;let ke={};_e&&W&&(ke=W.getState(nt.sourceLayer||"_geojsonTileLayer",_e));const tt=Te({},U[Ne]);tt.paint=Yp(tt.paint,nt.paint,he,ke,R),tt.layout=Yp(tt.layout,nt.layout,he,ke,R);const pt=!Y||Y(he,nt,ke);if(!pt)continue;const Wt=new jp(he,this.z,this.x,this.y,_e);Wt.layer=tt;let hn=n[Ne];hn===void 0&&(hn=n[Ne]=[]),hn.push({featureIndex:b,feature:Wt,intersectionZ:pt})}}lookupSymbolFeatures(n,o,p,b,M,A,R,O){const U={};this.loadVTLayers();const W=Nt(M);for(const Y of n)this.loadMatchingFeature(U,p,b,Y,W,A,R,O,o);return U}hasLayer(n){for(const o of this.bucketLayerIDs)for(const p of o)if(n===p)return!0;return!1}getId(n,o){let p=n.id;return this.promoteId&&(p=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof p=="boolean"&&(p=Number(p))),p}}function Yp(r,n,o,p,b){return de(r,(M,A)=>{const R=n instanceof Pc?n.get(A):null;return R&&R.evaluate?R.evaluate(o,p,b):R})}function $g(r){let n=1/0,o=1/0,p=-1/0,b=-1/0;for(const M of r)n=Math.min(n,M.x),o=Math.min(o,M.y),p=Math.max(p,M.x),b=Math.max(b,M.y);return{minX:n,minY:o,maxX:p,maxY:b}}function Wv(r,n){return n-r}function Xg(r,n,o,p,b){const M=[];for(let A=0;A<r.length;A++){const R=r[A];let O;for(let U=0;U<R.length-1;U++){let W=R[U],Y=R[U+1];W.x<n&&Y.x<n||(W.x<n?W=new D(n,W.y+(n-W.x)/(Y.x-W.x)*(Y.y-W.y))._round():Y.x<n&&(Y=new D(n,W.y+(n-W.x)/(Y.x-W.x)*(Y.y-W.y))._round()),W.y<o&&Y.y<o||(W.y<o?W=new D(W.x+(o-W.y)/(Y.y-W.y)*(Y.x-W.x),o)._round():Y.y<o&&(Y=new D(W.x+(o-W.y)/(Y.y-W.y)*(Y.x-W.x),o)._round()),W.x>=p&&Y.x>=p||(W.x>=p?W=new D(p,W.y+(p-W.x)/(Y.x-W.x)*(Y.y-W.y))._round():Y.x>=p&&(Y=new D(p,W.y+(p-W.x)/(Y.x-W.x)*(Y.y-W.y))._round()),W.y>=b&&Y.y>=b||(W.y>=b?W=new D(W.x+(b-W.y)/(Y.y-W.y)*(Y.x-W.x),b)._round():Y.y>=b&&(Y=new D(W.x+(b-W.y)/(Y.y-W.y)*(Y.x-W.x),b)._round()),O&&W.equals(O[O.length-1])||(O=[W],M.push(O)),O.push(Y)))))}}return M}pn("FeatureIndex",Zp,{omit:["rawTileData","sourceLayerCoder"]});class bo extends D{constructor(n,o,p,b){super(n,o),this.angle=p,b!==void 0&&(this.segment=b)}clone(){return new bo(this.x,this.y,this.angle,this.segment)}}function Jh(r,n,o,p,b){if(n.segment===void 0||o===0)return!0;let M=n,A=n.segment+1,R=0;for(;R>-o/2;){if(A--,A<0)return!1;R-=r[A].dist(M),M=r[A]}R+=r[A].dist(r[A+1]),A++;const O=[];let U=0;for(;R<o/2;){const W=r[A],Y=r[A+1];if(!Y)return!1;let ee=r[A-1].angleTo(W)-W.angleTo(Y);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:R,angleDelta:ee}),U+=ee;R-O[0].distance>p;)U-=O.shift().angleDelta;if(U>b)return!1;A++,R+=W.dist(Y)}return!0}function jg(r){let n=0;for(let o=0;o<r.length-1;o++)n+=r[o].dist(r[o+1]);return n}function Zg(r,n,o){return r?.6*n*o:0}function id(r,n){return Math.max(r?r.right-r.left:0,n?n.right-n.left:0)}function Yg(r,n,o,p,b,M){const A=Zg(o,b,M),R=id(o,p)*M;let O=0;const U=jg(r)/2;for(let W=0;W<r.length-1;W++){const Y=r[W],ee=r[W+1],ae=Y.dist(ee);if(O+ae>U){const he=(U-O)/ae,_e=sr.number(Y.x,ee.x,he),Ce=sr.number(Y.y,ee.y,he),Ne=new bo(_e,Ce,ee.angleTo(Y),W);return Ne._round(),!A||Jh(r,Ne,R,A,n)?Ne:void 0}O+=ae}}function qv(r,n,o,p,b,M,A,R,O){const U=Zg(p,M,A),W=id(p,b),Y=W*A,ee=r[0].x===0||r[0].x===O||r[0].y===0||r[0].y===O;return n-Y<n/4&&(n=Y+n/4),Kg(r,ee?n/2*R%n:(W/2+2*M)*A*R%n,n,U,o,Y,ee,!1,O)}function Kg(r,n,o,p,b,M,A,R,O){const U=M/2,W=jg(r);let Y=0,ee=n-o,ae=[];for(let he=0;he<r.length-1;he++){const _e=r[he],Ce=r[he+1],Ne=_e.dist(Ce),nt=Ce.angleTo(_e);for(;ee+o<Y+Ne;){ee+=o;const ke=(ee-Y)/Ne,tt=sr.number(_e.x,Ce.x,ke),pt=sr.number(_e.y,Ce.y,ke);if(tt>=0&&tt<O&&pt>=0&&pt<O&&ee-U>=0&&ee+U<=W){const Wt=new bo(tt,pt,nt,he);Wt._round(),p&&!Jh(r,Wt,M,p,b)||ae.push(Wt)}}Y+=Ne}return R||ae.length||A||(ae=Kg(r,Y/2,o,p,b,M,A,!0,O)),ae}pn("Anchor",bo);const th=ta;function Jg(r,n,o,p){const b=[],M=r.image,A=M.pixelRatio,R=M.paddedRect.w-2*th,O=M.paddedRect.h-2*th;let U={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const W=M.stretchX||[[0,R]],Y=M.stretchY||[[0,O]],ee=(At,Ln)=>At+Ln[1]-Ln[0],ae=W.reduce(ee,0),he=Y.reduce(ee,0),_e=R-ae,Ce=O-he;let Ne=0,nt=ae,ke=0,tt=he,pt=0,Wt=_e,hn=0,rn=Ce;if(M.content&&p){const At=M.content,Ln=At[2]-At[0],Mn=At[3]-At[1];(M.textFitWidth||M.textFitHeight)&&(U=Lg(r)),Ne=rd(W,0,At[0]),ke=rd(Y,0,At[1]),nt=rd(W,At[0],At[2]),tt=rd(Y,At[1],At[3]),pt=At[0]-Ne,hn=At[1]-ke,Wt=Ln-nt,rn=Mn-tt}const un=U.x1,sn=U.y1,wn=U.x2-un,_n=U.y2-sn,dn=(At,Ln,Mn,Xn)=>{const Zi=sd(At.stretch-Ne,nt,wn,un),Xi=ad(At.fixed-pt,Wt,At.stretch,ae),ns=sd(Ln.stretch-ke,tt,_n,sn),Ja=ad(Ln.fixed-hn,rn,Ln.stretch,he),ps=sd(Mn.stretch-Ne,nt,wn,un),Mr=ad(Mn.fixed-pt,Wt,Mn.stretch,ae),zs=sd(Xn.stretch-ke,tt,_n,sn),ms=ad(Xn.fixed-hn,rn,Xn.stretch,he),Bs=new D(Zi,ns),mr=new D(ps,ns),is=new D(ps,zs),Is=new D(Zi,zs),gs=new D(Xi/A,Ja/A),Vi=new D(Mr/A,ms/A),ji=n*Math.PI/180;if(ji){const Ti=Math.sin(ji),Yi=Math.cos(ji),ur=[Yi,-Ti,Ti,Yi];Bs._matMult(ur),mr._matMult(ur),Is._matMult(ur),is._matMult(ur)}const Ra=At.stretch+At.fixed,na=Ln.stretch+Ln.fixed;return{tl:Bs,tr:mr,bl:Is,br:is,tex:{x:M.paddedRect.x+th+Ra,y:M.paddedRect.y+th+na,w:Mn.stretch+Mn.fixed-Ra,h:Xn.stretch+Xn.fixed-na},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gs,pixelOffsetBR:Vi,minFontScaleX:Wt/A/wn,minFontScaleY:rn/A/_n,isSDF:o}};if(p&&(M.stretchX||M.stretchY)){const At=Qg(W,_e,ae),Ln=Qg(Y,Ce,he);for(let Mn=0;Mn<At.length-1;Mn++){const Xn=At[Mn],Zi=At[Mn+1];for(let Xi=0;Xi<Ln.length-1;Xi++)b.push(dn(Xn,Ln[Xi],Zi,Ln[Xi+1]))}}else b.push(dn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:O+1}));return b}function rd(r,n,o){let p=0;for(const b of r)p+=Math.max(n,Math.min(o,b[1]))-Math.max(n,Math.min(o,b[0]));return p}function Qg(r,n,o){const p=[{fixed:-th,stretch:0}];for(const[b,M]of r){const A=p[p.length-1];p.push({fixed:b-A.stretch,stretch:A.stretch}),p.push({fixed:b-A.stretch,stretch:A.stretch+(M-b)})}return p.push({fixed:n+th,stretch:o}),p}function sd(r,n,o,p){return r/n*o+p}function ad(r,n,o,p){return r-n*o/p}class od{constructor(n,o,p,b,M,A,R,O,U,W){var Y;if(this.boxStartIndex=n.length,U){let ee=A.top,ae=A.bottom;const he=A.collisionPadding;he&&(ee-=he[1],ae+=he[3]);let _e=ae-ee;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{const ee=!((Y=A.image)===null||Y===void 0)&&Y.content&&(A.image.textFitWidth||A.image.textFitHeight)?Lg(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};ee.y1=ee.y1*R-O[0],ee.y2=ee.y2*R+O[2],ee.x1=ee.x1*R-O[3],ee.x2=ee.x2*R+O[1];const ae=A.collisionPadding;if(ae&&(ee.x1-=ae[0]*R,ee.y1-=ae[1]*R,ee.x2+=ae[2]*R,ee.y2+=ae[3]*R),W){const he=new D(ee.x1,ee.y1),_e=new D(ee.x2,ee.y1),Ce=new D(ee.x1,ee.y2),Ne=new D(ee.x2,ee.y2),nt=W*Math.PI/180;he._rotate(nt),_e._rotate(nt),Ce._rotate(nt),Ne._rotate(nt),ee.x1=Math.min(he.x,_e.x,Ce.x,Ne.x),ee.x2=Math.max(he.x,_e.x,Ce.x,Ne.x),ee.y1=Math.min(he.y,_e.y,Ce.y,Ne.y),ee.y2=Math.max(he.y,_e.y,Ce.y,Ne.y)}n.emplaceBack(o.x,o.y,ee.x1,ee.y1,ee.x2,ee.y2,p,b,M)}this.boxEndIndex=n.length}}class $v{constructor(n=[],o=(p,b)=>p<b?-1:p>b?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:p}=this,b=o[n];for(;n>0;){const M=n-1>>1,A=o[M];if(p(b,A)>=0)break;o[n]=A,n=M}o[n]=b}_down(n){const{data:o,compare:p}=this,b=this.length>>1,M=o[n];for(;n<b;){let A=1+(n<<1);const R=A+1;if(R<this.length&&p(o[R],o[A])<0&&(A=R),p(o[A],M)>=0)break;o[n]=o[A],n=A}o[n]=M}}function Xv(r,n=1,o=!1){let p=1/0,b=1/0,M=-1/0,A=-1/0;const R=r[0];for(let ae=0;ae<R.length;ae++){const he=R[ae];(!ae||he.x<p)&&(p=he.x),(!ae||he.y<b)&&(b=he.y),(!ae||he.x>M)&&(M=he.x),(!ae||he.y>A)&&(A=he.y)}const O=Math.min(M-p,A-b);let U=O/2;const W=new $v([],jv);if(O===0)return new D(p,b);for(let ae=p;ae<M;ae+=O)for(let he=b;he<A;he+=O)W.push(new Os(ae+U,he+U,U,r));let Y=function(ae){let he=0,_e=0,Ce=0;const Ne=ae[0];for(let nt=0,ke=Ne.length,tt=ke-1;nt<ke;tt=nt++){const pt=Ne[nt],Wt=Ne[tt],hn=pt.x*Wt.y-Wt.x*pt.y;_e+=(pt.x+Wt.x)*hn,Ce+=(pt.y+Wt.y)*hn,he+=3*hn}return new Os(_e/he,Ce/he,0,ae)}(r),ee=W.length;for(;W.length;){const ae=W.pop();(ae.d>Y.d||!Y.d)&&(Y=ae,o&&console.log("found best %d after %d probes",Math.round(1e4*ae.d)/1e4,ee)),ae.max-Y.d<=n||(U=ae.h/2,W.push(new Os(ae.p.x-U,ae.p.y-U,U,r)),W.push(new Os(ae.p.x+U,ae.p.y-U,U,r)),W.push(new Os(ae.p.x-U,ae.p.y+U,U,r)),W.push(new Os(ae.p.x+U,ae.p.y+U,U,r)),ee+=4)}return o&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${Y.d}`)),Y.p}function jv(r,n){return n.max-r.max}function Os(r,n,o,p){this.p=new D(r,n),this.h=o,this.d=function(b,M){let A=!1,R=1/0;for(let O=0;O<M.length;O++){const U=M[O];for(let W=0,Y=U.length,ee=Y-1;W<Y;ee=W++){const ae=U[W],he=U[ee];ae.y>b.y!=he.y>b.y&&b.x<(he.x-ae.x)*(b.y-ae.y)/(he.y-ae.y)+ae.x&&(A=!A),R=Math.min(R,Nf(b,ae,he))}}return(A?1:-1)*Math.sqrt(R)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ds;_.ar=void 0,(ds=_.ar||(_.ar={}))[ds.center=1]="center",ds[ds.left=2]="left",ds[ds.right=3]="right",ds[ds.top=4]="top",ds[ds.bottom=5]="bottom",ds[ds["top-left"]=6]="top-left",ds[ds["top-right"]=7]="top-right",ds[ds["bottom-left"]=8]="bottom-left",ds[ds["bottom-right"]=9]="bottom-right";const fu=7,_l=Number.POSITIVE_INFINITY;function li(r,n){return n[1]!==_l?function(o,p,b){let M=0,A=0;switch(p=Math.abs(p),b=Math.abs(b),o){case"top-right":case"top-left":case"top":A=b-fu;break;case"bottom-right":case"bottom-left":case"bottom":A=-b+fu}switch(o){case"top-right":case"bottom-right":case"right":M=-p;break;case"top-left":case"bottom-left":case"left":M=p}return[M,A]}(r,n[0],n[1]):function(o,p){let b=0,M=0;p<0&&(p=0);const A=p/Math.SQRT2;switch(o){case"top-right":case"top-left":M=A-fu;break;case"bottom-right":case"bottom-left":M=-A+fu;break;case"bottom":M=-p+fu;break;case"top":M=p-fu}switch(o){case"top-right":case"bottom-right":b=-A;break;case"top-left":case"bottom-left":b=A;break;case"left":b=p;break;case"right":b=-p}return[b,M]}(r,n[0])}function e_(r,n,o){var p;const b=r.layout,M=(p=b.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(n,{},o);if(M){const R=M.values,O=[];for(let U=0;U<R.length;U+=2){const W=O[U]=R[U],Y=R[U+1].map(ee=>ee*Vr);W.startsWith("top")?Y[1]-=fu:W.startsWith("bottom")&&(Y[1]+=fu),O[U+1]=Y}return new Yn(O)}const A=b.get("text-variable-anchor");if(A){let R;R=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(n,{},o)*Vr,_l]:b.get("text-offset").evaluate(n,{},o).map(U=>U*Vr);const O=[];for(const U of A)O.push(U,li(U,R));return new Yn(O)}return null}function Fs(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zr(r,n,o,p,b,M,A,R,O,U,W){let Y=M.textMaxSize.evaluate(n,{});Y===void 0&&(Y=A);const ee=r.layers[0].layout,ae=ee.get("icon-offset").evaluate(n,{},W),he=yl(o.horizontal),_e=A/24,Ce=r.tilePixelRatio*_e,Ne=r.tilePixelRatio*Y/24,nt=r.tilePixelRatio*R,ke=r.tilePixelRatio*ee.get("symbol-spacing"),tt=ee.get("text-padding")*r.tilePixelRatio,pt=function(At,Ln,Mn,Xn=1){const Zi=At.get("icon-padding").evaluate(Ln,{},Mn),Xi=Zi&&Zi.values;return[Xi[0]*Xn,Xi[1]*Xn,Xi[2]*Xn,Xi[3]*Xn]}(ee,n,W,r.tilePixelRatio),Wt=ee.get("text-max-angle")/180*Math.PI,hn=ee.get("text-rotation-alignment")!=="viewport"&&ee.get("symbol-placement")!=="point",rn=ee.get("icon-rotation-alignment")==="map"&&ee.get("symbol-placement")!=="point",un=ee.get("symbol-placement"),sn=ke/2,wn=ee.get("icon-text-fit");let _n;p&&wn!=="none"&&(r.allowVerticalPlacement&&o.vertical&&(_n=zp(p,o.vertical,wn,ee.get("icon-text-fit-padding"),ae,_e)),he&&(p=zp(p,he,wn,ee.get("icon-text-fit-padding"),ae,_e)));const dn=(At,Ln)=>{Ln.x<0||Ln.x>=Ui||Ln.y<0||Ln.y>=Ui||function(Mn,Xn,Zi,Xi,ns,Ja,ps,Mr,zs,ms,Bs,mr,is,Is,gs,Vi,ji,Ra,na,Ti,Yi,ur,ga,br,rc){const Wo=Mn.addToLineVertexArray(Xn,Zi);let qo,Qa,_a,rs,vl=0,Qh=0,r_=0,s_=0,du=-1,tm=-1;const xl={};let a_=Yu("");if(Mn.allowVerticalPlacement&&Xi.vertical){const Cs=Mr.layout.get("text-rotate").evaluate(Yi,{},br)+90;_a=new od(zs,Xn,ms,Bs,mr,Xi.vertical,is,Is,gs,Cs),ps&&(rs=new od(zs,Xn,ms,Bs,mr,ps,ji,Ra,gs,Cs))}if(ns){const Cs=Mr.layout.get("icon-rotate").evaluate(Yi,{}),Pa=Mr.layout.get("icon-text-fit")!=="none",sc=Jg(ns,Cs,ga,Pa),So=ps?Jg(ps,Cs,ga,Pa):void 0;Qa=new od(zs,Xn,ms,Bs,mr,ns,ji,Ra,!1,Cs),vl=4*sc.length;const ac=Mn.iconSizeData;let $o=null;ac.kind==="source"?($o=[Ca*Mr.layout.get("icon-size").evaluate(Yi,{})],$o[0]>cu&&st(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${Kh}. Reduce your "icon-size".`)):ac.kind==="composite"&&($o=[Ca*ur.compositeIconSizes[0].evaluate(Yi,{},br),Ca*ur.compositeIconSizes[1].evaluate(Yi,{},br)],($o[0]>cu||$o[1]>cu)&&st(`${Mn.layerIds[0]}: Value for "icon-size" is >= ${Kh}. Reduce your "icon-size".`)),Mn.addSymbols(Mn.icon,sc,$o,Ti,na,Yi,_.ai.none,Xn,Wo.lineStartIndex,Wo.lineLength,-1,br),du=Mn.icon.placedSymbolArray.length-1,So&&(Qh=4*So.length,Mn.addSymbols(Mn.icon,So,$o,Ti,na,Yi,_.ai.vertical,Xn,Wo.lineStartIndex,Wo.lineLength,-1,br),tm=Mn.icon.placedSymbolArray.length-1)}const o_=Object.keys(Xi.horizontal);for(const Cs of o_){const Pa=Xi.horizontal[Cs];if(!qo){a_=Yu(Pa.text);const So=Mr.layout.get("text-rotate").evaluate(Yi,{},br);qo=new od(zs,Xn,ms,Bs,mr,Pa,is,Is,gs,So)}const sc=Pa.positionedLines.length===1;if(r_+=t_(Mn,Xn,Pa,Ja,Mr,gs,Yi,Vi,Wo,Xi.vertical?_.ai.horizontal:_.ai.horizontalOnly,sc?o_:[Cs],xl,du,ur,br),sc)break}Xi.vertical&&(s_+=t_(Mn,Xn,Xi.vertical,Ja,Mr,gs,Yi,Vi,Wo,_.ai.vertical,["vertical"],xl,tm,ur,br));const Kv=qo?qo.boxStartIndex:Mn.collisionBoxArray.length,l_=qo?qo.boxEndIndex:Mn.collisionBoxArray.length,u_=_a?_a.boxStartIndex:Mn.collisionBoxArray.length,Jv=_a?_a.boxEndIndex:Mn.collisionBoxArray.length,Qv=Qa?Qa.boxStartIndex:Mn.collisionBoxArray.length,e0=Qa?Qa.boxEndIndex:Mn.collisionBoxArray.length,t0=rs?rs.boxStartIndex:Mn.collisionBoxArray.length,n0=rs?rs.boxEndIndex:Mn.collisionBoxArray.length;let wo=-1;const cd=(Cs,Pa)=>Cs&&Cs.circleDiameter?Math.max(Cs.circleDiameter,Pa):Pa;wo=cd(qo,wo),wo=cd(_a,wo),wo=cd(Qa,wo),wo=cd(rs,wo);const c_=wo>-1?1:0;c_&&(wo*=rc/Vr),Mn.glyphOffsetArray.length>=Jc.MAX_GLYPHS&&st("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yi.sortKey!==void 0&&Mn.addToSortKeyRanges(Mn.symbolInstances.length,Yi.sortKey);const i0=e_(Mr,Yi,br),[r0,s0]=function(Cs,Pa){const sc=Cs.length,So=Pa==null?void 0:Pa.values;if((So==null?void 0:So.length)>0)for(let ac=0;ac<So.length;ac+=2){const $o=So[ac+1];Cs.emplaceBack(_.ar[So[ac]],$o[0],$o[1])}return[sc,Cs.length]}(Mn.textAnchorOffsets,i0);Mn.symbolInstances.emplaceBack(Xn.x,Xn.y,xl.right>=0?xl.right:-1,xl.center>=0?xl.center:-1,xl.left>=0?xl.left:-1,xl.vertical||-1,du,tm,a_,Kv,l_,u_,Jv,Qv,e0,t0,n0,ms,r_,s_,vl,Qh,c_,0,is,wo,r0,s0)}(r,Ln,At,o,p,b,_n,r.layers[0],r.collisionBoxArray,n.index,n.sourceLayerIndex,r.index,Ce,[tt,tt,tt,tt],hn,O,nt,pt,rn,ae,n,M,U,W,A)};if(un==="line")for(const At of Xg(n.geometry,0,0,Ui,Ui)){const Ln=qv(At,ke,Wt,o.vertical||he,p,24,Ne,r.overscaling,Ui);for(const Mn of Ln)he&&Zv(r,he.text,sn,Mn)||dn(At,Mn)}else if(un==="line-center"){for(const At of n.geometry)if(At.length>1){const Ln=Yg(At,Wt,o.vertical||he,p,24,Ne);Ln&&dn(At,Ln)}}else if(n.type==="Polygon")for(const At of Ls(n.geometry,0)){const Ln=Xv(At,16);dn(At[0],new bo(Ln.x,Ln.y,0))}else if(n.type==="LineString")for(const At of n.geometry)dn(At,new bo(At[0].x,At[0].y,0));else if(n.type==="Point")for(const At of n.geometry)for(const Ln of At)dn([Ln],new bo(Ln.x,Ln.y,0))}function t_(r,n,o,p,b,M,A,R,O,U,W,Y,ee,ae,he){const _e=function(nt,ke,tt,pt,Wt,hn,rn,un){const sn=pt.layout.get("text-rotate").evaluate(hn,{})*Math.PI/180,wn=[];for(const _n of ke.positionedLines)for(const dn of _n.positionedGlyphs){if(!dn.rect)continue;const At=dn.rect||{};let Ln=Ag+1,Mn=!0,Xn=1,Zi=0;const Xi=(Wt||un)&&dn.vertical,ns=dn.metrics.advance*dn.scale/2;if(un&&ke.verticalizable&&(Zi=_n.lineOffset/2-(dn.imageName?-(Vr-dn.metrics.width*dn.scale)/2:(dn.scale-1)*Vr)),dn.imageName){const Ti=rn[dn.imageName];Mn=Ti.sdf,Xn=Ti.pixelRatio,Ln=ta/Xn}const Ja=Wt?[dn.x+ns,dn.y]:[0,0];let ps=Wt?[0,0]:[dn.x+ns+tt[0],dn.y+tt[1]-Zi],Mr=[0,0];Xi&&(Mr=ps,ps=[0,0]);const zs=dn.metrics.isDoubleResolution?2:1,ms=(dn.metrics.left-Ln)*dn.scale-ns+ps[0],Bs=(-dn.metrics.top-Ln)*dn.scale+ps[1],mr=ms+At.w/zs*dn.scale/Xn,is=Bs+At.h/zs*dn.scale/Xn,Is=new D(ms,Bs),gs=new D(mr,Bs),Vi=new D(ms,is),ji=new D(mr,is);if(Xi){const Ti=new D(-ns,ns-Zh),Yi=-Math.PI/2,ur=Vr/2-ns,ga=new D(5-Zh-ur,-(dn.imageName?ur:0)),br=new D(...Mr);Is._rotateAround(Yi,Ti)._add(ga)._add(br),gs._rotateAround(Yi,Ti)._add(ga)._add(br),Vi._rotateAround(Yi,Ti)._add(ga)._add(br),ji._rotateAround(Yi,Ti)._add(ga)._add(br)}if(sn){const Ti=Math.sin(sn),Yi=Math.cos(sn),ur=[Yi,-Ti,Ti,Yi];Is._matMult(ur),gs._matMult(ur),Vi._matMult(ur),ji._matMult(ur)}const Ra=new D(0,0),na=new D(0,0);wn.push({tl:Is,tr:gs,bl:Vi,br:ji,tex:At,writingMode:ke.writingMode,glyphOffset:Ja,sectionIndex:dn.sectionIndex,isSDF:Mn,pixelOffsetTL:Ra,pixelOffsetBR:na,minFontScaleX:0,minFontScaleY:0})}return wn}(0,o,R,b,M,A,p,r.allowVerticalPlacement),Ce=r.textSizeData;let Ne=null;Ce.kind==="source"?(Ne=[Ca*b.layout.get("text-size").evaluate(A,{})],Ne[0]>cu&&st(`${r.layerIds[0]}: Value for "text-size" is >= ${Kh}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Ne=[Ca*ae.compositeTextSizes[0].evaluate(A,{},he),Ca*ae.compositeTextSizes[1].evaluate(A,{},he)],(Ne[0]>cu||Ne[1]>cu)&&st(`${r.layerIds[0]}: Value for "text-size" is >= ${Kh}. Reduce your "text-size".`)),r.addSymbols(r.text,_e,Ne,R,M,A,U,n,O.lineStartIndex,O.lineLength,ee,he);for(const nt of W)Y[nt]=r.text.placedSymbolArray.length-1;return 4*_e.length}function yl(r){for(const n in r)return r[n];return null}function Zv(r,n,o,p){const b=r.compareText;if(n in b){const M=b[n];for(let A=M.length-1;A>=0;A--)if(p.dist(M[A])<o)return!0}else b[n]=[];return b[n].push(p),!1}const n_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kp{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,p]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=p>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const M=n_[15&p];if(!M)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(n,2,1),[R]=new Uint32Array(n,4,1);return new Kp(R,A,M,n)}constructor(n,o=64,p=Float64Array,b){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=p,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const M=n_.indexOf(this.ArrayType),A=2*n*this.ArrayType.BYTES_PER_ELEMENT,R=n*this.IndexArrayType.BYTES_PER_ELEMENT,O=(8-R%8)%8;if(M<0)throw new Error(`Unexpected typed array class: ${p}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+R+O,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+A+R+O),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+R+O,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+M]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=n,this.coords[this._pos++]=o,p}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Jp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,p,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:A,nodeSize:R}=this,O=[0,M.length-1,0],U=[];for(;O.length;){const W=O.pop()||0,Y=O.pop()||0,ee=O.pop()||0;if(Y-ee<=R){for(let Ce=ee;Ce<=Y;Ce++){const Ne=A[2*Ce],nt=A[2*Ce+1];Ne>=n&&Ne<=p&&nt>=o&&nt<=b&&U.push(M[Ce])}continue}const ae=ee+Y>>1,he=A[2*ae],_e=A[2*ae+1];he>=n&&he<=p&&_e>=o&&_e<=b&&U.push(M[ae]),(W===0?n<=he:o<=_e)&&(O.push(ee),O.push(ae-1),O.push(1-W)),(W===0?p>=he:b>=_e)&&(O.push(ae+1),O.push(Y),O.push(1-W))}return U}within(n,o,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:M,nodeSize:A}=this,R=[0,b.length-1,0],O=[],U=p*p;for(;R.length;){const W=R.pop()||0,Y=R.pop()||0,ee=R.pop()||0;if(Y-ee<=A){for(let Ce=ee;Ce<=Y;Ce++)Ho(M[2*Ce],M[2*Ce+1],n,o)<=U&&O.push(b[Ce]);continue}const ae=ee+Y>>1,he=M[2*ae],_e=M[2*ae+1];Ho(he,_e,n,o)<=U&&O.push(b[ae]),(W===0?n-p<=he:o-p<=_e)&&(R.push(ee),R.push(ae-1),R.push(1-W)),(W===0?n+p>=he:o+p>=_e)&&(R.push(ae+1),R.push(Y),R.push(1-W))}return O}}function Jp(r,n,o,p,b,M){if(b-p<=o)return;const A=p+b>>1;i_(r,n,A,p,b,M),Jp(r,n,o,p,A-1,1-M),Jp(r,n,o,A+1,b,1-M)}function i_(r,n,o,p,b,M){for(;b>p;){if(b-p>600){const U=b-p+1,W=o-p+1,Y=Math.log(U),ee=.5*Math.exp(2*Y/3),ae=.5*Math.sqrt(Y*ee*(U-ee)/U)*(W-U/2<0?-1:1);i_(r,n,o,Math.max(p,Math.floor(o-W*ee/U+ae)),Math.min(b,Math.floor(o+(U-W)*ee/U+ae)),M)}const A=n[2*o+M];let R=p,O=b;for(nc(r,n,p,o),n[2*b+M]>A&&nc(r,n,p,b);R<O;){for(nc(r,n,R,O),R++,O--;n[2*R+M]<A;)R++;for(;n[2*O+M]>A;)O--}n[2*p+M]===A?nc(r,n,p,O):(O++,nc(r,n,O,b)),O<=o&&(p=O+1),o<=O&&(b=O-1)}}function nc(r,n,o,p){Qp(r,o,p),Qp(n,2*o,2*p),Qp(n,2*o+1,2*p+1)}function Qp(r,n,o){const p=r[n];r[n]=r[o],r[o]=p}function Ho(r,n,o,p){const b=r-o,M=n-p;return b*b+M*M}var ld;_.bf=void 0,(ld=_.bf||(_.bf={})).create="create",ld.load="load",ld.fullLoad="fullLoad";let ic=null,cr=[];const Tr=1e3/60,ud="loadTime",em="fullLoadTime",Yv={mark(r){performance.mark(r)},frame(r){const n=r;ic!=null&&cr.push(n-ic),ic=n},clearMetrics(){ic=null,cr=[],performance.clearMeasures(ud),performance.clearMeasures(em);for(const r in _.bf)performance.clearMarks(_.bf[r])},getPerformanceMetrics(){performance.measure(ud,_.bf.create,_.bf.load),performance.measure(em,_.bf.create,_.bf.fullLoad);const r=performance.getEntriesByName(ud)[0].duration,n=performance.getEntriesByName(em)[0].duration,o=cr.length,p=1/(cr.reduce((M,A)=>M+A,0)/o/1e3),b=cr.filter(M=>M>Tr).reduce((M,A)=>M+(A-Tr)/Tr,0);return{loadTime:r,fullLoadTime:n,fps:p,percentDroppedFrames:b/(o+b)*100,totalFrames:o}}};_.$=class extends ge{},_.A=Ju,_.B=No,_.C=function(r){if(gt==null){const n=r.navigator?r.navigator.userAgent:null;gt=!!r.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return gt},_.D=In,_.E=Kn,_.F=class{constructor(r,n){this.target=r,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Hv(()=>this.process()),this.subscription=function(o,p,b,M){return o.addEventListener(p,b,!1),{unsubscribe:()=>{o.removeEventListener(p,b,!1)}}}(this.target,"message",o=>this.receive(o)),this.globalScope=mt(self)?r:window}registerMessageHandler(r,n){this.messageHandlers[r]=n}sendAsync(r,n){return new Promise((o,p)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:o,reject:p},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const R={id:b,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(R)},{once:!0});const M=[],A=Object.assign(Object.assign({},r),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Oo(r.data,M)});this.target.postMessage(A,{transfer:M})})}receive(r){const n=r.data,o=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[o];const p=this.abortControllers[o];return delete this.abortControllers[o],void(p&&p.abort())}if(mt(self)||n.mustQueue)return this.tasks[o]=n,this.taskQueue.push(o),void this.invoker.trigger();this.processTask(o,n)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),n=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(r,n)}processTask(r,n){return c(this,void 0,void 0,function*(){if(n.type==="<response>"){const b=this.resolveRejects[r];return delete this.resolveRejects[r],b?void(n.error?b.reject(Ds(n.error)):b.resolve(Ds(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const o=Ds(n.data),p=new AbortController;this.abortControllers[r]=p;try{const b=yield this.messageHandlers[n.type](n.sourceMapId,o,p);this.completeTask(r,null,b)}catch(b){this.completeTask(r,b)}})}completeTask(r,n,o){const p=[];delete this.abortControllers[r];const b={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Oo(n):null,data:Oo(o,p)};this.target.postMessage(b,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.G=mn,_.H=function(){var r=new Ju(16);return Ju!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},_.I=Dp,_.J=function(r,n,o){var p,b,M,A,R,O,U,W,Y,ee,ae,he,_e=o[0],Ce=o[1],Ne=o[2];return n===r?(r[12]=n[0]*_e+n[4]*Ce+n[8]*Ne+n[12],r[13]=n[1]*_e+n[5]*Ce+n[9]*Ne+n[13],r[14]=n[2]*_e+n[6]*Ce+n[10]*Ne+n[14],r[15]=n[3]*_e+n[7]*Ce+n[11]*Ne+n[15]):(b=n[1],M=n[2],A=n[3],R=n[4],O=n[5],U=n[6],W=n[7],Y=n[8],ee=n[9],ae=n[10],he=n[11],r[0]=p=n[0],r[1]=b,r[2]=M,r[3]=A,r[4]=R,r[5]=O,r[6]=U,r[7]=W,r[8]=Y,r[9]=ee,r[10]=ae,r[11]=he,r[12]=p*_e+R*Ce+Y*Ne+n[12],r[13]=b*_e+O*Ce+ee*Ne+n[13],r[14]=M*_e+U*Ce+ae*Ne+n[14],r[15]=A*_e+W*Ce+he*Ne+n[15]),r},_.K=function(r,n,o){var p=o[0],b=o[1],M=o[2];return r[0]=n[0]*p,r[1]=n[1]*p,r[2]=n[2]*p,r[3]=n[3]*p,r[4]=n[4]*b,r[5]=n[5]*b,r[6]=n[6]*b,r[7]=n[7]*b,r[8]=n[8]*M,r[9]=n[9]*M,r[10]=n[10]*M,r[11]=n[11]*M,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},_.L=Zm,_.M=function(r,n){const o={};for(let p=0;p<n.length;p++){const b=n[p];b in r&&(o[b]=r[b])}return o},_.N=hu,_.O=Vg,_.P=D,_.Q=Gg,_.R=fs,_.S=ma,_.T=Kl,_.U=X,_.V=me,_.W=Jt,_.X=Ui,_.Y=H,_.Z=td,_._=c,_.a=ht,_.a$=function(r,n){var o=r[0],p=r[1],b=r[2],M=r[3],A=r[4],R=r[5],O=r[6],U=r[7],W=r[8],Y=r[9],ee=r[10],ae=r[11],he=r[12],_e=r[13],Ce=r[14],Ne=r[15],nt=n[0],ke=n[1],tt=n[2],pt=n[3],Wt=n[4],hn=n[5],rn=n[6],un=n[7],sn=n[8],wn=n[9],_n=n[10],dn=n[11],At=n[12],Ln=n[13],Mn=n[14],Xn=n[15];return Math.abs(o-nt)<=Ns*Math.max(1,Math.abs(o),Math.abs(nt))&&Math.abs(p-ke)<=Ns*Math.max(1,Math.abs(p),Math.abs(ke))&&Math.abs(b-tt)<=Ns*Math.max(1,Math.abs(b),Math.abs(tt))&&Math.abs(M-pt)<=Ns*Math.max(1,Math.abs(M),Math.abs(pt))&&Math.abs(A-Wt)<=Ns*Math.max(1,Math.abs(A),Math.abs(Wt))&&Math.abs(R-hn)<=Ns*Math.max(1,Math.abs(R),Math.abs(hn))&&Math.abs(O-rn)<=Ns*Math.max(1,Math.abs(O),Math.abs(rn))&&Math.abs(U-un)<=Ns*Math.max(1,Math.abs(U),Math.abs(un))&&Math.abs(W-sn)<=Ns*Math.max(1,Math.abs(W),Math.abs(sn))&&Math.abs(Y-wn)<=Ns*Math.max(1,Math.abs(Y),Math.abs(wn))&&Math.abs(ee-_n)<=Ns*Math.max(1,Math.abs(ee),Math.abs(_n))&&Math.abs(ae-dn)<=Ns*Math.max(1,Math.abs(ae),Math.abs(dn))&&Math.abs(he-At)<=Ns*Math.max(1,Math.abs(he),Math.abs(At))&&Math.abs(_e-Ln)<=Ns*Math.max(1,Math.abs(_e),Math.abs(Ln))&&Math.abs(Ce-Mn)<=Ns*Math.max(1,Math.abs(Ce),Math.abs(Mn))&&Math.abs(Ne-Xn)<=Ns*Math.max(1,Math.abs(Ne),Math.abs(Xn))},_.a0=jr,_.a1=Qc,_.a2=$e,_.a3=r=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(o=>{n.onloadstart=()=>{o(n)};for(const p of r){const b=window.document.createElement("source");bn(p)||(n.crossOrigin="Anonymous"),b.src=p,n.appendChild(b)}})},_.a4=function(){return We++},_.a5=ei,_.a6=Jc,_.a7=Nt,_.a8=ru,_.a9=nr,_.aA=function(r){r=r.slice();const n=Object.create(null);for(let o=0;o<r.length;o++)n[r[o].id]=r[o];for(let o=0;o<r.length;o++)"ref"in r[o]&&(r[o]=qn(r[o],n[r[o].ref]));return r},_.aB=function(r){if(r.type==="custom")return new ed(r);switch(r.type){case"background":return new Uv(r);case"circle":return new Vo(r);case"fill":return new uv(r);case"fill-extrusion":return new Ap(r);case"heatmap":return new rv(r);case"hillshade":return new Uf(r);case"line":return new _v(r);case"raster":return new Gv(r);case"symbol":return new Qf(r)}},_.aC=Oe,_.aD=function(r,n){if(!r)return[{command:"setStyle",args:[n]}];let o=[];try{if(!ut(r.version,n.version))return[{command:"setStyle",args:[n]}];ut(r.center,n.center)||o.push({command:"setCenter",args:[n.center]}),ut(r.zoom,n.zoom)||o.push({command:"setZoom",args:[n.zoom]}),ut(r.bearing,n.bearing)||o.push({command:"setBearing",args:[n.bearing]}),ut(r.pitch,n.pitch)||o.push({command:"setPitch",args:[n.pitch]}),ut(r.sprite,n.sprite)||o.push({command:"setSprite",args:[n.sprite]}),ut(r.glyphs,n.glyphs)||o.push({command:"setGlyphs",args:[n.glyphs]}),ut(r.transition,n.transition)||o.push({command:"setTransition",args:[n.transition]}),ut(r.light,n.light)||o.push({command:"setLight",args:[n.light]}),ut(r.terrain,n.terrain)||o.push({command:"setTerrain",args:[n.terrain]}),ut(r.sky,n.sky)||o.push({command:"setSky",args:[n.sky]}),ut(r.projection,n.projection)||o.push({command:"setProjection",args:[n.projection]});const p={},b=[];(function(A,R,O,U){let W;for(W in R=R||{},A=A||{})Object.prototype.hasOwnProperty.call(A,W)&&(Object.prototype.hasOwnProperty.call(R,W)||dt(W,O,U));for(W in R)Object.prototype.hasOwnProperty.call(R,W)&&(Object.prototype.hasOwnProperty.call(A,W)?ut(A[W],R[W])||(A[W].type==="geojson"&&R[W].type==="geojson"&&St(A,R,W)?Pe(O,{command:"setGeoJSONSourceData",args:[W,R[W].data]}):Ut(W,R,O,U)):pe(W,R,O))})(r.sources,n.sources,b,p);const M=[];r.layers&&r.layers.forEach(A=>{"source"in A&&p[A.source]?o.push({command:"removeLayer",args:[A.id]}):M.push(A)}),o=o.concat(b),function(A,R,O){R=R||[];const U=(A=A||[]).map(Dn),W=R.map(Dn),Y=A.reduce(an,{}),ee=R.reduce(an,{}),ae=U.slice(),he=Object.create(null);let _e,Ce,Ne,nt,ke;for(let tt=0,pt=0;tt<U.length;tt++)_e=U[tt],Object.prototype.hasOwnProperty.call(ee,_e)?pt++:(Pe(O,{command:"removeLayer",args:[_e]}),ae.splice(ae.indexOf(_e,pt),1));for(let tt=0,pt=0;tt<W.length;tt++)_e=W[W.length-1-tt],ae[ae.length-1-tt]!==_e&&(Object.prototype.hasOwnProperty.call(Y,_e)?(Pe(O,{command:"removeLayer",args:[_e]}),ae.splice(ae.lastIndexOf(_e,ae.length-pt),1)):pt++,nt=ae[ae.length-tt],Pe(O,{command:"addLayer",args:[ee[_e],nt]}),ae.splice(ae.length-tt,0,_e),he[_e]=!0);for(let tt=0;tt<W.length;tt++)if(_e=W[tt],Ce=Y[_e],Ne=ee[_e],!he[_e]&&!ut(Ce,Ne))if(ut(Ce.source,Ne.source)&&ut(Ce["source-layer"],Ne["source-layer"])&&ut(Ce.type,Ne.type)){for(ke in Lt(Ce.layout,Ne.layout,O,_e,null,"setLayoutProperty"),Lt(Ce.paint,Ne.paint,O,_e,null,"setPaintProperty"),ut(Ce.filter,Ne.filter)||Pe(O,{command:"setFilter",args:[_e,Ne.filter]}),ut(Ce.minzoom,Ne.minzoom)&&ut(Ce.maxzoom,Ne.maxzoom)||Pe(O,{command:"setLayerZoomRange",args:[_e,Ne.minzoom,Ne.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Lt(Ce[ke],Ne[ke],O,_e,ke.slice(6),"setPaintProperty"):ut(Ce[ke],Ne[ke])||Pe(O,{command:"setLayerProperty",args:[_e,ke,Ne[ke]]}));for(ke in Ne)Object.prototype.hasOwnProperty.call(Ne,ke)&&!Object.prototype.hasOwnProperty.call(Ce,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?Lt(Ce[ke],Ne[ke],O,_e,ke.slice(6),"setPaintProperty"):ut(Ce[ke],Ne[ke])||Pe(O,{command:"setLayerProperty",args:[_e,ke,Ne[ke]]}))}else Pe(O,{command:"removeLayer",args:[_e]}),nt=ae[ae.lastIndexOf(_e)+1],Pe(O,{command:"addLayer",args:[Ne,nt]})}(M,n.layers,o)}catch(p){console.warn("Unable to compute style diff:",p),o=[{command:"setStyle",args:[n]}]}return o},_.aE=function(r){const n=[],o=r.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),r.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},_.aF=function r(n,o){if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let p=0;p<n.length;p++)if(!r(n[p],o[p]))return!1;return!0}if(typeof n=="object"&&n!==null&&o!==null){if(typeof o!="object"||Object.keys(n).length!==Object.keys(o).length)return!1;for(const p in n)if(!r(n[p],o[p]))return!1;return!0}return n===o},_.aG=de,_.aH=be,_.aI=class extends Ku{constructor(r,n){super(r,n),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},_.aJ=Oh,_.aK=class extends Ku{constructor(r,n){super(r,n),this.current=$m}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let n=1;n<16;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},_.aL=qm,_.aM=Pf,_.aN=qt,_.aO=class extends Ku{constructor(r,n){super(r,n),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},_.aP=class extends Ku{constructor(r,n){super(r,n),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},_.aQ=function(r,n,o,p,b,M,A){var R=1/(n-o),O=1/(p-b),U=1/(M-A);return r[0]=-2*R,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*O,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*U,r[11]=0,r[12]=(n+o)*R,r[13]=(b+p)*O,r[14]=(A+M)*U,r[15]=1,r},_.aR=Ym,_.aS=class extends kt{},_.aT=bv,_.aU=class extends ln{},_.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},_.aW=Vc,_.aX=Lr,_.aY=ts,_.aZ=class extends tn{},_.a_=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]&&r[9]===n[9]&&r[10]===n[10]&&r[11]===n[11]&&r[12]===n[12]&&r[13]===n[13]&&r[14]===n[14]&&r[15]===n[15]},_.aa=jp,_.ab=function(r){const n={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,p,b,M)=>{const A=b||M;return n[p]=!A||A.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n},_.ac=function(r,n){const o=[];for(const p in r)p in n||o.push(p);return o},_.ad=Le,_.ae=function(r,n,o){var p=Math.sin(o),b=Math.cos(o),M=n[0],A=n[1],R=n[2],O=n[3],U=n[4],W=n[5],Y=n[6],ee=n[7];return n!==r&&(r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=M*b+U*p,r[1]=A*b+W*p,r[2]=R*b+Y*p,r[3]=O*b+ee*p,r[4]=U*b-M*p,r[5]=W*b-A*p,r[6]=Y*b-R*p,r[7]=ee*b-O*p,r},_.af=function(r){var n=new Ju(16);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n},_.ag=Ms,_.ah=function(r,n){let o=0,p=0;if(r.kind==="constant")p=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:b,minZoom:M,maxZoom:A}=r,R=b?Le(Hr.interpolationFactor(b,n,M,A),0,1):0;r.kind==="camera"?p=sr.number(r.minSize,r.maxSize,R):o=R}return{uSizeT:o,uSize:p}},_.aj=function(r,{uSize:n,uSizeT:o},{lowerSize:p,upperSize:b}){return r.kind==="source"?p/Ca:r.kind==="composite"?sr.number(p/Ca,b/Ca,o):n},_.ak=Up,_.al=function(r,n,o,p){const b=n.y-r.y,M=n.x-r.x,A=p.y-o.y,R=p.x-o.x,O=A*M-R*b;if(O===0)return null;const U=(R*(r.y-o.y)-A*(r.x-o.x))/O;return new D(r.x+U*M,r.y+U*b)},_.am=Xg,_.an=dl,_.ao=zf,_.ap=function(r){let n=1/0,o=1/0,p=-1/0,b=-1/0;for(const M of r)n=Math.min(n,M.x),o=Math.min(o,M.y),p=Math.max(p,M.x),b=Math.max(b,M.y);return[n,o,p,b]},_.aq=Vr,_.as=Bp,_.at=function(r,n){var o=n[0],p=n[1],b=n[2],M=n[3],A=n[4],R=n[5],O=n[6],U=n[7],W=n[8],Y=n[9],ee=n[10],ae=n[11],he=n[12],_e=n[13],Ce=n[14],Ne=n[15],nt=o*R-p*A,ke=o*O-b*A,tt=o*U-M*A,pt=p*O-b*R,Wt=p*U-M*R,hn=b*U-M*O,rn=W*_e-Y*he,un=W*Ce-ee*he,sn=W*Ne-ae*he,wn=Y*Ce-ee*_e,_n=Y*Ne-ae*_e,dn=ee*Ne-ae*Ce,At=nt*dn-ke*_n+tt*wn+pt*sn-Wt*un+hn*rn;return At?(r[0]=(R*dn-O*_n+U*wn)*(At=1/At),r[1]=(b*_n-p*dn-M*wn)*At,r[2]=(_e*hn-Ce*Wt+Ne*pt)*At,r[3]=(ee*Wt-Y*hn-ae*pt)*At,r[4]=(O*sn-A*dn-U*un)*At,r[5]=(o*dn-b*sn+M*un)*At,r[6]=(Ce*tt-he*hn-Ne*ke)*At,r[7]=(W*hn-ee*tt+ae*ke)*At,r[8]=(A*_n-R*sn+U*rn)*At,r[9]=(p*sn-o*_n-M*rn)*At,r[10]=(he*Wt-_e*tt+Ne*nt)*At,r[11]=(Y*tt-W*Wt-ae*nt)*At,r[12]=(R*un-A*wn-O*rn)*At,r[13]=(o*wn-p*un+b*rn)*At,r[14]=(_e*ke-he*pt-Ce*nt)*At,r[15]=(W*pt-Y*ke+ee*nt)*At,r):null},_.au=Fs,_.av=Fp,_.aw=Kp,_.ax=function(){const r={},n=Ze.$version;for(const o in Ze.$root){const p=Ze.$root[o];if(p.required){let b=null;b=o==="version"?n:p.type==="array"?[]:{},b!=null&&(r[o]=b)}}return r},_.ay=kh,_.az=qe,_.b=wt,_.b0=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},_.b1=function(r,n,o){return r[0]=n[0]*o[0],r[1]=n[1]*o[1],r[2]=n[2]*o[2],r[3]=n[3]*o[3],r},_.b2=function(r,n){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]*n[3]},_.b3=Me,_.b4=qg,_.b5=Hg,_.b6=function(r,n,o,p,b){var M,A=1/Math.tan(n/2);return r[0]=A/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=A,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,b!=null&&b!==1/0?(r[10]=(b+p)*(M=1/(p-b)),r[14]=2*b*p*M):(r[10]=-1,r[14]=-2*p),r},_.b7=function(r,n,o){var p=Math.sin(o),b=Math.cos(o),M=n[4],A=n[5],R=n[6],O=n[7],U=n[8],W=n[9],Y=n[10],ee=n[11];return n!==r&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[4]=M*b+U*p,r[5]=A*b+W*p,r[6]=R*b+Y*p,r[7]=O*b+ee*p,r[8]=U*b-M*p,r[9]=W*b-A*p,r[10]=Y*b-R*p,r[11]=ee*b-O*p,r},_.b8=le,_.b9=ye,_.bA=function(r){return r.message===Cn},_.bB=B,_.bC=Bo,_.ba=function(r){return r*Math.PI/180},_.bb=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},_.bc=class extends ue{},_.bd=qp,_.be=Yv,_.bg=cn,_.bh=function(r,n){ht.REGISTERED_PROTOCOLS[r]=n},_.bi=function(r){delete ht.REGISTERED_PROTOCOLS[r]},_.bj=function(r,n){const o={};for(let b=0;b<r.length;b++){const M=n&&n[r[b].id]||Xs(r[b]);n&&(n[r[b].id]=M);let A=o[M];A||(A=o[M]=[]),A.push(r[b])}const p=[];for(const b in o)p.push(o[b]);return p},_.bk=pn,_.bl=Xp,_.bm=Zp,_.bn=Cg,_.bo=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Ui/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const n=r.bucket.layers[0],o=n.layout,p=n._unevaluatedLayout._values,b={layoutIconSize:p["icon-size"].possiblyEvaluate(new nr(r.bucket.zoom+1),r.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new nr(r.bucket.zoom+1),r.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new nr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:W}=r.bucket.textSizeData;b.compositeTextSizes=[p["text-size"].possiblyEvaluate(new nr(U),r.canonical),p["text-size"].possiblyEvaluate(new nr(W),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:W}=r.bucket.iconSizeData;b.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new nr(U),r.canonical),p["icon-size"].possiblyEvaluate(new nr(W),r.canonical)]}const M=o.get("text-line-height")*Vr,A=o.get("text-rotation-alignment")!=="viewport"&&o.get("symbol-placement")!=="point",R=o.get("text-keep-upright"),O=o.get("text-size");for(const U of r.bucket.features){const W=o.get("text-font").evaluate(U,{},r.canonical).join(","),Y=O.evaluate(U,{},r.canonical),ee=b.layoutTextSize.evaluate(U,{},r.canonical),ae=b.layoutIconSize.evaluate(U,{},r.canonical),he={horizontal:{},vertical:void 0},_e=U.text;let Ce,Ne=[0,0];if(_e){const tt=_e.toString(),pt=o.get("text-letter-spacing").evaluate(U,{},r.canonical)*Vr,Wt=Cc(tt)?pt:0,hn=o.get("text-anchor").evaluate(U,{},r.canonical),rn=e_(n,U,r.canonical);if(!rn){const _n=o.get("text-radial-offset").evaluate(U,{},r.canonical);Ne=_n?li(hn,[_n*Vr,_l]):o.get("text-offset").evaluate(U,{},r.canonical).map(dn=>dn*Vr)}let un=A?"center":o.get("text-justify").evaluate(U,{},r.canonical);const sn=o.get("symbol-placement")==="point"?o.get("text-max-width").evaluate(U,{},r.canonical)*Vr:1/0,wn=()=>{r.bucket.allowVerticalPlacement&&Fo(tt)&&(he.vertical=Zf(_e,r.glyphMap,r.glyphPositions,r.imagePositions,W,sn,M,hn,"left",Wt,Ne,_.ai.vertical,!0,ee,Y))};if(!A&&rn){const _n=new Set;if(un==="auto")for(let At=0;At<rn.values.length;At+=2)_n.add(Fs(rn.values[At]));else _n.add(un);let dn=!1;for(const At of _n)if(!he.horizontal[At])if(dn)he.horizontal[At]=he.horizontal[0];else{const Ln=Zf(_e,r.glyphMap,r.glyphPositions,r.imagePositions,W,sn,M,"center",At,Wt,Ne,_.ai.horizontal,!1,ee,Y);Ln&&(he.horizontal[At]=Ln,dn=Ln.positionedLines.length===1)}wn()}else{un==="auto"&&(un=Fs(hn));const _n=Zf(_e,r.glyphMap,r.glyphPositions,r.imagePositions,W,sn,M,hn,un,Wt,Ne,_.ai.horizontal,!1,ee,Y);_n&&(he.horizontal[un]=_n),wn(),Fo(tt)&&A&&R&&(he.vertical=Zf(_e,r.glyphMap,r.glyphPositions,r.imagePositions,W,sn,M,hn,un,Wt,Ne,_.ai.vertical,!1,ee,Y))}}let nt=!1;if(U.icon&&U.icon.name){const tt=r.imageMap[U.icon.name];tt&&(Ce=Ov(r.imagePositions[U.icon.name],o.get("icon-offset").evaluate(U,{},r.canonical),o.get("icon-anchor").evaluate(U,{},r.canonical)),nt=!!tt.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=nt:r.bucket.sdfIcons!==nt&&st("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==r.bucket.pixelRatio||o.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ke=yl(he.horizontal)||he.vertical;r.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||Ce)&&Zr(r.bucket,U,he,Ce,r.imageMap,b,ee,ae,Ne,nt,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},_.bp=Cp,_.bq=$h,_.br=Tp,_.bs=ou,_.bt=Lp,_.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},_.bv=function(r,n,o,p,b){return c(this,void 0,void 0,function*(){if(me())try{return yield Jt(r,n,o,p,b)}catch{}return function(M,A,R,O,U){const W=M.width,Y=M.height;Tt&&jt||(Tt=new OffscreenCanvas(W,Y),jt=Tt.getContext("2d",{willReadFrequently:!0})),Tt.width=W,Tt.height=Y,jt.drawImage(M,0,0,W,Y);const ee=jt.getImageData(A,R,O,U);return jt.clearRect(0,0,W,Y),ee.data}(r,n,o,p,b)})},_.bw=nd,_.bx=I,_.by=P,_.bz=vg,_.c=jn,_.d=r=>c(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(n)}catch(o){throw new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),_.e=Te,_.f=r=>new Promise((n,o)=>{const p=new Image;p.onload=()=>{n(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=yt})},p.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(r)],{type:"image/png"});p.src=r.byteLength?URL.createObjectURL(b):yt}),_.g=Ft,_.h=(r,n)=>Wn(Te(r,{type:"json"}),n),_.i=mt,_.j=Gn,_.k=ui,_.l=(r,n)=>Wn(Te(r,{type:"arrayBuffer"}),n),_.m=Wn,_.n=function(r){return new Lp(r).readFields(Cv,[])},_.o=Uc,_.p=Ig,_.q=y,_.r=Ph,_.s=bn,_.t=Zl,_.u=se,_.v=Ze,_.w=st,_.x=Ys,_.y=function([r,n,o]){return n+=90,n*=Math.PI/180,o*=Math.PI/180,{x:r*Math.cos(n)*Math.sin(o),y:r*Math.sin(n)*Math.sin(o),z:r*Math.cos(o)}},_.z=sr}),d("worker",["./shared"],function(_){class c{constructor(te){this.keyCache={},te&&this.replace(te)}replace(te){this._layerConfigs={},this._layers={},this.update(te,[])}update(te,ie){for(const ce of te){this._layerConfigs[ce.id]=ce;const Ve=this._layers[ce.id]=_.aB(ce);Ve._featureFilter=_.a7(Ve.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of ie)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const fe=_.bj(Object.values(this._layerConfigs),this.keyCache);for(const ce of fe){const Ve=ce.map(ct=>this._layers[ct.id]),Xe=Ve[0];if(Xe.visibility==="none")continue;const et=Xe.source||"";let Fe=this.familiesBySource[et];Fe||(Fe=this.familiesBySource[et]={});const _t=Xe.sourceLayer||"_geojsonTileLayer";let Pt=Fe[_t];Pt||(Pt=Fe[_t]=[]),Pt.push(Ve)}}}class I{constructor(te){const ie={},fe=[];for(const et in te){const Fe=te[et],_t=ie[et]={};for(const Pt in Fe){const ct=Fe[+Pt];if(!ct||ct.bitmap.width===0||ct.bitmap.height===0)continue;const Xt={x:0,y:0,w:ct.bitmap.width+2,h:ct.bitmap.height+2};fe.push(Xt),_t[Pt]={rect:Xt,metrics:ct.metrics}}}const{w:ce,h:Ve}=_.p(fe),Xe=new _.o({width:ce||1,height:Ve||1});for(const et in te){const Fe=te[et];for(const _t in Fe){const Pt=Fe[+_t];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const ct=ie[et][_t].rect;_.o.copy(Pt.bitmap,Xe,{x:0,y:0},{x:ct.x+1,y:ct.y+1},Pt.bitmap)}}this.image=Xe,this.positions=ie}}_.bk("GlyphAtlas",I);class P{constructor(te){this.tileID=new _.S(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,ie,fe,ce){return _._(this,void 0,void 0,function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new _.a5;const Ve=new _.bl(Object.keys(te.layers).sort()),Xe=new _.bm(this.tileID,this.promoteId);Xe.bucketLayerIDs=[];const et={},Fe={featureIndex:Xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe},_t=ie.familiesBySource[this.source];for(const Ge in _t){const it=te.layers[Ge];if(!it)continue;it.version===1&&_.w(`Vector tile source "${this.source}" layer "${Ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const at=Ve.encode(Ge),Qe=[];for(let Dt=0;Dt<it.length;Dt++){const en=it.feature(Dt),Sn=Xe.getId(en,Ge);Qe.push({feature:en,id:Sn,index:Dt,sourceLayerIndex:at})}for(const Dt of _t[Ge]){const en=Dt[0];en.source!==this.source&&_.w(`layer.source = ${en.source} does not equal this.source = ${this.source}`),en.minzoom&&this.zoom<Math.floor(en.minzoom)||en.maxzoom&&this.zoom>=en.maxzoom||en.visibility!=="none"&&(F(Dt,this.zoom,fe),(et[en.id]=en.createBucket({index:Xe.bucketLayerIDs.length,layers:Dt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:at,sourceID:this.source})).populate(Qe,Fe,this.tileID.canonical),Xe.bucketLayerIDs.push(Dt.map(Sn=>Sn.id)))}}const Pt=_.aG(Fe.glyphDependencies,Ge=>Object.keys(Ge).map(Number));this.inFlightDependencies.forEach(Ge=>Ge==null?void 0:Ge.abort()),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Pt).length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),ct=ce.sendAsync({type:"GG",data:{stacks:Pt,source:this.source,tileID:this.tileID,type:"glyphs"}},Ge)}const Xt=Object.keys(Fe.iconDependencies);let yn=Promise.resolve({});if(Xt.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),yn=ce.sendAsync({type:"GI",data:{icons:Xt,source:this.source,tileID:this.tileID,type:"icons"}},Ge)}const An=Object.keys(Fe.patternDependencies);let Hn=Promise.resolve({});if(An.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),Hn=ce.sendAsync({type:"GI",data:{icons:An,source:this.source,tileID:this.tileID,type:"patterns"}},Ge)}const[di,kn,Mi]=yield Promise.all([ct,yn,Hn]),Li=new I(di),ve=new _.bn(kn,Mi);for(const Ge in et){const it=et[Ge];it instanceof _.a6?(F(it.layers,this.zoom,fe),_.bo({bucket:it,glyphMap:di,glyphPositions:Li.positions,imageMap:kn,imagePositions:ve.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):it.hasPattern&&(it instanceof _.bp||it instanceof _.bq||it instanceof _.br)&&(F(it.layers,this.zoom,fe),it.addFeatures(Fe,this.tileID.canonical,ve.patternPositions))}return this.status="done",{buckets:Object.values(et).filter(Ge=>!Ge.isEmpty()),featureIndex:Xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Li.image,imageAtlas:ve,glyphMap:this.returnDependencies?di:null,iconMap:this.returnDependencies?kn:null,glyphPositions:this.returnDependencies?Li.positions:null}})}}function F(Se,te,ie){const fe=new _.a9(te);for(const ce of Se)ce.recalculate(fe,ie)}class D{constructor(te,ie,fe){this.actor=te,this.layerIndex=ie,this.availableImages=fe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(te,ie){return _._(this,void 0,void 0,function*(){const fe=yield _.l(te.request,ie);try{return{vectorTile:new _.bs.VectorTile(new _.bt(fe.data)),rawData:fe.data,cacheControl:fe.cacheControl,expires:fe.expires}}catch(ce){const Ve=new Uint8Array(fe.data);let Xe=`Unable to parse the tile at ${te.request.url}, `;throw Xe+=Ve[0]===31&&Ve[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.message}`,new Error(Xe)}})}loadTile(te){return _._(this,void 0,void 0,function*(){const ie=te.uid,fe=!!(te&&te.request&&te.request.collectResourceTiming)&&new _.bu(te.request),ce=new P(te);this.loading[ie]=ce;const Ve=new AbortController;ce.abort=Ve;try{const Xe=yield this.loadVectorTile(te,Ve);if(delete this.loading[ie],!Xe)return null;const et=Xe.rawData,Fe={};Xe.expires&&(Fe.expires=Xe.expires),Xe.cacheControl&&(Fe.cacheControl=Xe.cacheControl);const _t={};if(fe){const ct=fe.finish();ct&&(_t.resourceTiming=JSON.parse(JSON.stringify(ct)))}ce.vectorTile=Xe.vectorTile;const Pt=ce.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ie]=ce,this.fetching[ie]={rawTileData:et,cacheControl:Fe,resourceTiming:_t};try{const ct=yield Pt;return _.e({rawTileData:et.slice(0)},ct,Fe,_t)}finally{delete this.fetching[ie]}}catch(Xe){throw delete this.loading[ie],ce.status="done",this.loaded[ie]=ce,Xe}})}reloadTile(te){return _._(this,void 0,void 0,function*(){const ie=te.uid;if(!this.loaded||!this.loaded[ie])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const fe=this.loaded[ie];if(fe.showCollisionBoxes=te.showCollisionBoxes,fe.status==="parsing"){const ce=yield fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ve;if(this.fetching[ie]){const{rawTileData:Xe,cacheControl:et,resourceTiming:Fe}=this.fetching[ie];delete this.fetching[ie],Ve=_.e({rawTileData:Xe.slice(0)},ce,et,Fe)}else Ve=ce;return Ve}if(fe.status==="done"&&fe.vectorTile)return fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(te){return _._(this,void 0,void 0,function*(){const ie=this.loading,fe=te.uid;ie&&ie[fe]&&ie[fe].abort&&(ie[fe].abort.abort(),delete ie[fe])})}removeTile(te){return _._(this,void 0,void 0,function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]})}}class N{constructor(){this.loaded={}}loadTile(te){return _._(this,void 0,void 0,function*(){const{uid:ie,encoding:fe,rawImageData:ce,redFactor:Ve,greenFactor:Xe,blueFactor:et,baseShift:Fe}=te,_t=ce.width+2,Pt=ce.height+2,ct=_.b(ce)?new _.R({width:_t,height:Pt},yield _.bv(ce,-1,-1,_t,Pt)):ce,Xt=new _.bw(ie,ct,fe,Ve,Xe,et,Fe);return this.loaded=this.loaded||{},this.loaded[ie]=Xt,Xt})}removeTile(te){const ie=this.loaded,fe=te.uid;ie&&ie[fe]&&delete ie[fe]}}function G(Se,te){if(Se.length!==0){Z(Se[0],te);for(var ie=1;ie<Se.length;ie++)Z(Se[ie],!te)}}function Z(Se,te){for(var ie=0,fe=0,ce=0,Ve=Se.length,Xe=Ve-1;ce<Ve;Xe=ce++){var et=(Se[ce][0]-Se[Xe][0])*(Se[Xe][1]+Se[ce][1]),Fe=ie+et;fe+=Math.abs(ie)>=Math.abs(et)?ie-Fe+et:et-Fe+ie,ie=Fe}ie+fe>=0!=!!te&&Se.reverse()}var re=_.bx(function Se(te,ie){var fe,ce=te&&te.type;if(ce==="FeatureCollection")for(fe=0;fe<te.features.length;fe++)Se(te.features[fe],ie);else if(ce==="GeometryCollection")for(fe=0;fe<te.geometries.length;fe++)Se(te.geometries[fe],ie);else if(ce==="Feature")Se(te.geometry,ie);else if(ce==="Polygon")G(te.coordinates,ie);else if(ce==="MultiPolygon")for(fe=0;fe<te.coordinates.length;fe++)G(te.coordinates[fe],ie);return te});const $=_.bs.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},me=_.by,le=_.bs.VectorTileFeature,ye=Le;function Le(Se,te){this.options=te||{},this.features=Se,this.length=Se.length}function Me(Se,te){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=te||4096}Le.prototype.feature=function(Se){return new Me(this.features[Se],this.options.extent)},Me.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var te=0;te<Se.length;te++){for(var ie=Se[te],fe=[],ce=0;ce<ie.length;ce++)fe.push(new me(ie[ce][0],ie[ce][1]));this.geometry.push(fe)}return this.geometry},Me.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,te=1/0,ie=-1/0,fe=1/0,ce=-1/0,Ve=0;Ve<Se.length;Ve++)for(var Xe=Se[Ve],et=0;et<Xe.length;et++){var Fe=Xe[et];te=Math.min(te,Fe.x),ie=Math.max(ie,Fe.x),fe=Math.min(fe,Fe.y),ce=Math.max(ce,Fe.y)}return[te,fe,ie,ce]},Me.prototype.toGeoJSON=le.prototype.toGeoJSON;var Te=_.bz,We=ye;function de(Se){var te=new Te;return function(ie,fe){for(var ce in ie.layers)fe.writeMessage(3,be,ie.layers[ce])}(Se,te),te.finish()}function be(Se,te){var ie;te.writeVarintField(15,Se.version||1),te.writeStringField(1,Se.name||""),te.writeVarintField(5,Se.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Se.length;ie++)fe.feature=Se.feature(ie),te.writeMessage(2,Oe,fe);var ce=fe.keys;for(ie=0;ie<ce.length;ie++)te.writeStringField(3,ce[ie]);var Ve=fe.values;for(ie=0;ie<Ve.length;ie++)te.writeMessage(4,gt,Ve[ie])}function Oe(Se,te){var ie=Se.feature;ie.id!==void 0&&te.writeVarintField(1,ie.id),te.writeMessage(2,vt,Se),te.writeVarintField(3,ie.type),te.writeMessage(4,mt,ie)}function vt(Se,te){var ie=Se.feature,fe=Se.keys,ce=Se.values,Ve=Se.keycache,Xe=Se.valuecache;for(var et in ie.properties){var Fe=ie.properties[et],_t=Ve[et];if(Fe!==null){_t===void 0&&(fe.push(et),Ve[et]=_t=fe.length-1),te.writeVarint(_t);var Pt=typeof Fe;Pt!=="string"&&Pt!=="boolean"&&Pt!=="number"&&(Fe=JSON.stringify(Fe));var ct=Pt+":"+Fe,Xt=Xe[ct];Xt===void 0&&(ce.push(Fe),Xe[ct]=Xt=ce.length-1),te.writeVarint(Xt)}}}function st(Se,te){return(te<<3)+(7&Se)}function Je(Se){return Se<<1^Se>>31}function mt(Se,te){for(var ie=Se.loadGeometry(),fe=Se.type,ce=0,Ve=0,Xe=ie.length,et=0;et<Xe;et++){var Fe=ie[et],_t=1;fe===1&&(_t=Fe.length),te.writeVarint(st(1,_t));for(var Pt=fe===3?Fe.length-1:Fe.length,ct=0;ct<Pt;ct++){ct===1&&fe!==1&&te.writeVarint(st(2,Pt-1));var Xt=Fe[ct].x-ce,yn=Fe[ct].y-Ve;te.writeVarint(Je(Xt)),te.writeVarint(Je(yn)),ce+=Xt,Ve+=yn}fe===3&&te.writeVarint(st(7,1))}}function gt(Se,te){var ie=typeof Se;ie==="string"?te.writeStringField(1,Se):ie==="boolean"?te.writeBooleanField(7,Se):ie==="number"&&(Se%1!=0?te.writeDoubleField(3,Se):Se<0?te.writeSVarintField(6,Se):te.writeVarintField(5,Se))}X.exports=de,X.exports.fromVectorTileJs=de,X.exports.fromGeojsonVt=function(Se,te){te=te||{};var ie={};for(var fe in Se)ie[fe]=new We(Se[fe].features,te),ie[fe].name=fe,ie[fe].version=te.version,ie[fe].extent=te.extent;return de({layers:ie})},X.exports.GeoJSONWrapper=We;var wt=_.bx(X.exports);const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Jt=Math.fround||(Tt=new Float32Array(1),Se=>(Tt[0]=+Se,Tt[0]));var Tt;const jt=3,Cn=5,jn=6;class ht{constructor(te){this.options=Object.assign(Object.create(yt),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:fe,maxZoom:ce}=this.options;ie&&console.time("total time");const Ve=`prepare ${te.length} points`;ie&&console.time(Ve),this.points=te;const Xe=[];for(let Fe=0;Fe<te.length;Fe++){const _t=te[Fe];if(!_t.geometry)continue;const[Pt,ct]=_t.geometry.coordinates,Xt=Jt(cn(Pt)),yn=Jt(qe(ct));Xe.push(Xt,yn,1/0,Fe,-1,1),this.options.reduce&&Xe.push(0)}let et=this.trees[ce+1]=this._createTree(Xe);ie&&console.timeEnd(Ve);for(let Fe=ce;Fe>=fe;Fe--){const _t=+Date.now();et=this.trees[Fe]=this._createTree(this._cluster(et,Fe)),ie&&console.log("z%d: %d clusters in %dms",Fe,et.numItems,+Date.now()-_t)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let fe=((te[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,te[1]));let Ve=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)fe=-180,Ve=180;else if(fe>Ve){const ct=this.getClusters([fe,ce,180,Xe],ie),Xt=this.getClusters([-180,ce,Ve,Xe],ie);return ct.concat(Xt)}const et=this.trees[this._limitZoom(ie)],Fe=et.range(cn(fe),qe(Xe),cn(Ve),qe(ce)),_t=et.data,Pt=[];for(const ct of Fe){const Xt=this.stride*ct;Pt.push(_t[Xt+Cn]>1?Ft(_t,Xt,this.clusterProps):this.points[_t[Xt+jt]])}return Pt}getChildren(te){const ie=this._getOriginId(te),fe=this._getOriginZoom(te),ce="No cluster with the specified id.",Ve=this.trees[fe];if(!Ve)throw new Error(ce);const Xe=Ve.data;if(ie*this.stride>=Xe.length)throw new Error(ce);const et=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Fe=Ve.within(Xe[ie*this.stride],Xe[ie*this.stride+1],et),_t=[];for(const Pt of Fe){const ct=Pt*this.stride;Xe[ct+4]===te&&_t.push(Xe[ct+Cn]>1?Ft(Xe,ct,this.clusterProps):this.points[Xe[ct+jt]])}if(_t.length===0)throw new Error(ce);return _t}getLeaves(te,ie,fe){const ce=[];return this._appendLeaves(ce,te,ie=ie||10,fe=fe||0,0),ce}getTile(te,ie,fe){const ce=this.trees[this._limitZoom(te)],Ve=Math.pow(2,te),{extent:Xe,radius:et}=this.options,Fe=et/Xe,_t=(fe-Fe)/Ve,Pt=(fe+1+Fe)/Ve,ct={features:[]};return this._addTileFeatures(ce.range((ie-Fe)/Ve,_t,(ie+1+Fe)/Ve,Pt),ce.data,ie,fe,Ve,ct),ie===0&&this._addTileFeatures(ce.range(1-Fe/Ve,_t,1,Pt),ce.data,Ve,fe,Ve,ct),ie===Ve-1&&this._addTileFeatures(ce.range(0,_t,Fe/Ve,Pt),ce.data,-1,fe,Ve,ct),ct.features.length?ct:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const fe=this.getChildren(te);if(ie++,fe.length!==1)break;te=fe[0].properties.cluster_id}return ie}_appendLeaves(te,ie,fe,ce,Ve){const Xe=this.getChildren(ie);for(const et of Xe){const Fe=et.properties;if(Fe&&Fe.cluster?Ve+Fe.point_count<=ce?Ve+=Fe.point_count:Ve=this._appendLeaves(te,Fe.cluster_id,fe,ce,Ve):Ve<ce?Ve++:te.push(et),te.length===fe)break}return Ve}_createTree(te){const ie=new _.aw(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<te.length;fe+=this.stride)ie.add(te[fe],te[fe+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,fe,ce,Ve,Xe){for(const et of te){const Fe=et*this.stride,_t=ie[Fe+Cn]>1;let Pt,ct,Xt;if(_t)Pt=mn(ie,Fe,this.clusterProps),ct=ie[Fe],Xt=ie[Fe+1];else{const Hn=this.points[ie[Fe+jt]];Pt=Hn.properties;const[di,kn]=Hn.geometry.coordinates;ct=cn(di),Xt=qe(kn)}const yn={type:1,geometry:[[Math.round(this.options.extent*(ct*Ve-fe)),Math.round(this.options.extent*(Xt*Ve-ce))]],tags:Pt};let An;An=_t||this.options.generateId?ie[Fe+jt]:this.points[ie[Fe+jt]].id,An!==void 0&&(yn.id=An),Xe.features.push(yn)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:fe,extent:ce,reduce:Ve,minPoints:Xe}=this.options,et=fe/(ce*Math.pow(2,ie)),Fe=te.data,_t=[],Pt=this.stride;for(let ct=0;ct<Fe.length;ct+=Pt){if(Fe[ct+2]<=ie)continue;Fe[ct+2]=ie;const Xt=Fe[ct],yn=Fe[ct+1],An=te.within(Fe[ct],Fe[ct+1],et),Hn=Fe[ct+Cn];let di=Hn;for(const kn of An){const Mi=kn*Pt;Fe[Mi+2]>ie&&(di+=Fe[Mi+Cn])}if(di>Hn&&di>=Xe){let kn,Mi=Xt*Hn,Li=yn*Hn,ve=-1;const Ge=((ct/Pt|0)<<5)+(ie+1)+this.points.length;for(const it of An){const at=it*Pt;if(Fe[at+2]<=ie)continue;Fe[at+2]=ie;const Qe=Fe[at+Cn];Mi+=Fe[at]*Qe,Li+=Fe[at+1]*Qe,Fe[at+4]=Ge,Ve&&(kn||(kn=this._map(Fe,ct,!0),ve=this.clusterProps.length,this.clusterProps.push(kn)),Ve(kn,this._map(Fe,at)))}Fe[ct+4]=Ge,_t.push(Mi/di,Li/di,1/0,Ge,-1,di),Ve&&_t.push(ve)}else{for(let kn=0;kn<Pt;kn++)_t.push(Fe[ct+kn]);if(di>1)for(const kn of An){const Mi=kn*Pt;if(!(Fe[Mi+2]<=ie)){Fe[Mi+2]=ie;for(let Li=0;Li<Pt;Li++)_t.push(Fe[Mi+Li])}}}}return _t}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,fe){if(te[ie+Cn]>1){const Xe=this.clusterProps[te[ie+jn]];return fe?Object.assign({},Xe):Xe}const ce=this.points[te[ie+jt]].properties,Ve=this.options.map(ce);return fe&&Ve===ce?Object.assign({},Ve):Ve}}function Ft(Se,te,ie){return{type:"Feature",id:Se[te+jt],properties:mn(Se,te,ie),geometry:{type:"Point",coordinates:[(fe=Se[te],360*(fe-.5)),Wn(Se[te+1])]}};var fe}function mn(Se,te,ie){const fe=Se[te+Cn],ce=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Ve=Se[te+jn],Xe=Ve===-1?{}:Object.assign({},ie[Ve]);return Object.assign(Xe,{cluster:!0,cluster_id:Se[te+jt],point_count:fe,point_count_abbreviated:ce})}function cn(Se){return Se/360+.5}function qe(Se){const te=Math.sin(Se*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Wn(Se){const te=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function bn(Se,te,ie,fe){let ce=fe;const Ve=te+(ie-te>>1);let Xe,et=ie-te;const Fe=Se[te],_t=Se[te+1],Pt=Se[ie],ct=Se[ie+1];for(let Xt=te+3;Xt<ie;Xt+=3){const yn=nn(Se[Xt],Se[Xt+1],Fe,_t,Pt,ct);if(yn>ce)Xe=Xt,ce=yn;else if(yn===ce){const An=Math.abs(Xt-Ve);An<et&&(Xe=Xt,et=An)}}ce>fe&&(Xe-te>3&&bn(Se,te,Xe,fe),Se[Xe+2]=ce,ie-Xe>3&&bn(Se,Xe,ie,fe))}function nn(Se,te,ie,fe,ce,Ve){let Xe=ce-ie,et=Ve-fe;if(Xe!==0||et!==0){const Fe=((Se-ie)*Xe+(te-fe)*et)/(Xe*Xe+et*et);Fe>1?(ie=ce,fe=Ve):Fe>0&&(ie+=Xe*Fe,fe+=et*Fe)}return Xe=Se-ie,et=te-fe,Xe*Xe+et*et}function ne(Se,te,ie,fe){const ce={id:Se??null,type:te,geometry:ie,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")ui(ce,ie);else if(te==="Polygon")ui(ce,ie[0]);else if(te==="MultiLineString")for(const Ve of ie)ui(ce,Ve);else if(te==="MultiPolygon")for(const Ve of ie)ui(ce,Ve[0]);return ce}function ui(Se,te){for(let ie=0;ie<te.length;ie+=3)Se.minX=Math.min(Se.minX,te[ie]),Se.minY=Math.min(Se.minY,te[ie+1]),Se.maxX=Math.max(Se.maxX,te[ie]),Se.maxY=Math.max(Se.maxY,te[ie+1])}function Gn(Se,te,ie,fe){if(!te.geometry)return;const ce=te.geometry.coordinates;if(ce&&ce.length===0)return;const Ve=te.geometry.type,Xe=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let et=[],Fe=te.id;if(ie.promoteId?Fe=te.properties[ie.promoteId]:ie.generateId&&(Fe=fe||0),Ve==="Point")Kn(ce,et);else if(Ve==="MultiPoint")for(const _t of ce)Kn(_t,et);else if(Ve==="LineString")Ze(ce,et,Xe,!1);else if(Ve==="MultiLineString"){if(ie.lineMetrics){for(const _t of ce)et=[],Ze(_t,et,Xe,!1),Se.push(ne(Fe,"LineString",et,te.properties));return}hi(ce,et,Xe,!1)}else if(Ve==="Polygon")hi(ce,et,Xe,!0);else{if(Ve!=="MultiPolygon"){if(Ve==="GeometryCollection"){for(const _t of te.geometry.geometries)Gn(Se,{id:Fe,geometry:_t,properties:te.properties},ie,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _t of ce){const Pt=[];hi(_t,Pt,Xe,!0),et.push(Pt)}}Se.push(ne(Fe,Ve,et,te.properties))}function Kn(Se,te){te.push(qn(Se[0]),ut(Se[1]),0)}function Ze(Se,te,ie,fe){let ce,Ve,Xe=0;for(let Fe=0;Fe<Se.length;Fe++){const _t=qn(Se[Fe][0]),Pt=ut(Se[Fe][1]);te.push(_t,Pt,0),Fe>0&&(Xe+=fe?(ce*Pt-_t*Ve)/2:Math.sqrt(Math.pow(_t-ce,2)+Math.pow(Pt-Ve,2))),ce=_t,Ve=Pt}const et=te.length-3;te[2]=1,bn(te,0,et,ie),te[et+2]=1,te.size=Math.abs(Xe),te.start=0,te.end=te.size}function hi(Se,te,ie,fe){for(let ce=0;ce<Se.length;ce++){const Ve=[];Ze(Se[ce],Ve,ie,fe),te.push(Ve)}}function qn(Se){return Se/360+.5}function ut(Se){const te=Math.sin(Se*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Pe(Se,te,ie,fe,ce,Ve,Xe,et){if(fe/=te,Ve>=(ie/=te)&&Xe<fe)return Se;if(Xe<ie||Ve>=fe)return null;const Fe=[];for(const _t of Se){const Pt=_t.geometry;let ct=_t.type;const Xt=ce===0?_t.minX:_t.minY,yn=ce===0?_t.maxX:_t.maxY;if(Xt>=ie&&yn<fe){Fe.push(_t);continue}if(yn<ie||Xt>=fe)continue;let An=[];if(ct==="Point"||ct==="MultiPoint")pe(Pt,An,ie,fe,ce);else if(ct==="LineString")dt(Pt,An,ie,fe,ce,!1,et.lineMetrics);else if(ct==="MultiLineString")St(Pt,An,ie,fe,ce,!1);else if(ct==="Polygon")St(Pt,An,ie,fe,ce,!0);else if(ct==="MultiPolygon")for(const Hn of Pt){const di=[];St(Hn,di,ie,fe,ce,!0),di.length&&An.push(di)}if(An.length){if(et.lineMetrics&&ct==="LineString"){for(const Hn of An)Fe.push(ne(_t.id,ct,Hn,_t.tags));continue}ct!=="LineString"&&ct!=="MultiLineString"||(An.length===1?(ct="LineString",An=An[0]):ct="MultiLineString"),ct!=="Point"&&ct!=="MultiPoint"||(ct=An.length===3?"Point":"MultiPoint"),Fe.push(ne(_t.id,ct,An,_t.tags))}}return Fe.length?Fe:null}function pe(Se,te,ie,fe,ce){for(let Ve=0;Ve<Se.length;Ve+=3){const Xe=Se[Ve+ce];Xe>=ie&&Xe<=fe&&Lt(te,Se[Ve],Se[Ve+1],Se[Ve+2])}}function dt(Se,te,ie,fe,ce,Ve,Xe){let et=Ut(Se);const Fe=ce===0?Dn:an;let _t,Pt,ct=Se.start;for(let di=0;di<Se.length-3;di+=3){const kn=Se[di],Mi=Se[di+1],Li=Se[di+2],ve=Se[di+3],Ge=Se[di+4],it=ce===0?kn:Mi,at=ce===0?ve:Ge;let Qe=!1;Xe&&(_t=Math.sqrt(Math.pow(kn-ve,2)+Math.pow(Mi-Ge,2))),it<ie?at>ie&&(Pt=Fe(et,kn,Mi,ve,Ge,ie),Xe&&(et.start=ct+_t*Pt)):it>fe?at<fe&&(Pt=Fe(et,kn,Mi,ve,Ge,fe),Xe&&(et.start=ct+_t*Pt)):Lt(et,kn,Mi,Li),at<ie&&it>=ie&&(Pt=Fe(et,kn,Mi,ve,Ge,ie),Qe=!0),at>fe&&it<=fe&&(Pt=Fe(et,kn,Mi,ve,Ge,fe),Qe=!0),!Ve&&Qe&&(Xe&&(et.end=ct+_t*Pt),te.push(et),et=Ut(Se)),Xe&&(ct+=_t)}let Xt=Se.length-3;const yn=Se[Xt],An=Se[Xt+1],Hn=ce===0?yn:An;Hn>=ie&&Hn<=fe&&Lt(et,yn,An,Se[Xt+2]),Xt=et.length-3,Ve&&Xt>=3&&(et[Xt]!==et[0]||et[Xt+1]!==et[1])&&Lt(et,et[0],et[1],et[2]),et.length&&te.push(et)}function Ut(Se){const te=[];return te.size=Se.size,te.start=Se.start,te.end=Se.end,te}function St(Se,te,ie,fe,ce,Ve){for(const Xe of Se)dt(Xe,te,ie,fe,ce,Ve,!1)}function Lt(Se,te,ie,fe){Se.push(te,ie,fe)}function Dn(Se,te,ie,fe,ce,Ve){const Xe=(Ve-te)/(fe-te);return Lt(Se,Ve,ie+(ce-ie)*Xe,1),Xe}function an(Se,te,ie,fe,ce,Ve){const Xe=(Ve-ie)/(ce-ie);return Lt(Se,te+(fe-te)*Xe,Ve,1),Xe}function $e(Se,te){const ie=[];for(let fe=0;fe<Se.length;fe++){const ce=Se[fe],Ve=ce.type;let Xe;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")Xe=On(ce.geometry,te);else if(Ve==="MultiLineString"||Ve==="Polygon"){Xe=[];for(const et of ce.geometry)Xe.push(On(et,te))}else if(Ve==="MultiPolygon"){Xe=[];for(const et of ce.geometry){const Fe=[];for(const _t of et)Fe.push(On(_t,te));Xe.push(Fe)}}ie.push(ne(ce.id,Ve,Xe,ce.tags))}return ie}function On(Se,te){const ie=[];ie.size=Se.size,Se.start!==void 0&&(ie.start=Se.start,ie.end=Se.end);for(let fe=0;fe<Se.length;fe+=3)ie.push(Se[fe]+te,Se[fe+1],Se[fe+2]);return ie}function Mt(Se,te){if(Se.transformed)return Se;const ie=1<<Se.z,fe=Se.x,ce=Se.y;for(const Ve of Se.features){const Xe=Ve.geometry,et=Ve.type;if(Ve.geometry=[],et===1)for(let Fe=0;Fe<Xe.length;Fe+=2)Ve.geometry.push(Rt(Xe[Fe],Xe[Fe+1],te,ie,fe,ce));else for(let Fe=0;Fe<Xe.length;Fe++){const _t=[];for(let Pt=0;Pt<Xe[Fe].length;Pt+=2)_t.push(Rt(Xe[Fe][Pt],Xe[Fe][Pt+1],te,ie,fe,ce));Ve.geometry.push(_t)}}return Se.transformed=!0,Se}function Rt(Se,te,ie,fe,ce,Ve){return[Math.round(ie*(Se*fe-ce)),Math.round(ie*(te*fe-Ve))]}function Qn(Se,te,ie,fe,ce){const Ve=te===ce.maxZoom?0:ce.tolerance/((1<<te)*ce.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:Se.length,source:null,x:ie,y:fe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Se)bt(Xe,et,Ve,ce);return Xe}function bt(Se,te,ie,fe){const ce=te.geometry,Ve=te.type,Xe=[];if(Se.minX=Math.min(Se.minX,te.minX),Se.minY=Math.min(Se.minY,te.minY),Se.maxX=Math.max(Se.maxX,te.maxX),Se.maxY=Math.max(Se.maxY,te.maxY),Ve==="Point"||Ve==="MultiPoint")for(let et=0;et<ce.length;et+=3)Xe.push(ce[et],ce[et+1]),Se.numPoints++,Se.numSimplified++;else if(Ve==="LineString")zt(Xe,ce,Se,ie,!1,!1);else if(Ve==="MultiLineString"||Ve==="Polygon")for(let et=0;et<ce.length;et++)zt(Xe,ce[et],Se,ie,Ve==="Polygon",et===0);else if(Ve==="MultiPolygon")for(let et=0;et<ce.length;et++){const Fe=ce[et];for(let _t=0;_t<Fe.length;_t++)zt(Xe,Fe[_t],Se,ie,!0,_t===0)}if(Xe.length){let et=te.tags||null;if(Ve==="LineString"&&fe.lineMetrics){et={};for(const _t in te.tags)et[_t]=te.tags[_t];et.mapbox_clip_start=ce.start/ce.size,et.mapbox_clip_end=ce.end/ce.size}const Fe={geometry:Xe,type:Ve==="Polygon"||Ve==="MultiPolygon"?3:Ve==="LineString"||Ve==="MultiLineString"?2:1,tags:et};te.id!==null&&(Fe.id=te.id),Se.features.push(Fe)}}function zt(Se,te,ie,fe,ce,Ve){const Xe=fe*fe;if(fe>0&&te.size<(ce?Xe:fe))return void(ie.numPoints+=te.length/3);const et=[];for(let Fe=0;Fe<te.length;Fe+=3)(fe===0||te[Fe+2]>Xe)&&(ie.numSimplified++,et.push(te[Fe],te[Fe+1])),ie.numPoints++;ce&&function(Fe,_t){let Pt=0;for(let ct=0,Xt=Fe.length,yn=Xt-2;ct<Xt;yn=ct,ct+=2)Pt+=(Fe[ct]-Fe[yn])*(Fe[ct+1]+Fe[yn+1]);if(Pt>0===_t)for(let ct=0,Xt=Fe.length;ct<Xt/2;ct+=2){const yn=Fe[ct],An=Fe[ct+1];Fe[ct]=Fe[Xt-2-ct],Fe[ct+1]=Fe[Xt-1-ct],Fe[Xt-2-ct]=yn,Fe[Xt-1-ct]=An}}(et,Ve),Se.push(et)}const xt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fn{constructor(te,ie){const fe=(ie=this.options=function(Ve,Xe){for(const et in Xe)Ve[et]=Xe[et];return Ve}(Object.create(xt),ie)).debug;if(fe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let ce=function(Ve,Xe){const et=[];if(Ve.type==="FeatureCollection")for(let Fe=0;Fe<Ve.features.length;Fe++)Gn(et,Ve.features[Fe],Xe,Fe);else Gn(et,Ve.type==="Feature"?Ve:{geometry:Ve},Xe);return et}(te,ie);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=function(Ve,Xe){const et=Xe.buffer/Xe.extent;let Fe=Ve;const _t=Pe(Ve,1,-1-et,et,0,-1,2,Xe),Pt=Pe(Ve,1,1-et,2+et,0,-1,2,Xe);return(_t||Pt)&&(Fe=Pe(Ve,1,-et,1+et,0,-1,2,Xe)||[],_t&&(Fe=$e(_t,1).concat(Fe)),Pt&&(Fe=Fe.concat($e(Pt,-1)))),Fe}(ce,ie),ce.length&&this.splitTile(ce,0,0,0),fe&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ie,fe,ce,Ve,Xe,et){const Fe=[te,ie,fe,ce],_t=this.options,Pt=_t.debug;for(;Fe.length;){ce=Fe.pop(),fe=Fe.pop(),ie=Fe.pop(),te=Fe.pop();const ct=1<<ie,Xt=fi(ie,fe,ce);let yn=this.tiles[Xt];if(!yn&&(Pt>1&&console.time("creation"),yn=this.tiles[Xt]=Qn(te,ie,fe,ce,_t),this.tileCoords.push({z:ie,x:fe,y:ce}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,fe,ce,yn.numFeatures,yn.numPoints,yn.numSimplified),console.timeEnd("creation"));const Qe=`z${ie}`;this.stats[Qe]=(this.stats[Qe]||0)+1,this.total++}if(yn.source=te,Ve==null){if(ie===_t.indexMaxZoom||yn.numPoints<=_t.indexMaxPoints)continue}else{if(ie===_t.maxZoom||ie===Ve)continue;if(Ve!=null){const Qe=Ve-ie;if(fe!==Xe>>Qe||ce!==et>>Qe)continue}}if(yn.source=null,te.length===0)continue;Pt>1&&console.time("clipping");const An=.5*_t.buffer/_t.extent,Hn=.5-An,di=.5+An,kn=1+An;let Mi=null,Li=null,ve=null,Ge=null,it=Pe(te,ct,fe-An,fe+di,0,yn.minX,yn.maxX,_t),at=Pe(te,ct,fe+Hn,fe+kn,0,yn.minX,yn.maxX,_t);te=null,it&&(Mi=Pe(it,ct,ce-An,ce+di,1,yn.minY,yn.maxY,_t),Li=Pe(it,ct,ce+Hn,ce+kn,1,yn.minY,yn.maxY,_t),it=null),at&&(ve=Pe(at,ct,ce-An,ce+di,1,yn.minY,yn.maxY,_t),Ge=Pe(at,ct,ce+Hn,ce+kn,1,yn.minY,yn.maxY,_t),at=null),Pt>1&&console.timeEnd("clipping"),Fe.push(Mi||[],ie+1,2*fe,2*ce),Fe.push(Li||[],ie+1,2*fe,2*ce+1),Fe.push(ve||[],ie+1,2*fe+1,2*ce),Fe.push(Ge||[],ie+1,2*fe+1,2*ce+1)}}getTile(te,ie,fe){te=+te,ie=+ie,fe=+fe;const ce=this.options,{extent:Ve,debug:Xe}=ce;if(te<0||te>24)return null;const et=1<<te,Fe=fi(te,ie=ie+et&et-1,fe);if(this.tiles[Fe])return Mt(this.tiles[Fe],Ve);Xe>1&&console.log("drilling down to z%d-%d-%d",te,ie,fe);let _t,Pt=te,ct=ie,Xt=fe;for(;!_t&&Pt>0;)Pt--,ct>>=1,Xt>>=1,_t=this.tiles[fi(Pt,ct,Xt)];return _t&&_t.source?(Xe>1&&(console.log("found parent tile z%d-%d-%d",Pt,ct,Xt),console.time("drilling down")),this.splitTile(_t.source,Pt,ct,Xt,te,ie,fe),Xe>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Mt(this.tiles[Fe],Ve):null):null}}function fi(Se,te,ie){return 32*((1<<Se)*ie+te)+Se}function Be(Se,te){return te?Se.properties[te]:Se.id}function Ht(Se,te){if(Se==null)return!0;if(Se.type==="Feature")return Be(Se,te)!=null;if(Se.type==="FeatureCollection"){const ie=new Set;for(const fe of Se.features){const ce=Be(fe,te);if(ce==null||ie.has(ce))return!1;ie.add(ce)}return!0}return!1}function Ct(Se,te){const ie=new Map;if(Se!=null)if(Se.type==="Feature")ie.set(Be(Se,te),Se);else for(const fe of Se.features)ie.set(Be(fe,te),fe);return ie}class It extends D{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(te,ie){return _._(this,void 0,void 0,function*(){const fe=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!ce)return null;const Ve=new class{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.X,this.length=et.length,this._features=et}feature(et){return new class{constructor(Fe){this._feature=Fe,this.extent=_.X,this.type=Fe.type,this.properties=Fe.tags,"id"in Fe&&!isNaN(Fe.id)&&(this.id=parseInt(Fe.id,10))}loadGeometry(){if(this._feature.type===1){const Fe=[];for(const _t of this._feature.geometry)Fe.push([new _.P(_t[0],_t[1])]);return Fe}{const Fe=[];for(const _t of this._feature.geometry){const Pt=[];for(const ct of _t)Pt.push(new _.P(ct[0],ct[1]));Fe.push(Pt)}return Fe}}toGeoJSON(Fe,_t,Pt){return $.call(this,Fe,_t,Pt)}}(this._features[et])}}(ce.features);let Xe=wt(Ve);return Xe.byteOffset===0&&Xe.byteLength===Xe.buffer.byteLength||(Xe=new Uint8Array(Xe)),{vectorTile:Ve,rawData:Xe.buffer}})}loadData(te){return _._(this,void 0,void 0,function*(){var ie;(ie=this._pendingRequest)===null||ie===void 0||ie.abort();const fe=!!(te&&te.request&&te.request.collectResourceTiming)&&new _.bu(te.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(te,this._pendingRequest),this._geoJSONIndex=te.cluster?new ht(function({superclusterOptions:Xe,clusterProperties:et}){if(!et||!Xe)return Xe;const Fe={},_t={},Pt={accumulated:null,zoom:0},ct={properties:null},Xt=Object.keys(et);for(const yn of Xt){const[An,Hn]=et[yn],di=_.bB(Hn),kn=_.bB(typeof An=="string"?[An,["accumulated"],["get",yn]]:An);Fe[yn]=di.value,_t[yn]=kn.value}return Xe.map=yn=>{ct.properties=yn;const An={};for(const Hn of Xt)An[Hn]=Fe[Hn].evaluate(Pt,ct);return An},Xe.reduce=(yn,An)=>{ct.properties=An;for(const Hn of Xt)Pt.accumulated=yn[Hn],yn[Hn]=_t[Hn].evaluate(Pt,ct)},Xe}(te)).load((yield this._pendingData).features):(ce=yield this._pendingData,new Fn(ce,te.geojsonVtOptions)),this.loaded={};const Ve={};if(fe){const Xe=fe.finish();Xe&&(Ve.resourceTiming={},Ve.resourceTiming[te.source]=JSON.parse(JSON.stringify(Xe)))}return Ve}catch(Ve){if(delete this._pendingRequest,_.bA(Ve))return{abandoned:!0};throw Ve}var ce})}getData(){return _._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(te){const ie=this.loaded;return ie&&ie[te.uid]?super.reloadTile(te):this.loadTile(te)}loadAndProcessGeoJSON(te,ie){return _._(this,void 0,void 0,function*(){let fe=yield this.loadGeoJSON(te,ie);if(delete this._pendingRequest,typeof fe!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(re(fe,!0),te.filter){const ce=_.bB(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ce.result==="error")throw new Error(ce.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(Xe=>ce.value.evaluate({zoom:0},Xe))}}return fe})}loadGeoJSON(te,ie){return _._(this,void 0,void 0,function*(){const{promoteId:fe}=te;if(te.request){const ce=yield _.h(te.request,ie);return this._dataUpdateable=Ht(ce.data,fe)?Ct(ce.data,fe):void 0,ce.data}if(typeof te.data=="string")try{const ce=JSON.parse(te.data);return this._dataUpdateable=Ht(ce,fe)?Ct(ce,fe):void 0,ce}catch{throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`)}if(!te.dataDiff)throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${te.source}`);return function(ce,Ve,Xe){var et,Fe,_t,Pt;if(Ve.removeAll&&ce.clear(),Ve.remove)for(const ct of Ve.remove)ce.delete(ct);if(Ve.add)for(const ct of Ve.add){const Xt=Be(ct,Xe);Xt!=null&&ce.set(Xt,ct)}if(Ve.update)for(const ct of Ve.update){let Xt=ce.get(ct.id);if(Xt==null)continue;const yn=!ct.removeAllProperties&&(((et=ct.removeProperties)===null||et===void 0?void 0:et.length)>0||((Fe=ct.addOrUpdateProperties)===null||Fe===void 0?void 0:Fe.length)>0);if((ct.newGeometry||ct.removeAllProperties||yn)&&(Xt=Object.assign({},Xt),ce.set(ct.id,Xt),yn&&(Xt.properties=Object.assign({},Xt.properties))),ct.newGeometry&&(Xt.geometry=ct.newGeometry),ct.removeAllProperties)Xt.properties={};else if(((_t=ct.removeProperties)===null||_t===void 0?void 0:_t.length)>0)for(const An of ct.removeProperties)Object.prototype.hasOwnProperty.call(Xt.properties,An)&&delete Xt.properties[An];if(((Pt=ct.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0)for(const{key:An,value:Hn}of ct.addOrUpdateProperties)Xt.properties[An]=Hn}}(this._dataUpdateable,te.dataDiff,fe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(te){return _._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}class Yt{constructor(te){this.self=te,this.actor=new _.F(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ie,fe)=>{if(this.externalWorkerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.externalWorkerSourceTypes[ie]=fe},this.self.addProtocol=_.bh,this.self.removeProtocol=_.bi,this.self.registerRTLTextPlugin=ie=>{if(_.bC.isParsed())throw new Error("RTL text plugin already registered.");_.bC.setMethods(ie)},this.actor.registerMessageHandler("LDT",(ie,fe)=>this._getDEMWorkerSource(ie,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RDT",(ie,fe)=>_._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ie,fe.source).removeTile(fe)})),this.actor.registerMessageHandler("GCEZ",(ie,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,fe.type,fe.source).getClusterExpansionZoom(fe)})),this.actor.registerMessageHandler("GCC",(ie,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,fe.type,fe.source).getClusterChildren(fe)})),this.actor.registerMessageHandler("GCL",(ie,fe)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(ie,fe.type,fe.source).getClusterLeaves(fe)})),this.actor.registerMessageHandler("LD",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).loadData(fe)),this.actor.registerMessageHandler("GD",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).getData()),this.actor.registerMessageHandler("LT",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).loadTile(fe)),this.actor.registerMessageHandler("RT",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).reloadTile(fe)),this.actor.registerMessageHandler("AT",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).abortTile(fe)),this.actor.registerMessageHandler("RMT",(ie,fe)=>this._getWorkerSource(ie,fe.type,fe.source).removeTile(fe)),this.actor.registerMessageHandler("RS",(ie,fe)=>_._(this,void 0,void 0,function*(){if(!this.workerSources[ie]||!this.workerSources[ie][fe.type]||!this.workerSources[ie][fe.type][fe.source])return;const ce=this.workerSources[ie][fe.type][fe.source];delete this.workerSources[ie][fe.type][fe.source],ce.removeSource!==void 0&&ce.removeSource(fe)})),this.actor.registerMessageHandler("RM",ie=>_._(this,void 0,void 0,function*(){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie]})),this.actor.registerMessageHandler("SR",(ie,fe)=>_._(this,void 0,void 0,function*(){this.referrer=fe})),this.actor.registerMessageHandler("SRPS",(ie,fe)=>this._syncRTLPluginState(ie,fe)),this.actor.registerMessageHandler("IS",(ie,fe)=>_._(this,void 0,void 0,function*(){this.self.importScripts(fe)})),this.actor.registerMessageHandler("SI",(ie,fe)=>this._setImages(ie,fe)),this.actor.registerMessageHandler("UL",(ie,fe)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(ie).update(fe.layers,fe.removedIds)})),this.actor.registerMessageHandler("SL",(ie,fe)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(ie).replace(fe)}))}_setImages(te,ie){return _._(this,void 0,void 0,function*(){this.availableImages[te]=ie;for(const fe in this.workerSources[te]){const ce=this.workerSources[te][fe];for(const Ve in ce)ce[Ve].availableImages=ie}})}_syncRTLPluginState(te,ie){return _._(this,void 0,void 0,function*(){if(_.bC.isParsed())return _.bC.getState();if(ie.pluginStatus!=="loading")return _.bC.setState(ie),ie;const fe=ie.pluginURL;if(this.self.importScripts(fe),_.bC.isParsed()){const ce={pluginStatus:"loaded",pluginURL:fe};return _.bC.setState(ce),ce}throw _.bC.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${fe}`)})}_getAvailableImages(te){let ie=this.availableImages[te];return ie||(ie=[]),ie}_getLayerIndex(te){let ie=this.layerIndexes[te];return ie||(ie=this.layerIndexes[te]=new c),ie}_getWorkerSource(te,ie,fe){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ie]||(this.workerSources[te][ie]={}),!this.workerSources[te][ie][fe]){const ce={sendAsync:(Ve,Xe)=>(Ve.targetMapId=te,this.actor.sendAsync(Ve,Xe))};switch(ie){case"vector":this.workerSources[te][ie][fe]=new D(ce,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][ie][fe]=new It(ce,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][ie][fe]=new this.externalWorkerSourceTypes[ie](ce,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][ie][fe]}_getDEMWorkerSource(te,ie){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][ie]||(this.demWorkerSources[te][ie]=new N),this.demWorkerSources[te][ie]}}return _.i(self)&&(self.worker=new Yt(self)),Yt}),d("index",["exports","./shared"],function(_,c){var I="4.5.1";let P,F;const D={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:T=>new Promise((i,h)=>{const y=requestAnimationFrame(i);T.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),h(c.c())})}),getImageData(T,i=0){return this.getImageCanvasContext(T).getImageData(-i,-i,T.width+2*i,T.height+2*i)},getImageCanvasContext(T){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=T.width,i.height=T.height,h.drawImage(T,0,0,T.width,T.height),h},resolveURL:T=>(P||(P=document.createElement("a")),P.href=T,P.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(F==null&&(F=matchMedia("(prefers-reduced-motion: reduce)")),F.matches)}};class N{static testProp(i){if(!N.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in N.docStyle)return i[h];return i[0]}static create(i,h,y){const x=window.document.createElement(i);return h!==void 0&&(x.className=h),y&&y.appendChild(x),x}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(i,h){i.style[N.transformProp]=h}static addEventListener(i,h,y,x={}){i.addEventListener(h,y,"passive"in x?x:x.capture)}static removeEventListener(i,h,y,x={}){i.removeEventListener(h,y,"passive"in x?x:x.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,y){const x=h.boundingClientRect;return new c.P((y.clientX-x.left)/h.x-i.clientLeft,(y.clientY-x.top)/h.y-i.clientTop)}static mousePos(i,h){const y=N.getScale(i);return N.getPoint(i,y,h)}static touchPos(i,h){const y=[],x=N.getScale(i);for(let E=0;E<h.length;E++)y.push(N.getPoint(i,x,h[E]));return y}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const G={supported:!1,testSupport:function(T){!$&&re&&(X?me(T):Z=T)}};let Z,re,$=!1,X=!1;function me(T){const i=T.createTexture();T.bindTexture(T.TEXTURE_2D,i);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,re),T.isContextLost())return;G.supported=!0}catch{}T.deleteTexture(i),$=!0}var le;typeof document<"u"&&(re=document.createElement("img"),re.onload=()=>{Z&&me(Z),Z=null,X=!0},re.onerror=()=>{$=!0,Z=null},re.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(T){let i,h,y,x;T.resetRequestQueue=()=>{i=[],h=0,y=0,x={}},T.addThrottleControl=V=>{const H=y++;return x[H]=V,H},T.removeThrottleControl=V=>{delete x[V],k()},T.getImage=(V,H,J=!0)=>new Promise((K,ue)=>{G.supported&&(V.headers||(V.headers={}),V.headers.accept="image/webp,*/*"),c.e(V,{type:"image"}),i.push({abortController:H,requestParameters:V,supportImageRefresh:J,state:"queued",onError:ge=>{ue(ge)},onSuccess:ge=>{K(ge)}}),k()});const E=V=>c._(this,void 0,void 0,function*(){V.state="running";const{requestParameters:H,supportImageRefresh:J,onError:K,onSuccess:ue,abortController:ge}=V,Ee=J===!1&&!c.i(self)&&!c.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((De,He)=>De&&He==="accept",!0));h++;const Re=Ee?z(H,ge):c.m(H,ge);try{const De=yield Re;delete V.abortController,V.state="completed",De.data instanceof HTMLImageElement||c.b(De.data)?ue(De):De.data&&ue({data:yield(Ie=De.data,typeof createImageBitmap=="function"?c.d(Ie):c.f(Ie)),cacheControl:De.cacheControl,expires:De.expires})}catch(De){delete V.abortController,K(De)}finally{h--,k()}var Ie}),k=()=>{const V=(()=>{for(const H of Object.keys(x))if(x[H]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=h;H<V&&i.length>0;H++){const J=i.shift();J.abortController.signal.aborted?H--:E(J)}},z=(V,H)=>new Promise((J,K)=>{const ue=new Image,ge=V.url,Ee=V.credentials;Ee&&Ee==="include"?ue.crossOrigin="use-credentials":(Ee&&Ee==="same-origin"||!c.s(ge))&&(ue.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{ue.src="",K(c.c())}),ue.fetchPriority="high",ue.onload=()=>{ue.onerror=ue.onload=null,J({data:ue})},ue.onerror=()=>{ue.onerror=ue.onload=null,H.signal.aborted||K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ue.src=ge})}(le||(le={})),le.resetRequestQueue();class ye{constructor(i){this._transformRequestFn=i}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Le(T){var i=new c.A(3);return i[0]=T[0],i[1]=T[1],i[2]=T[2],i}var Me,Te=function(T,i,h){return T[0]=i[0]-h[0],T[1]=i[1]-h[1],T[2]=i[2]-h[2],T};Me=new c.A(3),c.A!=Float32Array&&(Me[0]=0,Me[1]=0,Me[2]=0);var We=function(T){var i=T[0],h=T[1];return i*i+h*h};function de(T){const i=[];if(typeof T=="string")i.push({id:"default",url:T});else if(T&&T.length>0){const h=[];for(const{id:y,url:x}of T){const E=`${y}${x}`;h.indexOf(E)===-1&&(h.push(E),i.push({id:y,url:x}))}}return i}function be(T,i,h){const y=T.split("?");return y[0]+=`${i}${h}`,y.join("?")}(function(){var T=new c.A(2);c.A!=Float32Array&&(T[0]=0,T[1]=0)})();class Oe{constructor(i,h,y,x){this.context=i,this.format=y,this.texture=i.gl.createTexture(),this.update(h,x)}update(i,h,y){const{width:x,height:E}=i,k=!(this.size&&this.size[0]===x&&this.size[1]===E||y),{context:z}=this,{gl:V}=z;if(this.useMipmap=!!(h&&h.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),z.pixelStoreUnpackFlipY.set(!1),z.pixelStoreUnpack.set(1),z.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!h||h.premultiply!==!1)),k)this.size=[x,E],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||c.b(i)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,i):V.texImage2D(V.TEXTURE_2D,0,this.format,x,E,0,this.format,V.UNSIGNED_BYTE,i.data);else{const{x:H,y:J}=y||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||c.b(i)?V.texSubImage2D(V.TEXTURE_2D,0,H,J,V.RGBA,V.UNSIGNED_BYTE,i):V.texSubImage2D(V.TEXTURE_2D,0,H,J,x,E,V.RGBA,V.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D)}bind(i,h,y){const{context:x}=this,{gl:E}=x;E.bindTexture(E.TEXTURE_2D,this.texture),y!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=E.LINEAR),i!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,i),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,y||i),this.filter=i),h!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,h),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function vt(T){const{userImage:i}=T;return!!(i&&i.render&&i.render())&&(T.data.replace(new Uint8Array(i.data.buffer)),!0)}class st extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:y}of this.requestors)y(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const y=h.spriteData;h.data=new c.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let y=!0;const x=h.data||h.spriteData;return this._validateStretch(h.stretchX,x&&x.width)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,x&&x.height)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new c.j(new Error(`Image "${i}" has invalid "content" value`))),y=!1),y}_validateStretch(i,h){if(!i)return!0;let y=0;for(const x of i){if(x[0]<y||x[1]<x[0]||h<x[1])return!1;y=x[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const y=h.spriteData,x=y&&y.width||h.data.width,E=y&&y.height||h.data.height;return!(i[0]<0||x<i[0]||i[1]<0||E<i[1]||i[2]<0||x<i[2]||i[3]<0||E<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,y=!0){const x=this.getImage(i);if(y&&(x.data.width!==h.data.width||x.data.height!==h.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=x.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,y)=>{let x=!0;if(!this.isLoaded())for(const E of i)this.images[E]||(x=!1);this.isLoaded()||x?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const y of i){let x=this.getImage(y);x||(this.fire(new c.k("styleimagemissing",{id:y})),x=this.getImage(y)),x?h[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:c.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],y=this.getImage(i);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const x={w:y.data.width+2,h:y.data.height+2,x:0,y:0},E=new c.I(x,y);this.patterns[i]={bin:x,position:E}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Oe(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const E in this.patterns)i.push(this.patterns[E].bin);const{w:h,h:y}=c.p(i),x=this.atlasImage;x.resize({width:h||1,height:y||1});for(const E in this.patterns){const{bin:k}=this.patterns[E],z=k.x+1,V=k.y+1,H=this.getImage(E).data,J=H.width,K=H.height;c.R.copy(H,x,{x:0,y:0},{x:z,y:V},{width:J,height:K}),c.R.copy(H,x,{x:0,y:K-1},{x:z,y:V-1},{width:J,height:1}),c.R.copy(H,x,{x:0,y:0},{x:z,y:V+K},{width:J,height:1}),c.R.copy(H,x,{x:J-1,y:0},{x:z-1,y:V},{width:1,height:K}),c.R.copy(H,x,{x:0,y:0},{x:z+J,y:V},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.getImage(h);y||c.w(`Image with ID: "${h}" was not found`),vt(y)&&this.updateImage(h,y)}}}const Je=1e20;function mt(T,i,h,y,x,E,k,z,V){for(let H=i;H<i+y;H++)gt(T,h*E+H,E,x,k,z,V);for(let H=h;H<h+x;H++)gt(T,H*E+i,1,y,k,z,V)}function gt(T,i,h,y,x,E,k){E[0]=0,k[0]=-Je,k[1]=Je,x[0]=T[i];for(let z=1,V=0,H=0;z<y;z++){x[z]=T[i+z*h];const J=z*z;do{const K=E[V];H=(x[z]-x[K]+J-K*K)/(z-K)/2}while(H<=k[V]&&--V>-1);V++,E[V]=z,k[V]=H,k[V+1]=Je}for(let z=0,V=0;z<y;z++){for(;k[V+1]<z;)V++;const H=E[V],J=z-H;T[i+z*h]=x[H]+J*J}}class wt{constructor(i,h){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return c._(this,void 0,void 0,function*(){const h=[];for(const E in i)for(const k of i[E])h.push(this._getAndCacheGlyphsPromise(E,k));const y=yield Promise.all(h),x={};for(const{stack:E,id:k,glyph:z}of y)x[E]||(x[E]={}),x[E][k]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return x})}_getAndCacheGlyphsPromise(i,h){return c._(this,void 0,void 0,function*(){let y=this.entries[i];y||(y=this.entries[i]={glyphs:{},requests:{},ranges:{}});let x=y.glyphs[h];if(x!==void 0)return{stack:i,id:h,glyph:x};if(x=this._tinySDF(y,i,h),x)return y.glyphs[h]=x,{stack:i,id:h,glyph:x};const E=Math.floor(h/256);if(256*E>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[E])return{stack:i,id:h,glyph:x};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[E]){const z=wt.loadGlyphRange(i,E,this.url,this.requestManager);y.requests[E]=z}const k=yield y.requests[E];for(const z in k)this._doesCharSupportLocalGlyph(+z)||(y.glyphs[+z]=k[+z]);return y.ranges[E]=!0,{stack:i,id:h,glyph:k[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](i)||c.u["Hangul Syllables"](i)||c.u.Hiragana(i)||c.u.Katakana(i))}_tinySDF(i,h,y){const x=this.localIdeographFontFamily;if(!x||!this._doesCharSupportLocalGlyph(y))return;let E=i.tinySDF;if(!E){let z="400";/bold/i.test(h)?z="900":/medium/i.test(h)?z="500":/light/i.test(h)&&(z="200"),E=i.tinySDF=new wt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:x,fontWeight:z})}const k=E.draw(String.fromCharCode(y));return{id:y,bitmap:new c.o({width:k.width||60,height:k.height||60},k.data),metrics:{width:k.glyphWidth/2||24,height:k.glyphHeight/2||24,left:k.glyphLeft/2+.5||0,top:k.glyphTop/2-27.5||-8,advance:k.glyphAdvance/2||24,isDoubleResolution:!0}}}}wt.loadGlyphRange=function(T,i,h,y){return c._(this,void 0,void 0,function*(){const x=256*i,E=x+255,k=y.transformRequest(h.replace("{fontstack}",T).replace("{range}",`${x}-${E}`),"Glyphs"),z=yield c.l(k,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${i}, ${x}-${E}`);const V={};for(const H of c.n(z.data))V[H.id]=H;return V})},wt.TinySDF=class{constructor({fontSize:T=24,buffer:i=3,radius:h=8,cutoff:y=.25,fontFamily:x="sans-serif",fontWeight:E="normal",fontStyle:k="normal"}={}){this.buffer=i,this.cutoff=y,this.radius=h;const z=this.size=T+4*i,V=this._createCanvas(z),H=this.ctx=V.getContext("2d",{willReadFrequently:!0});H.font=`${k} ${E} ${T}px ${x}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(T){const i=document.createElement("canvas");return i.width=i.height=T,i}draw(T){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:y,actualBoundingBoxLeft:x,actualBoundingBoxRight:E}=this.ctx.measureText(T),k=Math.ceil(h),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-x))),V=Math.min(this.size-this.buffer,k+Math.ceil(y)),H=z+2*this.buffer,J=V+2*this.buffer,K=Math.max(H*J,0),ue=new Uint8ClampedArray(K),ge={data:ue,width:H,height:J,glyphWidth:z,glyphHeight:V,glyphTop:k,glyphLeft:0,glyphAdvance:i};if(z===0||V===0)return ge;const{ctx:Ee,buffer:Re,gridInner:Ie,gridOuter:De}=this;Ee.clearRect(Re,Re,z,V),Ee.fillText(T,Re,Re+k);const He=Ee.getImageData(Re,Re,z,V);De.fill(Je,0,K),Ie.fill(0,0,K);for(let Ae=0;Ae<V;Ae++)for(let Ke=0;Ke<z;Ke++){const rt=He.data[4*(Ae*z+Ke)+3]/255;if(rt===0)continue;const ft=(Ae+Re)*H+Ke+Re;if(rt===1)De[ft]=0,Ie[ft]=Je;else{const kt=.5-rt;De[ft]=kt>0?kt*kt:0,Ie[ft]=kt<0?kt*kt:0}}mt(De,0,0,H,J,H,this.f,this.v,this.z),mt(Ie,Re,Re,z,V,H,this.f,this.v,this.z);for(let Ae=0;Ae<K;Ae++){const Ke=Math.sqrt(De[Ae])-Math.sqrt(Ie[Ae]);ue[Ae]=Math.round(255-255*(Ke/this.radius+this.cutoff))}return ge}};class yt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(i,h){return c.y(i.expression.evaluate(h))}interpolate(i,h,y){return{x:c.z.number(i.x,h.x,y),y:c.z.number(i.y,h.y,y),z:c.z.number(i.z,h.z,y)}}}let Jt;class Tt extends c.E{constructor(i){super(),Jt=Jt||new c.q({anchor:new c.D(c.v.light.anchor),position:new yt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Jt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(c.r,i,h))for(const y in i){const x=i[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,y){return(!y||y.validate!==!1)&&c.t(this,i.call(c.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const jt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Cn extends c.E{constructor(i){super(),this._transitionable=new c.T(jt),this.setSky(i),this._transitioning=this._transitionable.untransitioned()}setSky(i,h={}){if(!this._validate(c.B,i,h))for(const y in i){const x=i[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,y={}){return(y==null?void 0:y.validate)!==!1&&c.t(this,i.call(c.x,c.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class jn{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const y=i.join(",")+String(h);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(i,h)),this.dashEntry[y]}getDashRanges(i,h,y){const x=[];let E=i.length%2==1?-i[i.length-1]*y:0,k=i[0]*y,z=!0;x.push({left:E,right:k,isDash:z,zeroLength:i[0]===0});let V=i[0];for(let H=1;H<i.length;H++){z=!z;const J=i[H];E=V*y,V+=J,k=V*y,x.push({left:E,right:k,isDash:z,zeroLength:J===0})}return x}addRoundDash(i,h,y){const x=h/2;for(let E=-y;E<=y;E++){const k=this.width*(this.nextRow+y+E);let z=0,V=i[z];for(let H=0;H<this.width;H++){H/V.right>1&&(V=i[++z]);const J=Math.abs(H-V.left),K=Math.abs(H-V.right),ue=Math.min(J,K);let ge;const Ee=E/y*(x+1);if(V.isDash){const Re=x-Math.abs(Ee);ge=Math.sqrt(ue*ue+Re*Re)}else ge=x-Math.sqrt(ue*ue+Ee*Ee);this.data[k+H]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(i){for(let z=i.length-1;z>=0;--z){const V=i[z],H=i[z+1];V.zeroLength?i.splice(z,1):H&&H.isDash===V.isDash&&(H.left=V.left,i.splice(z,1))}const h=i[0],y=i[i.length-1];h.isDash===y.isDash&&(h.left=y.left-this.width,y.right=h.right+this.width);const x=this.width*this.nextRow;let E=0,k=i[E];for(let z=0;z<this.width;z++){z/k.right>1&&(k=i[++E]);const V=Math.abs(z-k.left),H=Math.abs(z-k.right),J=Math.min(V,H);this.data[x+z]=Math.max(0,Math.min(255,(k.isDash?J:-J)+128))}}addDash(i,h){const y=h?7:0,x=2*y+1;if(this.nextRow+x>this.height)return c.w("LineAtlas out of space"),null;let E=0;for(let z=0;z<i.length;z++)E+=i[z];if(E!==0){const z=this.width/E,V=this.getDashRanges(i,this.width,z);h?this.addRoundDash(V,z,y):this.addRegularDash(V)}const k={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:E};return this.nextRow+=x,this.dirty=!0,k}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const ht="maplibre_preloaded_worker_pool";class Ft{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Ft.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ht]}numActive(){return Object.keys(this.active).length}}const mn=Math.floor(D.hardwareConcurrency/2);let cn,qe;function Wn(){return cn||(cn=new Ft),cn}Ft.workerCount=c.C(globalThis)?Math.max(Math.min(mn,3),1):1;class bn{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const y=this.workerPool.acquire(h);for(let x=0;x<y.length;x++){const E=new c.F(y[x],h);E.name=`Worker ${x}`,this.actors.push(E)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const y=[];for(const x of this.actors)y.push(x.sendAsync({type:i,data:h}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const y of this.actors)y.registerMessageHandler(i,h)}}function nn(){return qe||(qe=new bn(Wn(),c.G),qe.registerMessageHandler("GR",(T,i,h)=>c.m(i,h))),qe}function ne(T,i){const h=c.H();return c.J(h,h,[1,1,0]),c.K(h,h,[.5*T.width,.5*T.height,1]),c.L(h,h,T.calculatePosMatrix(i.toUnwrapped()))}function ui(T,i,h,y,x,E){const k=function(K,ue,ge){if(K)for(const Ee of K){const Re=ue[Ee];if(Re&&Re.source===ge&&Re.type==="fill-extrusion")return!0}else for(const Ee in ue){const Re=ue[Ee];if(Re.source===ge&&Re.type==="fill-extrusion")return!0}return!1}(x&&x.layers,i,T.id),z=E.maxPitchScaleFactor(),V=T.tilesIn(y,z,k);V.sort(Gn);const H=[];for(const K of V)H.push({wrappedTileID:K.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(i,h,T._state,K.queryGeometry,K.cameraQueryGeometry,K.scale,x,E,z,ne(T.transform,K.tileID))});const J=function(K){const ue={},ge={};for(const Ee of K){const Re=Ee.queryResults,Ie=Ee.wrappedTileID,De=ge[Ie]=ge[Ie]||{};for(const He in Re){const Ae=Re[He],Ke=De[He]=De[He]||{},rt=ue[He]=ue[He]||[];for(const ft of Ae)Ke[ft.featureIndex]||(Ke[ft.featureIndex]=!0,rt.push(ft))}}return ue}(H);for(const K in J)J[K].forEach(ue=>{const ge=ue.feature,Ee=T.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Ee});return J}function Gn(T,i){const h=T.tileID,y=i.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function Kn(T,i,h){return c._(this,void 0,void 0,function*(){let y=T;if(T.url?y=(yield c.h(i.transformRequest(T.url,"Source"),h)).data:yield D.frameAsync(h),!y)return null;const x=c.M(c.e(y,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(x.vectorLayerIds=y.vector_layers.map(E=>E.id)),x})}class Ze{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof c.N?new c.N(i.lng,i.lat):c.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof c.N?new c.N(i.lng,i.lat):c.N.convert(i),this}extend(i){const h=this._sw,y=this._ne;let x,E;if(i instanceof c.N)x=i,E=i;else{if(!(i instanceof Ze))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Ze.convert(i)):this.extend(c.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(c.N.convert(i)):this;if(x=i._sw,E=i._ne,!x||!E)return this}return h||y?(h.lng=Math.min(x.lng,h.lng),h.lat=Math.min(x.lat,h.lat),y.lng=Math.max(E.lng,y.lng),y.lat=Math.max(E.lat,y.lat)):(this._sw=new c.N(x.lng,x.lat),this._ne=new c.N(E.lng,E.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:y}=c.N.convert(i);let x=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&x}static convert(i){return i instanceof Ze?i:i&&new Ze(i)}static fromLngLat(i,h=0){const y=360*h/40075017,x=y/Math.cos(Math.PI/180*i.lat);return new Ze(new c.N(i.lng-x,i.lat-y),new c.N(i.lng+x,i.lat+y))}}class hi{constructor(i,h,y){this.bounds=Ze.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),y=Math.floor(c.O(this.bounds.getWest())*h),x=Math.floor(c.Q(this.bounds.getNorth())*h),E=Math.ceil(c.O(this.bounds.getEast())*h),k=Math.ceil(c.Q(this.bounds.getSouth())*h);return i.x>=y&&i.x<E&&i.y>=x&&i.y<k}}class qn extends c.E{constructor(i,h,y,x){if(super(),this.id=i,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(h,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Kn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(c.e(this,i),i.bounds&&(this.tileBounds=new hi(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new c.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((E,k)=>{i.reloadPromise={resolve:E,reject:k}})}else i.actor=this.dispatcher.getActor(),x="LT";i.abortController=new AbortController;try{const E=yield i.actor.sendAsync({type:x,data:y},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,E)}catch(E){if(delete i.abortController,i.aborted)return;if(E&&E.status!==404)throw E;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const y=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(y.resolve).catch(y.reject)}}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ut extends c.E{constructor(i,h,y,x){super(),this.id=i,this.dispatcher=y,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},h),c.e(this,c.M(h,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Kn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(c.e(this,i),i.bounds&&(this.tileBounds=new hi(i.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new c.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return c.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const y=yield le.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&i.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const x=this.map.painter.context,E=x.gl,k=y.data;i.texture=this.map.painter.getTileTexture(k.width),i.texture?i.texture.update(k,{useMipmap:!0}):(i.texture=new Oe(x,k,E.RGBA,{useMipmap:!0}),i.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),i.state="loaded"}}catch(y){if(delete i.abortController,i.aborted)i.state="unloaded";else if(y)throw i.state="errored",y}})}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class Pe extends ut{constructor(i,h,y,x){super(i,h,y,x),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const x=yield le.getImage(y,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(x&&x.data){const E=x.data;this.map._refreshExpiredTiles&&x.cacheControl&&x.expires&&i.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const k=c.b(E)&&c.U()?E:yield this.readImageNow(E),z={type:this.type,uid:i.uid,source:this.id,rawImageData:k,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const V=yield i.actor.sendAsync({type:"LDT",data:z});i.dem=V,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(x){if(delete i.abortController,i.aborted)i.state="unloaded";else if(x)throw i.state="errored",x}})}readImageNow(i){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const h=i.width+2,y=i.height+2;try{return new c.R({width:h,height:y},yield c.W(i,-1,-1,h,y))}catch{}}return D.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,y=Math.pow(2,h.z),x=(h.x-1+y)%y,E=h.x===0?i.wrap-1:i.wrap,k=(h.x+1+y)%y,z=h.x+1===y?i.wrap+1:i.wrap,V={};return V[new c.S(i.overscaledZ,E,h.z,x,h.y).key]={backfilled:!1},V[new c.S(i.overscaledZ,z,h.z,k,h.y).key]={backfilled:!1},h.y>0&&(V[new c.S(i.overscaledZ,E,h.z,x,h.y-1).key]={backfilled:!1},V[new c.S(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},V[new c.S(i.overscaledZ,z,h.z,k,h.y-1).key]={backfilled:!1}),h.y+1<y&&(V[new c.S(i.overscaledZ,E,h.z,x,h.y+1).key]={backfilled:!1},V[new c.S(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},V[new c.S(i.overscaledZ,z,h.z,k,h.y+1).key]={backfilled:!1}),V}unloadTile(i){return c._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class pe extends c.E{constructor(i,h,y,x){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(x),this._data=h.data,this._options=c.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const E=c.X/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*E,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*E,extent:c.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:c.X,radius:(h.clusterRadius||50)*E,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return c._(this,void 0,void 0,function*(){const i=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:y}})}_updateWorkerData(i){return c._(this,void 0,void 0,function*(){const h=c.e({type:this.type},this.workerOptions);i?h.dataDiff=i:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(D.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let x=null;y.resourceTiming&&y.resourceTiming[this.id]&&(x=y.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&c.e(E,{resourceTiming:x}),this.fire(new c.k("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(i){return c._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const y={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const x=yield this.actor.sendAsync({type:h,data:y},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(x,this.map.painter,h==="RT")})}abortTile(i){return c._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return c._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var dt=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ut extends c.E{constructor(i,h,y,x){super(),this.id=i,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(i){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new c.j(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(c.Z.fromLngLat);this.tileID=function(x){let E=1/0,k=1/0,z=-1/0,V=-1/0;for(const ue of x)E=Math.min(E,ue.x),k=Math.min(k,ue.y),z=Math.max(z,ue.x),V=Math.max(V,ue.y);const H=Math.max(z-E,V-k),J=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),K=Math.pow(2,J);return new c.a1(J,Math.floor((E+z)/2*K),Math.floor((k+V)/2*K))}(h),this.minzoom=this.maxzoom=this.tileID.z;const y=h.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,c.X,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,c.X),this._boundsArray.emplaceBack(y[2].x,y[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Oe(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class St extends Ut{constructor(i,h,y,x){super(i,h,y,x),this.roundZoom=!0,this.type="video",this.options=h}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield c.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new c.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Oe(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Lt extends Ut{constructor(i,h,y,x){super(i,h,y,x),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(E=>!Array.isArray(E)||E.length!==2||E.some(k=>typeof k!="number"))||this.fire(new c.j(new c.a2(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,y=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,dt.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Oe(h,this.canvas,y.RGBA,{premultiply:!0});let x=!1;for(const E in this.tiles){const k=this.tiles[E];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,x=!0)}x&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Dn={},an=T=>{switch(T){case"geojson":return pe;case"image":return Ut;case"raster":return ut;case"raster-dem":return Pe;case"vector":return qn;case"video":return St;case"canvas":return Lt}return Dn[T]},$e="RTLPluginLoaded";class On extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return c._(this,arguments,void 0,function*(h,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=D.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k($e))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Mt=null;function Rt(){return Mt||(Mt=new On),Mt}class Qn{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=c.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(x,E){const k={};if(!E)return k;for(const z of x){const V=z.layerIds.map(H=>E.getLayer(H)).filter(Boolean);if(V.length!==0){z.layers=V,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map(H=>V.filter(J=>J.id===H)[0]));for(const H of V)k[H.id]=z}}return k}(i.buckets,h.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const E=this.buckets[x];if(E instanceof c.a6){if(this.hasSymbolBuckets=!0,!y)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const E=this.buckets[x];if(E instanceof c.a6&&E.hasRTLText){this.hasRTLText=!0,Rt().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const E=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(x).queryRadius(E))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Oe(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Oe(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,y,x,E,k,z,V,H,J){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:E,scale:k,tileSize:this.tileSize,pixelPosMatrix:J,transform:V,params:z,queryPadding:this.queryPadding*H},i,h,y):{}}querySourceFeatures(i,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const x=y.loadVTLayers(),E=h&&h.sourceLayer?h.sourceLayer:"",k=x._geojsonTileLayer||x[E];if(!k)return;const z=c.a7(h&&h.filter),{z:V,x:H,y:J}=this.tileID.canonical,K={z:V,x:H,y:J};for(let ue=0;ue<k.length;ue++){const ge=k.feature(ue);if(z.needGeometry){const Ie=c.a8(ge,!0);if(!z.filter(new c.a9(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!z.filter(new c.a9(this.tileID.overscaledZ),ge))continue;const Ee=y.getId(ge,E),Re=new c.aa(ge,V,H,J,Ee);Re.tile=K,i.push(Re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const y=c.ab(i.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const y=Date.now();let x=!1;if(this.expirationTime>y)x=!1;else if(h)if(this.expirationTime<h)x=!0;else{const E=this.expirationTime-h;E?this.expirationTime=y+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!h.style.hasLayer(x))continue;const E=this.buckets[x],k=E.layers[0].sourceLayer||"_geojsonTileLayer",z=y[k],V=i[k];if(!z||!V||Object.keys(V).length===0)continue;E.update(V,z,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=h&&h.style&&h.style.getLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<D.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=D.now()+i}setDependencies(i,h){const y={};for(const x of h)y[x]=!0;this.dependencies[i]=y}hasDependency(i,h){for(const y of i){const x=this.dependencies[y];if(x){for(const E of h)if(x[E])return!0}}return!1}}class bt{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,y){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const E={value:h,timeout:void 0};if(y!==void 0&&(E.timeout=setTimeout(()=>{this.remove(i,E)},y)),this.data[x].push(E),this.order.push(x),this.order.length>this.max){const k=this._getAndRemoveByKey(this.order[0]);k&&this.onRemove(k)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const y=i.wrapped().key,x=h===void 0?0:this.data[y].indexOf(h),E=this.data[y][x];return this.data[y].splice(x,1),E.timeout&&clearTimeout(E.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(E.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const y in this.data)for(const x of this.data[y])i(x.value)||h.push(x);for(const y of h)this.remove(y.value.tileID,y)}}class zt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,y){const x=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},c.e(this.stateChanges[i][x],y),this.deletedStates[i]===null){this.deletedStates[i]={};for(const E in this.state[i])E!==x&&(this.deletedStates[i][E]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const E in this.state[i][x])y[E]||(this.deletedStates[i][x][E]=null)}else for(const E in y)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][E]===null&&delete this.deletedStates[i][x][E]}removeFeatureState(i,h,y){if(this.deletedStates[i]===null)return;const x=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},y&&h!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][y]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(y in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][y]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,h){const y=String(h),x=c.e({},(this.state[i]||{})[y],(this.stateChanges[i]||{})[y]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const E=this.deletedStates[i][h];if(E===null)return{};for(const k in E)delete x[k]}return x}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const y={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const E={};for(const k in this.stateChanges[x])this.state[x][k]||(this.state[x][k]={}),c.e(this.state[x][k],this.stateChanges[x][k]),E[k]=this.state[x][k];y[x]=E}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const E={};if(this.deletedStates[x]===null)for(const k in this.state[x])E[k]={},this.state[x][k]={};else for(const k in this.deletedStates[x]){if(this.deletedStates[x][k]===null)this.state[x][k]={};else for(const z of Object.keys(this.deletedStates[x][k]))delete this.state[x][k][z];E[k]=this.state[x][k]}y[x]=y[x]||{},c.e(y[x],E)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const x in i)i[x].setFeatureState(y,h)}}class xt extends c.E{constructor(i,h,y){super(),this.id=i,this.dispatcher=y,this.on("data",x=>this._dataHandler(x)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((x,E,k,z)=>{const V=new(an(E.type))(x,E,k,z);if(V.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${V.id}`);return V})(i,h,y,this),this._tiles={},this._cache=new bt(0,x=>this._unloadTile(x)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new zt,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,y){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,y)}catch(x){i.state="errored",x.status!==404?this._source.fire(new c.j(x,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new c.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(i),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Fn).map(i=>i.key)}getRenderableIds(i){const h=[];for(const y in this._tiles)this._isIdRenderable(y,i)&&h.push(this._tiles[y]);return i?h.sort((y,x)=>{const E=y.tileID,k=x.tileID,z=new c.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),V=new c.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-k.overscaledZ||V.y-z.y||V.x-z.x}).map(y=>y.tileID.key):h.map(y=>y.tileID).sort(Fn).map(y=>y.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,h){return c._(this,void 0,void 0,function*(){const y=this._tiles[i];y&&(y.state!=="loading"&&(y.state=h),yield this._loadTile(y,i,h))})}_tileLoaded(i,h,y){i.timeAdded=D.now(),y==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let x=0;x<h.length;x++){const E=h[x];if(i.neighboringTiles&&i.neighboringTiles[E]){const k=this.getTileByID(E);y(i,k),y(k,i)}}function y(x,E){x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let k=E.tileID.canonical.x-x.tileID.canonical.x;const z=E.tileID.canonical.y-x.tileID.canonical.y,V=Math.pow(2,x.tileID.canonical.z),H=E.tileID.key;k===0&&z===0||Math.abs(z)>1||(Math.abs(k)>1&&(Math.abs(k+V)===1?k+=V:Math.abs(k-V)===1&&(k-=V)),E.dem&&x.dem&&(x.dem.backfillBorder(E.dem,k,z),x.neighboringTiles&&x.neighboringTiles[H]&&(x.neighboringTiles[H].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,y,x){for(const E in this._tiles){let k=this._tiles[E];if(x[E]||!k.hasData()||k.tileID.overscaledZ<=h||k.tileID.overscaledZ>y)continue;let z=k.tileID;for(;k&&k.tileID.overscaledZ>h+1;){const H=k.tileID.scaledTo(k.tileID.overscaledZ-1);k=this._tiles[H.key],k&&k.hasData()&&(z=H)}let V=z;for(;V.overscaledZ>h;)if(V=V.scaledTo(V.overscaledZ-1),i[V.key]){x[z.key]=z;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const y=this._loadedParentTiles[i.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=i.overscaledZ-1;y>=h;y--){const x=i.scaledTo(y),E=this._getLoadedTile(x);if(E)return E}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,y=Math.ceil(i.height/this._source.tileSize)+1,x=Math.floor(h*y*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(E)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const y={};for(const x in this._tiles){const E=this._tiles[x];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),y[E.tileID.key]=E}this._tiles=y;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}}_updateCoveredAndRetainedTiles(i,h,y,x,E,k){const z={},V={},H=Object.keys(i),J=D.now();for(const K of H){const ue=i[K],ge=this._tiles[K];if(!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=J)continue;const Ee=this.findLoadedParent(ue,h),Re=this.findLoadedSibling(ue),Ie=Ee||Re||null;Ie&&(this._addTile(Ie.tileID),z[Ie.tileID.key]=Ie.tileID),V[K]=ue}this._retainLoadedChildren(V,x,y,i);for(const K in z)i[K]||(this._coveredTiles[K]=!0,i[K]=z[K]);if(k){const K={},ue={};for(const ge of E)this._tiles[ge.key].hasData()?K[ge.key]=ge:ue[ge.key]=ge;for(const ge in ue){const Ee=ue[ge].children(this._source.maxzoom);this._tiles[Ee[0].key]&&this._tiles[Ee[1].key]&&this._tiles[Ee[2].key]&&this._tiles[Ee[3].key]&&(K[Ee[0].key]=i[Ee[0].key]=Ee[0],K[Ee[1].key]=i[Ee[1].key]=Ee[1],K[Ee[2].key]=i[Ee[2].key]=Ee[2],K[Ee[3].key]=i[Ee[3].key]=Ee[3],delete ue[ge])}for(const ge in ue){const Ee=ue[ge],Re=this.findLoadedParent(Ee,this._source.minzoom),Ie=this.findLoadedSibling(Ee),De=Re||Ie||null;if(De){K[De.tileID.key]=i[De.tileID.key]=De.tileID;for(const He in K)K[He].isChildOf(De.tileID)&&delete K[He]}}for(const ge in this._tiles)K[ge]||(this._coveredTiles[ge]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let y;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(J=>new c.S(J.canonical.z,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y)):(y=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(y=y.filter(J=>this._source.hasTile(J)))):y=[];const x=i.coveringZoomLevel(this._source),E=Math.max(x-xt.maxOverzooming,this._source.minzoom),k=Math.max(x+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const J={};for(const K of y)if(K.canonical.z>this._source.minzoom){const ue=K.scaledTo(K.canonical.z-1);J[ue.key]=ue;const ge=K.scaledTo(Math.max(this._source.minzoom,Math.min(K.canonical.z,5)));J[ge.key]=ge}y=y.concat(Object.values(J))}const z=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,z&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const V=this._updateRetainedTiles(y,x);fi(this._source.type)&&this._updateCoveredAndRetainedTiles(V,E,k,x,y,h);for(const J in V)this._tiles[J].clearFadeHold();const H=c.ac(this._tiles,V);for(const J of H){const K=this._tiles[J];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(J)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var y;const x={},E={},k=Math.max(h-xt.maxOverzooming,this._source.minzoom),z=Math.max(h+xt.maxUnderzooming,this._source.minzoom),V={};for(const H of i){const J=this._addTile(H);x[H.key]=H,J.hasData()||h<this._source.maxzoom&&(V[H.key]=H)}this._retainLoadedChildren(V,h,z,x);for(const H of i){let J=this._tiles[H.key];if(J.hasData())continue;if(h+1>this._source.maxzoom){const ue=H.children(this._source.maxzoom)[0],ge=this.getTile(ue);if(ge&&ge.hasData()){x[ue.key]=ue;continue}}else{const ue=H.children(this._source.maxzoom);if(x[ue[0].key]&&x[ue[1].key]&&x[ue[2].key]&&x[ue[3].key])continue}let K=J.wasRequested();for(let ue=H.overscaledZ-1;ue>=k;--ue){const ge=H.scaledTo(ue);if(E[ge.key])break;if(E[ge.key]=!0,J=this.getTile(ge),!J&&K&&(J=this._addTile(ge)),J){const Ee=J.hasData();if((Ee||!(!((y=this.map)===null||y===void 0)&&y.cancelPendingTileRequestsWhileZooming)||K)&&(x[ge.key]=ge),K=J.wasRequested(),Ee)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let y,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){y=this._loadedParentTiles[x.key];break}h.push(x.key);const E=x.scaledTo(x.overscaledZ-1);if(y=this._getLoadedTile(E),y)break;x=E}for(const E of h)this._loadedParentTiles[E]=y}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,y=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=y}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const y=h;return h||(h=new Qn(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,y||this._source.fire(new c.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const y=h.getExpiryTimeout();y&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},y))}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,y){const x=[],E=this.transform;if(!E)return x;const k=y?E.getCameraQueryGeometry(i):i,z=i.map(Ee=>E.pointCoordinate(Ee,this.terrain)),V=k.map(Ee=>E.pointCoordinate(Ee,this.terrain)),H=this.getIds();let J=1/0,K=1/0,ue=-1/0,ge=-1/0;for(const Ee of V)J=Math.min(J,Ee.x),K=Math.min(K,Ee.y),ue=Math.max(ue,Ee.x),ge=Math.max(ge,Ee.y);for(let Ee=0;Ee<H.length;Ee++){const Re=this._tiles[H[Ee]];if(Re.holdingForFade())continue;const Ie=Re.tileID,De=Math.pow(2,E.zoom-Re.tileID.overscaledZ),He=h*Re.queryPadding*c.X/Re.tileSize/De,Ae=[Ie.getTilePoint(new c.Z(J,K)),Ie.getTilePoint(new c.Z(ue,ge))];if(Ae[0].x-He<c.X&&Ae[0].y-He<c.X&&Ae[1].x+He>=0&&Ae[1].y+He>=0){const Ke=z.map(ft=>Ie.getTilePoint(ft)),rt=V.map(ft=>Ie.getTilePoint(ft));x.push({tile:Re,tileID:Ie,queryGeometry:Ke,cameraQueryGeometry:rt,scale:De})}}return x}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(y=>this._tiles[y].tileID);for(const y of h)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(fi(this._source.type)){const i=D.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,y){this._state.updateState(i=i||"_geojsonTileLayer",h,y)}removeFeatureState(i,h,y){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,y)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,y){const x=this._tiles[i];x&&x.setDependencies(h,y)}reloadTilesForDependencies(i,h){for(const y in this._tiles)this._tiles[y].hasDependency(i,h)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(i,h))}}function Fn(T,i){const h=Math.abs(2*T.wrap)-+(T.wrap<0),y=Math.abs(2*i.wrap)-+(i.wrap<0);return T.overscaledZ-i.overscaledZ||y-h||i.canonical.y-T.canonical.y||i.canonical.x-T.canonical.x}function fi(T){return T==="raster"||T==="image"||T==="video"}xt.maxOverzooming=10,xt.maxUnderzooming=3;class Be{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=c.ad(i,0,1);let h=1,y=this._distances[h];const x=i*this.paddedLength+this.padding;for(;y<x&&h<this._distances.length;)y=this._distances[++h];const E=h-1,k=this._distances[E],z=y-k,V=z>0?(x-k)/z:0;return this.points[E].mult(1-V).add(this.points[h].mult(V))}}function Ht(T,i){let h=!0;return T==="always"||T!=="never"&&i!=="never"||(h=!1),h}class Ct{constructor(i,h,y){const x=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(i/y),this.yCellCount=Math.ceil(h/y);for(let k=0;k<this.xCellCount*this.yCellCount;k++)x.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,y,x,E){this._forEachCell(h,y,x,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(x),this.bboxes.push(E)}insertCircle(i,h,y,x){this._forEachCell(h-x,y-x,h+x,y+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(y),this.circles.push(x)}_insertBoxCell(i,h,y,x,E,k){this.boxCells[E].push(k)}_insertCircleCell(i,h,y,x,E,k){this.circleCells[E].push(k)}_query(i,h,y,x,E,k,z){if(y<0||i>this.width||x<0||h>this.height)return[];const V=[];if(i<=0&&h<=0&&this.width<=y&&this.height<=x){if(E)return[{key:null,x1:i,y1:h,x2:y,y2:x}];for(let H=0;H<this.boxKeys.length;H++)V.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const J=this.circles[3*H],K=this.circles[3*H+1],ue=this.circles[3*H+2];V.push({key:this.circleKeys[H],x1:J-ue,y1:K-ue,x2:J+ue,y2:K+ue})}}else this._forEachCell(i,h,y,x,this._queryCell,V,{hitTest:E,overlapMode:k,seenUids:{box:{},circle:{}}},z);return V}query(i,h,y,x){return this._query(i,h,y,x,!1,null)}hitTest(i,h,y,x,E,k){return this._query(i,h,y,x,!0,E,k).length>0}hitTestCircle(i,h,y,x,E){const k=i-y,z=i+y,V=h-y,H=h+y;if(z<0||k>this.width||H<0||V>this.height)return!1;const J=[];return this._forEachCell(k,V,z,H,this._queryCellCircle,J,{hitTest:!0,overlapMode:x,circle:{x:i,y:h,radius:y},seenUids:{box:{},circle:{}}},E),J.length>0}_queryCell(i,h,y,x,E,k,z,V){const{seenUids:H,hitTest:J,overlapMode:K}=z,ue=this.boxCells[E];if(ue!==null){const Ee=this.bboxes;for(const Re of ue)if(!H.box[Re]){H.box[Re]=!0;const Ie=4*Re,De=this.boxKeys[Re];if(i<=Ee[Ie+2]&&h<=Ee[Ie+3]&&y>=Ee[Ie+0]&&x>=Ee[Ie+1]&&(!V||V(De))&&(!J||!Ht(K,De.overlapMode))&&(k.push({key:De,x1:Ee[Ie],y1:Ee[Ie+1],x2:Ee[Ie+2],y2:Ee[Ie+3]}),J))return!0}}const ge=this.circleCells[E];if(ge!==null){const Ee=this.circles;for(const Re of ge)if(!H.circle[Re]){H.circle[Re]=!0;const Ie=3*Re,De=this.circleKeys[Re];if(this._circleAndRectCollide(Ee[Ie],Ee[Ie+1],Ee[Ie+2],i,h,y,x)&&(!V||V(De))&&(!J||!Ht(K,De.overlapMode))){const He=Ee[Ie],Ae=Ee[Ie+1],Ke=Ee[Ie+2];if(k.push({key:De,x1:He-Ke,y1:Ae-Ke,x2:He+Ke,y2:Ae+Ke}),J)return!0}}}return!1}_queryCellCircle(i,h,y,x,E,k,z,V){const{circle:H,seenUids:J,overlapMode:K}=z,ue=this.boxCells[E];if(ue!==null){const Ee=this.bboxes;for(const Re of ue)if(!J.box[Re]){J.box[Re]=!0;const Ie=4*Re,De=this.boxKeys[Re];if(this._circleAndRectCollide(H.x,H.y,H.radius,Ee[Ie+0],Ee[Ie+1],Ee[Ie+2],Ee[Ie+3])&&(!V||V(De))&&!Ht(K,De.overlapMode))return k.push(!0),!0}}const ge=this.circleCells[E];if(ge!==null){const Ee=this.circles;for(const Re of ge)if(!J.circle[Re]){J.circle[Re]=!0;const Ie=3*Re,De=this.circleKeys[Re];if(this._circlesCollide(Ee[Ie],Ee[Ie+1],Ee[Ie+2],H.x,H.y,H.radius)&&(!V||V(De))&&!Ht(K,De.overlapMode))return k.push(!0),!0}}}_forEachCell(i,h,y,x,E,k,z,V){const H=this._convertToXCellCoord(i),J=this._convertToYCellCoord(h),K=this._convertToXCellCoord(y),ue=this._convertToYCellCoord(x);for(let ge=H;ge<=K;ge++)for(let Ee=J;Ee<=ue;Ee++)if(E.call(this,i,h,y,x,this.xCellCount*Ee+ge,k,z,V))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,y,x,E,k){const z=x-i,V=E-h,H=y+k;return H*H>z*z+V*V}_circleAndRectCollide(i,h,y,x,E,k,z){const V=(k-x)/2,H=Math.abs(i-(x+V));if(H>V+y)return!1;const J=(z-E)/2,K=Math.abs(h-(E+J));if(K>J+y)return!1;if(H<=V||K<=J)return!0;const ue=H-V,ge=K-J;return ue*ue+ge*ge<=y*y}}function It(T,i,h,y,x){const E=c.H();return i?(c.K(E,E,[1/x,1/x,1]),h||c.ae(E,E,y.angle)):c.L(E,y.labelPlaneMatrix,T),E}function Yt(T,i,h,y,x){if(i){const E=c.af(T);return c.K(E,E,[x,x,1]),h||c.ae(E,E,-y.angle),E}return y.glCoordMatrix}function Se(T,i,h){let y;h?(y=[T.x,T.y,h(T.x,T.y),1],c.ag(y,y,i)):(y=[T.x,T.y,0,1],function(E,k,z){const V=k[0],H=k[1];E[0]=z[0]*V+z[4]*H+z[12],E[1]=z[1]*V+z[5]*H+z[13],E[3]=z[3]*V+z[7]*H+z[15]}(y,y,i));const x=y[3];return{point:new c.P(y[0]/x,y[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function te(T,i){return .5+T/i*.5}function ie(T,i){return T.x>=-i[0]&&T.x<=i[0]&&T.y>=-i[1]&&T.y<=i[1]}function fe(T,i,h,y,x,E,k,z,V,H,J,K,ue,ge,Ee){const Re=y?T.textSizeData:T.iconSizeData,Ie=c.ah(Re,h.transform.zoom),De=[256/h.width*2+1,256/h.height*2+1],He=y?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;He.clear();const Ae=T.lineVertexArray,Ke=y?T.text.placedSymbolArray:T.icon.placedSymbolArray,rt=h.transform.width/h.transform.height;let ft=!1;for(let kt=0;kt<Ke.length;kt++){const Gt=Ke.get(kt);if(Gt.hidden||Gt.writingMode===c.ai.vertical&&!ft){An(Gt.numGlyphs,He);continue}ft=!1;const ln=Se(new c.P(Gt.anchorX,Gt.anchorY),i,Ee);if(!ie(ln.point,De)){An(Gt.numGlyphs,He);continue}const on=te(h.transform.cameraToCenterDistance,ln.signedDistanceFromCamera),Ot=c.aj(Re,Ie,Gt),Kt=k?Ot/on:Ot*on,gn={getElevation:Ee,labelPlaneMatrix:x,lineVertexArray:Ae,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:H,tileAnchorPoint:new c.P(Gt.anchorX,Gt.anchorY),unwrappedTileID:J,width:K,height:ue,translation:ge},$n=Xe(gn,Gt,Kt,!1,z,i,E,T.glyphOffsetArray,He,rt,V);ft=$n.useVertical,($n.notEnoughRoom||ft||$n.needsFlipping&&Xe(gn,Gt,Kt,!0,z,i,E,T.glyphOffsetArray,He,rt,V).notEnoughRoom)&&An(Gt.numGlyphs,He)}y?T.text.dynamicLayoutVertexBuffer.updateData(He):T.icon.dynamicLayoutVertexBuffer.updateData(He)}function ce(T,i,h,y,x,E,k,z){const V=E.glyphStartIndex+E.numGlyphs,H=E.lineStartIndex,J=E.lineStartIndex+E.lineLength,K=i.getoffsetX(E.glyphStartIndex),ue=i.getoffsetX(V-1),ge=Xt(T*K,h,y,x,E.segment,H,J,z,k);if(!ge)return null;const Ee=Xt(T*ue,h,y,x,E.segment,H,J,z,k);return Ee?z.projectionCache.anyProjectionOccluded?null:{first:ge,last:Ee}:null}function Ve(T,i,h,y){return T===c.ai.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*y?{useVertical:!0}:(T===c.ai.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function Xe(T,i,h,y,x,E,k,z,V,H,J){const K=h/24,ue=i.lineOffsetX*K,ge=i.lineOffsetY*K;let Ee;if(i.numGlyphs>1){const Re=i.glyphStartIndex+i.numGlyphs,Ie=i.lineStartIndex,De=i.lineStartIndex+i.lineLength,He=ce(K,z,ue,ge,y,i,J,T);if(!He)return{notEnoughRoom:!0};const Ae=Se(He.first.point,k,T.getElevation).point,Ke=Se(He.last.point,k,T.getElevation).point;if(x&&!y){const rt=Ve(i.writingMode,Ae,Ke,H);if(rt)return rt}Ee=[He.first];for(let rt=i.glyphStartIndex+1;rt<Re-1;rt++)Ee.push(Xt(K*z.getoffsetX(rt),ue,ge,y,i.segment,Ie,De,T,J));Ee.push(He.last)}else{if(x&&!y){const Ie=Se(T.tileAnchorPoint,E,T.getElevation).point,De=i.lineStartIndex+i.segment+1,He=new c.P(T.lineVertexArray.getx(De),T.lineVertexArray.gety(De)),Ae=Se(He,E,T.getElevation),Ke=Ae.signedDistanceFromCamera>0?Ae.point:function(ft,kt,Gt,ln,on,Ot){return et(ft,kt,Gt,1,on,Ot)}(T.tileAnchorPoint,He,Ie,0,E,T),rt=Ve(i.writingMode,Ie,Ke,H);if(rt)return rt}const Re=Xt(K*z.getoffsetX(i.glyphStartIndex),ue,ge,y,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,T,J);if(!Re||T.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ee=[Re]}for(const Re of Ee)c.ak(V,Re.point,Re.angle);return{}}function et(T,i,h,y,x,E){const k=T.add(T.sub(i)._unit()),z=x!==void 0?Se(k,x,E.getElevation).point:_t(k.x,k.y,E).point,V=h.sub(z);return h.add(V._mult(y/V.mag()))}function Fe(T,i,h){const y=i.projectionCache;if(y.projections[T])return y.projections[T];const x=new c.P(i.lineVertexArray.getx(T),i.lineVertexArray.gety(T)),E=_t(x.x,x.y,i);if(E.signedDistanceFromCamera>0)return y.projections[T]=E.point,y.anyProjectionOccluded=y.anyProjectionOccluded||E.isOccluded,E.point;const k=T-h.direction;return function(z,V,H,J,K){return et(z,V,H,J,void 0,K)}(h.distanceFromAnchor===0?i.tileAnchorPoint:new c.P(i.lineVertexArray.getx(k),i.lineVertexArray.gety(k)),x,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function _t(T,i,h){const y=T+h.translation[0],x=i+h.translation[1];let E;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(E=h.projection.projectTileCoordinates(y,x,h.unwrappedTileID,h.getElevation),E.point.x=(.5*E.point.x+.5)*h.width,E.point.y=(.5*-E.point.y+.5)*h.height):(E=Se(new c.P(y,x),h.labelPlaneMatrix,h.getElevation),E.isOccluded=!1),E}function Pt(T,i,h){return T._unit()._perp()._mult(i*h)}function ct(T,i,h,y,x,E,k,z,V){if(z.projectionCache.offsets[T])return z.projectionCache.offsets[T];const H=h.add(i);if(T+V.direction<y||T+V.direction>=x)return z.projectionCache.offsets[T]=H,H;const J=Fe(T+V.direction,z,V),K=Pt(J.sub(h),k,V.direction),ue=h.add(K),ge=J.add(K);return z.projectionCache.offsets[T]=c.al(E,H,ue,ge)||H,z.projectionCache.offsets[T]}function Xt(T,i,h,y,x,E,k,z,V){const H=y?T-i:T+i;let J=H>0?1:-1,K=0;y&&(J*=-1,K=Math.PI),J<0&&(K+=Math.PI);let ue,ge=J>0?E+x:E+x+1;z.projectionCache.cachedAnchorPoint?ue=z.projectionCache.cachedAnchorPoint:(ue=_t(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=ue);let Ee,Re,Ie=ue,De=ue,He=0,Ae=0;const Ke=Math.abs(H),rt=[];let ft;for(;He+Ae<=Ke;){if(ge+=J,ge<E||ge>=k)return null;He+=Ae,De=Ie,Re=Ee;const ln={absOffsetX:Ke,direction:J,distanceFromAnchor:He,previousVertex:De};if(Ie=Fe(ge,z,ln),h===0)rt.push(De),ft=Ie.sub(De);else{let on;const Ot=Ie.sub(De);on=Ot.mag()===0?Pt(Fe(ge+J,z,ln).sub(Ie),h,J):Pt(Ot,h,J),Re||(Re=De.add(on)),Ee=ct(ge,on,Ie,E,k,Re,h,z,ln),rt.push(Re),ft=Ee.sub(Re)}Ae=ft.mag()}const kt=ft._mult((Ke-He)/Ae)._add(Re||De),Gt=K+Math.atan2(Ie.y-De.y,Ie.x-De.x);return rt.push(kt),{point:kt,angle:V?Gt:0,path:rt}}const yn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function An(T,i){for(let h=0;h<T;h++){const y=i.length;i.resize(y+4),i.float32.set(yn,3*y)}}const Hn=100;class di{constructor(i,h,y=new Ct(i.width+200,i.height+200,25),x=new Ct(i.width+200,i.height+200,25)){this.transform=i,this.mapProjection=h,this.grid=y,this.ignoredGrid=x,this.pitchFactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Hn,this.screenBottomBoundary=i.height+Hn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,y,x,E,k,z,V,H,J,K){const ue=i.anchorPointX+V[0],ge=i.anchorPointY+V[1],Ee=this.projectAndGetPerspectiveRatio(x,ue,ge,E,J),Re=this._projectCollisionBox(i,y,x,E,k,z,V,Ee,J,K),[Ie,De,He,Ae]=Re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(k?Re.allPointsOccluded:this.mapProjection.isOccluded(ue,ge,E))||Ee.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Ie,De,He,Ae)||h!=="always"&&this.grid.hitTest(Ie,De,He,Ae,h,H)?{box:[Ie,De,He,Ae],placeable:!1,offscreen:!1}:{box:[Ie,De,He,Ae],placeable:!0,offscreen:this.isOffscreen(Ie,De,He,Ae)}}placeCollisionCircles(i,h,y,x,E,k,z,V,H,J,K,ue,ge,Ee,Re,Ie){const De=[],He=new c.P(h.anchorX,h.anchorY),Ae=this.getPerspectiveRatio(k,He.x,He.y,z,Ie),Ke=(K?E/Ae:E*Ae)/c.aq,rt={getElevation:Ie,labelPlaneMatrix:V,lineVertexArray:y,pitchWithMap:K,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:He,unwrappedTileID:z,width:this.transform.width,height:this.transform.height,translation:Re},ft=ce(Ke,x,h.lineOffsetX*Ke,h.lineOffsetY*Ke,!1,h,!1,rt);let kt=!1,Gt=!1,ln=!0;if(ft){const on=.5*ge*Ae+Ee,Ot=new c.P(-100,-100),Kt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),gn=new Be,$n=ft.first,Qt=ft.last;let tn=[];for(let ei=$n.path.length-1;ei>=1;ei--)tn.push($n.path[ei]);for(let ei=1;ei<Qt.path.length;ei++)tn.push(Qt.path[ei]);const Vn=2.5*on;if(H){const ei=this.projectPathToScreenSpace(tn,rt,H);tn=ei.some(gi=>gi.signedDistanceFromCamera<=0)?[]:ei.map(gi=>gi.point)}let lr=[];if(tn.length>0){const ei=tn[0].clone(),gi=tn[0].clone();for(let ir=1;ir<tn.length;ir++)ei.x=Math.min(ei.x,tn[ir].x),ei.y=Math.min(ei.y,tn[ir].y),gi.x=Math.max(gi.x,tn[ir].x),gi.y=Math.max(gi.y,tn[ir].y);lr=ei.x>=Ot.x&&gi.x<=Kt.x&&ei.y>=Ot.y&&gi.y<=Kt.y?[tn]:gi.x<Ot.x||ei.x>Kt.x||gi.y<Ot.y||ei.y>Kt.y?[]:c.am([tn],Ot.x,Ot.y,Kt.x,Kt.y)}for(const ei of lr){gn.reset(ei,.25*on);let gi=0;gi=gn.length<=.5*on?1:Math.ceil(gn.paddedLength/Vn)+1;for(let ir=0;ir<gi;ir++){const Ni=ir/Math.max(gi-1,1),Js=gn.lerp(Ni),rr=Js.x+Hn,xr=Js.y+Hn;De.push(rr,xr,on,0);const as=rr-on,Xr=xr-on,Er=rr+on,da=xr+on;if(ln=ln&&this.isOffscreen(as,Xr,Er,da),Gt=Gt||this.isInsideGrid(as,Xr,Er,da),i!=="always"&&this.grid.hitTestCircle(rr,xr,on,i,ue)&&(kt=!0,!J))return{circles:[],offscreen:!1,collisionDetected:kt}}}}return{circles:!J&&kt||!Gt||Ae<this.perspectiveRatioCutoff?[]:De,offscreen:ln,collisionDetected:kt}}projectPathToScreenSpace(i,h,y){return i.map(x=>Se(x,y,h.getElevation))}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,x=1/0,E=-1/0,k=-1/0;for(const J of i){const K=new c.P(J.x+Hn,J.y+Hn);y=Math.min(y,K.x),x=Math.min(x,K.y),E=Math.max(E,K.x),k=Math.max(k,K.y),h.push(K)}const z=this.grid.query(y,x,E,k).concat(this.ignoredGrid.query(y,x,E,k)),V={},H={};for(const J of z){const K=J.key;if(V[K.bucketInstanceId]===void 0&&(V[K.bucketInstanceId]={}),V[K.bucketInstanceId][K.featureIndex])continue;const ue=[new c.P(J.x1,J.y1),new c.P(J.x2,J.y1),new c.P(J.x2,J.y2),new c.P(J.x1,J.y2)];c.an(h,ue)&&(V[K.bucketInstanceId][K.featureIndex]=!0,H[K.bucketInstanceId]===void 0&&(H[K.bucketInstanceId]=[]),H[K.bucketInstanceId].push(K.featureIndex))}return H}insertCollisionBox(i,h,y,x,E,k){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:E,collisionGroupID:k,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,y,x,E,k){const z=y?this.ignoredGrid:this.grid,V={bucketInstanceId:x,featureIndex:E,collisionGroupID:k,overlapMode:h};for(let H=0;H<i.length;H+=4)z.insertCircle(V,i[H],i[H+1],i[H+2])}projectAndGetPerspectiveRatio(i,h,y,x,E){const k=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,y,x,E):Se(new c.P(h,y),i,E);return{point:new c.P((k.point.x+1)/2*this.transform.width+Hn,(1-k.point.y)/2*this.transform.height+Hn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k.signedDistanceFromCamera*.5,isOccluded:k.isOccluded,signedDistanceFromCamera:k.signedDistanceFromCamera}}getPerspectiveRatio(i,h,y,x,E){const k=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,y,x,E):Se(new c.P(h,y),i,E);return .5+this.transform.cameraToCenterDistance/k.signedDistanceFromCamera*.5}isOffscreen(i,h,y,x){return y<Hn||i>=this.screenRightBoundary||x<Hn||h>this.screenBottomBoundary}isInsideGrid(i,h,y,x){return y>=0&&i<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=c.ao([]);return c.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,y,x,E,k,z,V,H,J){const K=h*V.perspectiveRatio;let ue=new c.P(1,0),ge=new c.P(0,1);const Ee=new c.P(i.anchorPointX+z[0],i.anchorPointY+z[1]);if(k&&!E){const on=this.projectAndGetPerspectiveRatio(y,Ee.x+1,Ee.y,x,H).point.sub(V.point).unit(),Ot=Math.atan(on.y/on.x)+(on.x<0?Math.PI:0),Kt=Math.sin(Ot),gn=Math.cos(Ot);ue=new c.P(gn,Kt),ge=new c.P(-Kt,gn)}else if(!k&&E){const on=-this.transform.angle,Ot=Math.sin(on),Kt=Math.cos(on);ue=new c.P(Kt,Ot),ge=new c.P(-Ot,Kt)}let Re=V.point,Ie=K;if(E){Re=Ee;const on=this.transform.zoom-Math.floor(this.transform.zoom);Ie=Math.pow(2,-on),Ie*=this.mapProjection.getPitchedTextCorrection(this.transform,Ee,x),J||(Ie*=c.ad(.5+V.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}J&&(Re=Re.add(ue.mult(J.x*Ie)).add(ge.mult(J.y*Ie)));const De=i.x1*Ie,He=i.x2*Ie,Ae=(De+He)/2,Ke=i.y1*Ie,rt=i.y2*Ie,ft=(Ke+rt)/2,kt=[{offsetX:De,offsetY:Ke},{offsetX:Ae,offsetY:Ke},{offsetX:He,offsetY:Ke},{offsetX:He,offsetY:ft},{offsetX:He,offsetY:rt},{offsetX:Ae,offsetY:rt},{offsetX:De,offsetY:rt},{offsetX:De,offsetY:ft}];let Gt=[];for(const{offsetX:on,offsetY:Ot}of kt)Gt.push(new c.P(Re.x+ue.x*on+ge.x*Ot,Re.y+ue.y*on+ge.y*Ot));let ln=!1;if(E){const on=Gt.map(Ot=>this.projectAndGetPerspectiveRatio(y,Ot.x,Ot.y,x,H));ln=on.some(Ot=>!Ot.isOccluded),Gt=on.map(Ot=>Ot.point)}else ln=!0;return{box:c.ap(Gt),allPointsOccluded:!ln}}}function kn(T,i,h){return i*(c.X/(T.tileSize*Math.pow(2,h-T.tileID.overscaledZ)))}class Mi{constructor(i,h,y,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):x&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Li{constructor(i,h,y,x,E){this.text=new Mi(i?i.text:null,h,y,E),this.icon=new Mi(i?i.icon:null,h,x,E)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(i,h,y){this.text=i,this.icon=h,this.skipFade=y}}class Ge{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class it{constructor(i,h,y,x,E){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=x,this.tileID=E}}class at{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[i]}}function Qe(T,i,h,y,x){const{horizontalAlign:E,verticalAlign:k}=c.av(T);return new c.P(-(E-.5)*i+y[0]*x,-(k-.5)*h+y[1]*x)}class Dt{constructor(i,h,y,x,E,k){this.transform=i.clone(),this.terrain=y,this.collisionIndex=new di(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new at(E),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(y,x)=>h.getElevation(i,y,x):null}getBucketParts(i,h,y,x){const E=y.getBucket(h),k=y.latestFeatureIndex;if(!E||!k||h.id!==E.layerIds[0])return;const z=y.collisionBoxArray,V=E.layers[0].layout,H=E.layers[0].paint,J=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),K=y.tileSize/c.X,ue=y.tileID.toUnwrapped(),ge=this.transform.calculatePosMatrix(ue),Ee=V.get("text-pitch-alignment")==="map",Re=V.get("text-rotation-alignment")==="map",Ie=kn(y,1,this.transform.zoom),De=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("text-translate"),H.get("text-translate-anchor")),He=this.collisionIndex.mapProjection.translatePosition(this.transform,y,H.get("icon-translate"),H.get("icon-translate-anchor")),Ae=It(ge,Ee,Re,this.transform,Ie);let Ke=null;if(Ee){const ft=Yt(ge,Ee,Re,this.transform,Ie);Ke=c.L([],this.transform.labelPlaneMatrix,ft)}this.retainedQueryData[E.bucketInstanceId]=new it(E.bucketInstanceId,k,E.sourceLayerIndex,E.index,y.tileID);const rt={bucket:E,layout:V,translationText:De,translationIcon:He,posMatrix:ge,unwrappedTileID:ue,textLabelPlaneMatrix:Ae,labelToScreenMatrix:Ke,scale:J,textPixelRatio:K,holdingForFade:y.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:c.ah(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(x)for(const ft of E.sortKeyRanges){const{sortKey:kt,symbolInstanceStart:Gt,symbolInstanceEnd:ln}=ft;i.push({sortKey:kt,symbolInstanceStart:Gt,symbolInstanceEnd:ln,parameters:rt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:rt})}attemptAnchorPlacement(i,h,y,x,E,k,z,V,H,J,K,ue,ge,Ee,Re,Ie,De,He,Ae){const Ke=c.ar[i.textAnchor],rt=[i.textOffset0,i.textOffset1],ft=Qe(Ke,y,x,rt,E),kt=this.collisionIndex.placeCollisionBox(h,ue,V,H,J,z,k,Ie,K.predicate,Ae,ft);if((!He||this.collisionIndex.placeCollisionBox(He,ue,V,H,J,z,k,De,K.predicate,Ae,ft).placeable)&&kt.placeable){let Gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Gt=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:rt,width:y,height:x,anchor:Ke,textBoxScale:E,prevAnchor:Gt},this.markUsedJustification(Ee,Ke,ge,Re),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Re,ge),this.placedOrientations[ge.crossTileID]=Re),{shift:ft,placedGlyphBoxes:kt}}}placeLayerBucketPart(i,h,y){const{bucket:x,layout:E,translationText:k,translationIcon:z,posMatrix:V,unwrappedTileID:H,textLabelPlaneMatrix:J,labelToScreenMatrix:K,textPixelRatio:ue,holdingForFade:ge,collisionBoxArray:Ee,partiallyEvaluatedTextSize:Re,collisionGroup:Ie}=i.parameters,De=E.get("text-optional"),He=E.get("icon-optional"),Ae=c.as(E,"text-overlap","text-allow-overlap"),Ke=Ae==="always",rt=c.as(E,"icon-overlap","icon-allow-overlap"),ft=rt==="always",kt=E.get("text-rotation-alignment")==="map",Gt=E.get("text-pitch-alignment")==="map",ln=E.get("icon-text-fit")!=="none",on=E.get("symbol-z-order")==="viewport-y",Ot=Ke&&(ft||!x.hasIconData()||He),Kt=ft&&(Ke||!x.hasTextData()||De);!x.collisionArrays&&Ee&&x.deserializeCollisionBoxes(Ee);const gn=this._getTerrainElevationFunc(this.retainedQueryData[x.bucketInstanceId].tileID),$n=(Qt,tn,Vn)=>{var lr,ei;if(h[Qt.crossTileID])return;if(ge)return void(this.placements[Qt.crossTileID]=new ve(!1,!1,!1));let gi=!1,ir=!1,Ni=!0,Js=null,rr={box:null,placeable:!1,offscreen:null},xr={box:null,placeable:!1,offscreen:null},as=null,Xr=null,Er=null,da=0,Lr=0,Jl=0;tn.textFeatureIndex?da=tn.textFeatureIndex:Qt.useRuntimeCollisionCircles&&(da=Qt.featureIndex),tn.verticalTextFeatureIndex&&(Lr=tn.verticalTextFeatureIndex);const Ql=tn.textBox;if(Ql){const os=hs=>{let Ur=c.ai.horizontal;if(x.allowVerticalPlacement&&!hs&&this.prevPlacement){const ts=this.prevPlacement.placedOrientations[Qt.crossTileID];ts&&(this.placedOrientations[Qt.crossTileID]=ts,Ur=ts,this.markUsedOrientation(x,Ur,Qt))}return Ur},Ts=(hs,Ur)=>{if(x.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&tn.verticalTextBox){for(const ts of x.writingModes)if(ts===c.ai.vertical?(rr=Ur(),xr=rr):rr=hs(),rr&&rr.placeable)break}else rr=hs()},yo=Qt.textAnchorOffsetStartIndex,eu=Qt.textAnchorOffsetEndIndex;if(eu===yo){const hs=(Ur,ts)=>{const pr=this.collisionIndex.placeCollisionBox(Ur,Ae,ue,V,H,Gt,kt,k,Ie.predicate,gn);return pr&&pr.placeable&&(this.markUsedOrientation(x,ts,Qt),this.placedOrientations[Qt.crossTileID]=ts),pr};Ts(()=>hs(Ql,c.ai.horizontal),()=>{const Ur=tn.verticalTextBox;return x.allowVerticalPlacement&&Qt.numVerticalGlyphVertices>0&&Ur?hs(Ur,c.ai.vertical):{box:null,offscreen:null}}),os(rr&&rr.placeable)}else{let hs=c.ar[(ei=(lr=this.prevPlacement)===null||lr===void 0?void 0:lr.variableOffsets[Qt.crossTileID])===null||ei===void 0?void 0:ei.anchor];const Ur=(pr,Uo,kc)=>{const jr=pr.x2-pr.x1,If=pr.y2-pr.y1,Dc=Qt.textBoxScale,ju=ln&&rt==="never"?Uo:null;let ja=null,Cf=Ae==="never"?1:2,Zu="never";hs&&Cf++;for(let Nc=0;Nc<Cf;Nc++){for(let Oc=yo;Oc<eu;Oc++){const Yu=x.textAnchorOffsets.get(Oc);if(hs&&Yu.textAnchor!==hs)continue;const vo=this.attemptAnchorPlacement(Yu,pr,jr,If,Dc,kt,Gt,ue,V,H,Ie,Zu,Qt,x,kc,k,z,ju,gn);if(vo&&(ja=vo.placedGlyphBoxes,ja&&ja.placeable))return gi=!0,Js=vo.shift,ja}hs?hs=null:Zu=Ae}return y&&!ja&&(ja={box:this.collisionIndex.placeCollisionBox(Ql,"always",ue,V,H,Gt,kt,k,Ie.predicate,gn,new c.P(0,0)).box,offscreen:!1,placeable:!1}),ja};Ts(()=>Ur(Ql,tn.iconBox,c.ai.horizontal),()=>{const pr=tn.verticalTextBox;return x.allowVerticalPlacement&&(!rr||!rr.placeable)&&Qt.numVerticalGlyphVertices>0&&pr?Ur(pr,tn.verticalIconBox,c.ai.vertical):{box:null,occluded:!0,offscreen:null}}),rr&&(gi=rr.placeable,Ni=rr.offscreen);const ts=os(rr&&rr.placeable);if(!gi&&this.prevPlacement){const pr=this.prevPlacement.variableOffsets[Qt.crossTileID];pr&&(this.variableOffsets[Qt.crossTileID]=pr,this.markUsedJustification(x,pr.anchor,Qt,ts))}}}if(as=rr,gi=as&&as.placeable,Ni=as&&as.offscreen,Qt.useRuntimeCollisionCircles){const os=x.text.placedSymbolArray.get(Qt.centerJustifiedTextSymbolIndex),Ts=c.aj(x.textSizeData,Re,os),yo=E.get("text-padding");Xr=this.collisionIndex.placeCollisionCircles(Ae,os,x.lineVertexArray,x.glyphOffsetArray,Ts,V,H,J,K,y,Gt,Ie.predicate,Qt.collisionCircleDiameter,yo,k,gn),Xr.circles.length&&Xr.collisionDetected&&!y&&c.w("Collisions detected, but collision boxes are not shown"),gi=Ke||Xr.circles.length>0&&!Xr.collisionDetected,Ni=Ni&&Xr.offscreen}if(tn.iconFeatureIndex&&(Jl=tn.iconFeatureIndex),tn.iconBox){const os=Ts=>this.collisionIndex.placeCollisionBox(Ts,rt,ue,V,H,Gt,kt,z,Ie.predicate,gn,ln&&Js?Js:void 0);xr&&xr.placeable&&tn.verticalIconBox?(Er=os(tn.verticalIconBox),ir=Er.placeable):(Er=os(tn.iconBox),ir=Er.placeable),Ni=Ni&&Er.offscreen}const hl=De||Qt.numHorizontalGlyphVertices===0&&Qt.numVerticalGlyphVertices===0,Lc=He||Qt.numIconVertices===0;hl||Lc?Lc?hl||(ir=ir&&gi):gi=ir&&gi:ir=gi=ir&&gi;const Xu=ir&&Er.placeable;if(gi&&as.placeable&&this.collisionIndex.insertCollisionBox(as.box,Ae,E.get("text-ignore-placement"),x.bucketInstanceId,xr&&xr.placeable&&Lr?Lr:da,Ie.ID),Xu&&this.collisionIndex.insertCollisionBox(Er.box,rt,E.get("icon-ignore-placement"),x.bucketInstanceId,Jl,Ie.ID),Xr&&gi&&this.collisionIndex.insertCollisionCircles(Xr.circles,Ae,E.get("text-ignore-placement"),x.bucketInstanceId,da,Ie.ID),y&&this.storeCollisionData(x.bucketInstanceId,Vn,tn,as,Er,Xr),Qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Qt.crossTileID]=new ve(gi||Ot,ir||Kt,Ni||x.justReloaded),h[Qt.crossTileID]=!0};if(on){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Qt=x.getSortedSymbolIndexes(this.transform.angle);for(let tn=Qt.length-1;tn>=0;--tn){const Vn=Qt[tn];$n(x.symbolInstances.get(Vn),x.collisionArrays[Vn],Vn)}}else for(let Qt=i.symbolInstanceStart;Qt<i.symbolInstanceEnd;Qt++)$n(x.symbolInstances.get(Qt),x.collisionArrays[Qt],Qt);if(y&&x.bucketInstanceId in this.collisionCircleArrays){const Qt=this.collisionCircleArrays[x.bucketInstanceId];c.at(Qt.invProjMatrix,V),Qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}storeCollisionData(i,h,y,x,E,k){if(y.textBox||y.iconBox){let z,V;this.collisionBoxArrays.has(i)?z=this.collisionBoxArrays.get(i):(z=new Map,this.collisionBoxArrays.set(i,z)),z.has(h)?V=z.get(h):(V={text:null,icon:null},z.set(h,V)),y.textBox&&(V.text=x.box),y.iconBox&&(V.icon=E.box)}if(k){let z=this.collisionCircleArrays[i];z===void 0&&(z=this.collisionCircleArrays[i]=new Ge);for(let V=0;V<k.circles.length;V+=4)z.circles.push(k.circles[V+0]),z.circles.push(k.circles[V+1]),z.circles.push(k.circles[V+2]),z.circles.push(k.collisionDetected?1:0)}}markUsedJustification(i,h,y,x){let E;E=x===c.ai.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[c.au(h)];const k=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const z of k)z>=0&&(i.text.placedSymbolArray.get(z).crossTileID=E>=0&&z!==E?0:y.crossTileID)}markUsedOrientation(i,h,y){const x=h===c.ai.horizontal||h===c.ai.horizontalOnly?h:0,E=h===c.ai.vertical?h:0,k=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const z of k)i.text.placedSymbolArray.get(z).placedOrientation=x;y.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(i):1,E=h?h.opacities:{},k=h?h.variableOffsets:{},z=h?h.placedOrientations:{};for(const V in this.placements){const H=this.placements[V],J=E[V];J?(this.opacities[V]=new Li(J,x,H.text,H.icon),y=y||H.text!==J.text.placed||H.icon!==J.icon.placed):(this.opacities[V]=new Li(null,x,H.text,H.icon,H.skipFade),y=y||H.text||H.icon)}for(const V in E){const H=E[V];if(!this.opacities[V]){const J=new Li(H,x,!1,!1);J.isHidden()||(this.opacities[V]=J,y=y||H.text.placed||H.icon.placed)}}for(const V in k)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=k[V]);for(const V in z)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=z[V]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const y={};for(const x of h){const E=x.getBucket(i);E&&x.latestFeatureIndex&&i.id===E.layerIds[0]&&this.updateBucketOpacities(E,x.tileID,y,x.collisionBoxArray)}}updateBucketOpacities(i,h,y,x){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const E=i.layers[0],k=E.layout,z=new Li(null,0,!1,!1,!0),V=k.get("text-allow-overlap"),H=k.get("icon-allow-overlap"),J=E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"),K=k.get("text-rotation-alignment")==="map",ue=k.get("text-pitch-alignment")==="map",ge=k.get("icon-text-fit")!=="none",Ee=new Li(null,0,V&&(H||!i.hasIconData()||k.get("icon-optional")),H&&(V||!i.hasTextData()||k.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const Re=(De,He,Ae)=>{for(let Ke=0;Ke<He/4;Ke++)De.opacityVertexArray.emplaceBack(Ae);De.hasVisibleVertices=De.hasVisibleVertices||Ae!==bi},Ie=this.collisionBoxArrays.get(i.bucketInstanceId);for(let De=0;De<i.symbolInstances.length;De++){const He=i.symbolInstances.get(De),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:Ke,crossTileID:rt}=He;let ft=this.opacities[rt];y[rt]?ft=z:ft||(ft=Ee,this.opacities[rt]=ft),y[rt]=!0;const kt=He.numIconVertices>0,Gt=this.placedOrientations[He.crossTileID],ln=Gt===c.ai.vertical,on=Gt===c.ai.horizontal||Gt===c.ai.horizontalOnly;if(Ae>0||Ke>0){const Kt=Yn(ft.text);Re(i.text,Ae,ln?bi:Kt),Re(i.text,Ke,on?bi:Kt);const gn=ft.text.isHidden();[He.rightJustifiedTextSymbolIndex,He.centerJustifiedTextSymbolIndex,He.leftJustifiedTextSymbolIndex].forEach(tn=>{tn>=0&&(i.text.placedSymbolArray.get(tn).hidden=gn||ln?1:0)}),He.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(He.verticalPlacedTextSymbolIndex).hidden=gn||on?1:0);const $n=this.variableOffsets[He.crossTileID];$n&&this.markUsedJustification(i,$n.anchor,He,Gt);const Qt=this.placedOrientations[He.crossTileID];Qt&&(this.markUsedJustification(i,"left",He,Qt),this.markUsedOrientation(i,Qt,He))}if(kt){const Kt=Yn(ft.icon),gn=!(ge&&He.verticalPlacedIconSymbolIndex&&ln);He.placedIconSymbolIndex>=0&&(Re(i.icon,He.numIconVertices,gn?Kt:bi),i.icon.placedSymbolArray.get(He.placedIconSymbolIndex).hidden=ft.icon.isHidden()),He.verticalPlacedIconSymbolIndex>=0&&(Re(i.icon,He.numVerticalIconVertices,gn?bi:Kt),i.icon.placedSymbolArray.get(He.verticalPlacedIconSymbolIndex).hidden=ft.icon.isHidden())}const Ot=Ie&&Ie.has(De)?Ie.get(De):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Kt=i.collisionArrays[De];if(Kt){let gn=new c.P(0,0);if(Kt.textBox||Kt.verticalTextBox){let $n=!0;if(J){const Qt=this.variableOffsets[rt];Qt?(gn=Qe(Qt.anchor,Qt.width,Qt.height,Qt.textOffset,Qt.textBoxScale),K&&gn._rotate(ue?this.transform.angle:-this.transform.angle)):$n=!1}if(Kt.textBox||Kt.verticalTextBox){let Qt;Kt.textBox&&(Qt=ln),Kt.verticalTextBox&&(Qt=on),en(i.textCollisionBox.collisionVertexArray,ft.text.placed,!$n||Qt,Ot.text,gn.x,gn.y)}}if(Kt.iconBox||Kt.verticalIconBox){const $n=!!(!on&&Kt.verticalIconBox);let Qt;Kt.iconBox&&(Qt=$n),Kt.verticalIconBox&&(Qt=!$n),en(i.iconCollisionBox.collisionVertexArray,ft.icon.placed,Qt,Ot.icon,ge?gn.x:0,ge?gn.y:0)}}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=De.invProjMatrix,i.placementViewportMatrix=De.viewportMatrix,i.collisionCircleArray=De.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>i}setStale(){this.stale=!0}}function en(T,i,h,y,x,E){y&&y.length!==0||(y=[0,0,0,0]);const k=y[0]-Hn,z=y[1]-Hn,V=y[2]-Hn,H=y[3]-Hn;T.emplaceBack(i?1:0,h?1:0,x||0,E||0,k,z),T.emplaceBack(i?1:0,h?1:0,x||0,E||0,V,z),T.emplaceBack(i?1:0,h?1:0,x||0,E||0,V,H),T.emplaceBack(i?1:0,h?1:0,x||0,E||0,k,H)}const Sn=Math.pow(2,25),qt=Math.pow(2,24),zn=Math.pow(2,17),Un=Math.pow(2,16),En=Math.pow(2,9),Jn=Math.pow(2,8),Qi=Math.pow(2,1);function Yn(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const i=T.placed?1:0,h=Math.floor(127*T.opacity);return h*Sn+i*qt+h*zn+i*Un+h*En+i*Jn+h*Qi+i}const bi=0;function pi(){return{isOccluded:(T,i,h)=>!1,getPitchedTextCorrection:(T,i,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(T,i,h,y){throw new Error("Not implemented.")},translatePosition:(T,i,h,y)=>function(x,E,k,z,V=!1){if(!k[0]&&!k[1])return[0,0];const H=V?z==="map"?x.angle:0:z==="viewport"?-x.angle:0;if(H){const J=Math.sin(H),K=Math.cos(H);k=[k[0]*K-k[1]*J,k[0]*J+k[1]*K]}return[V?k[0]:kn(E,k[0],x.zoom),V?k[1]:kn(E,k[1],x.zoom)]}(T,i,h,y),getCircleRadiusCorrection:T=>1}}class Tn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,y,x,E){const k=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(k,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((z,V)=>z.sortKey-V.sortKey));this._currentPartIndex<k.length;)if(h.placeLayerBucketPart(k[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,E())return!0;return!1}}class oi{constructor(i,h,y,x,E,k,z,V){this.placement=new Dt(i,pi(),h,k,z,V),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(i,h,y){const x=D.now(),E=()=>!this._forceFullPlacement&&D.now()-x>2;for(;this._currentPlacementIndex>=0;){const k=h[i[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=z)&&(!k.maxzoom||k.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Tn(k)),this._inProgressLayer.continuePlacement(y[k.source],this.placement,this._showCollisionBoxes,k,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const si=512/c.X/2;class wr{constructor(i,h,y){this.tileID=i,this.bucketInstanceId=y,this._symbolsByKey={};const x=new Map;for(let E=0;E<h.length;E++){const k=h.get(E),z=k.key,V=x.get(z);V?V.push(k):x.set(z,[k])}for(const[E,k]of x){const z={positions:k.map(V=>({x:Math.floor(V.anchorX*si),y:Math.floor(V.anchorY*si)})),crossTileIDs:k.map(V=>V.crossTileID)};if(z.positions.length>128){const V=new c.aw(z.positions.length,16,Uint16Array);for(const{x:H,y:J}of z.positions)V.add(H,J);V.finish(),delete z.positions,z.index=V}this._symbolsByKey[E]=z}}getScaledCoordinates(i,h){const{x:y,y:x,z:E}=this.tileID.canonical,{x:k,y:z,z:V}=h.canonical,H=si/Math.pow(2,V-E),J=(z*c.X+i.anchorY)*H,K=x*c.X*si;return{x:Math.floor((k*c.X+i.anchorX)*H-y*c.X*si),y:Math.floor(J-K)}}findMatches(i,h,y){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let E=0;E<i.length;E++){const k=i.get(E);if(k.crossTileID)continue;const z=this._symbolsByKey[k.key];if(!z)continue;const V=this.getScaledCoordinates(k,h);if(z.index){const H=z.index.range(V.x-x,V.y-x,V.x+x,V.y+x).sort();for(const J of H){const K=z.crossTileIDs[J];if(!y[K]){y[K]=!0,k.crossTileID=K;break}}}else if(z.positions)for(let H=0;H<z.positions.length;H++){const J=z.positions[H],K=z.crossTileIDs[H];if(Math.abs(J.x-V.x)<=x&&Math.abs(J.y-V.y)<=x&&!y[K]){y[K]=!0,k.crossTileID=K;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class Fi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _r{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const y in this.indexes){const x=this.indexes[y],E={};for(const k in x){const z=x[k];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+h),E[z.tileID.key]=z}this.indexes[y]=E}this.lng=i}addBucket(i,h,y){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let E=0;E<h.symbolInstances.length;E++)h.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const x=this.usedCrossTileIDs[i.overscaledZ];for(const E in this.indexes){const k=this.indexes[E];if(Number(E)>i.overscaledZ)for(const z in k){const V=k[z];V.tileID.isChildOf(i)&&V.findMatches(h.symbolInstances,i,x)}else{const z=k[i.scaledTo(Number(E)).key];z&&z.findMatches(h.symbolInstances,i,x)}}for(let E=0;E<h.symbolInstances.length;E++){const k=h.symbolInstances.get(E);k.crossTileID||(k.crossTileID=y.generate(),x[k.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new wr(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const y of h.getCrossTileIDsLists())for(const x of y)delete this.usedCrossTileIDs[i][x]}removeStaleBuckets(i){let h=!1;for(const y in this.indexes){const x=this.indexes[y];for(const E in x)i[x[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,x[E]),delete x[E],h=!0)}return h}}class Gr{constructor(){this.layerIndexes={},this.crossTileIDs=new Fi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,y){let x=this.layerIndexes[i.id];x===void 0&&(x=this.layerIndexes[i.id]=new _r);let E=!1;const k={};x.handleWrapJump(y);for(const z of h){const V=z.getBucket(i);V&&i.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(z.tileID,V,this.crossTileIDs)&&(E=!0),k[V.bucketInstanceId]=!0)}return x.removeStaleBuckets(k)&&(E=!0),E}pruneUnusedLayers(i){const h={};i.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const ki=(T,i)=>c.t(T,i&&i.filter(h=>h.identifier!=="source.canvas")),Hi=c.ax();class ss extends c.E{constructor(i,h={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const x=this.sourceCaches[y].getSource().type;x!=="vector"&&x!=="geojson"||this.sourceCaches[y].reload()}},this.map=i,this.dispatcher=new bn(Wn(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,x)=>this.getGlyphs(y,x)),this.dispatcher.registerMessageHandler("GI",(y,x)=>this.getImages(y,x)),this.imageManager=new st,this.imageManager.setEventedParent(this),this.glyphManager=new wt(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new jn(256,512),this.crossTileSymbolIndex=new Gr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.az()),Rt().on($e,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.sourceCaches[y.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const k in this._layers){const z=this._layers[k];z.source===E.id&&this._validateLayer(z)}})}loadURL(i,h={},y){this.fire(new c.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const x=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const E=this._loadStyleRequest;c.h(x,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,h,y)}).catch(k=>{this._loadStyleRequest=null,k&&!E.signal.aborted&&this.fire(new c.j(k))})}loadJSON(i,h={},y){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,y)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Hi,{validate:!1})}_load(i,h,y){var x;const E=h.transformStyle?h.transformStyle(y,i):i;if(!h.validate||!ki(this,c.x(E))){this._loaded=!0,this.stylesheet=E;for(const k in E.sources)this.addSource(k,E.sources[k],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new Tt(this.stylesheet.light),this.sky=new Cn(this.stylesheet.sky),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const i=c.aA(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of i){const y=c.aB(h);y.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=y}}_loadSprite(i,h=!1,y=void 0){let x;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(E,k,z,V){return c._(this,void 0,void 0,function*(){const H=de(E),J=z>1?"@2x":"",K={},ue={};for(const{id:ge,url:Ee}of H){const Re=k.transformRequest(be(Ee,J,".json"),"SpriteJSON");K[ge]=c.h(Re,V);const Ie=k.transformRequest(be(Ee,J,".png"),"SpriteImage");ue[ge]=le.getImage(Ie,V)}return yield Promise.all([...Object.values(K),...Object.values(ue)]),function(ge,Ee){return c._(this,void 0,void 0,function*(){const Re={};for(const Ie in ge){Re[Ie]={};const De=D.getImageCanvasContext((yield Ee[Ie]).data),He=(yield ge[Ie]).data;for(const Ae in He){const{width:Ke,height:rt,x:ft,y:kt,sdf:Gt,pixelRatio:ln,stretchX:on,stretchY:Ot,content:Kt,textFitWidth:gn,textFitHeight:$n}=He[Ae];Re[Ie][Ae]={data:null,pixelRatio:ln,sdf:Gt,stretchX:on,stretchY:Ot,content:Kt,textFitWidth:gn,textFitHeight:$n,spriteData:{width:Ke,height:rt,x:ft,y:kt,context:De}}}}return Re})}(K,ue)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(E=>{if(this._spriteRequest=null,E)for(const k in E){this._spritesImagesIds[k]=[];const z=this._spritesImagesIds[k]?this._spritesImagesIds[k].filter(V=>!(V in E)):[];for(const V of z)this.imageManager.removeImage(V),this._changedImages[V]=!0;for(const V in E[k]){const H=k==="default"?V:`${k}:${V}`;this._spritesImagesIds[k].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,E[k][V],!1):this.imageManager.addImage(H,E[k][V]),h&&(this._changedImages[H]=!0)}}}).catch(E=>{this._spriteRequest=null,x=E,this.fire(new c.j(x))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),y&&y(x)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const y=i.sourceLayer;if(!y)return;const x=h.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(y)===-1)&&this.fire(new c.j(new Error(`Source layer "${y}" does not exist on source "${x.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const h=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h);const y=[];for(const x of i)h[x]&&y.push(h[x]);return y}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const y of h){const x=this._layers[y];x.type!=="custom"&&(i[y]=x.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const x=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(x.length||E.length)&&this._updateWorkerLayers(x,E);for(const k in this._updatedSources){const z=this._updatedSources[k];if(z==="reload")this._reloadSource(k);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(k)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const k in this._updatedPaintProps)this._layers[k].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const y={};for(const x in this.sourceCaches){const E=this.sourceCaches[x];y[x]=E.used,E.used=!1}for(const x of this._order){const E=this._layers[x];E.recalculate(i,this._availableImages),!E.isHidden(i.zoom)&&E.source&&(this.sourceCaches[E.source].used=!0)}for(const x in y){const E=this.sourceCaches[x];!!y[x]!=!!E.used&&E.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(i),this.sky.recalculate(i),this.z=i.zoom,h&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var y;this._checkLoaded();const x=this.serialize();if(i=h.transformStyle?h.transformStyle(x,i):i,((y=h.validate)===null||y===void 0||y)&&ki(this,c.x(i)))return!1;(i=c.aC(i)).layers=c.aA(i.layers);const E=c.aD(x,i),k=this._getOperationsToPerform(E);if(k.unimplemented.length>0)throw new Error(`Unimplemented: ${k.unimplemented.join(", ")}.`);if(k.operations.length===0)return!1;for(const z of k.operations)z();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],y=[];for(const x of i)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,x.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,x.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,x.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,x.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,x.args));break;case"addSource":h.push(()=>this.addSource.apply(this,x.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,x.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,x.args));break;case"setLight":h.push(()=>this.setLight.apply(this,x.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,x.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,x.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,x.args));break;case"setSky":h.push(()=>this.setSky.apply(this,x.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,x.args));break;case"setTransition":h.push(()=>{});break;default:y.push(x.command)}return{operations:h,unimplemented:y}}addImage(i,h){if(this.getImage(i))return this.fire(new c.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new c.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,y={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(c.x.source,`sources.${i}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=this.sourceCaches[i]=new xt(i,h,this.dispatcher);x.style=this,x.setEventedParent(this,()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:i})),x.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===i)return this.fire(new c.j(new Error(`Source "${i}" cannot be removed while layer "${y}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const y=this.sourceCaches[i].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,y={}){this._checkLoaded();const x=i.id;if(this.getLayer(x))return void this.fire(new c.j(new Error(`Layer "${x}" already exists on this map.`)));let E;if(i.type==="custom"){if(ki(this,c.aE(i)))return;E=c.aB(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(x,i.source),i=c.aC(i),i=c.e(i,{source:x})),this._validate(c.x.layer,`layers.${x}`,i,{arrayIndex:-1},y))return;E=c.aB(i),this._validateLayer(E),E.setEventedParent(this,{layer:{id:x}})}const k=h?this._order.indexOf(h):this._order.length;if(h&&k===-1)this.fire(new c.j(new Error(`Cannot add layer "${x}" before non-existing layer "${h}".`)));else{if(this._order.splice(k,0,x),this._layerOrderChanged=!0,this._layers[x]=E,this._removedLayers[x]&&E.source&&E.type!=="custom"){const z=this._removedLayers[x];delete this._removedLayers[x],z.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const y=this._order.indexOf(i);this._order.splice(y,1);const x=h?this._order.indexOf(h):this._order.length;h&&x===-1?this.fire(new c.j(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(x,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const y=this._order.indexOf(i);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,y){this._checkLoaded();const x=this.getLayer(i);x?x.minzoom===h&&x.maxzoom===y||(h!=null&&(x.minzoom=h),y!=null&&(x.maxzoom=y),this._updateLayer(x)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,y={}){this._checkLoaded();const x=this.getLayer(i);if(x){if(!c.aF(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(c.x.filter,`layers.${x.id}.filter`,h,null,y)||(x.filter=c.aC(h),this._updateLayer(x)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return c.aC(this.getLayer(i).filter)}setLayoutProperty(i,h,y,x={}){this._checkLoaded();const E=this.getLayer(i);E?c.aF(E.getLayoutProperty(h),y)||(E.setLayoutProperty(h,y,x),this._updateLayer(E)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const y=this.getLayer(i);if(y)return y.getLayoutProperty(h);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,y,x={}){this._checkLoaded();const E=this.getLayer(i);E?c.aF(E.getPaintProperty(h),y)||(E.setPaintProperty(h,y,x)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const y=i.source,x=i.sourceLayer,E=this.sourceCaches[y];if(E===void 0)return void this.fire(new c.j(new Error(`The source '${y}' does not exist in the map's style.`)));const k=E.getSource().type;k==="geojson"&&x?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||x?(i.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),E.setFeatureState(x,i.id,h)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const y=i.source,x=this.sourceCaches[y];if(x===void 0)return void this.fire(new c.j(new Error(`The source '${y}' does not exist in the map's style.`)));const E=x.getSource().type,k=E==="vector"?i.sourceLayer:void 0;E!=="vector"||k?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(k,i.id,h):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,y=i.sourceLayer,x=this.sourceCaches[h];if(x!==void 0)return x.getSource().type!=="vector"||y?(i.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),x.getFeatureState(y,i.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=c.aG(this.sourceCaches,E=>E.serialize()),h=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,x=this.stylesheet;return c.aH({version:x.version,name:x.name,metadata:x.metadata,light:x.light,sky:x.sky,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,sources:i,layers:h,terrain:y},E=>E!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=k=>this._layers[k].type==="fill-extrusion",y={},x=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(h(z)){y[z]=k;for(const V of i){const H=V[z];if(H)for(const J of H)x.push(J)}}}x.sort((k,z)=>z.intersectionZ-k.intersectionZ);const E=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(h(z))for(let V=x.length-1;V>=0;V--){const H=x[V].feature;if(y[H.layer.id]<k)break;E.push(H),x.pop()}else for(const V of i){const H=V[z];if(H)for(const J of H)E.push(J.feature)}}return E}queryRenderedFeatures(i,h,y){h&&h.filter&&this._validate(c.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const z of h.layers){const V=this._layers[z];if(!V)return this.fire(new c.j(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];x[V.source]=!0}}const E=[];h.availableImages=this._availableImages;const k=this._serializedAllLayers();for(const z in this.sourceCaches)h.layers&&!x[z]||E.push(ui(this.sourceCaches[z],this._layers,k,i,h,y));return this.placement&&E.push(function(z,V,H,J,K,ue,ge){const Ee={},Re=ue.queryRenderedSymbols(J),Ie=[];for(const De of Object.keys(Re).map(Number))Ie.push(ge[De]);Ie.sort(Gn);for(const De of Ie){const He=De.featureIndex.lookupSymbolFeatures(Re[De.bucketInstanceId],V,De.bucketIndex,De.sourceLayerIndex,K.filter,K.layers,K.availableImages,z);for(const Ae in He){const Ke=Ee[Ae]=Ee[Ae]||[],rt=He[Ae];rt.sort((ft,kt)=>{const Gt=De.featureSortOrder;if(Gt){const ln=Gt.indexOf(ft.featureIndex);return Gt.indexOf(kt.featureIndex)-ln}return kt.featureIndex-ft.featureIndex});for(const ft of rt)Ke.push(ft)}}for(const De in Ee)Ee[De].forEach(He=>{const Ae=He.feature,Ke=H[z[De].source].getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ke});return Ee}(this._layers,k,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(i,h){h&&h.filter&&this._validate(c.x.filter,"querySourceFeatures.filter",h.filter,null,h);const y=this.sourceCaches[i];return y?function(x,E){const k=x.getRenderableIds().map(H=>x.getTileByID(H)),z=[],V={};for(let H=0;H<k.length;H++){const J=k[H],K=J.tileID.canonical.key;V[K]||(V[K]=!0,J.querySourceFeatures(z,E))}return z}(y,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const k in i)if(!c.aF(i[k],y[k])){x=!0;break}if(!x)return;const E={now:D.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(E)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){const y=this.sky.getSky();let x=!1;i||y&&(x=!0);for(const k in i)if(!c.aF(i[k],y[k])){x=!0;break}if(!x)return;const E={now:D.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(E)}_validate(i,h,y,x,E={}){return(!E||E.validate!==!1)&&ki(this,i.call(c.x,c.e({key:h,style:this.serialize(),value:y,styleSpec:c.v},x)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Rt().off($e,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const y=this.sourceCaches[h];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,y,x,E=!1){let k=!1,z=!1;const V={};for(const H of this._order){const J=this._layers[H];if(J.type!=="symbol")continue;if(!V[J.source]){const ue=this.sourceCaches[J.source];V[J.source]=ue.getRenderableIds(!0).map(ge=>ue.getTileByID(ge)).sort((ge,Ee)=>Ee.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(Ee.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(J,V[J.source],i.center.lng);k=k||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(D.now(),i.zoom))&&(this.pauseablePlacement=new oi(i,this.map.terrain,this._order,E,h,y,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(D.now()),z=!0),k&&this.pauseablePlacement.placement.setStale()),z||k)for(const H of this._order){const J=this._layers[H];J.type==="symbol"&&this.placement.updateLayerOpacities(J,V[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(D.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return c._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const x=this.sourceCaches[h.source];return x&&x.setDependencies(h.tileID.key,h.type,h.icons),y})}getGlyphs(i,h){return c._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(h.stacks),x=this.sourceCaches[h.source];return x&&x.setDependencies(h.tileID.key,h.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(c.x.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,y={},x){this._checkLoaded();const E=[{id:i,url:h}],k=[...de(this.stylesheet.sprite),...E];this._validate(c.x.sprite,"sprite",k,null,y)||(this.stylesheet.sprite=k,this._loadSprite(E,!0,x))}removeSprite(i){this._checkLoaded();const h=de(this.stylesheet.sprite);if(h.find(y=>y.id===i)){if(this._spritesImagesIds[i])for(const y of this._spritesImagesIds[i])this.imageManager.removeImage(y),this._changedImages[y]=!0;h.splice(h.findIndex(y=>y.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return de(this.stylesheet.sprite)}setSprite(i,h={},y){this._checkLoaded(),i&&this._validate(c.x.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,y):(this._unloadSprite(),y&&y(null)))}}var Ir=c.Y([{name:"a_pos",type:"Int16",components:2}]);const Nr={prelude:yi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:yi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:yi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:yi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:yi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:yi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:yi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:yi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:yi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yi(T,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=i.match(/attribute ([\w]+) ([\w]+)/g),x=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=E?E.concat(x):x,z={};return{fragmentSource:T=T.replace(h,(V,H,J,K,ue)=>(z[ue]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
varying ${J} ${K} ${ue};
#else
uniform ${J} ${K} u_${ue};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ue}
    ${J} ${K} ${ue} = u_${ue};
#endif
`)),vertexSource:i=i.replace(h,(V,H,J,K,ue)=>{const ge=K==="float"?"vec2":"vec4",Ee=ue.match(/color/)?"color":ge;return z[ue]?H==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
attribute ${J} ${ge} a_${ue};
varying ${J} ${K} ${ue};
#else
uniform ${J} ${K} u_${ue};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = a_${ue};
#else
    ${J} ${K} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${ue} = unpack_mix_${Ee}(a_${ue}, u_${ue}_t);
#else
    ${J} ${K} ${ue} = u_${ue};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${ue}
uniform lowp float u_${ue}_t;
attribute ${J} ${ge} a_${ue};
#else
uniform ${J} ${K} u_${ue};
#endif
`:Ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${ue}
    ${J} ${K} ${ue} = a_${ue};
#else
    ${J} ${K} ${ue} = u_${ue};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ue}
    ${J} ${K} ${ue} = unpack_mix_${Ee}(a_${ue}, u_${ue}_t);
#else
    ${J} ${K} ${ue} = u_${ue};
#endif
`}),staticAttributes:y,staticUniforms:k}}class wa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,y,x,E,k,z,V,H){this.context=i;let J=this.boundPaintVertexBuffers.length!==x.length;for(let K=0;!J&&K<x.length;K++)this.boundPaintVertexBuffers[K]!==x[K]&&(J=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||J||this.boundIndexBuffer!==E||this.boundVertexOffset!==k||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==V||this.boundDynamicVertexBuffer3!==H?this.freshBind(h,y,x,E,k,z,V,H):(i.bindVertexArray.set(this.vao),z&&z.bind(),E&&E.dynamicDraw&&E.bind(),V&&V.bind(),H&&H.bind())}freshBind(i,h,y,x,E,k,z,V){const H=i.numAttributes,J=this.context,K=J.gl;this.vao&&this.destroy(),this.vao=J.createVertexArray(),J.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=x,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=k,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=V,h.enableAttributes(K,i);for(const ue of y)ue.enableAttributes(K,i);k&&k.enableAttributes(K,i),z&&z.enableAttributes(K,i),V&&V.enableAttributes(K,i),h.bind(),h.setVertexAttribPointers(K,i,E);for(const ue of y)ue.bind(),ue.setVertexAttribPointers(K,i,E);k&&(k.bind(),k.setVertexAttribPointers(K,i,E)),x&&x.bind(),z&&(z.bind(),z.setVertexAttribPointers(K,i,E)),V&&(V.bind(),V.setVertexAttribPointers(K,i,E)),J.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ru=(T,i,h,y,x)=>({u_matrix:T,u_texture:0,u_ele_delta:i,u_fog_matrix:h,u_fog_color:y?y.properties.get("fog-color"):c.aN.white,u_fog_ground_blend:y?y.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?y.calculateFogBlendOpacity(x):0,u_horizon_color:y?y.properties.get("horizon-color"):c.aN.white,u_horizon_fog_blend:y?y.properties.get("horizon-fog-blend"):1});function Co(T){const i=[];for(let h=0;h<T.length;h++){if(T[h]===null)continue;const y=T[h].split(" ");i.push(y.pop())}return i}class ao{constructor(i,h,y,x,E,k){const z=i.gl;this.program=z.createProgram();const V=Co(h.staticAttributes),H=y?y.getBinderAttributes():[],J=V.concat(H),K=Nr.prelude.staticUniforms?Co(Nr.prelude.staticUniforms):[],ue=h.staticUniforms?Co(h.staticUniforms):[],ge=y?y.getBinderUniforms():[],Ee=K.concat(ue).concat(ge),Re=[];for(const ft of Ee)Re.indexOf(ft)<0&&Re.push(ft);const Ie=y?y.defines():[];E&&Ie.push("#define OVERDRAW_INSPECTOR;"),k&&Ie.push("#define TERRAIN3D;");const De=Ie.concat(Nr.prelude.fragmentSource,h.fragmentSource).join(`
`),He=Ie.concat(Nr.prelude.vertexSource,h.vertexSource).join(`
`),Ae=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Ae,De),z.compileShader(Ae),!z.getShaderParameter(Ae,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(Ae)}`);z.attachShader(this.program,Ae);const Ke=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Ke,He),z.compileShader(Ke),!z.getShaderParameter(Ke,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Ke)}`);z.attachShader(this.program,Ke),this.attributes={};const rt={};this.numAttributes=J.length;for(let ft=0;ft<this.numAttributes;ft++)J[ft]&&(z.bindAttribLocation(this.program,ft,J[ft]),this.attributes[J[ft]]=ft);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Ke),z.deleteShader(Ae);for(let ft=0;ft<Re.length;ft++){const kt=Re[ft];if(kt&&!rt[kt]){const Gt=z.getUniformLocation(this.program,kt);Gt&&(rt[kt]=Gt)}}this.fixedUniforms=x(i,rt),this.terrainUniforms=((ft,kt)=>({u_depth:new c.aI(ft,kt.u_depth),u_terrain:new c.aI(ft,kt.u_terrain),u_terrain_dim:new c.aJ(ft,kt.u_terrain_dim),u_terrain_matrix:new c.aK(ft,kt.u_terrain_matrix),u_terrain_unpack:new c.aL(ft,kt.u_terrain_unpack),u_terrain_exaggeration:new c.aJ(ft,kt.u_terrain_exaggeration)}))(i,rt),this.binderUniforms=y?y.getUniforms(i,rt):[]}draw(i,h,y,x,E,k,z,V,H,J,K,ue,ge,Ee,Re,Ie,De,He){const Ae=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(y),i.setStencilMode(x),i.setColorMode(E),i.setCullFace(k),V){i.activeTexture.set(Ae.TEXTURE2),Ae.bindTexture(Ae.TEXTURE_2D,V.depthTexture),i.activeTexture.set(Ae.TEXTURE3),Ae.bindTexture(Ae.TEXTURE_2D,V.texture);for(const rt in this.terrainUniforms)this.terrainUniforms[rt].set(V[rt])}for(const rt in this.fixedUniforms)this.fixedUniforms[rt].set(z[rt]);Re&&Re.setUniforms(i,this.binderUniforms,ge,{zoom:Ee});let Ke=0;switch(h){case Ae.LINES:Ke=2;break;case Ae.TRIANGLES:Ke=3;break;case Ae.LINE_STRIP:Ke=1}for(const rt of ue.get()){const ft=rt.vaos||(rt.vaos={});(ft[H]||(ft[H]=new wa)).bind(i,this,J,Re?Re.getPaintVertexBuffers():[],K,rt.vertexOffset,Ie,De,He),Ae.drawElements(h,rt.primitiveLength*Ke,Ae.UNSIGNED_SHORT,rt.primitiveOffset*Ke*2)}}}function sa(T,i,h){const y=1/kn(h,1,i.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),E=h.tileSize*Math.pow(2,i.transform.tileZoom)/x,k=E*(h.tileID.canonical.x+h.tileID.wrap*x),z=E*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[k>>16,z>>16],u_pixel_coord_lower:[65535&k,65535&z]}}const aa=(T,i,h,y)=>{const x=i.style.light,E=x.properties.get("position"),k=[E.x,E.y,E.z],z=function(){var H=new c.A(9);return c.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();x.properties.get("anchor")==="viewport"&&function(H,J){var K=Math.sin(J),ue=Math.cos(J);H[0]=ue,H[1]=K,H[2]=0,H[3]=-K,H[4]=ue,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(z,-i.transform.angle),function(H,J,K){var ue=J[0],ge=J[1],Ee=J[2];H[0]=ue*K[0]+ge*K[3]+Ee*K[6],H[1]=ue*K[1]+ge*K[4]+Ee*K[7],H[2]=ue*K[2]+ge*K[5]+Ee*K[8]}(k,k,z);const V=x.properties.get("color");return{u_matrix:T,u_lightpos:k,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+h,u_opacity:y}},Jo=(T,i,h,y,x,E,k)=>c.e(aa(T,i,h,y),sa(E,i,k),{u_height_factor:-Math.pow(2,x.overscaledZ)/k.tileSize/8}),oo=T=>({u_matrix:T}),Ro=(T,i,h,y)=>c.e(oo(T),sa(h,i,y)),Dl=(T,i)=>({u_matrix:T,u_world:i}),er=(T,i,h,y,x)=>c.e(Ro(T,i,h,y),{u_world:x}),Sa=(T,i,h,y)=>{const x=T.transform;let E,k;if(y.paint.get("circle-pitch-alignment")==="map"){const z=kn(h,1,x.zoom);E=!0,k=[z,z]}else E=!1,k=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:T.translatePosMatrix(i.posMatrix,h,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:k}},Sc=(T,i,h)=>({u_matrix:T,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),oa=(T,i,h=1)=>({u_matrix:T,u_color:i,u_overlay:0,u_overlay_scale:h}),Qr=T=>({u_matrix:T}),sr=(T,i,h,y)=>({u_matrix:T,u_extrude_scale:kn(i,1,h),u_intensity:y});function Hr(T,i){const h=Math.pow(2,i.canonical.z),y=i.canonical.y;return[new c.Z(0,y/h).toLngLat().lat,new c.Z(0,(y+1)/h).toLngLat().lat]}const Qo=(T,i,h,y)=>{const x=T.transform;return{u_matrix:Lu(T,i,h,y),u_ratio:1/kn(i,1,x.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Nl=(T,i,h,y,x)=>c.e(Qo(T,i,h,x),{u_image:0,u_image_height:y}),Pu=(T,i,h,y,x)=>{const E=T.transform,k=Ea(i,E);return{u_matrix:Lu(T,i,h,x),u_texsize:i.imageAtlasTexture.size,u_ratio:1/kn(i,1,E.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[k,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},el=(T,i,h,y,x,E)=>{const k=T.lineAtlas,z=Ea(i,T.transform),V=h.layout.get("line-cap")==="round",H=k.getDash(y.from,V),J=k.getDash(y.to,V),K=H.width*x.fromScale,ue=J.width*x.toScale;return c.e(Qo(T,i,h,E),{u_patternscale_a:[z/K,-H.height/2],u_patternscale_b:[z/ue,-J.height/2],u_sdfgamma:k.width/(256*Math.min(K,ue)*T.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:J.y,u_mix:x.t})};function Ea(T,i){return 1/kn(T,1,i.tileZoom)}function Lu(T,i,h,y){return T.translatePosMatrix(y?y.posMatrix:i.tileID.posMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ai=(T,i,h,y,x)=>{return{u_matrix:T,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(k=x.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(E=x.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:la(x.paint.get("raster-hue-rotate"))};var E,k};function la(T){T*=Math.PI/180;const i=Math.sin(T),h=Math.cos(T);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const Ol=(T,i,h,y,x,E,k,z,V,H,J,K,ue,ge)=>{const Ee=k.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Ee.cameraToCenterDistance,u_pitch:Ee.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Ee.width/Ee.height,u_fade_change:k.options.fadeDuration?k.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:V,u_coord_matrix:H,u_is_text:+K,u_pitch_with_map:+y,u_is_along_line:x,u_is_variable_anchor:E,u_texsize:ue,u_texture:0,u_translation:J,u_pitched_scale:ge}},ku=(T,i,h,y,x,E,k,z,V,H,J,K,ue,ge,Ee)=>{const Re=k.transform;return c.e(Ol(T,i,h,y,x,E,k,z,V,H,J,K,ue,Ee),{u_gamma_scale:y?Math.cos(Re._pitch)*Re.cameraToCenterDistance:1,u_device_pixel_ratio:k.pixelRatio,u_is_halo:+ge})},zi=(T,i,h,y,x,E,k,z,V,H,J,K,ue,ge)=>c.e(ku(T,i,h,y,x,E,k,z,V,H,J,!0,K,!0,ge),{u_texsize_icon:ue,u_texture_icon:1}),Di=(T,i,h)=>({u_matrix:T,u_opacity:i,u_color:h}),Wr=(T,i,h,y,x,E)=>c.e(function(k,z,V,H){const J=V.imageManager.getPattern(k.from.toString()),K=V.imageManager.getPattern(k.to.toString()),{width:ue,height:ge}=V.imageManager.getPixelSize(),Ee=Math.pow(2,H.tileID.overscaledZ),Re=H.tileSize*Math.pow(2,V.transform.tileZoom)/Ee,Ie=Re*(H.tileID.canonical.x+H.tileID.wrap*Ee),De=Re*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:J.tl,u_pattern_br_a:J.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ue,ge],u_mix:z.t,u_pattern_size_a:J.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:z.fromScale,u_scale_b:z.toScale,u_tile_units_to_pixels:1/kn(H,1,V.transform.tileZoom),u_pixel_coord_upper:[Ie>>16,De>>16],u_pixel_coord_lower:[65535&Ie,65535&De]}}(y,E,h,x),{u_matrix:T,u_opacity:i}),tl={fillExtrusion:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_lightpos:new c.aO(T,i.u_lightpos),u_lightintensity:new c.aJ(T,i.u_lightintensity),u_lightcolor:new c.aO(T,i.u_lightcolor),u_vertical_gradient:new c.aJ(T,i.u_vertical_gradient),u_opacity:new c.aJ(T,i.u_opacity)}),fillExtrusionPattern:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_lightpos:new c.aO(T,i.u_lightpos),u_lightintensity:new c.aJ(T,i.u_lightintensity),u_lightcolor:new c.aO(T,i.u_lightcolor),u_vertical_gradient:new c.aJ(T,i.u_vertical_gradient),u_height_factor:new c.aJ(T,i.u_height_factor),u_image:new c.aI(T,i.u_image),u_texsize:new c.aP(T,i.u_texsize),u_pixel_coord_upper:new c.aP(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aP(T,i.u_pixel_coord_lower),u_scale:new c.aO(T,i.u_scale),u_fade:new c.aJ(T,i.u_fade),u_opacity:new c.aJ(T,i.u_opacity)}),fill:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix)}),fillPattern:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_image:new c.aI(T,i.u_image),u_texsize:new c.aP(T,i.u_texsize),u_pixel_coord_upper:new c.aP(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aP(T,i.u_pixel_coord_lower),u_scale:new c.aO(T,i.u_scale),u_fade:new c.aJ(T,i.u_fade)}),fillOutline:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_world:new c.aP(T,i.u_world)}),fillOutlinePattern:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_world:new c.aP(T,i.u_world),u_image:new c.aI(T,i.u_image),u_texsize:new c.aP(T,i.u_texsize),u_pixel_coord_upper:new c.aP(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aP(T,i.u_pixel_coord_lower),u_scale:new c.aO(T,i.u_scale),u_fade:new c.aJ(T,i.u_fade)}),circle:(T,i)=>({u_camera_to_center_distance:new c.aJ(T,i.u_camera_to_center_distance),u_scale_with_map:new c.aI(T,i.u_scale_with_map),u_pitch_with_map:new c.aI(T,i.u_pitch_with_map),u_extrude_scale:new c.aP(T,i.u_extrude_scale),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_matrix:new c.aK(T,i.u_matrix)}),collisionBox:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_pixel_extrude_scale:new c.aP(T,i.u_pixel_extrude_scale)}),collisionCircle:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_inv_matrix:new c.aK(T,i.u_inv_matrix),u_camera_to_center_distance:new c.aJ(T,i.u_camera_to_center_distance),u_viewport_size:new c.aP(T,i.u_viewport_size)}),debug:(T,i)=>({u_color:new c.aM(T,i.u_color),u_matrix:new c.aK(T,i.u_matrix),u_overlay:new c.aI(T,i.u_overlay),u_overlay_scale:new c.aJ(T,i.u_overlay_scale)}),clippingMask:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix)}),heatmap:(T,i)=>({u_extrude_scale:new c.aJ(T,i.u_extrude_scale),u_intensity:new c.aJ(T,i.u_intensity),u_matrix:new c.aK(T,i.u_matrix)}),heatmapTexture:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_world:new c.aP(T,i.u_world),u_image:new c.aI(T,i.u_image),u_color_ramp:new c.aI(T,i.u_color_ramp),u_opacity:new c.aJ(T,i.u_opacity)}),hillshade:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_image:new c.aI(T,i.u_image),u_latrange:new c.aP(T,i.u_latrange),u_light:new c.aP(T,i.u_light),u_shadow:new c.aM(T,i.u_shadow),u_highlight:new c.aM(T,i.u_highlight),u_accent:new c.aM(T,i.u_accent)}),hillshadePrepare:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_image:new c.aI(T,i.u_image),u_dimension:new c.aP(T,i.u_dimension),u_zoom:new c.aJ(T,i.u_zoom),u_unpack:new c.aL(T,i.u_unpack)}),line:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_ratio:new c.aJ(T,i.u_ratio),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.aP(T,i.u_units_to_pixels)}),lineGradient:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_ratio:new c.aJ(T,i.u_ratio),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.aP(T,i.u_units_to_pixels),u_image:new c.aI(T,i.u_image),u_image_height:new c.aJ(T,i.u_image_height)}),linePattern:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_texsize:new c.aP(T,i.u_texsize),u_ratio:new c.aJ(T,i.u_ratio),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_image:new c.aI(T,i.u_image),u_units_to_pixels:new c.aP(T,i.u_units_to_pixels),u_scale:new c.aO(T,i.u_scale),u_fade:new c.aJ(T,i.u_fade)}),lineSDF:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_ratio:new c.aJ(T,i.u_ratio),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_units_to_pixels:new c.aP(T,i.u_units_to_pixels),u_patternscale_a:new c.aP(T,i.u_patternscale_a),u_patternscale_b:new c.aP(T,i.u_patternscale_b),u_sdfgamma:new c.aJ(T,i.u_sdfgamma),u_image:new c.aI(T,i.u_image),u_tex_y_a:new c.aJ(T,i.u_tex_y_a),u_tex_y_b:new c.aJ(T,i.u_tex_y_b),u_mix:new c.aJ(T,i.u_mix)}),raster:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_tl_parent:new c.aP(T,i.u_tl_parent),u_scale_parent:new c.aJ(T,i.u_scale_parent),u_buffer_scale:new c.aJ(T,i.u_buffer_scale),u_fade_t:new c.aJ(T,i.u_fade_t),u_opacity:new c.aJ(T,i.u_opacity),u_image0:new c.aI(T,i.u_image0),u_image1:new c.aI(T,i.u_image1),u_brightness_low:new c.aJ(T,i.u_brightness_low),u_brightness_high:new c.aJ(T,i.u_brightness_high),u_saturation_factor:new c.aJ(T,i.u_saturation_factor),u_contrast_factor:new c.aJ(T,i.u_contrast_factor),u_spin_weights:new c.aO(T,i.u_spin_weights)}),symbolIcon:(T,i)=>({u_is_size_zoom_constant:new c.aI(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aI(T,i.u_is_size_feature_constant),u_size_t:new c.aJ(T,i.u_size_t),u_size:new c.aJ(T,i.u_size),u_camera_to_center_distance:new c.aJ(T,i.u_camera_to_center_distance),u_pitch:new c.aJ(T,i.u_pitch),u_rotate_symbol:new c.aI(T,i.u_rotate_symbol),u_aspect_ratio:new c.aJ(T,i.u_aspect_ratio),u_fade_change:new c.aJ(T,i.u_fade_change),u_matrix:new c.aK(T,i.u_matrix),u_label_plane_matrix:new c.aK(T,i.u_label_plane_matrix),u_coord_matrix:new c.aK(T,i.u_coord_matrix),u_is_text:new c.aI(T,i.u_is_text),u_pitch_with_map:new c.aI(T,i.u_pitch_with_map),u_is_along_line:new c.aI(T,i.u_is_along_line),u_is_variable_anchor:new c.aI(T,i.u_is_variable_anchor),u_texsize:new c.aP(T,i.u_texsize),u_texture:new c.aI(T,i.u_texture),u_translation:new c.aP(T,i.u_translation),u_pitched_scale:new c.aJ(T,i.u_pitched_scale)}),symbolSDF:(T,i)=>({u_is_size_zoom_constant:new c.aI(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aI(T,i.u_is_size_feature_constant),u_size_t:new c.aJ(T,i.u_size_t),u_size:new c.aJ(T,i.u_size),u_camera_to_center_distance:new c.aJ(T,i.u_camera_to_center_distance),u_pitch:new c.aJ(T,i.u_pitch),u_rotate_symbol:new c.aI(T,i.u_rotate_symbol),u_aspect_ratio:new c.aJ(T,i.u_aspect_ratio),u_fade_change:new c.aJ(T,i.u_fade_change),u_matrix:new c.aK(T,i.u_matrix),u_label_plane_matrix:new c.aK(T,i.u_label_plane_matrix),u_coord_matrix:new c.aK(T,i.u_coord_matrix),u_is_text:new c.aI(T,i.u_is_text),u_pitch_with_map:new c.aI(T,i.u_pitch_with_map),u_is_along_line:new c.aI(T,i.u_is_along_line),u_is_variable_anchor:new c.aI(T,i.u_is_variable_anchor),u_texsize:new c.aP(T,i.u_texsize),u_texture:new c.aI(T,i.u_texture),u_gamma_scale:new c.aJ(T,i.u_gamma_scale),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_is_halo:new c.aI(T,i.u_is_halo),u_translation:new c.aP(T,i.u_translation),u_pitched_scale:new c.aJ(T,i.u_pitched_scale)}),symbolTextAndIcon:(T,i)=>({u_is_size_zoom_constant:new c.aI(T,i.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aI(T,i.u_is_size_feature_constant),u_size_t:new c.aJ(T,i.u_size_t),u_size:new c.aJ(T,i.u_size),u_camera_to_center_distance:new c.aJ(T,i.u_camera_to_center_distance),u_pitch:new c.aJ(T,i.u_pitch),u_rotate_symbol:new c.aI(T,i.u_rotate_symbol),u_aspect_ratio:new c.aJ(T,i.u_aspect_ratio),u_fade_change:new c.aJ(T,i.u_fade_change),u_matrix:new c.aK(T,i.u_matrix),u_label_plane_matrix:new c.aK(T,i.u_label_plane_matrix),u_coord_matrix:new c.aK(T,i.u_coord_matrix),u_is_text:new c.aI(T,i.u_is_text),u_pitch_with_map:new c.aI(T,i.u_pitch_with_map),u_is_along_line:new c.aI(T,i.u_is_along_line),u_is_variable_anchor:new c.aI(T,i.u_is_variable_anchor),u_texsize:new c.aP(T,i.u_texsize),u_texsize_icon:new c.aP(T,i.u_texsize_icon),u_texture:new c.aI(T,i.u_texture),u_texture_icon:new c.aI(T,i.u_texture_icon),u_gamma_scale:new c.aJ(T,i.u_gamma_scale),u_device_pixel_ratio:new c.aJ(T,i.u_device_pixel_ratio),u_is_halo:new c.aI(T,i.u_is_halo),u_translation:new c.aP(T,i.u_translation),u_pitched_scale:new c.aJ(T,i.u_pitched_scale)}),background:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_opacity:new c.aJ(T,i.u_opacity),u_color:new c.aM(T,i.u_color)}),backgroundPattern:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_opacity:new c.aJ(T,i.u_opacity),u_image:new c.aI(T,i.u_image),u_pattern_tl_a:new c.aP(T,i.u_pattern_tl_a),u_pattern_br_a:new c.aP(T,i.u_pattern_br_a),u_pattern_tl_b:new c.aP(T,i.u_pattern_tl_b),u_pattern_br_b:new c.aP(T,i.u_pattern_br_b),u_texsize:new c.aP(T,i.u_texsize),u_mix:new c.aJ(T,i.u_mix),u_pattern_size_a:new c.aP(T,i.u_pattern_size_a),u_pattern_size_b:new c.aP(T,i.u_pattern_size_b),u_scale_a:new c.aJ(T,i.u_scale_a),u_scale_b:new c.aJ(T,i.u_scale_b),u_pixel_coord_upper:new c.aP(T,i.u_pixel_coord_upper),u_pixel_coord_lower:new c.aP(T,i.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aJ(T,i.u_tile_units_to_pixels)}),terrain:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_texture:new c.aI(T,i.u_texture),u_ele_delta:new c.aJ(T,i.u_ele_delta),u_fog_matrix:new c.aK(T,i.u_fog_matrix),u_fog_color:new c.aM(T,i.u_fog_color),u_fog_ground_blend:new c.aJ(T,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aJ(T,i.u_fog_ground_blend_opacity),u_horizon_color:new c.aM(T,i.u_horizon_color),u_horizon_fog_blend:new c.aJ(T,i.u_horizon_fog_blend)}),terrainDepth:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_ele_delta:new c.aJ(T,i.u_ele_delta)}),terrainCoords:(T,i)=>({u_matrix:new c.aK(T,i.u_matrix),u_texture:new c.aI(T,i.u_texture),u_terrain_coords_id:new c.aJ(T,i.u_terrain_coords_id),u_ele_delta:new c.aJ(T,i.u_ele_delta)}),sky:(T,i)=>({u_sky_color:new c.aM(T,i.u_sky_color),u_horizon_color:new c.aM(T,i.u_horizon_color),u_horizon:new c.aJ(T,i.u_horizon),u_sky_horizon_blend:new c.aJ(T,i.u_sky_horizon_blend)})};class nl{constructor(i,h,y){this.context=i;const x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ws{constructor(i,h,y,x){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=i;const E=i.gl;this.buffer=E.createBuffer(),i.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let y=0;y<this.attributes.length;y++){const x=h.attributes[this.attributes[y].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,h,y){for(let x=0;x<this.attributes.length;x++){const E=this.attributes[x],k=h.attributes[E.name];k!==void 0&&i.vertexAttribPointer(k,E.components,i[Fl[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Du=new WeakMap;function za(T){var i;if(Du.has(T))return Du.get(T);{const h=(i=T.getParameter(T.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Du.set(T,h),h}}class ti{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ar extends ti{getDefault(){return c.aN.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Nu extends ti{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class yr extends ti{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class lo extends ti{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ba extends ti{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class qr extends ti{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class zl extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class uo extends ti{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ou extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class ys extends ti{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Bl extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class Fu extends ti{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class us extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class Ec extends ti{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Or extends ti{getDefault(){return c.aN.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Tc extends ti{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Mc extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Ua extends ti{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class qs extends ti{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Cr extends ti{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class or extends ti{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Ls extends ti{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class zu extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Bu extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class il extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ul extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Uu extends ti{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class vs extends ti{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const y=this.gl;za(y)?y.bindVertexArray(i):(h=y.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Vl extends ti{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Rr extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Fr extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class rl extends ti{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class sl extends rl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class al extends rl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ol extends rl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class co{constructor(i,h,y,x,E){this.context=i,this.width=h,this.height=y;const k=i.gl,z=this.framebuffer=k.createFramebuffer();if(this.colorAttachment=new sl(i,z),x)this.depthAttachment=E?new ol(i,z):new al(i,z);else if(E)throw new Error("Stencil cannot be set without depth");if(k.checkFramebufferStatus(k.FRAMEBUFFER)!==k.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&i.deleteRenderbuffer(y)}i.deleteFramebuffer(this.framebuffer)}}class Wi{constructor(i,h,y){this.blendFunction=i,this.blendColor=h,this.mask=y}}Wi.Replace=[1,0],Wi.disabled=new Wi(Wi.Replace,c.aN.transparent,[!1,!1,!1,!1]),Wi.unblended=new Wi(Wi.Replace,c.aN.transparent,[!0,!0,!0,!0]),Wi.alphaBlended=new Wi([1,771],c.aN.transparent,[!0,!0,!0,!0]);class Vu{constructor(i){var h,y;if(this.gl=i,this.clearColor=new ar(this),this.clearDepth=new Nu(this),this.clearStencil=new yr(this),this.colorMask=new lo(this),this.depthMask=new Ba(this),this.stencilMask=new qr(this),this.stencilFunc=new zl(this),this.stencilOp=new uo(this),this.stencilTest=new Ou(this),this.depthRange=new ys(this),this.depthTest=new Bl(this),this.depthFunc=new Fu(this),this.blend=new us(this),this.blendFunc=new Ec(this),this.blendColor=new Or(this),this.blendEquation=new Tc(this),this.cullFace=new Mc(this),this.cullFaceSide=new Ua(this),this.frontFace=new qs(this),this.program=new Cr(this),this.activeTexture=new or(this),this.viewport=new Ls(this),this.bindFramebuffer=new zu(this),this.bindRenderbuffer=new Bu(this),this.bindTexture=new il(this),this.bindVertexBuffer=new Ul(this),this.bindElementBuffer=new Uu(this),this.bindVertexArray=new vs(this),this.pixelStoreUnpack=new Vl(this),this.pixelStoreUnpackPremultiplyAlpha=new Rr(this),this.pixelStoreUnpackFlipY=new Fr(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),za(i)){this.HALF_FLOAT=i.HALF_FLOAT;const x=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:x==null?void 0:x.RGBA16F_EXT,this.RGB16F=(y=i.RGB16F)!==null&&y!==void 0?y:x==null?void 0:x.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const x=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=x==null?void 0:x.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new nl(this,i,h)}createVertexBuffer(i,h,y){return new Ws(this,i,h,y)}createRenderbuffer(i,h,y){const x=this.gl,E=x.createRenderbuffer();return this.bindRenderbuffer.set(E),x.renderbufferStorage(x.RENDERBUFFER,i,h,y),this.bindRenderbuffer.set(null),E}createFramebuffer(i,h,y,x){return new co(this,i,h,y,x)}clear({color:i,depth:h,stencil:y}){const x=this.gl;let E=0;i&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(E|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),x.clear(E)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){c.aF(i.blendFunction,Wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return za(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return za(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class ai{constructor(i,h,y){this.func=i,this.mask=h,this.range=y}}ai.ReadOnly=!1,ai.ReadWrite=!0,ai.disabled=new ai(519,ai.ReadOnly,[0,1]);const ll=7680;class tr{constructor(i,h,y,x,E,k){this.test=i,this.ref=h,this.mask=y,this.fail=x,this.depthFail=E,this.pass=k}}tr.disabled=new tr({func:519,mask:0},0,0,ll,ll,ll);class $i{constructor(i,h,y){this.enable=i,this.mode=h,this.frontFace=y}}let $r;function Gl(T,i,h,y,x){const E=T.context,k=E.gl,z=T.useProgram("collisionBox"),V=[];let H=0,J=0;for(let De=0;De<y.length;De++){const He=y[De],Ae=i.getTile(He).getBucket(h);if(!Ae)continue;const Ke=x?Ae.textCollisionBox:Ae.iconCollisionBox,rt=Ae.collisionCircleArray;if(rt.length>0){const ft=c.H();c.aR(ft,Ae.placementInvProjMatrix,T.transform.glCoordMatrix),c.aR(ft,ft,Ae.placementViewportMatrix),V.push({circleArray:rt,circleOffset:J,transform:He.posMatrix,invTransform:ft,coord:He}),H+=rt.length/4,J=H}Ke&&z.draw(E,k.LINES,ai.disabled,tr.disabled,T.colorModeForRenderPass(),$i.disabled,{u_matrix:He.posMatrix,u_pixel_extrude_scale:[1/(K=T.transform).width,1/K.height]},T.style.map.terrain&&T.style.map.terrain.getTerrainData(He),h.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,T.transform.zoom,null,null,Ke.collisionVertexBuffer)}var K;if(!x||!V.length)return;const ue=T.useProgram("collisionCircle"),ge=new c.aS;ge.resize(4*H),ge._trim();let Ee=0;for(const De of V)for(let He=0;He<De.circleArray.length/4;He++){const Ae=4*He,Ke=De.circleArray[Ae+0],rt=De.circleArray[Ae+1],ft=De.circleArray[Ae+2],kt=De.circleArray[Ae+3];ge.emplace(Ee++,Ke,rt,ft,kt,0),ge.emplace(Ee++,Ke,rt,ft,kt,1),ge.emplace(Ee++,Ke,rt,ft,kt,2),ge.emplace(Ee++,Ke,rt,ft,kt,3)}(!$r||$r.length<2*H)&&($r=function(De){const He=2*De,Ae=new c.aU;Ae.resize(He),Ae._trim();for(let Ke=0;Ke<He;Ke++){const rt=6*Ke;Ae.uint16[rt+0]=4*Ke+0,Ae.uint16[rt+1]=4*Ke+1,Ae.uint16[rt+2]=4*Ke+2,Ae.uint16[rt+3]=4*Ke+2,Ae.uint16[rt+4]=4*Ke+3,Ae.uint16[rt+5]=4*Ke+0}return Ae}(H));const Re=E.createIndexBuffer($r,!0),Ie=E.createVertexBuffer(ge,c.aT.members,!0);for(const De of V){const He=Sc(De.transform,De.invTransform,T.transform);ue.draw(E,k.TRIANGLES,ai.disabled,tr.disabled,T.colorModeForRenderPass(),$i.disabled,He,T.style.map.terrain&&T.style.map.terrain.getTerrainData(De.coord),h.id,Ie,Re,c.a0.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,T.transform.zoom,null,null,null)}Ie.destroy(),Re.destroy()}$i.disabled=new $i(!1,1029,2305),$i.backCCW=new $i(!0,1029,2305);const Va=c.ao(new Float32Array(16));function ul(T,i,h,y,x,E){const{horizontalAlign:k,verticalAlign:z}=c.av(T);return new c.P((-(k-.5)*i/x+y[0])*E,(-(z-.5)*h/x+y[1])*E)}function Po(T,i,h,y,x,E){const k=i.tileAnchorPoint.add(new c.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let z=y.mult(E);return h||(z=z.rotate(-x)),Se(k.add(z),i.labelPlaneMatrix,i.getElevation).point}if(h){const z=_t(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(T),V=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return T.add(y.rotate(V))}return T.add(y)}function Hl(T,i,h,y,x,E,k,z,V,H,J,K,ue,ge){const Ee=T.text.placedSymbolArray,Re=T.text.dynamicLayoutVertexArray,Ie=T.icon.dynamicLayoutVertexArray,De={};Re.clear();for(let He=0;He<Ee.length;He++){const Ae=Ee.get(He),Ke=Ae.hidden||!Ae.crossTileID||T.allowVerticalPlacement&&!Ae.placedOrientation?null:y[Ae.crossTileID];if(Ke){const rt=new c.P(Ae.anchorX,Ae.anchorY),ft={getElevation:ge,width:x.width,height:x.height,labelPlaneMatrix:E,lineVertexArray:null,pitchWithMap:h,projection:J,projectionCache:null,tileAnchorPoint:rt,translation:K,unwrappedTileID:ue},kt=h?Se(rt,k,ge):_t(rt.x,rt.y,ft),Gt=te(x.cameraToCenterDistance,kt.signedDistanceFromCamera);let ln=c.aj(T.textSizeData,V,Ae)*Gt/c.aq;h&&(ln*=T.tilePixelRatio/z);const{width:on,height:Ot,anchor:Kt,textOffset:gn,textBoxScale:$n}=Ke,Qt=ul(Kt,on,Ot,gn,$n,ln),tn=J.getPitchedTextCorrection(x,rt.add(new c.P(K[0],K[1])),ue),Vn=Po(kt.point,ft,i,Qt,x.angle,tn),lr=T.allowVerticalPlacement&&Ae.placedOrientation===c.ai.vertical?Math.PI/2:0;for(let ei=0;ei<Ae.numGlyphs;ei++)c.ak(Re,Vn,lr);H&&Ae.associatedIconIndex>=0&&(De[Ae.associatedIconIndex]={shiftedAnchor:Vn,angle:lr})}else An(Ae.numGlyphs,Re)}if(H){Ie.clear();const He=T.icon.placedSymbolArray;for(let Ae=0;Ae<He.length;Ae++){const Ke=He.get(Ae);if(Ke.hidden)An(Ke.numGlyphs,Ie);else{const rt=De[Ae];if(rt)for(let ft=0;ft<Ke.numGlyphs;ft++)c.ak(Ie,rt.shiftedAnchor,rt.angle);else An(Ke.numGlyphs,Ie)}}T.icon.dynamicLayoutVertexBuffer.updateData(Ie)}T.text.dynamicLayoutVertexBuffer.updateData(Re)}function Gu(T,i,h){return h.iconsInText&&i?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function Ga(T,i,h,y,x,E,k,z,V,H,J,K){const ue=T.context,ge=ue.gl,Ee=T.transform,Re=pi(),Ie=z==="map",De=V==="map",He=z!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ae=Ie&&!De&&!He,Ke=!De&&He,rt=!h.layout.get("symbol-sort-key").isConstant();let ft=!1;const kt=T.depthModeForSublayer(0,ai.ReadOnly),Gt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ln=[],on=Re.getCircleRadiusCorrection(Ee);for(const Ot of y){const Kt=i.getTile(Ot),gn=Kt.getBucket(h);if(!gn)continue;const $n=x?gn.text:gn.icon;if(!$n||!$n.segments.get().length||!$n.hasVisibleVertices)continue;const Qt=$n.programConfigurations.get(h.id),tn=x||gn.sdfIcons,Vn=x?gn.textSizeData:gn.iconSizeData,lr=De||Ee.pitch!==0,ei=T.useProgram(Gu(tn,x,gn),Qt),gi=c.ah(Vn,Ee.zoom),ir=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ot);let Ni,Js,rr,xr,as=[0,0],Xr=null;if(x)Js=Kt.glyphAtlasTexture,rr=ge.LINEAR,Ni=Kt.glyphAtlasTexture.size,gn.iconsInText&&(as=Kt.imageAtlasTexture.size,Xr=Kt.imageAtlasTexture,xr=lr||T.options.rotating||T.options.zooming||Vn.kind==="composite"||Vn.kind==="camera"?ge.LINEAR:ge.NEAREST);else{const pr=h.layout.get("icon-size").constantOr(0)!==1||gn.iconsNeedLinear;Js=Kt.imageAtlasTexture,rr=tn||T.options.rotating||T.options.zooming||pr||lr?ge.LINEAR:ge.NEAREST,Ni=Kt.imageAtlasTexture.size}const Er=kn(Kt,1,T.transform.zoom),da=Ke?Ot.posMatrix:Va,Lr=It(da,De,Ie,T.transform,Er),Jl=Yt(da,De,Ie,T.transform,Er),Ql=Yt(Ot.posMatrix,De,Ie,T.transform,Er),hl=Re.translatePosition(T.transform,Kt,E,k),Lc=Gt&&gn.hasTextData(),Xu=h.layout.get("icon-text-fit")!=="none"&&Lc&&gn.hasIconData();if(He){const pr=T.style.map.terrain?(kc,jr)=>T.style.map.terrain.getElevation(Ot,kc,jr):null,Uo=h.layout.get("text-rotation-alignment")==="map";fe(gn,Ot.posMatrix,T,x,Lr,Ql,De,H,Uo,Re,Ot.toUnwrapped(),Ee.width,Ee.height,hl,pr)}const os=Ot.posMatrix,Ts=x&&Gt||Xu,yo=He||Ts?Va:Lr,eu=Jl,hs=tn&&h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ur;Ur=tn?gn.iconsInText?zi(Vn.kind,gi,Ae,De,He,Ts,T,os,yo,eu,hl,Ni,as,on):ku(Vn.kind,gi,Ae,De,He,Ts,T,os,yo,eu,hl,x,Ni,!0,on):Ol(Vn.kind,gi,Ae,De,He,Ts,T,os,yo,eu,hl,x,Ni,on);const ts={program:ei,buffers:$n,uniformValues:Ur,atlasTexture:Js,atlasTextureIcon:Xr,atlasInterpolation:rr,atlasInterpolationIcon:xr,isSDF:tn,hasHalo:hs};if(rt&&gn.canOverlap){ft=!0;const pr=$n.segments.get();for(const Uo of pr)ln.push({segments:new c.a0([Uo]),sortKey:Uo.sortKey,state:ts,terrainData:ir})}else ln.push({segments:$n.segments,sortKey:0,state:ts,terrainData:ir})}ft&&ln.sort((Ot,Kt)=>Ot.sortKey-Kt.sortKey);for(const Ot of ln){const Kt=Ot.state;if(ue.activeTexture.set(ge.TEXTURE0),Kt.atlasTexture.bind(Kt.atlasInterpolation,ge.CLAMP_TO_EDGE),Kt.atlasTextureIcon&&(ue.activeTexture.set(ge.TEXTURE1),Kt.atlasTextureIcon&&Kt.atlasTextureIcon.bind(Kt.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),Kt.isSDF){const gn=Kt.uniformValues;Kt.hasHalo&&(gn.u_is_halo=1,ho(Kt.buffers,Ot.segments,h,T,Kt.program,kt,J,K,gn,Ot.terrainData)),gn.u_is_halo=0}ho(Kt.buffers,Ot.segments,h,T,Kt.program,kt,J,K,Kt.uniformValues,Ot.terrainData)}}function ho(T,i,h,y,x,E,k,z,V,H){const J=y.context;x.draw(J,J.gl.TRIANGLES,E,k,z,$i.disabled,V,H,h.id,T.layoutVertexBuffer,T.indexBuffer,i,h.paint,y.transform.zoom,T.programConfigurations.get(h.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function xs(T,i,h,y,x){if(!h||!y||!y.imageAtlas)return;const E=y.imageAtlas.patternPositions;let k=E[h.to.toString()],z=E[h.from.toString()];if(!k&&z&&(k=z),!z&&k&&(z=k),!k||!z){const V=x.getPaintProperty(i);k=E[V],z=E[V]}k&&z&&T.setConstantPatternPositions(k,z)}function Ha(T,i,h,y,x,E,k){const z=T.context.gl,V="fill-pattern",H=h.paint.get(V),J=H&&H.constantOr(1),K=h.getCrossfadeParameters();let ue,ge,Ee,Re,Ie;k?(ge=J&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ue=z.LINES):(ge=J?"fillPattern":"fill",ue=z.TRIANGLES);const De=H.constantOr(null);for(const He of y){const Ae=i.getTile(He);if(J&&!Ae.patternsLoaded())continue;const Ke=Ae.getBucket(h);if(!Ke)continue;const rt=Ke.programConfigurations.get(h.id),ft=T.useProgram(ge,rt),kt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(He);J&&(T.context.activeTexture.set(z.TEXTURE0),Ae.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),rt.updatePaintBuffers(K)),xs(rt,V,De,Ae,h);const Gt=kt?He:null,ln=T.translatePosMatrix(Gt?Gt.posMatrix:He.posMatrix,Ae,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(k){Re=Ke.indexBuffer2,Ie=Ke.segments2;const on=[z.drawingBufferWidth,z.drawingBufferHeight];Ee=ge==="fillOutlinePattern"&&J?er(ln,T,K,Ae,on):Dl(ln,on)}else Re=Ke.indexBuffer,Ie=Ke.segments,Ee=J?Ro(ln,T,K,Ae):oo(ln);ft.draw(T.context,ue,x,T.stencilModeForClipping(He),E,$i.disabled,Ee,kt,h.id,Ke.layoutVertexBuffer,Re,Ie,h.paint,T.transform.zoom,rt)}}function Wl(T,i,h,y,x,E,k){const z=T.context,V=z.gl,H="fill-extrusion-pattern",J=h.paint.get(H),K=J.constantOr(1),ue=h.getCrossfadeParameters(),ge=h.paint.get("fill-extrusion-opacity"),Ee=J.constantOr(null);for(const Re of y){const Ie=i.getTile(Re),De=Ie.getBucket(h);if(!De)continue;const He=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Re),Ae=De.programConfigurations.get(h.id),Ke=T.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Ae);K&&(T.context.activeTexture.set(V.TEXTURE0),Ie.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ae.updatePaintBuffers(ue)),xs(Ae,H,Ee,Ie,h);const rt=T.translatePosMatrix(Re.posMatrix,Ie,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ft=h.paint.get("fill-extrusion-vertical-gradient"),kt=K?Jo(rt,T,ft,ge,Re,ue,Ie):aa(rt,T,ft,ge);Ke.draw(z,z.gl.TRIANGLES,x,E,k,$i.backCCW,kt,He,h.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,h.paint,T.transform.zoom,Ae,T.style.map.terrain&&De.centroidVertexBuffer)}}function ql(T,i,h,y,x,E,k){const z=T.context,V=z.gl,H=h.fbo;if(!H)return;const J=T.useProgram("hillshade"),K=T.style.map.terrain&&T.style.map.terrain.getTerrainData(i);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,H.colorAttachment.get()),J.draw(z,V.TRIANGLES,x,E,k,$i.disabled,((ue,ge,Ee,Re)=>{const Ie=Ee.paint.get("hillshade-shadow-color"),De=Ee.paint.get("hillshade-highlight-color"),He=Ee.paint.get("hillshade-accent-color");let Ae=Ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ae-=ue.transform.angle);const Ke=!ue.options.moving;return{u_matrix:Re?Re.posMatrix:ue.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Ke),u_image:0,u_latrange:Hr(0,ge.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),Ae],u_shadow:Ie,u_highlight:De,u_accent:He}})(T,h,y,K?i:null),K,y.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments)}function ua(T,i,h,y,x,E){const k=T.context,z=k.gl,V=i.dem;if(V&&V.data){const H=V.dim,J=V.stride,K=V.getPixels();if(k.activeTexture.set(z.TEXTURE1),k.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||T.getTileTexture(J),i.demTexture){const ge=i.demTexture;ge.update(K,{premultiply:!1}),ge.bind(z.NEAREST,z.CLAMP_TO_EDGE)}else i.demTexture=new Oe(k,K,z.RGBA,{premultiply:!1}),i.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);k.activeTexture.set(z.TEXTURE0);let ue=i.fbo;if(!ue){const ge=new Oe(k,{width:H,height:H,data:null},z.RGBA);ge.bind(z.LINEAR,z.CLAMP_TO_EDGE),ue=i.fbo=k.createFramebuffer(H,H,!0,!1),ue.colorAttachment.set(ge.texture)}k.bindFramebuffer.set(ue.framebuffer),k.viewport.set([0,0,H,H]),T.useProgram("hillshadePrepare").draw(k,z.TRIANGLES,y,x,E,$i.disabled,((ge,Ee)=>{const Re=Ee.stride,Ie=c.H();return c.aQ(Ie,0,c.X,-c.X,0,0,1),c.J(Ie,Ie,[0,-c.X,0]),{u_matrix:Ie,u_image:1,u_dimension:[Re,Re],u_zoom:ge.overscaledZ,u_unpack:Ee.getUnpackVector()}})(i.tileID,V),null,h.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Lo(T,i,h,y,x,E){const k=y.paint.get("raster-fade-duration");if(!E&&k>0){const z=D.now(),V=(z-T.timeAdded)/k,H=i?(z-i.timeAdded)/k:-1,J=h.getSource(),K=x.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),ue=!i||Math.abs(i.tileID.overscaledZ-K)>Math.abs(T.tileID.overscaledZ-K),ge=ue&&T.refreshedUponExpiration?1:c.ad(ue?V:1-H,0,1);return T.refreshedUponExpiration&&V>=1&&(T.refreshedUponExpiration=!1),i?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const $s=new c.aN(1,0,0,1),Ta=new c.aN(0,1,0,1),ko=new c.aN(0,0,1,1),Ac=new c.aN(1,0,1,1),fo=new c.aN(0,1,1,1);function bs(T,i,h,y){po(T,0,i+h/2,T.transform.width,h,y)}function ws(T,i,h,y){po(T,i-h/2,0,h,T.transform.height,y)}function po(T,i,h,y,x,E){const k=T.context,z=k.gl;z.enable(z.SCISSOR_TEST),z.scissor(i*T.pixelRatio,h*T.pixelRatio,y*T.pixelRatio,x*T.pixelRatio),k.clear({color:E}),z.disable(z.SCISSOR_TEST)}function ci(T,i,h){const y=T.context,x=y.gl,E=h.posMatrix,k=T.useProgram("debug"),z=ai.disabled,V=tr.disabled,H=T.colorModeForRenderPass(),J="$debug",K=T.style.map.terrain&&T.style.map.terrain.getTerrainData(h);y.activeTexture.set(x.TEXTURE0);const ue=i.getTileByID(h.key).latestRawTileData,ge=Math.floor((ue&&ue.byteLength||0)/1024),Ee=i.getTile(h).tileSize,Re=512/Math.min(Ee,512)*(h.overscaledZ/T.transform.zoom)*.5;let Ie=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ie+=` => ${h.overscaledZ}`),function(De,He){De.initDebugOverlayCanvas();const Ae=De.debugOverlayCanvas,Ke=De.context.gl,rt=De.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ae.width,Ae.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(He,5,5),rt.strokeText(He,5,5),De.debugOverlayTexture.update(Ae),De.debugOverlayTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE)}(T,`${Ie} ${ge}kB`),k.draw(y,x.TRIANGLES,z,V,Wi.alphaBlended,$i.disabled,oa(E,c.aN.transparent,Re),null,J,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),k.draw(y,x.LINE_STRIP,z,V,H,$i.disabled,oa(E,c.aN.red),K,J,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function cl(T,i,h){const y=T.context,x=y.gl,E=T.colorModeForRenderPass(),k=new ai(x.LEQUAL,ai.ReadWrite,T.depthRangeFor3D),z=T.useProgram("terrain"),V=i.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,T.width,T.height]);for(const H of h){const J=T.renderToTexture.getTexture(H),K=i.getTerrainData(H.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,J.texture);const ue=T.transform.calculatePosMatrix(H.tileID.toUnwrapped()),ge=i.getMeshFrameDelta(T.transform.zoom),Ee=T.transform.calculateFogMatrix(H.tileID.toUnwrapped()),Re=Ru(ue,ge,Ee,T.style.sky,T.transform.pitch);z.draw(y,x.TRIANGLES,k,tr.disabled,E,$i.backCCW,Re,K,"terrain",V.vertexBuffer,V.indexBuffer,V.segments)}}class Hu{constructor(i,h,y){this.vertexBuffer=i,this.indexBuffer=h,this.segments=y}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ss{constructor(i,h){this.context=new Vu(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ao(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Gr}resize(i,h,y){if(this.width=Math.floor(i*y),this.height=Math.floor(h*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const i=this.context,h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(c.X,0),h.emplaceBack(0,c.X),h.emplaceBack(c.X,c.X),this.tileExtentBuffer=i.createVertexBuffer(h,Ir.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aX;y.emplaceBack(0,0),y.emplaceBack(c.X,0),y.emplaceBack(0,c.X),y.emplaceBack(c.X,c.X),this.debugBuffer=i.createVertexBuffer(y,Ir.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const x=new c.$;x.emplaceBack(0,0,0,0),x.emplaceBack(c.X,0,c.X,0),x.emplaceBack(0,c.X,0,c.X),x.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=i.createVertexBuffer(x,dt.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const E=new c.aX;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(E,Ir.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const k=new c.aZ;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(k);const z=new c.aY;z.emplaceBack(0,1,2),z.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(z);const V=this.context.gl;this.stencilClearMode=new tr({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=c.H();c.aQ(y,0,this.width,this.height,0,0,1),c.K(y,y,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,h.TRIANGLES,ai.disabled,this.stencilClearMode,Wi.disabled,$i.disabled,Qr(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source;const y=this.context,x=y.gl;this.nextStencilID+h.length>256&&this.clearStencil(),y.setColorMode(Wi.disabled),y.setDepthMode(ai.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of h){const z=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k);E.draw(y,x.TRIANGLES,ai.disabled,new tr({func:x.ALWAYS,mask:0},z,255,x.KEEP,x.KEEP,x.REPLACE),Wi.disabled,$i.disabled,Qr(k.posMatrix),V,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new tr({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new tr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,y=i.sort((k,z)=>z.overscaledZ-k.overscaledZ),x=y[y.length-1].overscaledZ,E=y[0].overscaledZ-x+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const k={};for(let z=0;z<E;z++)k[z+x]=new tr({func:h.GEQUAL,mask:255},z+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=E,[k,y]}return[{[x]:tr.disabled},y]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Wi([i.CONSTANT_COLOR,i.ONE],new c.aN(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wi.unblended:Wi.alphaBlended}depthModeForSublayer(i,h,y){if(!this.opaquePassEnabledForLayer())return ai.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new ai(y||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){var y;this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(D.now()),this.imageManager.beginFrame();const x=this.style._order,E=this.style.sourceCaches,k={},z={},V={};for(const H in E){const J=E[H];J.used&&J.prepare(this.context),k[H]=J.getVisibleCoordinates(),z[H]=k[H].slice().reverse(),V[H]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<x.length;H++)if(this.style._layers[x[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of x){const J=this.style._layers[H];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const K=z[J.source];(J.type==="custom"||K.length)&&this.renderLayer(this,E[J.source],J,K)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?c.aN.black:c.aN.transparent,depth:1}),this.clearStencil(),!((y=this.style.stylesheet)===null||y===void 0)&&y.sky&&function(H,J){const K=H.context,ue=K.gl,ge=((He,Ae,Ke)=>({u_sky_color:He.properties.get("sky-color"),u_horizon_color:He.properties.get("horizon-color"),u_horizon:(Ae.height/2+Ae.getHorizon())*Ke,u_sky_horizon_blend:He.properties.get("sky-horizon-blend")*Ae.height/2*Ke}))(J,H.style.map.transform,H.pixelRatio),Ee=new ai(ue.LEQUAL,ai.ReadWrite,[0,1]),Re=tr.disabled,Ie=H.colorModeForRenderPass(),De=H.useProgram("sky");if(!J.mesh){const He=new c.aX;He.emplaceBack(-1,-1),He.emplaceBack(1,-1),He.emplaceBack(1,1),He.emplaceBack(-1,1);const Ae=new c.aY;Ae.emplaceBack(0,1,2),Ae.emplaceBack(0,2,3),J.mesh=new Hu(K.createVertexBuffer(He,Ir.members),K.createIndexBuffer(Ae),c.a0.simpleSegment(0,0,He.length,Ae.length))}De.draw(K,ue.TRIANGLES,Ee,Re,Ie,$i.disabled,ge,void 0,"sky",J.mesh.vertexBuffer,J.mesh.indexBuffer,J.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[x[this.currentLayer]],J=E[H.source],K=k[H.source];this._renderTileClippingMasks(H,K),this.renderLayer(this,J,H,K)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const H=this.style._layers[x[this.currentLayer]],J=E[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H))continue;const K=(H.type==="symbol"?V:z)[H.source];this._renderTileClippingMasks(H,k[H.source]),this.renderLayer(this,J,H,K)}if(this.options.showTileBoundaries){const H=function(J,K){let ue=null;const ge=Object.values(J._layers).flatMap(De=>De.source&&!De.isHidden(K)?[J.sourceCaches[De.source]]:[]),Ee=ge.filter(De=>De.getSource().type==="vector"),Re=ge.filter(De=>De.getSource().type!=="vector"),Ie=De=>{(!ue||ue.getSource().maxzoom<De.getSource().maxzoom)&&(ue=De)};return Ee.forEach(De=>Ie(De)),ue||Re.forEach(De=>Ie(De)),ue}(this.style,this.transform.zoom);H&&function(J,K,ue){for(let ge=0;ge<ue.length;ge++)ci(J,K,ue[ge])}(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const J=H.transform.padding;bs(H,H.transform.height-(J.top||0),3,$s),bs(H,J.bottom||0,3,Ta),ws(H,J.left||0,3,ko),ws(H,H.transform.width-(J.right||0),3,Ac);const K=H.transform.centerPoint;(function(ue,ge,Ee,Re){po(ue,ge-1,Ee-10,2,20,Re),po(ue,ge-10,Ee-1,20,2,Re)})(H,K.x,H.transform.height-K.y,fo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,y=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=i?!c.a_(h,y):!c.a$(h,y)),x||(x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),x&&(c.b0(h,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(E,k){const z=E.context,V=z.gl,H=Wi.unblended,J=new ai(V.LEQUAL,ai.ReadWrite,[0,1]),K=k.getTerrainMesh(),ue=k.sourceCache.getRenderableTiles(),ge=E.useProgram("terrainDepth");z.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),z.clear({color:c.aN.transparent,depth:1});for(const Ee of ue){const Re=k.getTerrainData(Ee.tileID),Ie={u_matrix:E.transform.calculatePosMatrix(Ee.tileID.toUnwrapped()),u_ele_delta:k.getMeshFrameDelta(E.transform.zoom)};ge.draw(z,V.TRIANGLES,J,tr.disabled,H,$i.backCCW,Ie,Re,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain),function(E,k){const z=E.context,V=z.gl,H=Wi.unblended,J=new ai(V.LEQUAL,ai.ReadWrite,[0,1]),K=k.getTerrainMesh(),ue=k.getCoordsTexture(),ge=k.sourceCache.getRenderableTiles(),Ee=E.useProgram("terrainCoords");z.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,E.width/devicePixelRatio,E.height/devicePixelRatio]),z.clear({color:c.aN.transparent,depth:1}),k.coordsIndex=[];for(const Re of ge){const Ie=k.getTerrainData(Re.tileID);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ue.texture);const De={u_matrix:E.transform.calculatePosMatrix(Re.tileID.toUnwrapped()),u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(E.transform.zoom)};Ee.draw(z,V.TRIANGLES,J,tr.disabled,H,$i.backCCW,De,Ie,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),k.coordsIndex.push(Re.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,E.width,E.height])}(this,this.style.map.terrain))}renderLayer(i,h,y,x){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(x||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(E,k,z,V,H){if(E.renderPass!=="translucent")return;const J=tr.disabled,K=E.colorModeForRenderPass();(z._unevaluatedLayout.hasValue("text-variable-anchor")||z._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ue,ge,Ee,Re,Ie,De,He,Ae,Ke){const rt=ge.transform,ft=pi(),kt=Ie==="map",Gt=De==="map";for(const ln of ue){const on=Re.getTile(ln),Ot=on.getBucket(Ee);if(!Ot||!Ot.text||!Ot.text.segments.get().length)continue;const Kt=c.ah(Ot.textSizeData,rt.zoom),gn=kn(on,1,ge.transform.zoom),$n=It(ln.posMatrix,Gt,kt,ge.transform,gn),Qt=Ee.layout.get("icon-text-fit")!=="none"&&Ot.hasIconData();if(Kt){const tn=Math.pow(2,rt.zoom-on.tileID.overscaledZ),Vn=ge.style.map.terrain?(ei,gi)=>ge.style.map.terrain.getElevation(ln,ei,gi):null,lr=ft.translatePosition(rt,on,He,Ae);Hl(Ot,kt,Gt,Ke,rt,$n,ln.posMatrix,tn,Kt,Qt,ft,lr,ln.toUnwrapped(),Vn)}}}(V,E,z,k,z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),H),z.paint.get("icon-opacity").constantOr(1)!==0&&Ga(E,k,z,V,!1,z.paint.get("icon-translate"),z.paint.get("icon-translate-anchor"),z.layout.get("icon-rotation-alignment"),z.layout.get("icon-pitch-alignment"),z.layout.get("icon-keep-upright"),J,K),z.paint.get("text-opacity").constantOr(1)!==0&&Ga(E,k,z,V,!0,z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.layout.get("text-keep-upright"),J,K),k.map.showCollisionBoxes&&(Gl(E,k,z,V,!0),Gl(E,k,z,V,!1))})(i,h,y,x,this.style.placement.variableOffsets);break;case"circle":(function(E,k,z,V){if(E.renderPass!=="translucent")return;const H=z.paint.get("circle-opacity"),J=z.paint.get("circle-stroke-width"),K=z.paint.get("circle-stroke-opacity"),ue=!z.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(J.constantOr(1)===0||K.constantOr(1)===0))return;const ge=E.context,Ee=ge.gl,Re=E.depthModeForSublayer(0,ai.ReadOnly),Ie=tr.disabled,De=E.colorModeForRenderPass(),He=[];for(let Ae=0;Ae<V.length;Ae++){const Ke=V[Ae],rt=k.getTile(Ke),ft=rt.getBucket(z);if(!ft)continue;const kt=ft.programConfigurations.get(z.id),Gt=E.useProgram("circle",kt),ln=ft.layoutVertexBuffer,on=ft.indexBuffer,Ot=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Ke),Kt={programConfiguration:kt,program:Gt,layoutVertexBuffer:ln,indexBuffer:on,uniformValues:Sa(E,Ke,rt,z),terrainData:Ot};if(ue){const gn=ft.segments.get();for(const $n of gn)He.push({segments:new c.a0([$n]),sortKey:$n.sortKey,state:Kt})}else He.push({segments:ft.segments,sortKey:0,state:Kt})}ue&&He.sort((Ae,Ke)=>Ae.sortKey-Ke.sortKey);for(const Ae of He){const{programConfiguration:Ke,program:rt,layoutVertexBuffer:ft,indexBuffer:kt,uniformValues:Gt,terrainData:ln}=Ae.state;rt.draw(ge,Ee.TRIANGLES,Re,Ie,De,$i.disabled,Gt,ln,z.id,ft,kt,Ae.segments,z.paint,E.transform.zoom,Ke)}})(i,h,y,x);break;case"heatmap":(function(E,k,z,V){if(z.paint.get("heatmap-opacity")!==0)if(E.renderPass==="offscreen"){const H=E.context,J=H.gl,K=tr.disabled,ue=new Wi([J.ONE,J.ONE],c.aN.transparent,[!0,!0,!0,!0]);(function(ge,Ee,Re){const Ie=ge.gl;ge.activeTexture.set(Ie.TEXTURE1),ge.viewport.set([0,0,Ee.width/4,Ee.height/4]);let De=Re.heatmapFbo;if(De)Ie.bindTexture(Ie.TEXTURE_2D,De.colorAttachment.get()),ge.bindFramebuffer.set(De.framebuffer);else{const He=Ie.createTexture();Ie.bindTexture(Ie.TEXTURE_2D,He),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,Ie.CLAMP_TO_EDGE),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR),Ie.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MAG_FILTER,Ie.LINEAR),De=Re.heatmapFbo=ge.createFramebuffer(Ee.width/4,Ee.height/4,!1,!1),function(Ae,Ke,rt,ft){var kt,Gt;const ln=Ae.gl,on=(kt=Ae.HALF_FLOAT)!==null&&kt!==void 0?kt:ln.UNSIGNED_BYTE,Ot=(Gt=Ae.RGBA16F)!==null&&Gt!==void 0?Gt:ln.RGBA;ln.texImage2D(ln.TEXTURE_2D,0,Ot,Ke.width/4,Ke.height/4,0,ln.RGBA,on,null),ft.colorAttachment.set(rt)}(ge,Ee,He,De)}})(H,E,z),H.clear({color:c.aN.transparent});for(let ge=0;ge<V.length;ge++){const Ee=V[ge];if(k.hasRenderableParent(Ee))continue;const Re=k.getTile(Ee),Ie=Re.getBucket(z);if(!Ie)continue;const De=Ie.programConfigurations.get(z.id),He=E.useProgram("heatmap",De),{zoom:Ae}=E.transform;He.draw(H,J.TRIANGLES,ai.disabled,K,ue,$i.disabled,sr(Ee.posMatrix,Re,Ae,z.paint.get("heatmap-intensity")),null,z.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,z.paint,E.transform.zoom,De)}H.viewport.set([0,0,E.width,E.height])}else E.renderPass==="translucent"&&(E.context.setColorMode(E.colorModeForRenderPass()),function(H,J){const K=H.context,ue=K.gl,ge=J.heatmapFbo;if(!ge)return;K.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,ge.colorAttachment.get()),K.activeTexture.set(ue.TEXTURE1);let Ee=J.colorRampTexture;Ee||(Ee=J.colorRampTexture=new Oe(K,J.colorRamp,ue.RGBA)),Ee.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(K,ue.TRIANGLES,ai.disabled,tr.disabled,H.colorModeForRenderPass(),$i.disabled,((Re,Ie,De,He)=>{const Ae=c.H();c.aQ(Ae,0,Re.width,Re.height,0,0,1);const Ke=Re.context.gl;return{u_matrix:Ae,u_world:[Ke.drawingBufferWidth,Ke.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ie.paint.get("heatmap-opacity")}})(H,J),null,J.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,J.paint,H.transform.zoom)}(E,z))})(i,h,y,x);break;case"line":(function(E,k,z,V){if(E.renderPass!=="translucent")return;const H=z.paint.get("line-opacity"),J=z.paint.get("line-width");if(H.constantOr(1)===0||J.constantOr(1)===0)return;const K=E.depthModeForSublayer(0,ai.ReadOnly),ue=E.colorModeForRenderPass(),ge=z.paint.get("line-dasharray"),Ee=z.paint.get("line-pattern"),Re=Ee.constantOr(1),Ie=z.paint.get("line-gradient"),De=z.getCrossfadeParameters(),He=Re?"linePattern":ge?"lineSDF":Ie?"lineGradient":"line",Ae=E.context,Ke=Ae.gl;let rt=!0;for(const ft of V){const kt=k.getTile(ft);if(Re&&!kt.patternsLoaded())continue;const Gt=kt.getBucket(z);if(!Gt)continue;const ln=Gt.programConfigurations.get(z.id),on=E.context.program.get(),Ot=E.useProgram(He,ln),Kt=rt||Ot.program!==on,gn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ft),$n=Ee.constantOr(null);if($n&&kt.imageAtlas){const Vn=kt.imageAtlas,lr=Vn.patternPositions[$n.to.toString()],ei=Vn.patternPositions[$n.from.toString()];lr&&ei&&ln.setConstantPatternPositions(lr,ei)}const Qt=gn?ft:null,tn=Re?Pu(E,kt,z,De,Qt):ge?el(E,kt,z,ge,De,Qt):Ie?Nl(E,kt,z,Gt.lineClipsArray.length,Qt):Qo(E,kt,z,Qt);if(Re)Ae.activeTexture.set(Ke.TEXTURE0),kt.imageAtlasTexture.bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),ln.updatePaintBuffers(De);else if(ge&&(Kt||E.lineAtlas.dirty))Ae.activeTexture.set(Ke.TEXTURE0),E.lineAtlas.bind(Ae);else if(Ie){const Vn=Gt.gradients[z.id];let lr=Vn.texture;if(z.gradientVersion!==Vn.version){let ei=256;if(z.stepInterpolant){const gi=k.getSource().maxzoom,ir=ft.canonical.z===gi?Math.ceil(1<<E.transform.maxZoom-ft.canonical.z):1;ei=c.ad(c.aV(Gt.maxLineLength/c.X*1024*ir),256,Ae.maxTextureSize)}Vn.gradient=c.aW({expression:z.gradientExpression(),evaluationKey:"lineProgress",resolution:ei,image:Vn.gradient||void 0,clips:Gt.lineClipsArray}),Vn.texture?Vn.texture.update(Vn.gradient):Vn.texture=new Oe(Ae,Vn.gradient,Ke.RGBA),Vn.version=z.gradientVersion,lr=Vn.texture}Ae.activeTexture.set(Ke.TEXTURE0),lr.bind(z.stepInterpolant?Ke.NEAREST:Ke.LINEAR,Ke.CLAMP_TO_EDGE)}Ot.draw(Ae,Ke.TRIANGLES,K,E.stencilModeForClipping(ft),ue,$i.disabled,tn,gn,z.id,Gt.layoutVertexBuffer,Gt.indexBuffer,Gt.segments,z.paint,E.transform.zoom,ln,Gt.layoutVertexBuffer2),rt=!1}})(i,h,y,x);break;case"fill":(function(E,k,z,V){const H=z.paint.get("fill-color"),J=z.paint.get("fill-opacity");if(J.constantOr(1)===0)return;const K=E.colorModeForRenderPass(),ue=z.paint.get("fill-pattern"),ge=E.opaquePassEnabledForLayer()&&!ue.constantOr(1)&&H.constantOr(c.aN.transparent).a===1&&J.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===ge){const Ee=E.depthModeForSublayer(1,E.renderPass==="opaque"?ai.ReadWrite:ai.ReadOnly);Ha(E,k,z,V,Ee,K,!1)}if(E.renderPass==="translucent"&&z.paint.get("fill-antialias")){const Ee=E.depthModeForSublayer(z.getPaintProperty("fill-outline-color")?2:0,ai.ReadOnly);Ha(E,k,z,V,Ee,K,!0)}})(i,h,y,x);break;case"fill-extrusion":(function(E,k,z,V){const H=z.paint.get("fill-extrusion-opacity");if(H!==0&&E.renderPass==="translucent"){const J=new ai(E.context.gl.LEQUAL,ai.ReadWrite,E.depthRangeFor3D);if(H!==1||z.paint.get("fill-extrusion-pattern").constantOr(1))Wl(E,k,z,V,J,tr.disabled,Wi.disabled),Wl(E,k,z,V,J,E.stencilModeFor3D(),E.colorModeForRenderPass());else{const K=E.colorModeForRenderPass();Wl(E,k,z,V,J,tr.disabled,K)}}})(i,h,y,x);break;case"hillshade":(function(E,k,z,V){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const H=E.context,J=E.depthModeForSublayer(0,ai.ReadOnly),K=E.colorModeForRenderPass(),[ue,ge]=E.renderPass==="translucent"?E.stencilConfigForOverlap(V):[{},V];for(const Ee of ge){const Re=k.getTile(Ee);Re.needsHillshadePrepare!==void 0&&Re.needsHillshadePrepare&&E.renderPass==="offscreen"?ua(E,Re,z,J,tr.disabled,K):E.renderPass==="translucent"&&ql(E,Ee,Re,z,J,ue[Ee.overscaledZ],K)}H.viewport.set([0,0,E.width,E.height])})(i,h,y,x);break;case"raster":(function(E,k,z,V){if(E.renderPass!=="translucent"||z.paint.get("raster-opacity")===0||!V.length)return;const H=E.context,J=H.gl,K=k.getSource(),ue=E.useProgram("raster"),ge=E.colorModeForRenderPass(),[Ee,Re]=K instanceof Ut?[{},V]:E.stencilConfigForOverlap(V),Ie=Re[Re.length-1].overscaledZ,De=!E.options.moving;for(const He of Re){const Ae=E.depthModeForSublayer(He.overscaledZ-Ie,z.paint.get("raster-opacity")===1?ai.ReadWrite:ai.ReadOnly,J.LESS),Ke=k.getTile(He);Ke.registerFadeDuration(z.paint.get("raster-fade-duration"));const rt=k.findLoadedParent(He,0),ft=k.findLoadedSibling(He),kt=Lo(Ke,rt||ft||null,k,z,E.transform,E.style.map.terrain);let Gt,ln;const on=z.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR;H.activeTexture.set(J.TEXTURE0),Ke.texture.bind(on,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(J.TEXTURE1),rt?(rt.texture.bind(on,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),Gt=Math.pow(2,rt.tileID.overscaledZ-Ke.tileID.overscaledZ),ln=[Ke.tileID.canonical.x*Gt%1,Ke.tileID.canonical.y*Gt%1]):Ke.texture.bind(on,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const Ot=E.style.map.terrain&&E.style.map.terrain.getTerrainData(He),Kt=Ot?He:null,gn=Kt?Kt.posMatrix:E.transform.calculatePosMatrix(He.toUnwrapped(),De),$n=Ai(gn,ln||[0,0],Gt||1,kt,z);K instanceof Ut?ue.draw(H,J.TRIANGLES,Ae,tr.disabled,ge,$i.disabled,$n,Ot,z.id,K.boundsBuffer,E.quadTriangleIndexBuffer,K.boundsSegments):ue.draw(H,J.TRIANGLES,Ae,Ee[He.overscaledZ],ge,$i.disabled,$n,Ot,z.id,E.rasterBoundsBuffer,E.quadTriangleIndexBuffer,E.rasterBoundsSegments)}})(i,h,y,x);break;case"background":(function(E,k,z,V){const H=z.paint.get("background-color"),J=z.paint.get("background-opacity");if(J===0)return;const K=E.context,ue=K.gl,ge=E.transform,Ee=ge.tileSize,Re=z.paint.get("background-pattern");if(E.isPatternMissing(Re))return;const Ie=!Re&&H.a===1&&J===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==Ie)return;const De=tr.disabled,He=E.depthModeForSublayer(0,Ie==="opaque"?ai.ReadWrite:ai.ReadOnly),Ae=E.colorModeForRenderPass(),Ke=E.useProgram(Re?"backgroundPattern":"background"),rt=V||ge.coveringTiles({tileSize:Ee,terrain:E.style.map.terrain});Re&&(K.activeTexture.set(ue.TEXTURE0),E.imageManager.bind(E.context));const ft=z.getCrossfadeParameters();for(const kt of rt){const Gt=V?kt.posMatrix:E.transform.calculatePosMatrix(kt.toUnwrapped()),ln=Re?Wr(Gt,J,E,Re,{tileID:kt,tileSize:Ee},ft):Di(Gt,J,H),on=E.style.map.terrain&&E.style.map.terrain.getTerrainData(kt);Ke.draw(K,ue.TRIANGLES,He,De,Ae,$i.disabled,ln,on,z.id,E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}})(i,0,y,x);break;case"custom":(function(E,k,z){const V=E.context,H=z.implementation;if(E.renderPass==="offscreen"){const J=H.prerender;J&&(E.setCustomLayerDefaults(),V.setColorMode(E.colorModeForRenderPass()),J.call(H,V.gl,E.transform.customLayerMatrix()),V.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),V.setColorMode(E.colorModeForRenderPass()),V.setStencilMode(tr.disabled);const J=H.renderingMode==="3d"?new ai(E.context.gl.LEQUAL,ai.ReadWrite,E.depthRangeFor3D):E.depthModeForSublayer(0,ai.ReadOnly);V.setDepthMode(J),H.render(V.gl,E.transform.customLayerMatrix(),{farZ:E.transform.farZ,nearZ:E.transform.nearZ,fov:E.transform._fov,modelViewProjectionMatrix:E.transform.modelViewProjectionMatrix,projectionMatrix:E.transform.projectionMatrix}),V.setDirty(),E.setBaseState(),V.bindFramebuffer.set(null)}})(i,0,y)}}translatePosMatrix(i,h,y,x,E){if(!y[0]&&!y[1])return i;const k=E?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(k){const H=Math.sin(k),J=Math.cos(k);y=[y[0]*J-y[1]*H,y[0]*H+y[1]*J]}const z=[E?y[0]:kn(h,y[0],this.transform.zoom),E?y[1]:kn(h,y[1],this.transform.zoom),0],V=new Float32Array(16);return c.J(V,i,z),V}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),y=this.imageManager.getPattern(i.to.toString());return!h||!y}useProgram(i,h){this.cache=this.cache||{};const y=i+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new ao(this.context,Nr[i],h,tl[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Oe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}class es{constructor(i,h){this.points=i,this.planes=h}static fromInvProjectionMatrix(i,h,y){const x=Math.pow(2,y),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const V=1/(z=c.ag([],z,i))[3]/h*x;return c.b1(z,z,[V,V,1/z[3],V])}),k=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const V=function(ue,ge){var Ee=ge[0],Re=ge[1],Ie=ge[2],De=Ee*Ee+Re*Re+Ie*Ie;return De>0&&(De=1/Math.sqrt(De)),ue[0]=ge[0]*De,ue[1]=ge[1]*De,ue[2]=ge[2]*De,ue}([],function(ue,ge,Ee){var Re=ge[0],Ie=ge[1],De=ge[2],He=Ee[0],Ae=Ee[1],Ke=Ee[2];return ue[0]=Ie*Ke-De*Ae,ue[1]=De*He-Re*Ke,ue[2]=Re*Ae-Ie*He,ue}([],Te([],E[z[0]],E[z[1]]),Te([],E[z[2]],E[z[1]]))),H=-((J=V)[0]*(K=E[z[1]])[0]+J[1]*K[1]+J[2]*K[2]);var J,K;return V.concat(H)});return new es(E,k)}}class S{constructor(i,h){this.min=i,this.max=h,this.center=function(y,x,E){return y[0]=.5*x[0],y[1]=.5*x[1],y[2]=.5*x[2],y}([],function(y,x,E){return y[0]=x[0]+E[0],y[1]=x[1]+E[1],y[2]=x[2]+E[2],y}([],this.min,this.max))}quadrant(i){const h=[i%2==0,i<2],y=Le(this.min),x=Le(this.max);for(let E=0;E<h.length;E++)y[E]=h[E]?this.min[E]:this.center[E],x[E]=h[E]?this.center[E]:this.max[E];return x[2]=this.max[2],new S(y,x)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let x=0;x<i.planes.length;x++){const E=i.planes[x];let k=0;for(let z=0;z<h.length;z++)c.b2(E,h[z])>=0&&k++;if(k===0)return 0;k!==h.length&&(y=!1)}if(y)return 2;for(let x=0;x<3;x++){let E=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let z=0;z<i.points.length;z++){const V=i.points[z][x]-this.min[x];E=Math.min(E,V),k=Math.max(k,V)}if(k<0||E>this.max[x]-this.min[x])return 0}return 1}}class s{constructor(i=0,h=0,y=0,x=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=y,this.right=x}interpolate(i,h,y){return h.top!=null&&i.top!=null&&(this.top=c.z.number(i.top,h.top,y)),h.bottom!=null&&i.bottom!=null&&(this.bottom=c.z.number(i.bottom,h.bottom,y)),h.left!=null&&i.left!=null&&(this.left=c.z.number(i.left,h.left,y)),h.right!=null&&i.right!=null&&(this.right=c.z.number(i.right,h.right,y)),this}getCenter(i,h){const y=c.ad((this.left+i-this.right)/2,0,i),x=c.ad((this.top+h-this.bottom)/2,0,h);return new c.P(y,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new s(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const u=85.051129;class f{constructor(i,h,y,x,E){this.tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=x??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new f(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const h=-c.b3(i,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var y=new c.A(4);return c.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,x,E){var k=x[0],z=x[1],V=x[2],H=x[3],J=Math.sin(E),K=Math.cos(E);y[0]=k*K+V*J,y[1]=z*K+H*J,y[2]=k*-J+V*K,y[3]=z*-J+H*K}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=c.ad(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,y){this._unmodified=!1,this._edgeInsets.interpolate(i,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new c.b4(0,i)];if(this._renderWorldCopies){const y=this.pointCoordinate(new c.P(0,0)),x=this.pointCoordinate(new c.P(this.width,0)),E=this.pointCoordinate(new c.P(this.width,this.height)),k=this.pointCoordinate(new c.P(0,this.height)),z=Math.floor(Math.min(y.x,x.x,E.x,k.x)),V=Math.floor(Math.max(y.x,x.x,E.x,k.x)),H=1;for(let J=z-H;J<=V+H;J++)J!==0&&h.push(new c.b4(J,i))}return h}coveringTiles(i){var h,y;let x=this.coveringZoomLevel(i);const E=x;if(i.minzoom!==void 0&&x<i.minzoom)return[];i.maxzoom!==void 0&&x>i.maxzoom&&(x=i.maxzoom);const k=this.pointCoordinate(this.getCameraPoint()),z=c.Z.fromLngLat(this.center),V=Math.pow(2,x),H=[V*k.x,V*k.y,0],J=[V*z.x,V*z.y,0],K=es.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,x);let ue=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ue=x);const ge=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,Ee=Ae=>({aabb:new S([Ae*V,0,0],[(Ae+1)*V,V,0]),zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),Re=[],Ie=[],De=x,He=i.reparseOverscaled?E:x;if(this._renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)Re.push(Ee(-Ae)),Re.push(Ee(Ae));for(Re.push(Ee(0));Re.length>0;){const Ae=Re.pop(),Ke=Ae.x,rt=Ae.y;let ft=Ae.fullyVisible;if(!ft){const Ot=Ae.aabb.intersects(K);if(Ot===0)continue;ft=Ot===2}const kt=i.terrain?H:J,Gt=Ae.aabb.distanceX(kt),ln=Ae.aabb.distanceY(kt),on=Math.max(Math.abs(Gt),Math.abs(ln));if(Ae.zoom===De||on>ge+(1<<De-Ae.zoom)-2&&Ae.zoom>=ue){const Ot=De-Ae.zoom,Kt=H[0]-.5-(Ke<<Ot),gn=H[1]-.5-(rt<<Ot);Ie.push({tileID:new c.S(Ae.zoom===De?He:Ae.zoom,Ae.wrap,Ae.zoom,Ke,rt),distanceSq:We([J[0]-.5-Ke,J[1]-.5-rt]),tileDistanceToCamera:Math.sqrt(Kt*Kt+gn*gn)})}else for(let Ot=0;Ot<4;Ot++){const Kt=(Ke<<1)+Ot%2,gn=(rt<<1)+(Ot>>1),$n=Ae.zoom+1;let Qt=Ae.aabb.quadrant(Ot);if(i.terrain){const tn=new c.S($n,Ae.wrap,$n,Kt,gn),Vn=i.terrain.getMinMaxElevation(tn),lr=(h=Vn.minElevation)!==null&&h!==void 0?h:this.elevation,ei=(y=Vn.maxElevation)!==null&&y!==void 0?y:this.elevation;Qt=new S([Qt.min[0],Qt.min[1],lr],[Qt.max[0],Qt.max[1],ei])}Re.push({aabb:Qt,zoom:$n,x:Kt,y:gn,wrap:Ae.wrap,fullyVisible:ft})}}return Ie.sort((Ae,Ke)=>Ae.distanceSq-Ke.distanceSq).map(Ae=>Ae.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=c.ad(i.lat,-85.051129,u);return new c.P(c.O(i.lng)*this.worldSize,c.Q(h)*this.worldSize)}unproject(i){return new c.Z(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const h=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,x=this.pointLocation(this.centerPoint,i),E=i.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-E))return;const k=y+h-E,z=Math.cos(this._pitch)*this.cameraToCenterDistance/k/c.b5(1,x.lat),V=this.scaleZoom(z/this.tileSize);this._elevation=E,this._center=x,this.zoom=V}setLocationAtPoint(i,h){const y=this.pointCoordinate(h),x=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(i),k=new c.Z(E.x-(y.x-x.x),E.y-(y.y-x.y));this.center=this.coordinateLocation(k),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,h){return h?this.coordinatePoint(this.locationCoordinate(i),h.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,h){return this.coordinateLocation(this.pointCoordinate(i,h))}locationCoordinate(i){return c.Z.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,h){if(h){const ue=h.pointCoordinate(i);if(ue!=null)return ue}const y=[i.x,i.y,0,1],x=[i.x,i.y,1,1];c.ag(y,y,this.pixelMatrixInverse),c.ag(x,x,this.pixelMatrixInverse);const E=y[3],k=x[3],z=y[1]/E,V=x[1]/k,H=y[2]/E,J=x[2]/k,K=H===J?0:(0-H)/(J-H);return new c.Z(c.z.number(y[0]/E,x[0]/k,K)/this.worldSize,c.z.number(z,V,K)/this.worldSize)}coordinatePoint(i,h=0,y=this.pixelMatrix){const x=[i.x*this.worldSize,i.y*this.worldSize,h,1];return c.ag(x,x,y),new c.P(x[0]/x[3],x[1]/x[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new Ze().extend(this.pointLocation(new c.P(0,i))).extend(this.pointLocation(new c.P(this.width,i))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,u])}calculateTileMatrix(i){const h=i.canonical,y=this.worldSize/this.zoomScale(h.z),x=h.x+Math.pow(2,h.z)*i.wrap,E=c.ao(new Float64Array(16));return c.J(E,E,[x*y,h.y*y,0]),c.K(E,E,[y/c.X,y/c.X,1]),E}calculatePosMatrix(i,h=!1){const y=i.key,x=h?this._alignedPosMatrixCache:this._posMatrixCache;if(x[y])return x[y];const E=this.calculateTileMatrix(i);return c.L(E,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,E),x[y]=new Float32Array(E),x[y]}calculateFogMatrix(i){const h=i.key,y=this._fogMatrixCache;if(y[h])return y[h];const x=this.calculateTileMatrix(i);return c.L(x,this.fogMatrix,x),y[h]=new Float32Array(x),y[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,h){h=c.ad(+h,this.minZoom,this.maxZoom);const y={center:new c.N(i.lng,i.lat),zoom:h};let x=this.lngRange;if(!this._renderWorldCopies&&x===null){const Ae=179.9999999999;x=[-Ae,Ae]}const E=this.tileSize*this.zoomScale(y.zoom);let k=0,z=E,V=0,H=E,J=0,K=0;const{x:ue,y:ge}=this.size;if(this.latRange){const Ae=this.latRange;k=c.Q(Ae[1])*E,z=c.Q(Ae[0])*E,z-k<ge&&(J=ge/(z-k))}x&&(V=c.b3(c.O(x[0])*E,0,E),H=c.b3(c.O(x[1])*E,0,E),H<V&&(H+=E),H-V<ue&&(K=ue/(H-V)));const{x:Ee,y:Re}=this.project.call({worldSize:E},i);let Ie,De;const He=Math.max(K||0,J||0);if(He){const Ae=new c.P(K?(H+V)/2:Ee,J?(z+k)/2:Re);return y.center=this.unproject.call({worldSize:E},Ae).wrap(),y.zoom+=this.scaleZoom(He),y}if(this.latRange){const Ae=ge/2;Re-Ae<k&&(De=k+Ae),Re+Ae>z&&(De=z-Ae)}if(x){const Ae=(V+H)/2;let Ke=Ee;this._renderWorldCopies&&(Ke=c.b3(Ee,Ae-E/2,Ae+E/2));const rt=ue/2;Ke-rt<V&&(Ie=V+rt),Ke+rt>H&&(Ie=H-rt)}if(Ie!==void 0||De!==void 0){const Ae=new c.P(Ie??Ee,De??Re);y.center=this.unproject.call({worldSize:E},Ae).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=y,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let x=c.ao(new Float64Array(16));c.K(x,x,[this.width/2,-this.height/2,1]),c.J(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=c.ao(new Float64Array(16)),c.K(x,x,[1,-1,1]),c.J(x,x,[-1,-1,0]),c.K(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x;const E=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),k=Math.min(this.elevation,this.minElevationForCurrentTile),z=E-k*this._pixelPerMeter/Math.cos(this._pitch),V=k<0?z:E,H=Math.PI/2+this._pitch,J=this._fov*(.5+i.y/this.height),K=Math.sin(J)*V/Math.sin(c.ad(Math.PI-H-J,.01,Math.PI-.01)),ue=this.getHorizon(),ge=2*Math.atan(ue/this.cameraToCenterDistance)*(.5+i.y/(2*ue)),Ee=Math.sin(ge)*V/Math.sin(c.ad(Math.PI-H-ge,.01,Math.PI-.01)),Re=Math.min(K,Ee);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Re+V),this.nearZ=this.height/50,x=new Float64Array(16),c.b6(x,this._fov,this.width/this.height,this.nearZ,this.farZ),x[8]=2*-i.x/this.width,x[9]=2*i.y/this.height,this.projectionMatrix=c.af(x),c.K(x,x,[1,-1,1]),c.J(x,x,[0,0,-this.cameraToCenterDistance]),c.b7(x,x,this._pitch),c.ae(x,x,this.angle),c.J(x,x,[-h,-y,0]),this.mercatorMatrix=c.K([],x,[this.worldSize,this.worldSize,this.worldSize]),c.K(x,x,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,x),c.J(x,x,[0,0,-this.elevation]),this.modelViewProjectionMatrix=x,this.invModelViewProjectionMatrix=c.at([],x),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,E,this.farZ),this.fogMatrix[8]=2*-i.x/this.width,this.fogMatrix[9]=2*i.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ae(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-h,-y,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,x);const Ie=this.width%2/2,De=this.height%2/2,He=Math.cos(this.angle),Ae=Math.sin(this.angle),Ke=h-Math.round(h)+He*Ie+Ae*De,rt=y-Math.round(y)+He*De+Ae*Ie,ft=new Float64Array(x);if(c.J(ft,ft,[Ke>.5?Ke-1:Ke,rt>.5?rt-1:rt,0]),this.alignedModelViewProjectionMatrix=ft,x=c.at(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");this.pixelMatrixInverse=x,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new c.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return c.ag(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,i))}getCameraQueryGeometry(i){const h=this.getCameraPoint();if(i.length===1)return[i[0],h];{let y=h.x,x=h.y,E=h.x,k=h.y;for(const z of i)y=Math.min(y,z.x),x=Math.min(x,z.y),E=Math.max(E,z.x),k=Math.max(k,z.y);return[new c.P(y,x),new c.P(E,x),new c.P(E,k),new c.P(y,k),new c.P(y,x)]}}lngLatToCameraDepth(i,h){const y=this.locationCoordinate(i),x=[y.x*this.worldSize,y.y*this.worldSize,h,1];return c.ag(x,x,this.modelViewProjectionMatrix),x[2]/x[3]}}function v(T,i){let h,y=!1,x=null,E=null;const k=()=>{x=null,y&&(T.apply(E,h),x=setTimeout(k,i),y=!1)};return(...z)=>(y=!0,E=this,h=z,x||k(),x)}class C{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let y;return h.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(y=x)}),(y&&y[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const y=h.join("/");let x=y;x.split("&").length>0&&(x=x.split("&")[0]),this._hashName&&(x=`${this._hashName}=${y}`);let E=window.location.hash.replace(x,"");E.startsWith("#&")?E=E.slice(0,1)+E.slice(2):E==="#"&&(E="");let k=window.location.href.replace(/(#.+)?$/,E);k=k.replace("&&","&"),window.history.replaceState(window.history.state,null,k)},this._updateHash=v(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,x=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,x),k=Math.round(h.lng*E)/E,z=Math.round(h.lat*E)/E,V=this._map.getBearing(),H=this._map.getPitch();let J="";if(J+=i?`/${k}/${z}/${y}`:`${y}/${z}/${k}`,(V||H)&&(J+="/"+Math.round(10*V)/10),H&&(J+=`/${Math.round(H)}`),this._hashName){const K=this._hashName;let ue=!1;const ge=window.location.hash.slice(1).split("&").map(Ee=>{const Re=Ee.split("=")[0];return Re===K?(ue=!0,`${Re}=${J}`):Ee}).filter(Ee=>Ee);return ue||ge.push(`${K}=${J}`),`#${ge.join("&")}`}return`#${J}`}}const B={linearity:.3,easing:c.b8(0,0,.3,1)},j=c.e({deceleration:2500,maxSpeed:1400},B),Q=c.e({deceleration:20,maxSpeed:1400},B),xe=c.e({deceleration:1e3,maxSpeed:360},B),Ue=c.e({deceleration:1e3,maxSpeed:90},B);class je{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:D.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=D.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)h.zoom+=E.zoomDelta||0,h.bearing+=E.bearingDelta||0,h.pitch+=E.pitchDelta||0,E.panDelta&&h.pan._add(E.panDelta),E.around&&(h.around=E.around),E.pinchAround&&(h.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const E=Zt(h.pan.mag(),y,c.e({},j,i||{}));x.offset=h.pan.mult(E.amount/h.pan.mag()),x.center=this._map.transform.center,Et(x,E)}if(h.zoom){const E=Zt(h.zoom,y,Q);x.zoom=this._map.transform.zoom+E.amount,Et(x,E)}if(h.bearing){const E=Zt(h.bearing,y,xe);x.bearing=this._map.transform.bearing+c.ad(E.amount,-179,179),Et(x,E)}if(h.pitch){const E=Zt(h.pitch,y,Ue);x.pitch=this._map.transform.pitch+E.amount,Et(x,E)}if(x.zoom||x.bearing){const E=h.pinchAround===void 0?h.around:h.pinchAround;x.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),c.e(x,{noMoveStart:!0})}}function Et(T,i){(!T.duration||T.duration<i.duration)&&(T.duration=i.duration,T.easing=i.easing)}function Zt(T,i,h){const{maxSpeed:y,linearity:x,deceleration:E}=h,k=c.ad(T*x/(i/1e3),-y,y),z=Math.abs(k)/(E*x);return{easing:h.easing,duration:1e3*z,amount:k*(z/2)}}class Nt extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,y,x={}){const E=N.mousePos(h.getCanvas(),y),k=h.unproject(E);super(i,c.e({point:E,lngLat:k,originalEvent:y},x)),this._defaultPrevented=!1,this.target=h}}class Rn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,y){const x=i==="touchend"?y.changedTouches:y.touches,E=N.touchPos(h.getCanvasContainer(),x),k=E.map(V=>h.unproject(V)),z=E.reduce((V,H,J,K)=>V.add(H.div(K.length)),new c.P(0,0));super(i,{points:E,point:z,lngLats:k,lngLat:h.unproject(z),originalEvent:y}),this._defaultPrevented=!1}}class Nn extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,y){super(i,{originalEvent:y}),this._defaultPrevented=!1}}class fn{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Nn(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new Nt(i.type,this._map,i))}mouseup(i){this._map.fire(new Nt(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Nt(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Nt(i.type,this._map,i))}mouseover(i){this._map.fire(new Nt(i.type,this._map,i))}mouseout(i){this._map.fire(new Nt(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Rn(i.type,this._map,i))}touchmove(i){this._map.fire(new Rn(i.type,this._map,i))}touchend(i){this._map.fire(new Rn(i.type,this._map,i))}touchcancel(i){this._map.fire(new Rn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ii{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Nt(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nt("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Nt(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bi{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(c.P.convert(i),this._map.terrain)}}class vr{constructor(i,h){this._map=i,this._tr=new Bi(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(N.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const y=h;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=y,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const E=Math.min(x.x,y.x),k=Math.max(x.x,y.x),z=Math.min(x.y,y.y),V=Math.max(x.y,y.y);N.setTransform(this._box,`translate(${E}px,${z}px)`),this._box.style.width=k-E+"px",this._box.style.height=V-z+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const y=this._startPos,x=h;if(this.reset(),N.suppressClick(),y.x!==x.x||y.y!==x.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:i})),{cameraAnimation:E=>E.fitScreenCoordinates(y,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new c.k(i,{originalEvent:h}))}}function zr(T,i){if(T.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${i.length}`);const h={};for(let y=0;y<T.length;y++)h[T[y].identifier]=i[y];return h}class Es{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),y.length===this.numTouches&&(this.centroid=function(x){const E=new c.P(0,0);for(const k of x)E._add(k);return E.div(x.length)}(h),this.touches=zr(y,h)))}touchmove(i,h,y){if(this.aborted||!this.centroid)return;const x=zr(y,h);for(const E in this.touches){const k=x[E];(!k||k.dist(this.touches[E])>30)&&(this.aborted=!0)}}touchend(i,h,y){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Xs{constructor(i){this.singleTap=new Es(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,y){this.singleTap.touchstart(i,h,y)}touchmove(i,h,y){this.singleTap.touchmove(i,h,y)}touchend(i,h,y){const x=this.singleTap.touchend(i,h,y);if(x){const E=i.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(x)<30;if(E&&k||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class js{constructor(i){this._tr=new Bi(i),this._zoomIn=new Xs({numTouches:1,numTaps:2}),this._zoomOut=new Xs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,y){this._zoomIn.touchstart(i,h,y),this._zoomOut.touchstart(i,h,y)}touchmove(i,h,y){this._zoomIn.touchmove(i,h,y),this._zoomOut.touchmove(i,h,y)}touchend(i,h,y){const x=this._zoomIn.touchend(i,h,y),E=this._zoomOut.touchend(i,h,y),k=this._tr;return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:k.zoom+1,around:k.unproject(x)},{originalEvent:i})}):E?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:k.zoom-1,around:k.unproject(E)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mi{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const x=h.length?h[0]:h;return!this._moved&&x.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(y,x))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&N.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const cs={0:1,2:2};class Sr{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=N.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,y){const x=cs[y];return h.buttons===void 0||(h.buttons&x)!==x}(i,this._eventButton)}isValidEndEvent(i){return N.mouseButton(i)===this._eventButton}}class Wa{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const mo=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=i=>{i.preventDefault()}},Do=({enable:T,clickTolerance:i,bearingDegreesPerPixelMoved:h=.8})=>{const y=new Sr({checkCorrectEvent:x=>N.mouseButton(x)===0&&x.ctrlKey||N.mouseButton(x)===2});return new mi({clickTolerance:i,move:(x,E)=>({bearingDelta:(E.x-x.x)*h}),moveStateManager:y,enable:T,assignEvents:mo})},ks=({enable:T,clickTolerance:i,pitchDegreesPerPixelMoved:h=-.5})=>{const y=new Sr({checkCorrectEvent:x=>N.mouseButton(x)===0&&x.ctrlKey||N.mouseButton(x)===2});return new mi({clickTolerance:i,move:(x,E)=>({pitchDelta:(E.y-x.y)*h}),moveStateManager:y,enable:T,assignEvents:mo})};class $l{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(i,h,y){return this._calculateTransform(i,h,y)}touchmove(i,h,y){if(this._active&&!(y.length<this.minTouchs()))return i.preventDefault(),this._calculateTransform(i,h,y)}touchend(i,h,y){this._calculateTransform(i,h,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,y){y.length>0&&(this._active=!0);const x=zr(y,h),E=new c.P(0,0),k=new c.P(0,0);let z=0;for(const H in x){const J=x[H],K=this._touches[H];K&&(E._add(J),k._add(J.sub(K)),z++,x[H]=J)}if(this._touches=x,z<this.minTouchs()||!k.mag())return;const V=k.div(z);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(z),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,y){if(!this._firstTwoTouches)return;i.preventDefault();const[x,E]=this._firstTwoTouches,k=Ma(y,h,x),z=Ma(y,h,E);if(!k||!z)return;const V=this._aroundCenter?null:k.add(z).div(2);return this._move([k,z],V,i)}touchend(i,h,y){if(!this._firstTwoTouches)return;const[x,E]=this._firstTwoTouches,k=Ma(y,h,x),z=Ma(y,h,E);k&&z||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ma(T,i,h){for(let y=0;y<T.length;y++)if(T[y].identifier===h)return i[y]}function Xl(T,i){return Math.log(T/i)/Math.LN2}class Sh extends go{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const y=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Xl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xl(this._distance,y),pinchAround:h}}}function Eh(T,i){return 180*T.angleWith(i)/Math.PI}class Th extends go{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,y){const x=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Eh(this._vector,x),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,y=Eh(i,this._startVector);return Math.abs(y)<h}}function ca(T){return Math.abs(T.y)>Math.abs(T.x)}class jl extends go{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,y){super.touchstart(i,h,y),this._currentTouchCount=y.length}_start(i){this._lastPoints=i,ca(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=i[0].sub(this._lastPoints[0]),E=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,E,y.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(x.y+E.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,y){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,E=h.mag()>=2;if(!x&&!E)return;if(!x||!E)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const k=i.y>0==h.y>0;return ca(i)&&ca(h)&&k}}const Ic={panStep:100,bearingStep:15,pitchStep:10};class Mh{constructor(i){this._tr=new Bi(i);const h=Ic;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,y=0,x=0,E=0,k=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?y=-1:(i.preventDefault(),E=-1);break;case 39:i.shiftKey?y=1:(i.preventDefault(),E=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),k=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(y=0,x=0),{cameraAnimation:z=>{const V=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:Ah,zoom:h?Math.round(V.zoom)+h*(i.shiftKey?2:1):V.zoom,bearing:V.bearing+y*this._bearingStep,pitch:V.pitch+x*this._pitchStep,offset:[-E*this._panStep,-k*this._panStep],center:V.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ah(T){return T*(2-T)}const Ih=4.000244140625;class Ch{constructor(i,h){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=i,this._tr=new Bi(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled()||this._map.cooperativeGestures.shouldPreventWheelEvent(i))return;let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const y=D.now(),x=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%Ih==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=N.mousePos(this._map.getCanvas(),i),y=this._tr;this._around=h.y>y.transform.height/2-y.transform.getHorizon()?c.N.convert(this._aroundCenter?y.center:y.unproject(h)):c.N.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>Ih?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&H!==0&&(H=1/H);const J=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(J*H))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,y=this._startZoom,x=this._easing;let E,k=!1;const z=D.now()-this._lastWheelEventTime;if(this._type==="wheel"&&y&&x&&z){const V=Math.min(z/200,1),H=x(V);E=c.z.number(y,h,H),V<1?this._frameId||(this._frameId=!0):k=!0}else E=h,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:E-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=c.b9;if(this._prevEase){const y=this._prevEase,x=(D.now()-y.start)/y.duration,E=y.easing(x+.01)-y.easing(x),k=.27/Math.sqrt(E*E+1e-4)*.01,z=Math.sqrt(.0729-k*k);h=c.b8(k,z,.25,1)}return this._prevEase={start:D.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pr{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Br{constructor(i){this._tr=new Bi(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sf{constructor(){this._tap=new Xs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,y){if(!this._swipePoint)if(this._tapTime){const x=h[0],E=i.timeStamp-this._tapTime<500,k=this._tapPoint.dist(x)<30;E&&k?y.length>0&&(this._swipePoint=x,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(i,h,y)}touchmove(i,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const x=h[0],E=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(i,h,y)}touchend(i,h,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const x=this._tap.touchend(i,h,y);x&&(this._tapTime=i.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(i,h,y){this._el=i,this._mousePan=h,this._touchPan=y}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fa{constructor(i,h,y){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rh{constructor(i,h,y,x){this._el=i,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zs{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=h,this._container.appendChild(x);const E=document.createElement("div");E.className="maplibregl-mobile-message",E.textContent=y,this._container.appendChild(E),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(i){this._onCooperativeGesture(i.touches.length===1)}wheel(i){if(!this._map.scrollZoom.isEnabled())return;const h=this.shouldPreventWheelEvent(i);this._onCooperativeGesture(h)}shouldPreventWheelEvent(i){return!!this.isEnabled()&&!(i[this._bypassKey]||i.ctrlKey)}_onCooperativeGesture(i){this._enabled&&i&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ys=T=>T.zoom||T.drag||T.pitch||T.rotate;class Ph extends c.k{}function No(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta}class Wu{constructor(i,h){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,E)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const k=x.type==="renderFrame"?void 0:x,z={needsRenderFrame:!1},V={},H={},J=x.touches,K=J?this._getMapTouches(J):void 0,ue=K?N.touchPos(this._map.getCanvas(),K):N.mousePos(this._map.getCanvas(),x);for(const{handlerName:Re,handler:Ie,allowed:De}of this._handlers){if(!Ie.isEnabled())continue;let He;this._blockedByActive(H,De,Re)?Ie.reset():Ie[E||x.type]&&(He=Ie[E||x.type](x,ue,K),this.mergeHandlerResult(z,V,He,Re,k),He&&He.needsRenderFrame&&this._triggerRenderFrame()),(He||Ie.isActive())&&(H[Re]=Ie)}const ge={};for(const Re in this._previousActiveHandlers)H[Re]||(ge[Re]=k);this._previousActiveHandlers=H,(Object.keys(ge).length||No(z))&&(this._changes.push([z,V,ge]),this._triggerRenderFrame()),(Object.keys(H).length||No(z))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ee}=z;Ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ee(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new je(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,E,k]of this._listeners)N.addEventListener(x,E,x===document?this.handleWindowEvent:this.handleEvent,k)}destroy(){for(const[i,h,y]of this._listeners)N.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(i){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new fn(h,i));const x=h.boxZoom=new vr(h,i);this._add("boxZoom",x),i.interactive&&i.boxZoom&&x.enable();const E=h.cooperativeGestures=new Zs(h,i.cooperativeGestures);this._add("cooperativeGestures",E),i.cooperativeGestures&&E.enable();const k=new js(h),z=new Br(h);h.doubleClickZoom=new Pr(z,k),this._add("tapZoom",k),this._add("clickZoom",z),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const V=new Sf;this._add("tapDragZoom",V);const H=h.touchPitch=new jl(h);this._add("touchPitch",H),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const J=Do(i),K=ks(i);h.dragRotate=new fa(i,J,K),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",K,["mouseRotate"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const ue=(({enable:He,clickTolerance:Ae})=>{const Ke=new Sr({checkCorrectEvent:rt=>N.mouseButton(rt)===0&&!rt.ctrlKey});return new mi({clickTolerance:Ae,move:(rt,ft)=>({around:ft,panDelta:ft.sub(rt)}),activateOnStart:!0,moveStateManager:Ke,enable:He,assignEvents:mo})})(i),ge=new $l(i,h);h.dragPan=new ha(y,ue,ge),this._add("mousePan",ue),this._add("touchPan",ge,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const Ee=new Th,Re=new Sh;h.touchZoomRotate=new Rh(y,Re,Ee,V),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const Ie=h.scrollZoom=new Ch(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Ie,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const De=h.keyboard=new Mh(h);this._add("keyboard",De),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Ii(h))}_add(i,h,y){this._handlers.push({handlerName:i,handler:h,allowed:y}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ys(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,y){for(const x in i)if(x!==y&&(!h||h.indexOf(x)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const y of i)this._el.contains(y.target)&&h.push(y);return h}mergeHandlerResult(i,h,y,x,E){if(!y)return;c.e(i,y);const k={handlerName:x,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(h.zoom=k),y.panDelta!==void 0&&(h.drag=k),y.pitchDelta!==void 0&&(h.pitch=k),y.bearingDelta!==void 0&&(h.rotate=k)}_applyChanges(){const i={},h={},y={};for(const[x,E,k]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new c.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),c.e(h,E),c.e(y,k);this._updateMapTransform(i,h,y),this._changes=[]}_updateMapTransform(i,h,y){const x=this._map,E=x._getTransformForUpdate(),k=x.terrain;if(!(No(i)||k&&this._terrainMovement))return this._fireEvents(h,y,!0);let{panDelta:z,zoomDelta:V,bearingDelta:H,pitchDelta:J,around:K,pinchAround:ue}=i;ue!==void 0&&(K=ue),x._stop(!0),K=K||x.transform.centerPoint;const ge=E.pointLocation(z?K.sub(z):K);H&&(E.bearing+=H),J&&(E.pitch+=J),V&&(E.zoom+=V),k?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?E.center=E.pointLocation(E.centerPoint.sub(z)):E.setLocationAtPoint(ge,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,E.setLocationAtPoint(ge,K)):E.setLocationAtPoint(ge,K),x._applyUpdatedTransform(E),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,y,!0)}_fireEvents(i,h,y){const x=Ys(this._eventsInProgress),E=Ys(i),k={};for(const K in i){const{originalEvent:ue}=i[K];this._eventsInProgress[K]||(k[`${K}start`]=ue),this._eventsInProgress[K]=i[K]}!x&&E&&this._fireEvent("movestart",E.originalEvent);for(const K in k)this._fireEvent(K,k[K]);E&&this._fireEvent("move",E.originalEvent);for(const K in i){const{originalEvent:ue}=i[K];this._fireEvent(K,ue)}const z={};let V;for(const K in this._eventsInProgress){const{handlerName:ue,originalEvent:ge}=this._eventsInProgress[K];this._handlersById[ue].isActive()||(delete this._eventsInProgress[K],V=h[ue]||ge,z[`${K}end`]=V)}for(const K in z)this._fireEvent(K,z[K]);const H=Ys(this._eventsInProgress),J=(x||E)&&!H;if(J&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const K=this._map._getTransformForUpdate();K.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(K)}if(y&&J){this._updatingCamera=!0;const K=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ue=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!K||!K.essential&&D.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:V})),ue(this._map.getBearing())&&this._map.resetNorth()):(ue(K.bearing||this._map.getBearing())&&(K.bearing=0),K.freezeElevation=!0,this._map.easeTo(K,{originalEvent:V})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new c.k(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Ph("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qu extends c.E{constructor(i,h){super(),this._renderFrameCallback=()=>{const y=Math.min((D.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,y){return i=c.P.convert(i).mult(-1),this.panTo(this.transform.center,c.e({offset:i},h),y)}panTo(i,h,y){return this.easeTo(c.e({center:i},h),y)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,y){return this.easeTo(c.e({zoom:i},h),y)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,y){return this.easeTo(c.e({bearing:i},h),y)}resetNorth(i,h){return this.rotateTo(0,c.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=Ze.convert(i);const y=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),y,h)}_cameraForBoxAndBearing(i,h,y,x){const E={top:0,bottom:0,right:0,left:0};if(typeof(x=c.e({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Ot=x.padding;x.padding={top:Ot,bottom:Ot,right:Ot,left:Ot}}x.padding=c.e(E,x.padding);const k=this.transform,z=k.padding,V=new Ze(i,h),H=k.project(V.getNorthWest()),J=k.project(V.getNorthEast()),K=k.project(V.getSouthEast()),ue=k.project(V.getSouthWest()),ge=c.ba(-y),Ee=H.rotate(ge),Re=J.rotate(ge),Ie=K.rotate(ge),De=ue.rotate(ge),He=new c.P(Math.max(Ee.x,Re.x,De.x,Ie.x),Math.max(Ee.y,Re.y,De.y,Ie.y)),Ae=new c.P(Math.min(Ee.x,Re.x,De.x,Ie.x),Math.min(Ee.y,Re.y,De.y,Ie.y)),Ke=He.sub(Ae),rt=(k.width-(z.left+z.right+x.padding.left+x.padding.right))/Ke.x,ft=(k.height-(z.top+z.bottom+x.padding.top+x.padding.bottom))/Ke.y;if(ft<0||rt<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const kt=Math.min(k.scaleZoom(k.scale*Math.min(rt,ft)),x.maxZoom),Gt=c.P.convert(x.offset),ln=new c.P((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(c.ba(y)),on=Gt.add(ln).mult(k.scale/k.zoomScale(kt));return{center:k.unproject(H.add(K).div(2).sub(on)),zoom:kt,bearing:y}}fitBounds(i,h,y){return this._fitInternal(this.cameraForBounds(i,h),h,y)}fitScreenCoordinates(i,h,y,x,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(i)),this.transform.pointLocation(c.P.convert(h)),y,x),x,E)}_fitInternal(i,h,y){return i?(delete(h=c.e(i,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(i,h){this.stop();const y=this._getTransformForUpdate();let x=!1,E=!1,k=!1;return"zoom"in i&&y.zoom!==+i.zoom&&(x=!0,y.zoom=+i.zoom),i.center!==void 0&&(y.center=c.N.convert(i.center)),"bearing"in i&&y.bearing!==+i.bearing&&(E=!0,y.bearing=+i.bearing),"pitch"in i&&y.pitch!==+i.pitch&&(k=!0,y.pitch=+i.pitch),i.padding==null||y.isPaddingEqual(i.padding)||(y.padding=i.padding),this._applyUpdatedTransform(y),this.fire(new c.k("movestart",h)).fire(new c.k("move",h)),x&&this.fire(new c.k("zoomstart",h)).fire(new c.k("zoom",h)).fire(new c.k("zoomend",h)),E&&this.fire(new c.k("rotatestart",h)).fire(new c.k("rotate",h)).fire(new c.k("rotateend",h)),k&&this.fire(new c.k("pitchstart",h)).fire(new c.k("pitch",h)).fire(new c.k("pitchend",h)),this.fire(new c.k("moveend",h))}calculateCameraOptionsFromTo(i,h,y,x=0){const E=c.Z.fromLngLat(i,h),k=c.Z.fromLngLat(y,x),z=k.x-E.x,V=k.y-E.y,H=k.z-E.z,J=Math.hypot(z,V,H);if(J===0)throw new Error("Can't calculate camera options with same From and To");const K=Math.hypot(z,V),ue=this.transform.scaleZoom(this.transform.cameraToCenterDistance/J/this.transform.tileSize),ge=180*Math.atan2(z,-V)/Math.PI;let Ee=180*Math.acos(K/J)/Math.PI;return Ee=H<0?90-Ee:90+Ee,{center:k.toLngLat(),zoom:ue,pitch:Ee,bearing:ge}}easeTo(i,h){var y;this._stop(!1,i.easeId),((i=c.e({offset:[0,0],duration:500,easing:c.b9},i)).animate===!1||!i.essential&&D.prefersReducedMotion)&&(i.duration=0);const x=this._getTransformForUpdate(),E=this.getZoom(),k=this.getBearing(),z=this.getPitch(),V=this.getPadding(),H="bearing"in i?this._normalizeBearing(i.bearing,k):k,J="pitch"in i?+i.pitch:z,K="padding"in i?i.padding:x.padding,ue=c.P.convert(i.offset);let ge=x.centerPoint.add(ue);const Ee=x.pointLocation(ge),{center:Re,zoom:Ie}=x.getConstrained(c.N.convert(i.center||Ee),(y=i.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(Re);const De=x.project(Ee),He=x.project(Re).sub(De),Ae=x.zoomScale(Ie-E);let Ke,rt;i.around&&(Ke=c.N.convert(i.around),rt=x.locationPoint(Ke));const ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ie!==E,this._rotating=this._rotating||k!==H,this._pitching=this._pitching||J!==z,this._padding=!x.isPaddingEqual(K),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,ft),this.terrain&&this._prepareElevation(Re),this._ease(kt=>{if(this._zooming&&(x.zoom=c.z.number(E,Ie,kt)),this._rotating&&(x.bearing=c.z.number(k,H,kt)),this._pitching&&(x.pitch=c.z.number(z,J,kt)),this._padding&&(x.interpolatePadding(V,K,kt),ge=x.centerPoint.add(ue)),this.terrain&&!i.freezeElevation&&this._updateElevation(kt),Ke)x.setLocationAtPoint(Ke,rt);else{const Gt=x.zoomScale(x.zoom-E),ln=Ie>E?Math.min(2,Ae):Math.max(.5,Ae),on=Math.pow(ln,1-kt),Ot=x.unproject(De.add(He.mult(kt*on)).mult(Gt));x.setLocationAtPoint(x.renderWorldCopies?Ot.wrap():Ot,ge)}this._applyUpdatedTransform(x),this._fireMoveEvents(h)},kt=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,kt)},i),this}_prepareEase(i,h,y={}){this._moving=!0,h||y.moving||this.fire(new c.k("movestart",i)),this._zooming&&!y.zooming&&this.fire(new c.k("zoomstart",i)),this._rotating&&!y.rotating&&this.fire(new c.k("rotatestart",i)),this._pitching&&!y.pitching&&this.fire(new c.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(y-(h-(y*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.elevation=c.z.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const h=i.clone(),{center:y,zoom:x,pitch:E,bearing:k,elevation:z}=this.transformCameraUpdate(h);y&&(h.center=y),x!==void 0&&(h.zoom=x),E!==void 0&&(h.pitch=E),k!==void 0&&(h.bearing=k),z!==void 0&&(h.elevation=z),this.transform.apply(h)}_fireMoveEvents(i){this.fire(new c.k("move",i)),this._zooming&&this.fire(new c.k("zoom",i)),this._rotating&&this.fire(new c.k("rotate",i)),this._pitching&&this.fire(new c.k("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const y=this._zooming,x=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new c.k("zoomend",i)),x&&this.fire(new c.k("rotateend",i)),E&&this.fire(new c.k("pitchend",i)),this.fire(new c.k("moveend",i))}flyTo(i,h){var y;if(!i.essential&&D.prefersReducedMotion){const tn=c.M(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tn,h)}this.stop(),i=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},i);const x=this._getTransformForUpdate(),E=this.getZoom(),k=this.getBearing(),z=this.getPitch(),V=this.getPadding(),H="bearing"in i?this._normalizeBearing(i.bearing,k):k,J="pitch"in i?+i.pitch:z,K="padding"in i?i.padding:x.padding,ue=c.P.convert(i.offset);let ge=x.centerPoint.add(ue);const Ee=x.pointLocation(ge),{center:Re,zoom:Ie}=x.getConstrained(c.N.convert(i.center||Ee),(y=i.zoom)!==null&&y!==void 0?y:E);this._normalizeCenter(Re);const De=x.zoomScale(Ie-E),He=x.project(Ee),Ae=x.project(Re).sub(He);let Ke=i.curve;const rt=Math.max(x.width,x.height),ft=rt/De,kt=Ae.mag();if("minZoom"in i){const tn=c.ad(Math.min(i.minZoom,E,Ie),x.minZoom,x.maxZoom),Vn=rt/x.zoomScale(tn-E);Ke=Math.sqrt(Vn/kt*2)}const Gt=Ke*Ke;function ln(tn){const Vn=(ft*ft-rt*rt+(tn?-1:1)*Gt*Gt*kt*kt)/(2*(tn?ft:rt)*Gt*kt);return Math.log(Math.sqrt(Vn*Vn+1)-Vn)}function on(tn){return(Math.exp(tn)-Math.exp(-tn))/2}function Ot(tn){return(Math.exp(tn)+Math.exp(-tn))/2}const Kt=ln(!1);let gn=function(tn){return Ot(Kt)/Ot(Kt+Ke*tn)},$n=function(tn){return rt*((Ot(Kt)*(on(Vn=Kt+Ke*tn)/Ot(Vn))-on(Kt))/Gt)/kt;var Vn},Qt=(ln(!0)-Kt)/Ke;if(Math.abs(kt)<1e-6||!isFinite(Qt)){if(Math.abs(rt-ft)<1e-6)return this.easeTo(i,h);const tn=ft<rt?-1:1;Qt=Math.abs(Math.log(ft/rt))/Ke,$n=()=>0,gn=Vn=>Math.exp(tn*Ke*Vn)}return i.duration="duration"in i?+i.duration:1e3*Qt/("screenSpeed"in i?+i.screenSpeed/Ke:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=k!==H,this._pitching=J!==z,this._padding=!x.isPaddingEqual(K),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Re),this._ease(tn=>{const Vn=tn*Qt,lr=1/gn(Vn);x.zoom=tn===1?Ie:E+x.scaleZoom(lr),this._rotating&&(x.bearing=c.z.number(k,H,tn)),this._pitching&&(x.pitch=c.z.number(z,J,tn)),this._padding&&(x.interpolatePadding(V,K,tn),ge=x.centerPoint.add(ue)),this.terrain&&!i.freezeElevation&&this._updateElevation(tn);const ei=tn===1?Re:x.unproject(He.add(Ae.mult($n(Vn))).mult(lr));x.setLocationAtPoint(x.renderWorldCopies?ei.wrap():ei,ge),this._applyUpdatedTransform(x),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var y;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,h)}return i||(y=this.handlers)===null||y===void 0||y.stop(!1),this}_ease(i,h,y){y.animate===!1||y.duration===0?(i(1),h()):(this._easeStart=D.now(),this._easeOptions=y,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=c.b3(i,-180,180);const y=Math.abs(i-h);return Math.abs(i-360-h)<y&&(i-=360),Math.abs(i+360-h)<y&&(i+=360),i}_normalizeCenter(i){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const y=i.lng-h.center.lng;i.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const Zl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Aa{constructor(i=Zl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const y=this._map._getUIString(`AttributionControl.${h}`);i.title=y,i.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(x=>typeof x!="string"?"":x)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style.sourceCaches;for(const x in h){const E=h[x];if(E.used||E.usedForTerrain){const k=E.getSource();k.attribution&&i.indexOf(k.attribution)<0&&i.push(k.attribution)}}i=i.filter(x=>String(x).trim()),i.sort((x,E)=>x.length-E.length),i=i.filter((x,E)=>{for(let k=E+1;k<i.length;k++)if(i[k].indexOf(x)>=0)return!1;return!0});const y=i.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,i.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qa{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const y=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const h=N.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const x of y)if(x.id===i)return void(x.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ef=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Lh extends c.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const y={};for(const x of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))y[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.posMatrix=new Float64Array(16),c.aQ(x.posMatrix,0,c.X,0,c.X,0,1),this._tiles[x.key]=new Qn(x,this.tileSize));for(const x in this._tiles)y[x]||delete this._tiles[x]}freeRtt(i){for(const h in this._tiles){const y=this._tiles[h];(!i||y.tileID.equals(i)||y.tileID.isChildOf(i)||i.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const h={};for(const y of this._renderableTilesKeys){const x=this._tiles[y].tileID;if(x.canonical.equals(i.canonical)){const E=i.clone();E.posMatrix=new Float64Array(16),c.aQ(E.posMatrix,0,c.X,0,c.X,0,1),h[y]=E}else if(x.canonical.isChildOf(i.canonical)){const E=i.clone();E.posMatrix=new Float64Array(16);const k=x.canonical.z-i.canonical.z,z=x.canonical.x-(x.canonical.x>>k<<k),V=x.canonical.y-(x.canonical.y>>k<<k),H=c.X>>k;c.aQ(E.posMatrix,0,H,0,H,0,1),c.J(E.posMatrix,E.posMatrix,[-z*H,-V*H,0]),h[y]=E}else if(i.canonical.isChildOf(x.canonical)){const E=i.clone();E.posMatrix=new Float64Array(16);const k=i.canonical.z-x.canonical.z,z=i.canonical.x-(i.canonical.x>>k<<k),V=i.canonical.y-(i.canonical.y>>k<<k),H=c.X>>k;c.aQ(E.posMatrix,0,c.X,0,c.X,0,1),c.J(E.posMatrix,E.posMatrix,[z*H,V*H,0]),c.K(E.posMatrix,E.posMatrix,[1/2**k,1/2**k,0]),h[y]=E}}return h}getSourceTile(i,h){const y=this.sourceCache._source;let x=i.overscaledZ-this.deltaZoom;if(x>y.maxzoom&&(x=y.maxzoom),x<y.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(x).key);let E=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!E||!E.dem)&&h)for(;x>=y.minzoom&&(!E||!E.dem);)E=this.sourceCache.getTileByID(i.scaledTo(x--).key);return E}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=i)}}class Tf{constructor(i,h,y){this.painter=i,this.sourceCache=new Lh(h),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,y,x=c.X){var E;if(!(h>=0&&h<x&&y>=0&&y<x))return 0;const k=this.getTerrainData(i),z=(E=k.tile)===null||E===void 0?void 0:E.dem;if(!z)return 0;const V=function(Ee,Re,Ie){var De=Re[0],He=Re[1];return Ee[0]=Ie[0]*De+Ie[4]*He+Ie[12],Ee[1]=Ie[1]*De+Ie[5]*He+Ie[13],Ee}([],[h/x*c.X,y/x*c.X],k.u_terrain_matrix),H=[V[0]*z.dim,V[1]*z.dim],J=Math.floor(H[0]),K=Math.floor(H[1]),ue=H[0]-J,ge=H[1]-K;return z.get(J,K)*(1-ue)*(1-ge)+z.get(J+1,K)*ue*(1-ge)+z.get(J,K+1)*(1-ue)*ge+z.get(J+1,K+1)*ue*ge}getElevationForLngLatZoom(i,h){const{tileID:y,mercatorX:x,mercatorY:E}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(y,x%c.X,E%c.X,c.X)}getElevation(i,h,y,x=c.X){return this.getDEMElevation(i,h,y,x)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const x=this.painter.context,E=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Oe(x,E,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Oe(x,new c.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ao([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const x=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Oe(x,h.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),h.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const y=h&&h+h.tileID.key+i.key;if(y&&!this._demMatrixCache[y]){const x=this.sourceCache.sourceCache._source.maxzoom;let E=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=x?E=i.canonical.z-x:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const k=i.canonical.x-(i.canonical.x>>E<<E),z=i.canonical.y-(i.canonical.y>>E<<E),V=c.bb(new Float64Array(16),[1/(c.X<<E),1/(c.X<<E),0]);c.J(V,V,[k*c.X,z*c.X,0]),this._demMatrixCache[i.key]={matrix:V,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,y=h.width/devicePixelRatio,x=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Oe(h.context,{width:y,height:x,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Oe(h.context,{width:y,height:x,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(y,x,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,y,x))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let E=0,k=0;E<this._coordsTextureSize;E++)for(let z=0;z<this._coordsTextureSize;z++,k+=4)h[k+0]=255&z,h[k+1]=255&E,h[k+2]=z>>8<<4|E>>8,h[k+3]=0;const y=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),x=new Oe(i,y,i.gl.RGBA,{premultiply:!1});return x.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),y=this.painter.context,x=y.gl,E=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),k=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(E,z-k-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null);const V=h[0]+(h[2]>>4<<8),H=h[1]+((15&h[2])<<8),J=this.coordsIndex[255-h[3]],K=J&&this.sourceCache.getTileByID(J);if(!K)return null;const ue=this._coordsTextureSize,ge=(1<<K.tileID.canonical.z)*ue;return new c.Z((K.tileID.canonical.x*ue+V)/ge+K.tileID.wrap,(K.tileID.canonical.y*ue+H)/ge,this.getElevation(K.tileID,V,H,ue))}depthAtPoint(i){const h=new Uint8Array(4),y=this.painter.context,x=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,h=new c.bc,y=new c.aY,x=this.meshSize,E=c.X/x,k=x*x;for(let K=0;K<=x;K++)for(let ue=0;ue<=x;ue++)h.emplaceBack(ue*E,K*E,0);for(let K=0;K<k;K+=x+1)for(let ue=0;ue<x;ue++)y.emplaceBack(ue+K,x+ue+K+1,x+ue+K+2),y.emplaceBack(ue+K,x+ue+K+2,ue+K+1);const z=h.length,V=z+2*(x+1);for(const K of[0,1])for(let ue=0;ue<=x;ue++)for(const ge of[0,1])h.emplaceBack(ue*E,K*c.X,ge);for(let K=0;K<2*x;K+=2)y.emplaceBack(V+K,V+K+1,V+K+3),y.emplaceBack(V+K,V+K+3,V+K+2),y.emplaceBack(z+K,z+K+3,z+K+1),y.emplaceBack(z+K,z+K+2,z+K+3);const H=h.length,J=H+2*(x+1);for(const K of[0,1])for(let ue=0;ue<=x;ue++)for(const ge of[0,1])h.emplaceBack(K*c.X,ue*E,ge);for(let K=0;K<2*x;K+=2)y.emplaceBack(H+K,H+K+1,H+K+3),y.emplaceBack(H+K,H+K+3,H+K+2),y.emplaceBack(J+K,J+K+3,J+K+1),y.emplaceBack(J+K,J+K+2,J+K+3);return this._mesh=new Hu(i.createVertexBuffer(h,Ef.members),i.createIndexBuffer(y),c.a0.simpleSegment(0,0,h.length,y.length)),this._mesh}getMeshFrameDelta(i){return 2*Math.PI*c.bd/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,h){var y;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(y=this.getMinMaxElevation(x).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,y={minElevation:null,maxElevation:null};return h&&h.dem&&(y.minElevation=h.dem.min*this.exaggeration,y.maxElevation=h.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(i,h){const y=c.Z.fromLngLat(i.wrap()),x=(1<<h)*c.X,E=y.x*x,k=y.y*x,z=Math.floor(E/c.X),V=Math.floor(k/c.X);return{tileID:new c.S(h,0,h,z,V),mercatorX:E,mercatorY:k}}}class Oo{constructor(i,h,y){this._context=i,this._size=h,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new Oe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(y.texture),{id:i,fbo:h,texture:y,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const Ds={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class kh{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new Oo(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(y=>!i._layers[y].isHidden(h)),this._coordsDescendingInv={};for(const y in i.sourceCaches){this._coordsDescendingInv[y]={};const x=i.sourceCaches[y].getVisibleCoordinates();for(const E of x){const k=this.terrain.sourceCache.getTerrainCoords(E);for(const z in k)this._coordsDescendingInv[y][z]||(this._coordsDescendingInv[y][z]=[]),this._coordsDescendingInv[y][z].push(k[z])}}this._coordsDescendingInvStr={};for(const y of i._order){const x=i._layers[y],E=x.source;if(Ds[x.type]&&!this._coordsDescendingInvStr[E]){this._coordsDescendingInvStr[E]={};for(const k in this._coordsDescendingInv[E])this._coordsDescendingInvStr[E][k]=this._coordsDescendingInv[E][k].map(z=>z.key).sort().join()}}for(const y of this._renderableTiles)for(const x in this._coordsDescendingInvStr){const E=this._coordsDescendingInvStr[x][y.tileID.key];E&&E!==y.rttCoords[x]&&(y.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const h=i.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(Ds[h]&&(this._prevType&&Ds[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(i.id),!x))return!0;if(Ds[this._prevType]||Ds[h]&&x){this._prevType=h;const E=this._stacks.length-1,k=this._stacks[E]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(cl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[E]){const H=this.pool.getObjectForId(z.rtt[E].id);if(H.stamp===z.rtt[E].stamp){this.pool.useObject(H);continue}}const V=this.pool.getOrCreateFreeObject();this.pool.useObject(V),this.pool.stampObject(V),z.rtt[E]={id:V.id,stamp:V.stamp},y.context.bindFramebuffer.set(V.fbo.framebuffer),y.context.clear({color:c.aN.transparent,stencil:0}),y.currentStencilSource=void 0;for(let H=0;H<k.length;H++){const J=y.style._layers[k[H]],K=J.source?this._coordsDescendingInv[J.source][z.tileID.key]:[z.tileID];y.context.viewport.set([0,0,V.fbo.width,V.fbo.height]),y._renderTileClippingMasks(J,K),y.renderLayer(y,y.style.sourceCaches[J.source],J,K),J.source&&(z.rttCoords[J.source]=this._coordsDescendingInvStr[J.source][z.tileID.key])}}return cl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ds[h]}return!1}}const se={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fo=I,Cc={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Zl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Ks=T=>{T.touchstart=T.dragStart,T.touchmoveWindow=T.dragMove,T.touchend=T.dragEnd},vi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mf{constructor(i,h,y=!1){this.mousedown=k=>{this.startMouse(c.e({},k,{ctrlKey:!0,preventDefault:()=>k.preventDefault()}),N.mousePos(this.element,k)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=k=>{this.moveMouse(k,N.mousePos(this.element,k))},this.mouseup=k=>{this.mouseRotate.dragEnd(k),this.mousePitch&&this.mousePitch.dragEnd(k),this.offTemp()},this.touchstart=k=>{k.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,k.targetTouches)[0],this.startTouch(k,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=k=>{k.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,k.targetTouches)[0],this.moveTouch(k,this._lastPos))},this.touchend=k=>{k.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const x=i.dragRotate._mouseRotate.getClickTolerance(),E=i.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Do({clickTolerance:x,enable:!0}),this.touchRotate=(({enable:k,clickTolerance:z,bearingDegreesPerPixelMoved:V=.8})=>{const H=new Wa;return new mi({clickTolerance:z,move:(J,K)=>({bearingDelta:(K.x-J.x)*V}),moveStateManager:H,enable:k,assignEvents:Ks})})({clickTolerance:x,enable:!0}),this.map=i,y&&(this.mousePitch=ks({clickTolerance:E,enable:!0}),this.touchPitch=(({enable:k,clickTolerance:z,pitchDegreesPerPixelMoved:V=-.5})=>{const H=new Wa;return new mi({clickTolerance:z,move:(J,K)=>({pitchDelta:(K.y-J.y)*V}),moveStateManager:H,enable:k,assignEvents:Ks})})({clickTolerance:E,enable:!0})),N.addEventListener(h,"mousedown",this.mousedown),N.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(h,"touchcancel",this.reset)}startMouse(i,h){this.mouseRotate.dragStart(i,h),this.mousePitch&&this.mousePitch.dragStart(i,h),N.disableDrag()}startTouch(i,h){this.touchRotate.dragStart(i,h),this.touchPitch&&this.touchPitch.dragStart(i,h),N.disableDrag()}moveMouse(i,h){const y=this.map,{bearingDelta:x}=this.mouseRotate.dragMove(i,h)||{};if(x&&y.setBearing(y.getBearing()+x),this.mousePitch){const{pitchDelta:E}=this.mousePitch.dragMove(i,h)||{};E&&y.setPitch(y.getPitch()+E)}}moveTouch(i,h){const y=this.map,{bearingDelta:x}=this.touchRotate.dragMove(i,h)||{};if(x&&y.setBearing(y.getBearing()+x),this.touchPitch){const{pitchDelta:E}=this.touchPitch.dragMove(i,h)||{};E&&y.setPitch(y.getPitch()+E)}}off(){const i=this.element;N.removeEventListener(i,"mousedown",this.mousedown),N.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let zo;function Af(T,i,h){const y=new c.N(T.lng,T.lat);if(T=new c.N(T.lng,T.lat),i){const x=new c.N(T.lng-360,T.lat),E=new c.N(T.lng+360,T.lat),k=h.locationPoint(T).distSqr(i);h.locationPoint(x).distSqr(i)<k?T=x:h.locationPoint(E).distSqr(i)<k&&(T=E)}for(;Math.abs(T.lng-h.center.lng)>180;){const x=h.locationPoint(T);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;T.lng>h.center.lng?T.lng-=360:T.lng+=360}return T.lng!==y.lng&&h.locationPoint(T).y>h.height/2-h.getHorizon()?T:y}const _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bo(T,i,h){const y=T.classList;for(const x in _o)y.remove(`maplibregl-${h}-anchor-${x}`);y.add(`maplibregl-${h}-anchor-${i}`)}class nr extends c.E{constructor(i){if(super(),this._onKeyPress=h=>{const y=h.code,x=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=h=>{const y=h.originalEvent.target,x=this._element;this._popup&&(y===x||x.contains(y))&&this.togglePopup()},this._update=h=>{var y;if(!this._map)return;const x=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!x)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Af(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let E="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?E=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(E=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let k="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?k="rotateX(0deg)":this._pitchAlignment==="map"&&(k=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${_o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${k} ${E}`),D.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=c.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const h=N.createNS("http://www.w3.org/2000/svg","svg"),y=41,x=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${y}px`),h.setAttributeNS(null,"width",`${x}px`),h.setAttributeNS(null,"viewBox",`0 0 ${x} ${y}`);const E=N.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const k=N.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");const z=N.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const De of V){const He=N.createNS("http://www.w3.org/2000/svg","ellipse");He.setAttributeNS(null,"opacity","0.04"),He.setAttributeNS(null,"cx","10.5"),He.setAttributeNS(null,"cy","5.80029008"),He.setAttributeNS(null,"rx",De.rx),He.setAttributeNS(null,"ry",De.ry),z.appendChild(He)}const H=N.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const J=N.createNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(J);const K=N.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"fill","#000000");const ue=N.createNS("http://www.w3.org/2000/svg","path");ue.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),K.appendChild(ue);const ge=N.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const Ee=N.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Re=N.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#000000"),Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962");const Ie=N.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#FFFFFF"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962"),Ee.appendChild(Re),Ee.appendChild(Ie),k.appendChild(z),k.appendChild(H),k.appendChild(K),k.appendChild(ge),k.appendChild(Ee),h.appendChild(k),h.setAttributeNS(null,"height",y*this._scale+"px"),h.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(h),this._offset=c.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Bo(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,y;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const x=this._map,E=x.terrain.depthAtPoint(this._pos),k=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,k)-E<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/x.transform._pixelPerMeter,V=Math.sin(x.getPitch()*Math.PI/180)*z,H=x.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),J=x.transform.lngLatToCameraDepth(this._lngLat,k+V)-H>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&J&&this._popup.remove(),this._element.style.opacity=J?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=c.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return i===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Rc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Yl=0,Kl=!1;const $a={maxWidth:100,unit:"metric"};function Dh(T,i,h){const y=h&&h.maxWidth||100,x=T._container.clientHeight/2,E=T.unproject([0,x]),k=T.unproject([y,x]),z=E.distanceTo(k);if(h&&h.unit==="imperial"){const V=3.2808*z;V>5280?$u(i,y,V/5280,T._getUIString("ScaleControl.Miles")):$u(i,y,V,T._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?$u(i,y,z/1852,T._getUIString("ScaleControl.NauticalMiles")):z>=1e3?$u(i,y,z/1e3,T._getUIString("ScaleControl.Kilometers")):$u(i,y,z,T._getUIString("ScaleControl.Meters"))}function $u(T,i,h,y){const x=function(E){const k=Math.pow(10,`${Math.floor(E)}`.length-1);let z=E/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(V){const H=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*H)/H}(z),k*z}(h);T.style.width=i*(x/h)+"px",T.innerHTML=`${x}&nbsp;${y}`}const Xa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Pc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function In(T){if(T){if(typeof T=="number"){const i=Math.round(Math.abs(T)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,T),"top-left":new c.P(i,i),"top-right":new c.P(-i,i),bottom:new c.P(0,-T),"bottom-left":new c.P(i,-i),"bottom-right":new c.P(-i,-i),left:new c.P(T,0),right:new c.P(-T,0)}}if(T instanceof c.P||Array.isArray(T)){const i=c.P.convert(T);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:c.P.convert(T.center||[0,0]),top:c.P.convert(T.top||[0,0]),"top-left":c.P.convert(T["top-left"]||[0,0]),"top-right":c.P.convert(T["top-right"]||[0,0]),bottom:c.P.convert(T.bottom||[0,0]),"bottom-left":c.P.convert(T["bottom-left"]||[0,0]),"bottom-right":c.P.convert(T["bottom-right"]||[0,0]),left:c.P.convert(T.left||[0,0]),right:c.P.convert(T.right||[0,0])}}return In(new c.P(0,0))}const Pn=I;_.AJAXError=c.bg,_.Evented=c.E,_.LngLat=c.N,_.MercatorCoordinate=c.Z,_.Point=c.P,_.addProtocol=c.bh,_.config=c.a,_.removeProtocol=c.bi,_.AttributionControl=Aa,_.BoxZoomHandler=vr,_.CanvasSource=Lt,_.CooperativeGesturesHandler=Zs,_.DoubleClickZoomHandler=Pr,_.DragPanHandler=ha,_.DragRotateHandler=fa,_.EdgeInsets=s,_.FullscreenControl=class extends c.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=pe,_.GeolocateControl=class extends c.E{constructor(T){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new c.N(i.coords.longitude,i.coords.latitude),y=i.coords.accuracy,x=this._map.getBearing(),E=c.e({bearing:x},this.options.fitBoundsOptions),k=Ze.fromLngLat(h,y);this._map.fitBounds(k,E,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new c.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&Kl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nr({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Rc,T)}onAdd(T){return this._map=T,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(i=!1){if(zo!==void 0&&!i)return zo;if(window.navigator.permissions===void 0)return zo=!!window.navigator.geolocation,zo;try{zo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{zo=!!window.navigator.geolocation}return zo})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yl=0,Kl=!1}_isOutOfMapMaxBounds(T){const i=this._map.getMaxBounds(),h=T.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const T=this._map.getBounds(),i=T.getSouthEast(),h=T.getNorthEast(),y=i.distanceTo(h),x=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yl--,Kl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yl++,Yl>1?(T={maximumAge:6e5,timeout:0},Kl=!0):(T=this.options.positionOptions,Kl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.Hash=C,_.ImageSource=Ut,_.KeyboardHandler=Mh,_.LngLatBounds=Ze,_.LogoControl=qa,_.Map=class extends qu{constructor(T){c.be.mark(c.bf.create);const i=Object.assign(Object.assign({},Cc),T);if(i.minZoom!=null&&i.maxZoom!=null&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(i.minPitch!=null&&i.maxPitch!=null&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(i.minPitch!=null&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(i.maxPitch!=null&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new f(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new pn,this._controls=[],this._mapId=c.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=i.preserveDrawingBuffer===!0,this._antialias=i.antialias===!0,this._trackResize=i.trackResize===!0,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles===!0,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=i.crossSourceCollisions===!0,this._collectResourceTiming=i.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},se),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=i.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=le.addThrottleControl(()=>this.isMoving()),this._requestManager=new ye(i.transformRequest),typeof i.container=="string"){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const y=v(x=>{this._trackResize&&!this._removed&&this.resize(x)._update()},50);this._resizeObserver=new ResizeObserver(x=>{h?y(x):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wu(this,i),this._hash=i.hash&&new C(typeof i.hash=="string"&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,c.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Aa(typeof i.attributionControl=="boolean"?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new qa,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new c.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new c.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new c.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(T,i){if(i===void 0&&(i=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=T.onAdd(this);this._controls.push(T);const y=this._controlPositions[i];return i.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(T);return i>-1&&this._controls.splice(i,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}calculateCameraOptionsFromTo(T,i,h,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,i,h,y)}resize(T){var i;const h=this._containerDimensions(),y=h[0],x=h[1],E=this._getClampedPixelRatio(y,x);if(this._resizeCanvas(y,x,E),this.painter.resize(y,x,E),this.painter.overLimit()){const z=this.painter.context.gl;this._maxCanvasSize=[z.drawingBufferWidth,z.drawingBufferHeight];const V=this._getClampedPixelRatio(y,x);this._resizeCanvas(y,x,V),this.painter.resize(y,x,V)}this.transform.resize(y,x),(i=this._requestedCameraState)===null||i===void 0||i.resize(y,x);const k=!this._moving;return k&&(this.stop(),this.fire(new c.k("movestart",T)).fire(new c.k("move",T))),this.fire(new c.k("resize",T)),k&&this.fire(new c.k("moveend",T)),this}_getClampedPixelRatio(T,i){const{0:h,1:y}=this._maxCanvasSize,x=this.getPixelRatio(),E=T*x,k=i*x;return Math.min(E>h?h/E:1,k>y?y/k:1)*x}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(Ze.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.minZoom=T,this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.maxZoom=T,this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.minPitch=T,this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(T>=this.transform.minPitch)return this.transform.maxPitch=T,this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.renderWorldCopies=T,this._update()}project(T){return this.transform.locationPoint(c.N.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.pointLocation(c.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,i,h){if(T==="mouseenter"||T==="mouseover"){let y=!1;return{layer:i,listener:h,delegates:{mousemove:E=>{const k=this.getLayer(i)?this.queryRenderedFeatures(E.point,{layers:[i]}):[];k.length?y||(y=!0,h.call(this,new Nt(T,this,E.originalEvent,{features:k}))):y=!1},mouseout:()=>{y=!1}}}}if(T==="mouseleave"||T==="mouseout"){let y=!1;return{layer:i,listener:h,delegates:{mousemove:k=>{(this.getLayer(i)?this.queryRenderedFeatures(k.point,{layers:[i]}):[]).length?y=!0:y&&(y=!1,h.call(this,new Nt(T,this,k.originalEvent)))},mouseout:k=>{y&&(y=!1,h.call(this,new Nt(T,this,k.originalEvent)))}}}}{const y=x=>{const E=this.getLayer(i)?this.queryRenderedFeatures(x.point,{layers:[i]}):[];E.length&&(x.features=E,h.call(this,x),delete x.features)};return{layer:i,listener:h,delegates:{[T]:y}}}}on(T,i,h){if(h===void 0)return super.on(T,i);const y=this._createDelegatedListener(T,i,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(y);for(const x in y.delegates)this.on(x,y.delegates[x]);return this}once(T,i,h){if(h===void 0)return super.once(T,i);const y=this._createDelegatedListener(T,i,h);for(const x in y.delegates)this.once(x,y.delegates[x]);return this}off(T,i,h){return h===void 0?super.off(T,i):(this._delegatedListeners&&this._delegatedListeners[T]&&(y=>{const x=this._delegatedListeners[T];for(let E=0;E<x.length;E++){const k=x[E];if(k.layer===i&&k.listener===h){for(const z in k.delegates)this.off(z,k.delegates[z]);return x.splice(E,1),this}}})(),this)}queryRenderedFeatures(T,i){if(!this.style)return[];let h;const y=T instanceof c.P||Array.isArray(T),x=y?T:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(y?{}:T)||{},x instanceof c.P||typeof x[0]=="number")h=[c.P.convert(x)];else{const E=c.P.convert(x[0]),k=c.P.convert(x[1]);h=[E,new c.P(k.x,E.y),k,new c.P(E.x,k.y),E]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(T,i){return this.style.querySourceFeatures(T,i)}setStyle(T,i){return(i=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(T,i))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const i=this._locale[T];if(i==null)throw new Error(`Missing UI string '${T}'`);return i}_updateStyle(T,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(T,i));const h=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new ss(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,i,h):this.style.loadJSON(T,i,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ss(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,i){if(typeof T=="string"){const h=this._requestManager.transformRequest(T,"Style");c.h(h,new AbortController).then(y=>{this._updateDiff(y.data,i)}).catch(y=>{y&&this.fire(new c.j(y))})}else typeof T=="object"&&this._updateDiff(T,i)}_updateDiff(T,i){try{this.style.setState(T,i)&&this._update(!0)}catch(h){c.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(T,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(T,i){return this._lazyInitEmptyStyle(),this.style.addSource(T,i),this._update(!0)}isSourceLoaded(T){const i=this.style&&this.style.sourceCaches[T];if(i!==void 0)return i.loaded();this.fire(new c.j(new Error(`There is no source with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const i=this.style.sourceCaches[T.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const y=this.style._layers[h];y.type==="hillshade"&&y.source===T.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Tf(this.painter,i,T),this.painter.renderToTexture=new kh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==T.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:T})),this}getTerrain(){var T,i;return(i=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const T=this.style&&this.style.sourceCaches;for(const i in T){const h=T[i]._tiles;for(const y in h){const x=h[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}addImage(T,i,h={}){const{pixelRatio:y=1,sdf:x=!1,stretchX:E,stretchY:k,content:z,textFitWidth:V,textFitHeight:H}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||c.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:J,height:K,data:ue}=i,ge=i;return this.style.addImage(T,{data:new c.R({width:J,height:K},new Uint8Array(ue)),pixelRatio:y,stretchX:E,stretchY:k,content:z,textFitWidth:V,textFitHeight:H,sdf:x,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,T),this}}{const{width:J,height:K,data:ue}=D.getImageData(i);this.style.addImage(T,{data:new c.R({width:J,height:K},ue),pixelRatio:y,stretchX:E,stretchY:k,content:z,textFitWidth:V,textFitHeight:H,sdf:x,version:0})}}updateImage(T,i){const h=this.style.getImage(T);if(!h)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=i instanceof HTMLImageElement||c.b(i)?D.getImageData(i):i,{width:x,height:E,data:k}=y;if(x===void 0||E===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==h.data.width||E!==h.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const z=!(i instanceof HTMLImageElement||c.b(i));return h.data.replace(k,z),this.style.updateImage(T,h),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return le.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,i){return this._lazyInitEmptyStyle(),this.style.addLayer(T,i),this._update(!0)}moveLayer(T,i){return this.style.moveLayer(T,i),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,i,h){return this.style.setLayerZoomRange(T,i,h),this._update(!0)}setFilter(T,i,h={}){return this.style.setFilter(T,i,h),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,i,h,y={}){return this.style.setPaintProperty(T,i,h,y),this._update(!0)}getPaintProperty(T,i){return this.style.getPaintProperty(T,i)}setLayoutProperty(T,i,h,y={}){return this.style.setLayoutProperty(T,i,h,y),this._update(!0)}getLayoutProperty(T,i){return this.style.getLayoutProperty(T,i)}setGlyphs(T,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,i,h,y=>{y||this._update(!0)}),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,i,h=>{h||this._update(!0)}),this}setLight(T,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(T){return this._lazyInitEmptyStyle(),this.style.setSky(T),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,i){return this.style.setFeatureState(T,i),this._update()}removeFeatureState(T,i){return this.style.removeFeatureState(T,i),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,i=0;return this._container&&(T=this._container.clientWidth||400,i=this._container.clientHeight||300),[T,i]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const i=this._canvasContainer=N.create("div","maplibregl-canvas-container",T);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),y=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],y);const x=this._controlContainer=N.create("div","maplibregl-control-container",T),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(k=>{E[k]=N.create("div",`maplibregl-ctrl-${k} `,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,i,h){this._canvas.width=Math.floor(h*T),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const T={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{i={requestedAttributes:T},y&&(i.statusMessage=y.statusMessage,i.type=y.type)},{once:!0});const h=this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T);if(!h){const y="Failed to initialize WebGL";throw i?(i.message=y,new Error(JSON.stringify(i))):new Error(y)}this.painter=new Ss(h,this.transform),G.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,E=D.now();this.style.zoomHistory.update(x,E);const k=new c.a9(x,{now:E,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),z=k.crossFadingFactor();z===1&&z===this._crossFadingFactor||(h=!0,this._crossFadingFactor=z),this.style.update(k)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.be.mark(c.bf.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,c.be.mark(c.bf.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),le.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.be.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,D.frameAsync(this._frameRequest).then(T=>{c.be.frame(T),this._frameRequest=null,this._render(T)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return Fo}getCameraTargetElevation(){return this.transform.elevation}},_.MapMouseEvent=Nt,_.MapTouchEvent=Rn,_.MapWheelEvent=Nn,_.Marker=nr,_.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),y=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,h)=>{const y=this._map._getUIString(`NavigationControl.${h}`);i.title=y,i.setAttribute("aria-label",y)},this.options=c.e({},vi,T),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,i){const h=N.create("button",T,this._container);return h.type="button",h.addEventListener("click",i),h}},_.Popup=class extends c.E{constructor(T){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const z of this.options.className.split(" "))this._container.classList.add(z);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Af(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!i)return;const y=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let x=this.options.anchor;const E=In(this.options.offset);if(!x){const z=this._container.offsetWidth,V=this._container.offsetHeight;let H;H=y.y+E.bottom.y<V?["top"]:y.y>this._map.transform.height-V?["bottom"]:[],y.x<z/2?H.push("left"):y.x>this._map.transform.width-z/2&&H.push("right"),x=H.length===0?"bottom":H.join("-")}let k=y.add(E[x]);this.options.subpixelPositioning||(k=k.round()),N.setTransform(this._container,`${_o[x]} translate(${k.x}px,${k.y}px)`),Bo(this._container,x,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Xa),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=c.N.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const i=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=T;y=h.firstChild,y;)i.appendChild(y);return this.setDOMContent(i)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(Pc);T&&T.focus()}},_.RasterDEMTileSource=Pe,_.RasterTileSource=ut,_.ScaleControl=class{constructor(T){this._onMove=()=>{Dh(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Dh(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},$a),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=Ch,_.Style=ss,_.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=jl,_.TwoFingersTouchRotateHandler=Th,_.TwoFingersTouchZoomHandler=Sh,_.TwoFingersTouchZoomRotateHandler=Rh,_.VectorTileSource=qn,_.VideoSource=St,_.addSourceType=(T,i)=>c._(void 0,void 0,void 0,function*(){if(an(T))throw new Error(`A source type called "${T}" already exists.`);((h,y)=>{Dn[h]=y})(T,i)}),_.clearPrewarmedResources=function(){const T=cn;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(ht),cn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return Rt().getRTLTextPluginStatus()},_.getVersion=function(){return Pn},_.getWorkerCount=function(){return Ft.workerCount},_.getWorkerUrl=function(){return c.a.WORKER_URL},_.importScriptInWorkers=function(T){return nn().broadcast("IS",T)},_.prewarm=function(){Wn().acquire(ht)},_.setMaxParallelImageRequests=function(T){c.a.MAX_PARALLEL_IMAGE_REQUESTS=T},_.setRTLTextPlugin=function(T,i){return Rt().setRTLTextPlugin(T,i)},_.setWorkerCount=function(T){Ft.workerCount=T},_.setWorkerUrl=function(T){c.a.WORKER_URL=T}});var g=t;return g})})(WE);var sI=WE.exports;const P1=qy(sI);var Cb=Object.prototype.toString,$E=function(e){var t=Cb.call(e),a=t==="[object Arguments]";return a||(a=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Cb.call(e.callee)==="[object Function]"),a},d0,Rb;function aI(){if(Rb)return d0;Rb=1;var l;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,a=$E,d=Object.prototype.propertyIsEnumerable,g=!d.call({toString:null},"toString"),_=d.call(function(){},"prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],I=function(N){var G=N.constructor;return G&&G.prototype===N},P={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},F=function(){if(typeof window>"u")return!1;for(var N in window)try{if(!P["$"+N]&&e.call(window,N)&&window[N]!==null&&typeof window[N]=="object")try{I(window[N])}catch{return!0}}catch{return!0}return!1}(),D=function(N){if(typeof window>"u"||!F)return I(N);try{return I(N)}catch{return!1}};l=function(G){var Z=G!==null&&typeof G=="object",re=t.call(G)==="[object Function]",$=a(G),X=Z&&t.call(G)==="[object String]",me=[];if(!Z&&!re&&!$)throw new TypeError("Object.keys called on a non-object");var le=_&&re;if(X&&G.length>0&&!e.call(G,0))for(var ye=0;ye<G.length;++ye)me.push(String(ye));if($&&G.length>0)for(var Le=0;Le<G.length;++Le)me.push(String(Le));else for(var Me in G)!(le&&Me==="prototype")&&e.call(G,Me)&&me.push(String(Me));if(g)for(var Te=D(G),We=0;We<c.length;++We)!(Te&&c[We]==="constructor")&&e.call(G,c[We])&&me.push(c[We]);return me}}return d0=l,d0}var oI=Array.prototype.slice,lI=$E,Pb=Object.keys,Y_=Pb?function(e){return Pb(e)}:aI(),Lb=Object.keys;Y_.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(a){return lI(a)?Lb(oI.call(a)):Lb(a)})}else Object.keys=Y_;return Object.keys||Y_};var L1=Y_,uI=Error,cI=EvalError,hI=RangeError,fI=ReferenceError,XE=SyntaxError,vh=TypeError,dI=URIError,$y=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),a=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(a)!=="[object Symbol]")return!1;var d=42;e[t]=d;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var g=Object.getOwnPropertySymbols(e);if(g.length!==1||g[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var _=Object.getOwnPropertyDescriptor(e,t);if(_.value!==d||_.enumerable!==!0)return!1}return!0},kb=typeof Symbol<"u"&&Symbol,pI=$y,k1=function(){return typeof kb!="function"||typeof Symbol!="function"||typeof kb("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:pI()},p0={__proto__:null,foo:{}},mI=Object,gI=function(){return{__proto__:p0}.foo===p0.foo&&!(p0 instanceof mI)},_I="Function.prototype.bind called on incompatible ",yI=Object.prototype.toString,vI=Math.max,xI="[object Function]",Db=function(e,t){for(var a=[],d=0;d<e.length;d+=1)a[d]=e[d];for(var g=0;g<t.length;g+=1)a[g+e.length]=t[g];return a},bI=function(e,t){for(var a=[],d=t,g=0;d<e.length;d+=1,g+=1)a[g]=e[d];return a},wI=function(l,e){for(var t="",a=0;a<l.length;a+=1)t+=l[a],a+1<l.length&&(t+=e);return t},SI=function(e){var t=this;if(typeof t!="function"||yI.apply(t)!==xI)throw new TypeError(_I+t);for(var a=bI(arguments,1),d,g=function(){if(this instanceof d){var F=t.apply(this,Db(a,arguments));return Object(F)===F?F:this}return t.apply(e,Db(a,arguments))},_=vI(0,t.length-a.length),c=[],I=0;I<_;I++)c[I]="$"+I;if(d=Function("binder","return function ("+wI(c,",")+"){ return binder.apply(this,arguments); }")(g),t.prototype){var P=function(){};P.prototype=t.prototype,d.prototype=new P,P.prototype=null}return d},EI=SI,D1=Function.prototype.bind||EI,TI=Function.prototype.call,MI=Object.prototype.hasOwnProperty,AI=D1,jE=AI.call(TI,MI),Oi,II=uI,CI=cI,RI=hI,PI=fI,Vd=XE,Dd=vh,LI=dI,ZE=Function,m0=function(l){try{return ZE('"use strict"; return ('+l+").constructor;")()}catch{}},pf=Object.getOwnPropertyDescriptor;if(pf)try{pf({},"")}catch{pf=null}var g0=function(){throw new Dd},kI=pf?function(){try{return arguments.callee,g0}catch{try{return pf(arguments,"callee").get}catch{return g0}}}():g0,hd=k1(),DI=gI(),Vs=Object.getPrototypeOf||(DI?function(l){return l.__proto__}:null),Pd={},NI=typeof Uint8Array>"u"||!Vs?Oi:Vs(Uint8Array),mf={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Oi:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Oi:ArrayBuffer,"%ArrayIteratorPrototype%":hd&&Vs?Vs([][Symbol.iterator]()):Oi,"%AsyncFromSyncIteratorPrototype%":Oi,"%AsyncFunction%":Pd,"%AsyncGenerator%":Pd,"%AsyncGeneratorFunction%":Pd,"%AsyncIteratorPrototype%":Pd,"%Atomics%":typeof Atomics>"u"?Oi:Atomics,"%BigInt%":typeof BigInt>"u"?Oi:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Oi:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Oi:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Oi:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":II,"%eval%":eval,"%EvalError%":CI,"%Float32Array%":typeof Float32Array>"u"?Oi:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Oi:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Oi:FinalizationRegistry,"%Function%":ZE,"%GeneratorFunction%":Pd,"%Int8Array%":typeof Int8Array>"u"?Oi:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Oi:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Oi:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hd&&Vs?Vs(Vs([][Symbol.iterator]())):Oi,"%JSON%":typeof JSON=="object"?JSON:Oi,"%Map%":typeof Map>"u"?Oi:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hd||!Vs?Oi:Vs(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Oi:Promise,"%Proxy%":typeof Proxy>"u"?Oi:Proxy,"%RangeError%":RI,"%ReferenceError%":PI,"%Reflect%":typeof Reflect>"u"?Oi:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Oi:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hd||!Vs?Oi:Vs(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Oi:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hd&&Vs?Vs(""[Symbol.iterator]()):Oi,"%Symbol%":hd?Symbol:Oi,"%SyntaxError%":Vd,"%ThrowTypeError%":kI,"%TypedArray%":NI,"%TypeError%":Dd,"%Uint8Array%":typeof Uint8Array>"u"?Oi:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Oi:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Oi:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Oi:Uint32Array,"%URIError%":LI,"%WeakMap%":typeof WeakMap>"u"?Oi:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Oi:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Oi:WeakSet};if(Vs)try{null.error}catch(l){var OI=Vs(Vs(l));mf["%Error.prototype%"]=OI}var FI=function l(e){var t;if(e==="%AsyncFunction%")t=m0("async function () {}");else if(e==="%GeneratorFunction%")t=m0("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=m0("async function* () {}");else if(e==="%AsyncGenerator%"){var a=l("%AsyncGeneratorFunction%");a&&(t=a.prototype)}else if(e==="%AsyncIteratorPrototype%"){var d=l("%AsyncGenerator%");d&&Vs&&(t=Vs(d.prototype))}return mf[e]=t,t},Nb={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Fm=D1,dy=jE,zI=Fm.call(Function.call,Array.prototype.concat),BI=Fm.call(Function.apply,Array.prototype.splice),Ob=Fm.call(Function.call,String.prototype.replace),py=Fm.call(Function.call,String.prototype.slice),UI=Fm.call(Function.call,RegExp.prototype.exec),VI=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,GI=/\\(\\)?/g,HI=function(e){var t=py(e,0,1),a=py(e,-1);if(t==="%"&&a!=="%")throw new Vd("invalid intrinsic syntax, expected closing `%`");if(a==="%"&&t!=="%")throw new Vd("invalid intrinsic syntax, expected opening `%`");var d=[];return Ob(e,VI,function(g,_,c,I){d[d.length]=c?Ob(I,GI,"$1"):_||g}),d},WI=function(e,t){var a=e,d;if(dy(Nb,a)&&(d=Nb[a],a="%"+d[0]+"%"),dy(mf,a)){var g=mf[a];if(g===Pd&&(g=FI(a)),typeof g>"u"&&!t)throw new Dd("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:d,name:a,value:g}}throw new Vd("intrinsic "+e+" does not exist!")},Eu=function(e,t){if(typeof e!="string"||e.length===0)throw new Dd("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Dd('"allowMissing" argument must be a boolean');if(UI(/^%?[^%]*%?$/,e)===null)throw new Vd("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var a=HI(e),d=a.length>0?a[0]:"",g=WI("%"+d+"%",t),_=g.name,c=g.value,I=!1,P=g.alias;P&&(d=P[0],BI(a,zI([0,1],P)));for(var F=1,D=!0;F<a.length;F+=1){var N=a[F],G=py(N,0,1),Z=py(N,-1);if((G==='"'||G==="'"||G==="`"||Z==='"'||Z==="'"||Z==="`")&&G!==Z)throw new Vd("property names with quotes must have matching quotes");if((N==="constructor"||!D)&&(I=!0),d+="."+N,_="%"+d+"%",dy(mf,_))c=mf[_];else if(c!=null){if(!(N in c)){if(!t)throw new Dd("base intrinsic for "+e+" exists, but the property is not available.");return}if(pf&&F+1>=a.length){var re=pf(c,N);D=!!re,D&&"get"in re&&!("originalValue"in re.get)?c=re.get:c=c[N]}else D=dy(c,N),c=c[N];D&&!I&&(mf[_]=c)}}return c},qI=Eu,K_=qI("%Object.defineProperty%",!0)||!1;if(K_)try{K_({},"a",{value:1})}catch{K_=!1}var N1=K_,$I=Eu,J_=$I("%Object.getOwnPropertyDescriptor%",!0);if(J_)try{J_([],"length")}catch{J_=null}var O1=J_,Fb=N1,XI=XE,fd=vh,zb=O1,F1=function(e,t,a){if(!e||typeof e!="object"&&typeof e!="function")throw new fd("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new fd("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new fd("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new fd("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new fd("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new fd("`loose`, if provided, must be a boolean");var d=arguments.length>3?arguments[3]:null,g=arguments.length>4?arguments[4]:null,_=arguments.length>5?arguments[5]:null,c=arguments.length>6?arguments[6]:!1,I=!!zb&&zb(e,t);if(Fb)Fb(e,t,{configurable:_===null&&I?I.configurable:!_,enumerable:d===null&&I?I.enumerable:!d,value:a,writable:g===null&&I?I.writable:!g});else if(c||!d&&!g&&!_)e[t]=a;else throw new XI("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},vx=N1,YE=function(){return!!vx};YE.hasArrayLengthDefineBug=function(){if(!vx)return null;try{return vx([],"length",{value:1}).length!==1}catch{return!0}};var z1=YE,jI=L1,ZI=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",YI=Object.prototype.toString,KI=Array.prototype.concat,Bb=F1,JI=function(l){return typeof l=="function"&&YI.call(l)==="[object Function]"},KE=z1(),QI=function(l,e,t,a){if(e in l){if(a===!0){if(l[e]===t)return}else if(!JI(a)||!a())return}KE?Bb(l,e,t,!0):Bb(l,e,t)},JE=function(l,e){var t=arguments.length>2?arguments[2]:{},a=jI(e);ZI&&(a=KI.call(a,Object.getOwnPropertySymbols(e)));for(var d=0;d<a.length;d+=1)QI(l,a[d],e[a[d]],t[a[d]])};JE.supportsDescriptors=!!KE;var bf=JE,QE={exports:{}},e2=Eu,Ub=F1,t2=z1(),Vb=O1,Gb=vh,n2=e2("%Math.floor%"),i2=function(e,t){if(typeof e!="function")throw new Gb("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||n2(t)!==t)throw new Gb("`length` must be a positive 32-bit integer");var a=arguments.length>2&&!!arguments[2],d=!0,g=!0;if("length"in e&&Vb){var _=Vb(e,"length");_&&!_.configurable&&(d=!1),_&&!_.writable&&(g=!1)}return(d||g||!a)&&(t2?Ub(e,"length",t,!0,!0):Ub(e,"length",t)),e};(function(l){var e=D1,t=Eu,a=i2,d=vh,g=t("%Function.prototype.apply%"),_=t("%Function.prototype.call%"),c=t("%Reflect.apply%",!0)||e.call(_,g),I=N1,P=t("%Math.max%");l.exports=function(N){if(typeof N!="function")throw new d("a function is required");var G=c(e,_,arguments);return a(G,1+P(0,N.length-(arguments.length-1)),!0)};var F=function(){return c(e,g,arguments)};I?I(l.exports,"apply",{value:F}):l.exports.apply=F})(QE);var ip=QE.exports,eT=Eu,tT=ip,r2=tT(eT("String.prototype.indexOf")),Ko=function(e,t){var a=eT(e,!!t);return typeof a=="function"&&r2(e,".prototype.")>-1?tT(a):a},s2=L1,nT=$y(),iT=Ko,Hb=Object,a2=iT("Array.prototype.push"),Wb=iT("Object.prototype.propertyIsEnumerable"),o2=nT?Object.getOwnPropertySymbols:null,rT=function(e,t){if(e==null)throw new TypeError("target must be an object");var a=Hb(e);if(arguments.length===1)return a;for(var d=1;d<arguments.length;++d){var g=Hb(arguments[d]),_=s2(g),c=nT&&(Object.getOwnPropertySymbols||o2);if(c)for(var I=c(g),P=0;P<I.length;++P){var F=I[P];Wb(g,F)&&a2(_,F)}for(var D=0;D<_.length;++D){var N=_[D];if(Wb(g,N)){var G=g[N];a[N]=G}}}return a},_0=rT,l2=function(){if(!Object.assign)return!1;for(var l="abcdefghijklmnopqrst",e=l.split(""),t={},a=0;a<e.length;++a)t[e[a]]=e[a];var d=Object.assign({},t),g="";for(var _ in d)g+=_;return l!==g},u2=function(){if(!Object.assign||!Object.preventExtensions)return!1;var l=Object.preventExtensions({1:2});try{Object.assign(l,"xy")}catch{return l[1]==="y"}return!1},sT=function(){return!Object.assign||l2()||u2()?_0:Object.assign},c2=bf,h2=sT,f2=function(){var e=h2();return c2(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},d2=bf,p2=ip,m2=rT,aT=sT,g2=f2,_2=p2.apply(aT()),oT=function(e,t){return _2(Object,arguments)};d2(oT,{getPolyfill:aT,implementation:m2,shim:g2});var y2=oT,Im=function(){return typeof(function(){}).name=="string"},bm=Object.getOwnPropertyDescriptor;if(bm)try{bm([],"length")}catch{bm=null}Im.functionsHaveConfigurableNames=function(){if(!Im()||!bm)return!1;var e=bm(function(){},"name");return!!e&&!!e.configurable};var v2=Function.prototype.bind;Im.boundFunctionsHaveNames=function(){return Im()&&typeof v2=="function"&&(function(){}).bind().name!==""};var x2=Im,qb=F1,b2=z1(),w2=x2.functionsHaveConfigurableNames(),S2=vh,E2=function(e,t){if(typeof e!="function")throw new S2("`fn` is not a function");var a=arguments.length>2&&!!arguments[2];return(!a||w2)&&(b2?qb(e,"name",t,!0,!0):qb(e,"name",t)),e},T2=E2,M2=vh,A2=Object,lT=T2(function(){if(this==null||this!==A2(this))throw new M2("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),I2=lT,C2=bf.supportsDescriptors,R2=Object.getOwnPropertyDescriptor,uT=function(){if(C2&&/a/mig.flags==="gim"){var e=R2(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",a={};if(Object.defineProperty(a,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(a,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return I2},P2=bf.supportsDescriptors,L2=uT,k2=Object.getOwnPropertyDescriptor,D2=Object.defineProperty,N2=TypeError,$b=Object.getPrototypeOf,O2=/a/,F2=function(){if(!P2||!$b)throw new N2("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=L2(),t=$b(O2),a=k2(t,"flags");return(!a||a.get!==e)&&D2(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},z2=bf,B2=ip,U2=lT,cT=uT,V2=F2,hT=B2(cT());z2(hT,{getPolyfill:cT,implementation:U2,shim:V2});var G2=hT,Q_={exports:{}},H2=$y,wf=function(){return H2()&&!!Symbol.toStringTag},W2=wf(),q2=Ko,xx=q2("Object.prototype.toString"),Xy=function(e){return W2&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:xx(e)==="[object Arguments]"},fT=function(e){return Xy(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&xx(e)!=="[object Array]"&&xx(e.callee)==="[object Function]"},$2=function(){return Xy(arguments)}();Xy.isLegacyArguments=fT;var dT=$2?Xy:fT;const X2={},j2=Object.freeze(Object.defineProperty({__proto__:null,default:X2},Symbol.toStringTag,{value:"Module"})),Z2=rI(j2);var B1=typeof Map=="function"&&Map.prototype,y0=Object.getOwnPropertyDescriptor&&B1?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,my=B1&&y0&&typeof y0.get=="function"?y0.get:null,Xb=B1&&Map.prototype.forEach,U1=typeof Set=="function"&&Set.prototype,v0=Object.getOwnPropertyDescriptor&&U1?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,gy=U1&&v0&&typeof v0.get=="function"?v0.get:null,jb=U1&&Set.prototype.forEach,Y2=typeof WeakMap=="function"&&WeakMap.prototype,wm=Y2?WeakMap.prototype.has:null,K2=typeof WeakSet=="function"&&WeakSet.prototype,Sm=K2?WeakSet.prototype.has:null,J2=typeof WeakRef=="function"&&WeakRef.prototype,Zb=J2?WeakRef.prototype.deref:null,Q2=Boolean.prototype.valueOf,eC=Object.prototype.toString,tC=Function.prototype.toString,nC=String.prototype.match,V1=String.prototype.slice,fh=String.prototype.replace,iC=String.prototype.toUpperCase,Yb=String.prototype.toLowerCase,pT=RegExp.prototype.test,Kb=Array.prototype.concat,pu=Array.prototype.join,rC=Array.prototype.slice,Jb=Math.floor,bx=typeof BigInt=="function"?BigInt.prototype.valueOf:null,x0=Object.getOwnPropertySymbols,wx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Gd=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ba=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Gd||!0)?Symbol.toStringTag:null,mT=Object.prototype.propertyIsEnumerable,Qb=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(l){return l.__proto__}:null);function ew(l,e){if(l===1/0||l===-1/0||l!==l||l&&l>-1e3&&l<1e3||pT.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof l=="number"){var a=l<0?-Jb(-l):Jb(l);if(a!==l){var d=String(a),g=V1.call(e,d.length+1);return fh.call(d,t,"$&_")+"."+fh.call(fh.call(g,/([0-9]{3})/g,"$&_"),/_$/,"")}}return fh.call(e,t,"$&_")}var Sx=Z2,tw=Sx.custom,nw=_T(tw)?tw:null,sC=function l(e,t,a,d){var g=t||{};if(ch(g,"quoteStyle")&&g.quoteStyle!=="single"&&g.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ch(g,"maxStringLength")&&(typeof g.maxStringLength=="number"?g.maxStringLength<0&&g.maxStringLength!==1/0:g.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var _=ch(g,"customInspect")?g.customInspect:!0;if(typeof _!="boolean"&&_!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ch(g,"indent")&&g.indent!==null&&g.indent!=="	"&&!(parseInt(g.indent,10)===g.indent&&g.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ch(g,"numericSeparator")&&typeof g.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var c=g.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return vT(e,g);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var I=String(e);return c?ew(e,I):I}if(typeof e=="bigint"){var P=String(e)+"n";return c?ew(e,P):P}var F=typeof g.depth>"u"?5:g.depth;if(typeof a>"u"&&(a=0),a>=F&&F>0&&typeof e=="object")return Ex(e)?"[Array]":"[Object]";var D=SC(g,a);if(typeof d>"u")d=[];else if(yT(d,e)>=0)return"[Circular]";function N(st,Je,mt){if(Je&&(d=rC.call(d),d.push(Je)),mt){var gt={depth:g.depth};return ch(g,"quoteStyle")&&(gt.quoteStyle=g.quoteStyle),l(st,gt,a+1,d)}return l(st,g,a+1,d)}if(typeof e=="function"&&!iw(e)){var G=pC(e),Z=h_(e,N);return"[Function"+(G?": "+G:" (anonymous)")+"]"+(Z.length>0?" { "+pu.call(Z,", ")+" }":"")}if(_T(e)){var re=Gd?fh.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):wx.call(e);return typeof e=="object"&&!Gd?nm(re):re}if(xC(e)){for(var $="<"+Yb.call(String(e.nodeName)),X=e.attributes||[],me=0;me<X.length;me++)$+=" "+X[me].name+"="+gT(aC(X[me].value),"double",g);return $+=">",e.childNodes&&e.childNodes.length&&($+="..."),$+="</"+Yb.call(String(e.nodeName))+">",$}if(Ex(e)){if(e.length===0)return"[]";var le=h_(e,N);return D&&!wC(le)?"["+Tx(le,D)+"]":"[ "+pu.call(le,", ")+" ]"}if(lC(e)){var ye=h_(e,N);return!("cause"in Error.prototype)&&"cause"in e&&!mT.call(e,"cause")?"{ ["+String(e)+"] "+pu.call(Kb.call("[cause]: "+N(e.cause),ye),", ")+" }":ye.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+pu.call(ye,", ")+" }"}if(typeof e=="object"&&_){if(nw&&typeof e[nw]=="function"&&Sx)return Sx(e,{depth:F-a});if(_!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(mC(e)){var Le=[];return Xb&&Xb.call(e,function(st,Je){Le.push(N(Je,e,!0)+" => "+N(st,e))}),rw("Map",my.call(e),Le,D)}if(yC(e)){var Me=[];return jb&&jb.call(e,function(st){Me.push(N(st,e))}),rw("Set",gy.call(e),Me,D)}if(gC(e))return b0("WeakMap");if(vC(e))return b0("WeakSet");if(_C(e))return b0("WeakRef");if(cC(e))return nm(N(Number(e)));if(fC(e))return nm(N(bx.call(e)));if(hC(e))return nm(Q2.call(e));if(uC(e))return nm(N(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof Ml<"u"&&e===Ml)return"{ [object globalThis] }";if(!oC(e)&&!iw(e)){var Te=h_(e,N),We=Qb?Qb(e)===Object.prototype:e instanceof Object||e.constructor===Object,de=e instanceof Object?"":"null prototype",be=!We&&ba&&Object(e)===e&&ba in e?V1.call(xh(e),8,-1):de?"Object":"",Oe=We||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",vt=Oe+(be||de?"["+pu.call(Kb.call([],be||[],de||[]),": ")+"] ":"");return Te.length===0?vt+"{}":D?vt+"{"+Tx(Te,D)+"}":vt+"{ "+pu.call(Te,", ")+" }"}return String(e)};function gT(l,e,t){var a=(t.quoteStyle||e)==="double"?'"':"'";return a+l+a}function aC(l){return fh.call(String(l),/"/g,"&quot;")}function Ex(l){return xh(l)==="[object Array]"&&(!ba||!(typeof l=="object"&&ba in l))}function oC(l){return xh(l)==="[object Date]"&&(!ba||!(typeof l=="object"&&ba in l))}function iw(l){return xh(l)==="[object RegExp]"&&(!ba||!(typeof l=="object"&&ba in l))}function lC(l){return xh(l)==="[object Error]"&&(!ba||!(typeof l=="object"&&ba in l))}function uC(l){return xh(l)==="[object String]"&&(!ba||!(typeof l=="object"&&ba in l))}function cC(l){return xh(l)==="[object Number]"&&(!ba||!(typeof l=="object"&&ba in l))}function hC(l){return xh(l)==="[object Boolean]"&&(!ba||!(typeof l=="object"&&ba in l))}function _T(l){if(Gd)return l&&typeof l=="object"&&l instanceof Symbol;if(typeof l=="symbol")return!0;if(!l||typeof l!="object"||!wx)return!1;try{return wx.call(l),!0}catch{}return!1}function fC(l){if(!l||typeof l!="object"||!bx)return!1;try{return bx.call(l),!0}catch{}return!1}var dC=Object.prototype.hasOwnProperty||function(l){return l in this};function ch(l,e){return dC.call(l,e)}function xh(l){return eC.call(l)}function pC(l){if(l.name)return l.name;var e=nC.call(tC.call(l),/^function\s*([\w$]+)/);return e?e[1]:null}function yT(l,e){if(l.indexOf)return l.indexOf(e);for(var t=0,a=l.length;t<a;t++)if(l[t]===e)return t;return-1}function mC(l){if(!my||!l||typeof l!="object")return!1;try{my.call(l);try{gy.call(l)}catch{return!0}return l instanceof Map}catch{}return!1}function gC(l){if(!wm||!l||typeof l!="object")return!1;try{wm.call(l,wm);try{Sm.call(l,Sm)}catch{return!0}return l instanceof WeakMap}catch{}return!1}function _C(l){if(!Zb||!l||typeof l!="object")return!1;try{return Zb.call(l),!0}catch{}return!1}function yC(l){if(!gy||!l||typeof l!="object")return!1;try{gy.call(l);try{my.call(l)}catch{return!0}return l instanceof Set}catch{}return!1}function vC(l){if(!Sm||!l||typeof l!="object")return!1;try{Sm.call(l,Sm);try{wm.call(l,wm)}catch{return!0}return l instanceof WeakSet}catch{}return!1}function xC(l){return!l||typeof l!="object"?!1:typeof HTMLElement<"u"&&l instanceof HTMLElement?!0:typeof l.nodeName=="string"&&typeof l.getAttribute=="function"}function vT(l,e){if(l.length>e.maxStringLength){var t=l.length-e.maxStringLength,a="... "+t+" more character"+(t>1?"s":"");return vT(V1.call(l,0,e.maxStringLength),e)+a}var d=fh.call(fh.call(l,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,bC);return gT(d,"single",e)}function bC(l){var e=l.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+iC.call(e.toString(16))}function nm(l){return"Object("+l+")"}function b0(l){return l+" { ? }"}function rw(l,e,t,a){var d=a?Tx(t,a):pu.call(t,", ");return l+" ("+e+") {"+d+"}"}function wC(l){for(var e=0;e<l.length;e++)if(yT(l[e],`
`)>=0)return!1;return!0}function SC(l,e){var t;if(l.indent==="	")t="	";else if(typeof l.indent=="number"&&l.indent>0)t=pu.call(Array(l.indent+1)," ");else return null;return{base:t,prev:pu.call(Array(e+1),t)}}function Tx(l,e){if(l.length===0)return"";var t=`
`+e.prev+e.base;return t+pu.call(l,","+t)+`
`+e.prev}function h_(l,e){var t=Ex(l),a=[];if(t){a.length=l.length;for(var d=0;d<l.length;d++)a[d]=ch(l,d)?e(l[d],l):""}var g=typeof x0=="function"?x0(l):[],_;if(Gd){_={};for(var c=0;c<g.length;c++)_["$"+g[c]]=g[c]}for(var I in l)ch(l,I)&&(t&&String(Number(I))===I&&I<l.length||Gd&&_["$"+I]instanceof Symbol||(pT.call(/[^\w$]/,I)?a.push(e(I,l)+": "+e(l[I],l)):a.push(I+": "+e(l[I],l))));if(typeof x0=="function")for(var P=0;P<g.length;P++)mT.call(l,g[P])&&a.push("["+e(g[P])+"]: "+e(l[g[P]],l));return a}var xT=Eu,rp=Ko,EC=sC,TC=vh,f_=xT("%WeakMap%",!0),d_=xT("%Map%",!0),MC=rp("WeakMap.prototype.get",!0),AC=rp("WeakMap.prototype.set",!0),IC=rp("WeakMap.prototype.has",!0),CC=rp("Map.prototype.get",!0),RC=rp("Map.prototype.set",!0),PC=rp("Map.prototype.has",!0),G1=function(l,e){for(var t=l,a;(a=t.next)!==null;t=a)if(a.key===e)return t.next=a.next,a.next=l.next,l.next=a,a},LC=function(l,e){var t=G1(l,e);return t&&t.value},kC=function(l,e,t){var a=G1(l,e);a?a.value=t:l.next={key:e,next:l.next,value:t}},DC=function(l,e){return!!G1(l,e)},bT=function(){var e,t,a,d={assert:function(g){if(!d.has(g))throw new TC("Side channel does not contain "+EC(g))},get:function(g){if(f_&&g&&(typeof g=="object"||typeof g=="function")){if(e)return MC(e,g)}else if(d_){if(t)return CC(t,g)}else if(a)return LC(a,g)},has:function(g){if(f_&&g&&(typeof g=="object"||typeof g=="function")){if(e)return IC(e,g)}else if(d_){if(t)return PC(t,g)}else if(a)return DC(a,g);return!1},set:function(g,_){f_&&g&&(typeof g=="object"||typeof g=="function")?(e||(e=new f_),AC(e,g,_)):d_?(t||(t=new d_),RC(t,g,_)):(a||(a={key:{},next:null}),kC(a,g,_))}};return d},NC=jE,im=bT(),lc=vh,H1={assert:function(l,e){if(!l||typeof l!="object"&&typeof l!="function")throw new lc("`O` is not an object");if(typeof e!="string")throw new lc("`slot` must be a string");if(im.assert(l),!H1.has(l,e))throw new lc("`"+e+"` is not present on `O`")},get:function(l,e){if(!l||typeof l!="object"&&typeof l!="function")throw new lc("`O` is not an object");if(typeof e!="string")throw new lc("`slot` must be a string");var t=im.get(l);return t&&t["$"+e]},has:function(l,e){if(!l||typeof l!="object"&&typeof l!="function")throw new lc("`O` is not an object");if(typeof e!="string")throw new lc("`slot` must be a string");var t=im.get(l);return!!t&&NC(t,"$"+e)},set:function(l,e,t){if(!l||typeof l!="object"&&typeof l!="function")throw new lc("`O` is not an object");if(typeof e!="string")throw new lc("`slot` must be a string");var a=im.get(l);a||(a={},im.set(l,a)),a["$"+e]=t}};Object.freeze&&Object.freeze(H1);var OC=H1,rm=OC,FC=SyntaxError,sw=typeof StopIteration=="object"?StopIteration:null,zC=function(e){if(!sw)throw new FC("this environment lacks StopIteration");rm.set(e,"[[Done]]",!1);var t={next:function(){var d=rm.get(this,"[[Iterator]]"),g=rm.get(d,"[[Done]]");try{return{done:g,value:g?void 0:d.next()}}catch(_){if(rm.set(d,"[[Done]]",!0),_!==sw)throw _;return{done:!0,value:void 0}}}};return rm.set(t,"[[Iterator]]",e),t},BC={}.toString,wT=Array.isArray||function(l){return BC.call(l)=="[object Array]"},UC=String.prototype.valueOf,VC=function(e){try{return UC.call(e),!0}catch{return!1}},GC=Object.prototype.toString,HC="[object String]",WC=wf(),ST=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:WC?VC(e):GC.call(e)===HC},W1=typeof Map=="function"&&Map.prototype?Map:null,qC=typeof Set=="function"&&Set.prototype?Set:null,_y;W1||(_y=function(e){return!1});var ET=W1?Map.prototype.has:null,aw=qC?Set.prototype.has:null;!_y&&!ET&&(_y=function(e){return!1});var TT=_y||function(e){if(!e||typeof e!="object")return!1;try{if(ET.call(e),aw)try{aw.call(e)}catch{return!0}return e instanceof W1}catch{}return!1},$C=typeof Map=="function"&&Map.prototype?Map:null,q1=typeof Set=="function"&&Set.prototype?Set:null,yy;q1||(yy=function(e){return!1});var ow=$C?Map.prototype.has:null,MT=q1?Set.prototype.has:null;!yy&&!MT&&(yy=function(e){return!1});var AT=yy||function(e){if(!e||typeof e!="object")return!1;try{if(MT.call(e),ow)try{ow.call(e)}catch{return!0}return e instanceof q1}catch{}return!1},lw=dT,uw=zC;if(k1()||$y()){var w0=Symbol.iterator;Q_.exports=function(e){if(e!=null&&typeof e[w0]<"u")return e[w0]();if(lw(e))return Array.prototype[w0].call(e)}}else{var XC=wT,jC=ST,cw=Eu,ZC=cw("%Map%",!0),YC=cw("%Set%",!0),wl=Ko,hw=wl("Array.prototype.push"),fw=wl("String.prototype.charCodeAt"),KC=wl("String.prototype.slice"),JC=function(e,t){var a=e.length;if(t+1>=a)return t+1;var d=fw(e,t);if(d<55296||d>56319)return t+1;var g=fw(e,t+1);return g<56320||g>57343?t+1:t+2},S0=function(e){var t=0;return{next:function(){var d=t>=e.length,g;return d||(g=e[t],t+=1),{done:d,value:g}}}},dw=function(e,t){if(XC(e)||lw(e))return S0(e);if(jC(e)){var a=0;return{next:function(){var g=JC(e,a),_=KC(e,a,g);return a=g,{done:g>e.length,value:_}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!ZC&&!YC)Q_.exports=function(e){if(e!=null)return dw(e,!0)};else{var QC=TT,eR=AT,pw=wl("Map.prototype.forEach",!0),mw=wl("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var gw=wl("Map.prototype.iterator",!0),_w=wl("Set.prototype.iterator",!0);var yw=wl("Map.prototype.@@iterator",!0)||wl("Map.prototype._es6-shim iterator_",!0),vw=wl("Set.prototype.@@iterator",!0)||wl("Set.prototype._es6-shim iterator_",!0),tR=function(e){if(QC(e)){if(gw)return uw(gw(e));if(yw)return yw(e);if(pw){var t=[];return pw(e,function(d,g){hw(t,[g,d])}),S0(t)}}if(eR(e)){if(_w)return uw(_w(e));if(vw)return vw(e);if(mw){var a=[];return mw(e,function(d){hw(a,d)}),S0(a)}}};Q_.exports=function(e){return tR(e)||dw(e)}}}var nR=Q_.exports,xw=function(l){return l!==l},IT=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||xw(e)&&xw(t))},iR=IT,CT=function(){return typeof Object.is=="function"?Object.is:iR},rR=CT,sR=bf,aR=function(){var e=rR();return sR(Object,{is:e},{is:function(){return Object.is!==e}}),e},oR=bf,lR=ip,uR=IT,RT=CT,cR=aR,PT=lR(RT(),Object);oR(PT,{getPolyfill:RT,implementation:uR,shim:cR});var hR=PT,fR=ip,LT=Ko,dR=Eu,Mx=dR("%ArrayBuffer%",!0),ey=LT("ArrayBuffer.prototype.byteLength",!0),pR=LT("Object.prototype.toString"),bw=!!Mx&&!ey&&new Mx(0).slice,ww=!!bw&&fR(bw),kT=ey||ww?function(e){if(!e||typeof e!="object")return!1;try{return ey?ey(e):ww(e,0),!0}catch{return!1}}:Mx?function(e){return pR(e)==="[object ArrayBuffer]"}:function(e){return!1},mR=Date.prototype.getDay,gR=function(e){try{return mR.call(e),!0}catch{return!1}},_R=Object.prototype.toString,yR="[object Date]",vR=wf(),xR=function(e){return typeof e!="object"||e===null?!1:vR?gR(e):_R.call(e)===yR},Ax=Ko,DT=wf(),NT,OT,Ix,Cx;if(DT){NT=Ax("Object.prototype.hasOwnProperty"),OT=Ax("RegExp.prototype.exec"),Ix={};var E0=function(){throw Ix};Cx={toString:E0,valueOf:E0},typeof Symbol.toPrimitive=="symbol"&&(Cx[Symbol.toPrimitive]=E0)}var bR=Ax("Object.prototype.toString"),wR=Object.getOwnPropertyDescriptor,SR="[object RegExp]",ER=DT?function(e){if(!e||typeof e!="object")return!1;var t=wR(e,"lastIndex"),a=t&&NT(t,"value");if(!a)return!1;try{OT(e,Cx)}catch(d){return d===Ix}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:bR(e)===SR},TR=Ko,Sw=TR("SharedArrayBuffer.prototype.byteLength",!0),MR=Sw?function(e){if(!e||typeof e!="object")return!1;try{return Sw(e),!0}catch{return!1}}:function(e){return!1},AR=Number.prototype.toString,IR=function(e){try{return AR.call(e),!0}catch{return!1}},CR=Object.prototype.toString,RR="[object Number]",PR=wf(),LR=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:PR?IR(e):CR.call(e)===RR},FT=Ko,kR=FT("Boolean.prototype.toString"),DR=FT("Object.prototype.toString"),NR=function(e){try{return kR(e),!0}catch{return!1}},OR="[object Boolean]",FR=wf(),zR=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:FR&&Symbol.toStringTag in e?NR(e):DR(e)===OR},Rx={exports:{}},BR=Object.prototype.toString,UR=k1();if(UR){var VR=Symbol.prototype.toString,GR=/^Symbol\(.*\)$/,HR=function(e){return typeof e.valueOf()!="symbol"?!1:GR.test(VR.call(e))};Rx.exports=function(e){if(typeof e=="symbol")return!0;if(BR.call(e)!=="[object Symbol]")return!1;try{return HR(e)}catch{return!1}}}else Rx.exports=function(e){return!1};var WR=Rx.exports,Px={exports:{}},Ew=typeof BigInt<"u"&&BigInt,qR=function(){return typeof Ew=="function"&&typeof BigInt=="function"&&typeof Ew(42)=="bigint"&&typeof BigInt(42)=="bigint"},$R=qR();if($R){var XR=BigInt.prototype.valueOf,jR=function(e){try{return XR.call(e),!0}catch{}return!1};Px.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:jR(e)}}else Px.exports=function(e){return!1};var ZR=Px.exports,YR=ST,KR=LR,JR=zR,QR=WR,eP=ZR,tP=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(YR(e))return"String";if(KR(e))return"Number";if(JR(e))return"Boolean";if(QR(e))return"Symbol";if(eP(e))return"BigInt"},vy=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,Tw=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,xy;vy||(xy=function(e){return!1});var Lx=vy?vy.prototype.has:null,T0=Tw?Tw.prototype.has:null;!xy&&!Lx&&(xy=function(e){return!1});var nP=xy||function(e){if(!e||typeof e!="object")return!1;try{if(Lx.call(e,Lx),T0)try{T0.call(e,T0)}catch{return!0}return e instanceof vy}catch{}return!1},kx={exports:{}},iP=Eu,zT=Ko,rP=iP("%WeakSet%",!0),M0=zT("WeakSet.prototype.has",!0);if(M0){var A0=zT("WeakMap.prototype.has",!0);kx.exports=function(e){if(!e||typeof e!="object")return!1;try{if(M0(e,M0),A0)try{A0(e,A0)}catch{return!0}return e instanceof rP}catch{}return!1}}else kx.exports=function(e){return!1};var sP=kx.exports,aP=TT,oP=AT,lP=nP,uP=sP,cP=function(e){if(e&&typeof e=="object"){if(aP(e))return"Map";if(oP(e))return"Set";if(lP(e))return"WeakMap";if(uP(e))return"WeakSet"}return!1},BT=Function.prototype.toString,Ld=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Dx,ty;if(typeof Ld=="function"&&typeof Object.defineProperty=="function")try{Dx=Object.defineProperty({},"length",{get:function(){throw ty}}),ty={},Ld(function(){throw 42},null,Dx)}catch(l){l!==ty&&(Ld=null)}else Ld=null;var hP=/^\s*class\b/,Nx=function(e){try{var t=BT.call(e);return hP.test(t)}catch{return!1}},I0=function(e){try{return Nx(e)?!1:(BT.call(e),!0)}catch{return!1}},ny=Object.prototype.toString,fP="[object Object]",dP="[object Function]",pP="[object GeneratorFunction]",mP="[object HTMLAllCollection]",gP="[object HTML document.all class]",_P="[object HTMLCollection]",yP=typeof Symbol=="function"&&!!Symbol.toStringTag,vP=!(0 in[,]),Ox=function(){return!1};if(typeof document=="object"){var xP=document.all;ny.call(xP)===ny.call(document.all)&&(Ox=function(e){if((vP||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=ny.call(e);return(t===mP||t===gP||t===_P||t===fP)&&e("")==null}catch{}return!1})}var bP=Ld?function(e){if(Ox(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Ld(e,null,Dx)}catch(t){if(t!==ty)return!1}return!Nx(e)&&I0(e)}:function(e){if(Ox(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(yP)return I0(e);if(Nx(e))return!1;var t=ny.call(e);return t!==dP&&t!==pP&&!/^\[object HTML/.test(t)?!1:I0(e)},wP=bP,SP=Object.prototype.toString,UT=Object.prototype.hasOwnProperty,EP=function(e,t,a){for(var d=0,g=e.length;d<g;d++)UT.call(e,d)&&(a==null?t(e[d],d,e):t.call(a,e[d],d,e))},TP=function(e,t,a){for(var d=0,g=e.length;d<g;d++)a==null?t(e.charAt(d),d,e):t.call(a,e.charAt(d),d,e)},MP=function(e,t,a){for(var d in e)UT.call(e,d)&&(a==null?t(e[d],d,e):t.call(a,e[d],d,e))},AP=function(e,t,a){if(!wP(t))throw new TypeError("iterator must be a function");var d;arguments.length>=3&&(d=a),SP.call(e)==="[object Array]"?EP(e,t,d):typeof e=="string"?TP(e,t,d):MP(e,t,d)},IP=AP,CP=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],C0=CP,RP=typeof globalThis>"u"?Ml:globalThis,PP=function(){for(var e=[],t=0;t<C0.length;t++)typeof RP[C0[t]]=="function"&&(e[e.length]=C0[t]);return e},by=IP,LP=PP,Mw=ip,$1=Ko,iy=O1,kP=$1("Object.prototype.toString"),VT=wf(),Aw=typeof globalThis>"u"?Ml:globalThis,Fx=LP(),X1=$1("String.prototype.slice"),R0=Object.getPrototypeOf,DP=$1("Array.prototype.indexOf",!0)||function(e,t){for(var a=0;a<e.length;a+=1)if(e[a]===t)return a;return-1},wy={__proto__:null};VT&&iy&&R0?by(Fx,function(l){var e=new Aw[l];if(Symbol.toStringTag in e){var t=R0(e),a=iy(t,Symbol.toStringTag);if(!a){var d=R0(t);a=iy(d,Symbol.toStringTag)}wy["$"+l]=Mw(a.get)}}):by(Fx,function(l){var e=new Aw[l],t=e.slice||e.set;t&&(wy["$"+l]=Mw(t))});var NP=function(e){var t=!1;return by(wy,function(a,d){if(!t)try{"$"+a(e)===d&&(t=X1(d,1))}catch{}}),t},OP=function(e){var t=!1;return by(wy,function(a,d){if(!t)try{a(e),t=X1(d,1)}catch{}}),t},FP=function(e){if(!e||typeof e!="object")return!1;if(!VT){var t=X1(kP(e),8,-1);return DP(Fx,t)>-1?t:t!=="Object"?!1:OP(e)}return iy?NP(e):null},zP=Ko,Iw=zP("ArrayBuffer.prototype.byteLength",!0),BP=kT,UP=function(e){return BP(e)?Iw?Iw(e):e.byteLength:NaN},GT=y2,Tu=Ko,Cw=G2,VP=Eu,Hd=nR,GP=bT,Rw=hR,Pw=dT,Lw=wT,kw=kT,Dw=xR,Nw=ER,Ow=MR,Fw=L1,zw=tP,Bw=cP,Uw=FP,Vw=UP,Gw=Tu("SharedArrayBuffer.prototype.byteLength",!0),Hw=Tu("Date.prototype.getTime"),P0=Object.getPrototypeOf,Ww=Tu("Object.prototype.toString"),Sy=VP("%Set%",!0),zx=Tu("Map.prototype.has",!0),Ey=Tu("Map.prototype.get",!0),qw=Tu("Map.prototype.size",!0),Ty=Tu("Set.prototype.add",!0),HT=Tu("Set.prototype.delete",!0),My=Tu("Set.prototype.has",!0),ry=Tu("Set.prototype.size",!0);function $w(l,e,t,a){for(var d=Hd(l),g;(g=d.next())&&!g.done;)if(Pl(e,g.value,t,a))return HT(l,g.value),!0;return!1}function WT(l){if(typeof l>"u")return null;if(typeof l!="object")return typeof l=="symbol"?!1:typeof l=="string"||typeof l=="number"?+l==+l:!0}function HP(l,e,t,a,d,g){var _=WT(t);if(_!=null)return _;var c=Ey(e,_),I=GT({},d,{strict:!1});return typeof c>"u"&&!zx(e,_)||!Pl(a,c,I,g)?!1:!zx(l,_)&&Pl(a,c,I,g)}function WP(l,e,t){var a=WT(t);return a??(My(e,a)&&!My(l,a))}function Xw(l,e,t,a,d,g){for(var _=Hd(l),c,I;(c=_.next())&&!c.done;)if(I=c.value,Pl(t,I,d,g)&&Pl(a,Ey(e,I),d,g))return HT(l,I),!0;return!1}function Pl(l,e,t,a){var d=t||{};if(d.strict?Rw(l,e):l===e)return!0;var g=zw(l),_=zw(e);if(g!==_)return!1;if(!l||!e||typeof l!="object"&&typeof e!="object")return d.strict?Rw(l,e):l==e;var c=a.has(l),I=a.has(e),P;if(c&&I){if(a.get(l)===a.get(e))return!0}else P={};return c||a.set(l,P),I||a.set(e,P),XP(l,e,d,a)}function jw(l){return!l||typeof l!="object"||typeof l.length!="number"||typeof l.copy!="function"||typeof l.slice!="function"||l.length>0&&typeof l[0]!="number"?!1:!!(l.constructor&&l.constructor.isBuffer&&l.constructor.isBuffer(l))}function qP(l,e,t,a){if(ry(l)!==ry(e))return!1;for(var d=Hd(l),g=Hd(e),_,c,I;(_=d.next())&&!_.done;)if(_.value&&typeof _.value=="object")I||(I=new Sy),Ty(I,_.value);else if(!My(e,_.value)){if(t.strict||!WP(l,e,_.value))return!1;I||(I=new Sy),Ty(I,_.value)}if(I){for(;(c=g.next())&&!c.done;)if(c.value&&typeof c.value=="object"){if(!$w(I,c.value,t.strict,a))return!1}else if(!t.strict&&!My(l,c.value)&&!$w(I,c.value,t.strict,a))return!1;return ry(I)===0}return!0}function $P(l,e,t,a){if(qw(l)!==qw(e))return!1;for(var d=Hd(l),g=Hd(e),_,c,I,P,F,D;(_=d.next())&&!_.done;)if(P=_.value[0],F=_.value[1],P&&typeof P=="object")I||(I=new Sy),Ty(I,P);else if(D=Ey(e,P),typeof D>"u"&&!zx(e,P)||!Pl(F,D,t,a)){if(t.strict||!HP(l,e,P,F,t,a))return!1;I||(I=new Sy),Ty(I,P)}if(I){for(;(c=g.next())&&!c.done;)if(P=c.value[0],D=c.value[1],P&&typeof P=="object"){if(!Xw(I,l,P,D,t,a))return!1}else if(!t.strict&&(!l.has(P)||!Pl(Ey(l,P),D,t,a))&&!Xw(I,l,P,D,GT({},t,{strict:!1}),a))return!1;return ry(I)===0}return!0}function XP(l,e,t,a){var d,g;if(typeof l!=typeof e||l==null||e==null||Ww(l)!==Ww(e)||Pw(l)!==Pw(e))return!1;var _=Lw(l),c=Lw(e);if(_!==c)return!1;var I=l instanceof Error,P=e instanceof Error;if(I!==P||(I||P)&&(l.name!==e.name||l.message!==e.message))return!1;var F=Nw(l),D=Nw(e);if(F!==D||(F||D)&&(l.source!==e.source||Cw(l)!==Cw(e)))return!1;var N=Dw(l),G=Dw(e);if(N!==G||(N||G)&&Hw(l)!==Hw(e)||t.strict&&P0&&P0(l)!==P0(e))return!1;var Z=Uw(l),re=Uw(e);if(Z!==re)return!1;if(Z||re){if(l.length!==e.length)return!1;for(d=0;d<l.length;d++)if(l[d]!==e[d])return!1;return!0}var $=jw(l),X=jw(e);if($!==X)return!1;if($||X){if(l.length!==e.length)return!1;for(d=0;d<l.length;d++)if(l[d]!==e[d])return!1;return!0}var me=kw(l),le=kw(e);if(me!==le)return!1;if(me||le)return Vw(l)!==Vw(e)?!1:typeof Uint8Array=="function"&&Pl(new Uint8Array(l),new Uint8Array(e),t,a);var ye=Ow(l),Le=Ow(e);if(ye!==Le)return!1;if(ye||Le)return Gw(l)!==Gw(e)?!1:typeof Uint8Array=="function"&&Pl(new Uint8Array(l),new Uint8Array(e),t,a);if(typeof l!=typeof e)return!1;var Me=Fw(l),Te=Fw(e);if(Me.length!==Te.length)return!1;for(Me.sort(),Te.sort(),d=Me.length-1;d>=0;d--)if(Me[d]!=Te[d])return!1;for(d=Me.length-1;d>=0;d--)if(g=Me[d],!Pl(l[g],e[g],t,a))return!1;var We=Bw(l),de=Bw(e);return We!==de?!1:We==="Set"||de==="Set"?qP(l,e,t,a):We==="Map"?$P(l,e,t,a):!0}var jP=function(e,t,a){return Pl(e,t,a,GP())};const ZP=qy(jP);var YP=Object.defineProperty,dr=(l,e)=>YP(l,"name",{value:e,configurable:!0}),KP=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,a,d;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(a=e==null?void 0:e.direction)!=null?a:!1,this.compareProperties=(d=e==null?void 0:e.compareProperties)!=null?d:!0}compare(e,t){if(e.type!==t.type||!mm(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const a=Bx(e),d=Bx(t);return a.every(g=>d.some(_=>this.compare(g,_)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((a,d)=>Math.abs(a-t[d])<this.precision)}compareLine(e,t,a=0,d=!1){if(!mm(e,t))return!1;const g=e;let _=t;if(d&&!this.compareCoord(g[0],_[0])){const I=this.fixStartIndex(_,g);if(I)_=I;else return!1}const c=this.compareCoord(g[a],_[a]);return this.direction||c?this.comparePath(g,_):this.compareCoord(g[a],_[_.length-(1+a)])?this.comparePath(g.slice().reverse(),_):!1}fixStartIndex(e,t){let a,d=-1;for(let g=0;g<e.length;g++)if(this.compareCoord(e[g],t[0])){d=g;break}return d>=0&&(a=[].concat(e.slice(d,e.length),e.slice(1,d+1))),a}comparePath(e,t){return e.every((a,d)=>this.compareCoord(a,t[d]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const a=e.coordinates.slice(1,e.coordinates.length),d=t.coordinates.slice(1,t.coordinates.length);return a.every(g=>d.some(_=>this.compareLine(g,_,1,!0)))}return!1}compareGeometryCollection(e,t){return mm(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((a,d)=>this.compare(a,t.geometries[d]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?ZP(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return mm(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((a,d)=>this.compare(a,t.features[d]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};dr(KP,"GeojsonEquality");function mm(l,e){return l.coordinates?l.coordinates.length===e.coordinates.length:l.length===e.length}dr(mm,"sameLength");function Bx(l){return l.coordinates.map(e=>({type:l.type.replace("Multi",""),coordinates:e}))}dr(Bx,"explode");var to=63710088e-1,qT={centimeters:to*100,centimetres:to*100,degrees:360/(2*Math.PI),feet:to*3.28084,inches:to*39.37,kilometers:to/1e3,kilometres:to/1e3,meters:to,metres:to,miles:to/1609.344,millimeters:to*1e3,millimetres:to*1e3,nauticalmiles:to/1852,radians:1,yards:to*1.0936},Zw={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function kl(l,e,t={}){const a={type:"Feature"};return(t.id===0||t.id)&&(a.id=t.id),t.bbox&&(a.bbox=t.bbox),a.properties=e||{},a.geometry=l,a}dr(kl,"feature");function JP(l,e,t={}){switch(l){case"Point":return mu(e).geometry;case"LineString":return yu(e).geometry;case"Polygon":return j1(e).geometry;case"MultiPoint":return jT(e).geometry;case"MultiLineString":return XT(e).geometry;case"MultiPolygon":return ZT(e).geometry;default:throw new Error(l+" is invalid")}}dr(JP,"geometry");function mu(l,e,t={}){if(!l)throw new Error("coordinates is required");if(!Array.isArray(l))throw new Error("coordinates must be an Array");if(l.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ay(l[0])||!Ay(l[1]))throw new Error("coordinates must contain numbers");return kl({type:"Point",coordinates:l},e,t)}dr(mu,"point");function $T(l,e,t={}){return _f(l.map(a=>mu(a,e)),t)}dr($T,"points");function j1(l,e,t={}){for(const d of l){if(d.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(d[d.length-1].length!==d[0].length)throw new Error("First and last Position are not equivalent.");for(let g=0;g<d[d.length-1].length;g++)if(d[d.length-1][g]!==d[0][g])throw new Error("First and last Position are not equivalent.")}return kl({type:"Polygon",coordinates:l},e,t)}dr(j1,"polygon");function QP(l,e,t={}){return _f(l.map(a=>j1(a,e)),t)}dr(QP,"polygons");function yu(l,e,t={}){if(l.length<2)throw new Error("coordinates must be an array of two or more positions");return kl({type:"LineString",coordinates:l},e,t)}dr(yu,"lineString");function eL(l,e,t={}){return _f(l.map(a=>yu(a,e)),t)}dr(eL,"lineStrings");function _f(l,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=l,t}dr(_f,"featureCollection");function XT(l,e,t={}){return kl({type:"MultiLineString",coordinates:l},e,t)}dr(XT,"multiLineString");function jT(l,e,t={}){return kl({type:"MultiPoint",coordinates:l},e,t)}dr(jT,"multiPoint");function ZT(l,e,t={}){return kl({type:"MultiPolygon",coordinates:l},e,t)}dr(ZT,"multiPolygon");function tL(l,e,t={}){return kl({type:"GeometryCollection",geometries:l},e,t)}dr(tL,"geometryCollection");function nL(l,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(l*t)/t}dr(nL,"round");function Z1(l,e="kilometers"){const t=qT[e];if(!t)throw new Error(e+" units is invalid");return l*t}dr(Z1,"radiansToLength");function jy(l,e="kilometers"){const t=qT[e];if(!t)throw new Error(e+" units is invalid");return l/t}dr(jy,"lengthToRadians");function iL(l,e){return YT(jy(l,e))}dr(iL,"lengthToDegrees");function rL(l){let e=l%360;return e<0&&(e+=360),e}dr(rL,"bearingToAzimuth");function YT(l){return l%(2*Math.PI)*180/Math.PI}dr(YT,"radiansToDegrees");function sL(l){return l%360*Math.PI/180}dr(sL,"degreesToRadians");function aL(l,e="kilometers",t="kilometers"){if(!(l>=0))throw new Error("length must be a positive number");return Z1(jy(l,e),t)}dr(aL,"convertLength");function oL(l,e="meters",t="kilometers"){if(!(l>=0))throw new Error("area must be a positive number");const a=Zw[e];if(!a)throw new Error("invalid original units");const d=Zw[t];if(!d)throw new Error("invalid final units");return l/a*d}dr(oL,"convertArea");function Ay(l){return!isNaN(l)&&l!==null&&!Array.isArray(l)}dr(Ay,"isNumber");function Y1(l){return l!==null&&typeof l=="object"&&!Array.isArray(l)}dr(Y1,"isObject");function lL(l){if(!l)throw new Error("bbox is required");if(!Array.isArray(l))throw new Error("bbox must be an Array");if(l.length!==4&&l.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");l.forEach(e=>{if(!Ay(e))throw new Error("bbox must only contain numbers")})}dr(lL,"validateBBox");function uL(l){if(!l)throw new Error("id is required");if(["string","number"].indexOf(typeof l)===-1)throw new Error("id must be a number or a string")}dr(uL,"validateId");var cL=Object.defineProperty,ra=(l,e)=>cL(l,"name",{value:e,configurable:!0});function sp(l,e,t){if(l!==null)for(var a,d,g,_,c,I,P,F=0,D=0,N,G=l.type,Z=G==="FeatureCollection",re=G==="Feature",$=Z?l.features.length:1,X=0;X<$;X++){P=Z?l.features[X].geometry:re?l.geometry:l,N=P?P.type==="GeometryCollection":!1,c=N?P.geometries.length:1;for(var me=0;me<c;me++){var le=0,ye=0;if(_=N?P.geometries[me]:P,_!==null){I=_.coordinates;var Le=_.type;switch(F=t&&(Le==="Polygon"||Le==="MultiPolygon")?1:0,Le){case null:break;case"Point":if(e(I,D,X,le,ye)===!1)return!1;D++,le++;break;case"LineString":case"MultiPoint":for(a=0;a<I.length;a++){if(e(I[a],D,X,le,ye)===!1)return!1;D++,Le==="MultiPoint"&&le++}Le==="LineString"&&le++;break;case"Polygon":case"MultiLineString":for(a=0;a<I.length;a++){for(d=0;d<I[a].length-F;d++){if(e(I[a][d],D,X,le,ye)===!1)return!1;D++}Le==="MultiLineString"&&le++,Le==="Polygon"&&ye++}Le==="Polygon"&&le++;break;case"MultiPolygon":for(a=0;a<I.length;a++){for(ye=0,d=0;d<I[a].length;d++){for(g=0;g<I[a][d].length-F;g++){if(e(I[a][d][g],D,X,le,ye)===!1)return!1;D++}ye++}le++}break;case"GeometryCollection":for(a=0;a<_.geometries.length;a++)if(sp(_.geometries[a],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}ra(sp,"coordEach");function hL(l,e,t,a){var d=t;return sp(l,function(g,_,c,I,P){_===0&&t===void 0?d=g:d=e(d,g,_,c,I,P)},a),d}ra(hL,"coordReduce");function KT(l,e){var t;switch(l.type){case"FeatureCollection":for(t=0;t<l.features.length&&e(l.features[t].properties,t)!==!1;t++);break;case"Feature":e(l.properties,0);break}}ra(KT,"propEach");function fL(l,e,t){var a=t;return KT(l,function(d,g){g===0&&t===void 0?a=d:a=e(a,d,g)}),a}ra(fL,"propReduce");function Iy(l,e){if(l.type==="Feature")e(l,0);else if(l.type==="FeatureCollection")for(var t=0;t<l.features.length&&e(l.features[t],t)!==!1;t++);}ra(Iy,"featureEach");function dL(l,e,t){var a=t;return Iy(l,function(d,g){g===0&&t===void 0?a=d:a=e(a,d,g)}),a}ra(dL,"featureReduce");function pL(l){var e=[];return sp(l,function(t){e.push(t)}),e}ra(pL,"coordAll");function zm(l,e){var t,a,d,g,_,c,I,P,F,D,N=0,G=l.type==="FeatureCollection",Z=l.type==="Feature",re=G?l.features.length:1;for(t=0;t<re;t++){for(c=G?l.features[t].geometry:Z?l.geometry:l,P=G?l.features[t].properties:Z?l.properties:{},F=G?l.features[t].bbox:Z?l.bbox:void 0,D=G?l.features[t].id:Z?l.id:void 0,I=c?c.type==="GeometryCollection":!1,_=I?c.geometries.length:1,d=0;d<_;d++){if(g=I?c.geometries[d]:c,g===null){if(e(null,N,P,F,D)===!1)return!1;continue}switch(g.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(g,N,P,F,D)===!1)return!1;break}case"GeometryCollection":{for(a=0;a<g.geometries.length;a++)if(e(g.geometries[a],N,P,F,D)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}ra(zm,"geomEach");function mL(l,e,t){var a=t;return zm(l,function(d,g,_,c,I){g===0&&t===void 0?a=d:a=e(a,d,g,_,c,I)}),a}ra(mL,"geomReduce");function Zy(l,e){zm(l,function(t,a,d,g,_){var c=t===null?null:t.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return e(kl(t,d,{bbox:g,id:_}),a,0)===!1?!1:void 0}var I;switch(c){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var P=0;P<t.coordinates.length;P++){var F=t.coordinates[P],D={type:I,coordinates:F};if(e(kl(D,d),a,P)===!1)return!1}})}ra(Zy,"flattenEach");function gL(l,e,t){var a=t;return Zy(l,function(d,g,_){g===0&&_===0&&t===void 0?a=d:a=e(a,d,g,_)}),a}ra(gL,"flattenReduce");function JT(l,e){Zy(l,function(t,a,d){var g=0;if(t.geometry){var _=t.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var c,I=0,P=0,F=0;if(sp(t,function(D,N,G,Z,re){if(c===void 0||a>I||Z>P||re>F){c=D,I=a,P=Z,F=re,g=0;return}var $=yu([c,D],t.properties);if(e($,a,d,re,g)===!1)return!1;g++,c=D})===!1)return!1}}})}ra(JT,"segmentEach");function _L(l,e,t){var a=t,d=!1;return JT(l,function(g,_,c,I,P){d===!1&&t===void 0?a=g:a=e(a,g,_,c,I,P),d=!0}),a}ra(_L,"segmentReduce");function QT(l,e){if(!l)throw new Error("geojson is required");Zy(l,function(t,a,d){if(t.geometry!==null){var g=t.geometry.type,_=t.geometry.coordinates;switch(g){case"LineString":if(e(t,a,d,0,0)===!1)return!1;break;case"Polygon":for(var c=0;c<_.length;c++)if(e(yu(_[c],t.properties),a,d,c)===!1)return!1;break}}})}ra(QT,"lineEach");function yL(l,e,t){var a=t;return QT(l,function(d,g,_,c){g===0&&t===void 0?a=d:a=e(a,d,g,_,c)}),a}ra(yL,"lineReduce");function vL(l,e){if(e=e||{},!Y1(e))throw new Error("options is invalid");var t=e.featureIndex||0,a=e.multiFeatureIndex||0,d=e.geometryIndex||0,g=e.segmentIndex||0,_=e.properties,c;switch(l.type){case"FeatureCollection":t<0&&(t=l.features.length+t),_=_||l.features[t].properties,c=l.features[t].geometry;break;case"Feature":_=_||l.properties,c=l.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=l;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var I=c.coordinates;switch(c.type){case"Point":case"MultiPoint":return null;case"LineString":return g<0&&(g=I.length+g-1),yu([I[g],I[g+1]],_,e);case"Polygon":return d<0&&(d=I.length+d),g<0&&(g=I[d].length+g-1),yu([I[d][g],I[d][g+1]],_,e);case"MultiLineString":return a<0&&(a=I.length+a),g<0&&(g=I[a].length+g-1),yu([I[a][g],I[a][g+1]],_,e);case"MultiPolygon":return a<0&&(a=I.length+a),d<0&&(d=I[a].length+d),g<0&&(g=I[a][d].length-g-1),yu([I[a][d][g],I[a][d][g+1]],_,e)}throw new Error("geojson is invalid")}ra(vL,"findSegment");function xL(l,e){if(e=e||{},!Y1(e))throw new Error("options is invalid");var t=e.featureIndex||0,a=e.multiFeatureIndex||0,d=e.geometryIndex||0,g=e.coordIndex||0,_=e.properties,c;switch(l.type){case"FeatureCollection":t<0&&(t=l.features.length+t),_=_||l.features[t].properties,c=l.features[t].geometry;break;case"Feature":_=_||l.properties,c=l.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=l;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var I=c.coordinates;switch(c.type){case"Point":return mu(I,_,e);case"MultiPoint":return a<0&&(a=I.length+a),mu(I[a],_,e);case"LineString":return g<0&&(g=I.length+g),mu(I[g],_,e);case"Polygon":return d<0&&(d=I.length+d),g<0&&(g=I[d].length+g),mu(I[d][g],_,e);case"MultiLineString":return a<0&&(a=I.length+a),g<0&&(g=I[a].length+g),mu(I[a][g],_,e);case"MultiPolygon":return a<0&&(a=I.length+a),d<0&&(d=I[a].length+d),g<0&&(g=I[a][d].length-g),mu(I[a][d][g],_,e)}throw new Error("geojson is invalid")}ra(xL,"findPoint");var bL=Object.defineProperty,wL=(l,e)=>bL(l,"name",{value:e,configurable:!0});function eM(l,e={}){if(l.bbox!=null&&e.recompute!==!0)return l.bbox;const t=[1/0,1/0,-1/0,-1/0];return sp(l,a=>{t[0]>a[0]&&(t[0]=a[0]),t[1]>a[1]&&(t[1]=a[1]),t[2]<a[0]&&(t[2]=a[0]),t[3]<a[1]&&(t[3]=a[1])}),t}wL(eM,"bbox");var SL=Object.defineProperty,EL=(l,e)=>SL(l,"name",{value:e,configurable:!0});function K1(l,e={}){const t=eM(l),a=(t[0]+t[2])/2,d=(t[1]+t[3])/2;return mu([a,d],e.properties,e)}EL(K1,"center");var tM={exports:{}};(function(l,e){(function(t,a){l.exports=a()})(Ml,function(){function t(S,s){if(!(S instanceof s))throw new TypeError("Cannot call a class as a function")}function a(S,s){for(var u=0;u<s.length;u++){var f=s[u];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(S,f.key,f)}}function d(S,s,u){return s&&a(S.prototype,s),u&&a(S,u),S}function g(S,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(s&&s.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),s&&c(S,s)}function _(S){return _=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)},_(S)}function c(S,s){return c=Object.setPrototypeOf||function(u,f){return u.__proto__=f,u},c(S,s)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(S,s,u){return P=I()?Reflect.construct:function(f,v,C){var B=[null];B.push.apply(B,v);var j=new(Function.bind.apply(f,B));return C&&c(j,C.prototype),j},P.apply(null,arguments)}function F(S){var s=typeof Map=="function"?new Map:void 0;return F=function(u){if(u===null||(f=u,Function.toString.call(f).indexOf("[native code]")===-1))return u;var f;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(u))return s.get(u);s.set(u,v)}function v(){return P(u,arguments,_(this).constructor)}return v.prototype=Object.create(u.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),c(v,u)},F(S)}function D(S){if(S===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function N(S,s){if(s&&(typeof s=="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return D(S)}function G(S){var s=I();return function(){var u,f=_(S);if(s){var v=_(this).constructor;u=Reflect.construct(f,arguments,v)}else u=f.apply(this,arguments);return N(this,u)}}function Z(S,s,u){return Z=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(f,v,C){var B=function(Q,xe){for(;!Object.prototype.hasOwnProperty.call(Q,xe)&&(Q=_(Q))!==null;);return Q}(f,v);if(B){var j=Object.getOwnPropertyDescriptor(B,v);return j.get?j.get.call(C):j.value}},Z(S,s,u||S)}function re(S){return function(s){if(Array.isArray(s))return X(s)}(S)||function(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}(S)||$(S)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function $(S,s){if(S){if(typeof S=="string")return X(S,s);var u=Object.prototype.toString.call(S).slice(8,-1);return u==="Object"&&S.constructor&&(u=S.constructor.name),u==="Map"||u==="Set"?Array.from(S):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?X(S,s):void 0}}function X(S,s){(s==null||s>S.length)&&(s=S.length);for(var u=0,f=new Array(s);u<s;u++)f[u]=S[u];return f}function me(S,s){var u=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!u){if(Array.isArray(S)||(u=$(S))||s){u&&(S=u);var f=0,v=function(){};return{s:v,n:function(){return f>=S.length?{done:!0}:{done:!1,value:S[f++]}},e:function(Q){throw Q},f:v}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C,B=!0,j=!1;return{s:function(){u=u.call(S)},n:function(){var Q=u.next();return B=Q.done,Q},e:function(Q){j=!0,C=Q},f:function(){try{B||u.return==null||u.return()}finally{if(j)throw C}}}}var le=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(s){this._quadrantSegments=s,this._quadrantSegments===0&&(this._joinStyle=S.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=S.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),s<=0&&(this._quadrantSegments=1),this._joinStyle!==S.JOIN_ROUND&&(this._quadrantSegments=S.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(s){this._joinStyle=s}},{key:"setSimplifyFactor",value:function(s){this._simplifyFactor=s<0?0:s}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(s){this._endCapStyle=s}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(s){this._mitreLimit=s}},{key:"setSingleSided",value:function(s){this._isSingleSided=s}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=S.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=S.CAP_ROUND,this._joinStyle=S.JOIN_ROUND,this._mitreLimit=S.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=S.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setQuadrantSegments(s)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this.setQuadrantSegments(u),this.setEndCapStyle(f)}else if(arguments.length===4){var v=arguments[0],C=arguments[1],B=arguments[2],j=arguments[3];this.setQuadrantSegments(v),this.setEndCapStyle(C),this.setJoinStyle(B),this.setMitreLimit(j)}}}},{key:"bufferDistanceError",value:function(s){var u=Math.PI/2/s;return 1-Math.cos(u/2)}}]),S}();le.CAP_ROUND=1,le.CAP_FLAT=2,le.CAP_SQUARE=3,le.JOIN_ROUND=1,le.JOIN_MITRE=2,le.JOIN_BEVEL=3,le.DEFAULT_QUADRANT_SEGMENTS=8,le.DEFAULT_MITRE_LIMIT=5,le.DEFAULT_SIMPLIFY_FACTOR=.01;var ye=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({Exception:u})[0],v}return d(u,[{key:"toString",value:function(){return this.message}}]),u}(F(Error)),Le=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({IllegalArgumentException:u})[0],v}return u}(ye),Me=function(){function S(){t(this,S)}return d(S,[{key:"filter",value:function(s){}}]),S}();function Te(){}function We(){}function de(){}var be,Oe,vt,st,Je,mt,gt,wt,yt=function(){function S(){t(this,S)}return d(S,null,[{key:"equalsWithTolerance",value:function(s,u,f){return Math.abs(s-u)<=f}}]),S}(),Jt=function(){function S(s,u){t(this,S),this.low=u||0,this.high=s||0}return d(S,null,[{key:"toBinaryString",value:function(s){var u,f="";for(u=2147483648;u>0;u>>>=1)f+=(s.high&u)===u?"1":"0";for(u=2147483648;u>0;u>>>=1)f+=(s.low&u)===u?"1":"0";return f}}]),S}();function Tt(){}function jt(){}Tt.NaN=NaN,Tt.isNaN=function(S){return Number.isNaN(S)},Tt.isInfinite=function(S){return!Number.isFinite(S)},Tt.MAX_VALUE=Number.MAX_VALUE,Tt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Tt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(mt=2146435072,gt=new Float64Array(1),wt=new Int32Array(gt.buffer),Tt.doubleToLongBits=function(S){gt[0]=S;var s=0|wt[0],u=0|wt[1];return(u&mt)===mt&&1048575&u&&s!==0&&(s=0,u=2146959360),new Jt(u,s)},Tt.longBitsToDouble=function(S){return wt[0]=S.low,wt[1]=S.high,gt[0]}):(be=1023,Oe=Math.log2,vt=Math.floor,st=Math.pow,Je=function(){for(var S=53;S>0;S--){var s=st(2,S)-1;if(vt(Oe(s))+1===S)return s}return 0}(),Tt.doubleToLongBits=function(S){var s,u,f,v,C,B,j,Q,xe;if(S<0||1/S===Number.NEGATIVE_INFINITY?(B=1<<31,S=-S):B=0,S===0)return new Jt(Q=B,xe=0);if(S===1/0)return new Jt(Q=2146435072|B,xe=0);if(S!=S)return new Jt(Q=2146959360,xe=0);if(v=0,xe=0,(s=vt(S))>1)if(s<=Je)(v=vt(Oe(s)))<=20?(xe=0,Q=s<<20-v&1048575):(xe=s%(u=st(2,f=v-20))<<32-f,Q=s/u&1048575);else for(f=s,xe=0;(f=vt(u=f/2))!==0;)v++,xe>>>=1,xe|=(1&Q)<<31,Q>>>=1,u!==f&&(Q|=524288);if(j=v+be,C=s===0,s=S-s,v<52&&s!==0)for(f=0;;){if((u=2*s)>=1?(s=u-1,C?(j--,C=!1):(f<<=1,f|=1,v++)):(s=u,C?--j==0&&(v++,C=!1):(f<<=1,v++)),v===20)Q|=f,f=0;else if(v===52){xe|=f;break}if(u===1){v<20?Q|=f<<20-v:v<52&&(xe|=f<<52-v);break}}return Q|=j<<20,new Jt(Q|=B,xe)},Tt.longBitsToDouble=function(S){var s,u,f,v,C=S.high,B=S.low,j=C&1<<31?-1:1;for(f=((2146435072&C)>>20)-be,v=0,u=1<<19,s=1;s<=20;s++)C&u&&(v+=st(2,-s)),u>>>=1;for(u=1<<31,s=21;s<=52;s++)B&u&&(v+=st(2,-s)),u>>>=1;if(f===-1023){if(v===0)return 0*j;f=-1022}else{if(f===1024)return v===0?j/0:NaN;v+=1}return j*v*st(2,f)});var Cn=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({RuntimeException:u})[0],v}return u}(ye),jn=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,null,[{key:"constructor_",value:function(){if(arguments.length===0)Cn.constructor_.call(this);else if(arguments.length===1){var f=arguments[0];Cn.constructor_.call(this,f)}}}]),u}(Cn),ht=function(){function S(){t(this,S)}return d(S,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)S.shouldNeverReachHere(null);else if(arguments.length===1){var s=arguments[0];throw new jn("Should never reach here"+(s!==null?": "+s:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var s=arguments[0];S.isTrue(s,null)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];if(!u)throw f===null?new jn:new jn(f)}}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];S.equals(s,u,null)}else if(arguments.length===3){var f=arguments[0],v=arguments[1],C=arguments[2];if(!v.equals(f))throw new jn("Expected "+f+" but encountered "+v+(C!==null?": "+C:""))}}}]),S}(),Ft=new ArrayBuffer(8),mn=new Float64Array(Ft),cn=new Int32Array(Ft),qe=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getM",value:function(){return Tt.NaN}},{key:"setOrdinate",value:function(s,u){switch(s){case S.X:this.x=u;break;case S.Y:this.y=u;break;case S.Z:this.setZ(u);break;default:throw new Le("Invalid ordinate index: "+s)}}},{key:"equals2D",value:function(){if(arguments.length===1){var s=arguments[0];return this.x===s.x&&this.y===s.y}if(arguments.length===2){var u=arguments[0],f=arguments[1];return!!yt.equalsWithTolerance(this.x,u.x,f)&&!!yt.equalsWithTolerance(this.y,u.y,f)}}},{key:"setM",value:function(s){throw new Le("Invalid ordinate index: "+S.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(s){switch(s){case S.X:return this.x;case S.Y:return this.y;case S.Z:return this.getZ()}throw new Le("Invalid ordinate index: "+s)}},{key:"equals3D",value:function(s){return this.x===s.x&&this.y===s.y&&(this.getZ()===s.getZ()||Tt.isNaN(this.getZ())&&Tt.isNaN(s.getZ()))}},{key:"equals",value:function(s){return s instanceof S&&this.equals2D(s)}},{key:"equalInZ",value:function(s,u){return yt.equalsWithTolerance(this.getZ(),s.getZ(),u)}},{key:"setX",value:function(s){this.x=s}},{key:"compareTo",value:function(s){var u=s;return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(s){this.z=s}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return ht.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw s}}},{key:"copy",value:function(){return new S(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(s){var u=this.x-s.x,f=this.y-s.y,v=this.getZ()-s.getZ();return Math.sqrt(u*u+f*f+v*v)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(s){this.y=s}},{key:"distance",value:function(s){var u=this.x-s.x,f=this.y-s.y;return Math.sqrt(u*u+f*f)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*s+S.hashCode(this.x))+S.hashCode(this.y)}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}},{key:"interfaces_",get:function(){return[Te,We,de]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)S.constructor_.call(this,0,0);else if(arguments.length===1){var s=arguments[0];S.constructor_.call(this,s.x,s.y,s.getZ())}else if(arguments.length===2){var u=arguments[0],f=arguments[1];S.constructor_.call(this,u,f,S.NULL_ORDINATE)}else if(arguments.length===3){var v=arguments[0],C=arguments[1],B=arguments[2];this.x=v,this.y=C,this.z=B}}},{key:"hashCode",value:function(s){return mn[0]=s,cn[0]^cn[1]}}]),S}(),Wn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"compare",value:function(s,u){var f=S.compare(s.x,u.x);if(f!==0)return f;var v=S.compare(s.y,u.y);return v!==0?v:this._dimensionsToTest<=2?0:S.compare(s.getZ(),u.getZ())}},{key:"interfaces_",get:function(){return[jt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)S.constructor_.call(this,2);else if(arguments.length===1){var s=arguments[0];if(s!==2&&s!==3)throw new Le("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}}},{key:"compare",value:function(s,u){return s<u?-1:s>u?1:Tt.isNaN(s)?Tt.isNaN(u)?0:-1:Tt.isNaN(u)?1:0}}]),S}();qe.DimensionalComparator=Wn,qe.NULL_ORDINATE=Tt.NaN,qe.X=0,qe.Y=1,qe.Z=2,qe.M=3;var bn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(s){if(!(s instanceof S))return!1;var u=s;return this.isNull()?u.isNull():this._maxx===u.getMaxX()&&this._maxy===u.getMaxY()&&this._minx===u.getMinX()&&this._miny===u.getMinY()}},{key:"intersection",value:function(s){if(this.isNull()||s.isNull()||!this.intersects(s))return new S;var u=this._minx>s._minx?this._minx:s._minx,f=this._miny>s._miny?this._miny:s._miny;return new S(u,this._maxx<s._maxx?this._maxx:s._maxx,f,this._maxy<s._maxy?this._maxy:s._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof qe){var s=arguments[0];return this.covers(s.x,s.y)}if(arguments[0]instanceof S){var u=arguments[0];return!this.isNull()&&!u.isNull()&&u.getMinX()>=this._minx&&u.getMaxX()<=this._maxx&&u.getMinY()>=this._miny&&u.getMaxY()<=this._maxy}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];return!this.isNull()&&f>=this._minx&&f<=this._maxx&&v>=this._miny&&v<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof S){var s=arguments[0];return!this.isNull()&&!s.isNull()&&!(s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny)}if(arguments[0]instanceof qe){var u=arguments[0];return this.intersects(u.x,u.y)}}else if(arguments.length===2){if(arguments[0]instanceof qe&&arguments[1]instanceof qe){var f=arguments[0],v=arguments[1];if(this.isNull())return!1;var C=f.x<v.x?f.x:v.x;if(C>this._maxx)return!1;var B=f.x>v.x?f.x:v.x;if(B<this._minx)return!1;var j=f.y<v.y?f.y:v.y;if(j>this._maxy)return!1;var Q=f.y>v.y?f.y:v.y;return!(Q<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var xe=arguments[0],Ue=arguments[1];return!this.isNull()&&!(xe>this._maxx||xe<this._minx||Ue>this._maxy||Ue<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var s=this.getWidth(),u=this.getHeight();return Math.sqrt(s*s+u*u)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof qe){var s=arguments[0];this.expandToInclude(s.x,s.y)}else if(arguments[0]instanceof S){var u=arguments[0];if(u.isNull())return null;this.isNull()?(this._minx=u.getMinX(),this._maxx=u.getMaxX(),this._miny=u.getMinY(),this._maxy=u.getMaxY()):(u._minx<this._minx&&(this._minx=u._minx),u._maxx>this._maxx&&(this._maxx=u._maxx),u._miny<this._miny&&(this._miny=u._miny),u._maxy>this._maxy&&(this._maxy=u._maxy))}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];this.isNull()?(this._minx=f,this._maxx=f,this._miny=v,this._maxy=v):(f<this._minx&&(this._minx=f),f>this._maxx&&(this._maxx=f),v<this._miny&&(this._miny=v),v>this._maxy&&(this._maxy=v))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),u=this.getHeight();return s<u?s:u}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(s){var u=s;return this.isNull()?u.isNull()?0:-1:u.isNull()?1:this._minx<u._minx?-1:this._minx>u._minx?1:this._miny<u._miny?-1:this._miny>u._miny?1:this._maxx<u._maxx?-1:this._maxx>u._maxx?1:this._maxy<u._maxy?-1:this._maxy>u._maxy?1:0}},{key:"translate",value:function(s,u){if(this.isNull())return null;this.init(this.getMinX()+s,this.getMaxX()+s,this.getMinY()+u,this.getMaxY()+u)}},{key:"copy",value:function(){return new S(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(s){return!(!this.isNull()&&!s.isNull())||s._minx>this._maxx||s._maxx<this._minx||s._miny>this._maxy||s._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var s=this.getWidth(),u=this.getHeight();return s>u?s:u}},{key:"expandBy",value:function(){if(arguments.length===1){var s=arguments[0];this.expandBy(s,s)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];if(this.isNull())return null;this._minx-=u,this._maxx+=u,this._miny-=f,this._maxy+=f,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof S){var s=arguments[0];return this.covers(s)}if(arguments[0]instanceof qe){var u=arguments[0];return this.covers(u)}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];return this.covers(f,v)}}},{key:"centre",value:function(){return this.isNull()?null:new qe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof qe){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof S){var u=arguments[0];this._minx=u._minx,this._maxx=u._maxx,this._miny=u._miny,this._maxy=u._maxy}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];this.init(f.x,v.x,f.y,v.y)}else if(arguments.length===4){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3];C<B?(this._minx=C,this._maxx=B):(this._minx=B,this._maxx=C),j<Q?(this._miny=j,this._maxy=Q):(this._miny=Q,this._maxy=j)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(s){if(this.intersects(s))return 0;var u=0;this._maxx<s._minx?u=s._minx-this._maxx:this._minx>s._maxx&&(u=this._minx-s._maxx);var f=0;return this._maxy<s._miny?f=s._miny-this._maxy:this._miny>s._maxy&&(f=this._miny-s._maxy),u===0?f:f===0?u:Math.sqrt(u*u+f*f)}},{key:"hashCode",value:function(){var s=17;return s=37*(s=37*(s=37*(s=37*s+qe.hashCode(this._minx))+qe.hashCode(this._maxx))+qe.hashCode(this._miny))+qe.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[Te,de]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof qe){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof S){var u=arguments[0];this.init(u)}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];this.init(f.x,v.x,f.y,v.y)}else if(arguments.length===4){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3];this.init(C,B,j,Q)}}},{key:"intersects",value:function(){if(arguments.length===3){var s=arguments[0],u=arguments[1],f=arguments[2];return f.x>=(s.x<u.x?s.x:u.x)&&f.x<=(s.x>u.x?s.x:u.x)&&f.y>=(s.y<u.y?s.y:u.y)&&f.y<=(s.y>u.y?s.y:u.y)}if(arguments.length===4){var v=arguments[0],C=arguments[1],B=arguments[2],j=arguments[3],Q=Math.min(B.x,j.x),xe=Math.max(B.x,j.x),Ue=Math.min(v.x,C.x),je=Math.max(v.x,C.x);return!(Ue>xe)&&!(je<Q)&&(Q=Math.min(B.y,j.y),xe=Math.max(B.y,j.y),Ue=Math.min(v.y,C.y),je=Math.max(v.y,C.y),!(Ue>xe)&&!(je<Q))}}}]),S}(),nn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===S.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(s){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(s){return this===s||this.equalsExact(s,0)}},{key:"geometryChanged",value:function(){this.apply(S.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(s){return s!==null&&this.norm().equalsExact(s.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var s;if(arguments.length===1){var u=arguments[0];return s=u,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(u)}if(arguments.length===2){var f=arguments[0],v=arguments[1];return s=f,this.getTypeCode()!==s.getTypeCode()?this.getTypeCode()-s.getTypeCode():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(f,v)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(s){if(s.getTypeCode()===S.TYPECODE_GEOMETRYCOLLECTION)throw new Le("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(s,u,f){return f===0?s.equals(u):s.distance(u)<=f}},{key:"norm",value:function(){var s=this.copy();return s.normalize(),s}},{key:"reverse",value:function(){var s=this.reverseInternal();return this.envelope!=null&&(s.envelope=this.envelope.copy()),s.setSRID(this.getSRID()),s}},{key:"copy",value:function(){var s=this.copyInternal();return s.envelope=this._envelope==null?null:this._envelope.copy(),s._SRID=this._SRID,s._userData=this._userData,s}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new bn(this._envelope)}},{key:"setSRID",value:function(s){this._SRID=s}},{key:"setUserData",value:function(s){this._userData=s}},{key:"compare",value:function(s,u){for(var f=s.iterator(),v=u.iterator();f.hasNext()&&v.hasNext();){var C=f.next(),B=v.next(),j=C.compareTo(B);if(j!==0)return j}return f.hasNext()?1:v.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(s){return this.getClass()===s.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===S.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===S.TYPECODE_MULTIPOINT||this.getTypeCode()===S.TYPECODE_MULTILINESTRING||this.getTypeCode()===S.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[We,Te,de]}},{key:"getClass",value:function(){return S}}],[{key:"hasNonEmptyElements",value:function(s){for(var u=0;u<s.length;u++)if(!s[u].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(s){for(var u=0;u<s.length;u++)if(s[u]===null)return!0;return!1}}]),S}();nn.constructor_=function(S){S&&(this._envelope=null,this._userData=null,this._factory=S,this._SRID=S.getSRID())},nn.TYPECODE_POINT=0,nn.TYPECODE_MULTIPOINT=1,nn.TYPECODE_LINESTRING=2,nn.TYPECODE_LINEARRING=3,nn.TYPECODE_MULTILINESTRING=4,nn.TYPECODE_POLYGON=5,nn.TYPECODE_MULTIPOLYGON=6,nn.TYPECODE_GEOMETRYCOLLECTION=7,nn.TYPENAME_POINT="Point",nn.TYPENAME_MULTIPOINT="MultiPoint",nn.TYPENAME_LINESTRING="LineString",nn.TYPENAME_LINEARRING="LinearRing",nn.TYPENAME_MULTILINESTRING="MultiLineString",nn.TYPENAME_POLYGON="Polygon",nn.TYPENAME_MULTIPOLYGON="MultiPolygon",nn.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",nn.geometryChangedFilter={get interfaces_(){return[Me]},filter:function(S){S.geometryChangedAction()}};var ne=function(){function S(){t(this,S)}return d(S,null,[{key:"toLocationSymbol",value:function(s){switch(s){case S.EXTERIOR:return"e";case S.BOUNDARY:return"b";case S.INTERIOR:return"i";case S.NONE:return"-"}throw new Le("Unknown location value: "+s)}}]),S}();ne.INTERIOR=0,ne.BOUNDARY=1,ne.EXTERIOR=2,ne.NONE=-1;var ui=function(){function S(){t(this,S)}return d(S,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),S}(),Gn=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({NoSuchElementException:u})[0],v}return u}(ye),Kn=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({UnsupportedOperationException:u})[0],v}return u}(ye),Ze=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.apply(this,arguments)}return d(u,[{key:"contains",value:function(){}}]),u}(ui),hi=function(S,s){g(f,S);var u=G(f);function f(v){var C;return t(this,f),(C=u.call(this)).map=new Map,v instanceof ui&&C.addAll(v),C}return d(f,[{key:"contains",value:function(v){var C=v.hashCode?v.hashCode():v;return!!this.map.has(C)}},{key:"add",value:function(v){var C=v.hashCode?v.hashCode():v;return!this.map.has(C)&&!!this.map.set(C,v)}},{key:"addAll",value:function(v){var C,B=me(v);try{for(B.s();!(C=B.n()).done;){var j=C.value;this.add(j)}}catch(Q){B.e(Q)}finally{B.f()}return!0}},{key:"remove",value:function(){throw new Kn}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new qn(this.map)}},{key:s,value:function(){return this.map}}]),f}(Ze,Symbol.iterator),qn=function(){function S(s){t(this,S),this.iterator=s.values();var u=this.iterator.next(),f=u.done,v=u.value;this.done=f,this.value=v}return d(S,[{key:"next",value:function(){if(this.done)throw new Gn;var s=this.value,u=this.iterator.next(),f=u.done,v=u.value;return this.done=f,this.value=v,s}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Kn}}]),S}(),ut=function(){function S(){t(this,S)}return d(S,null,[{key:"opposite",value:function(s){return s===S.LEFT?S.RIGHT:s===S.RIGHT?S.LEFT:s}}]),S}();ut.ON=0,ut.LEFT=1,ut.RIGHT=2;var Pe=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({EmptyStackException:u})[0],v}return u}(ye),pe=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this,f)).name=Object.keys({IndexOutOfBoundsException:u})[0],v}return u}(ye),dt=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.apply(this,arguments)}return d(u,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),u}(ui),Ut=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),(f=s.call(this)).array=[],f}return d(u,[{key:"add",value:function(f){return this.array.push(f),!0}},{key:"get",value:function(f){if(f<0||f>=this.size())throw new pe;return this.array[f]}},{key:"push",value:function(f){return this.array.push(f),f}},{key:"pop",value:function(){if(this.array.length===0)throw new Pe;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Pe;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(f){return this.array.indexOf(f)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),u}(dt);function St(S,s){return S.interfaces_&&S.interfaces_.indexOf(s)>-1}var Lt=function(){function S(s){t(this,S),this.str=s}return d(S,[{key:"append",value:function(s){this.str+=s}},{key:"setCharAt",value:function(s,u){this.str=this.str.substr(0,s)+u+this.str.substr(s+1)}},{key:"toString",value:function(){return this.str}}]),S}(),Dn=function(){function S(s){t(this,S),this.value=s}return d(S,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(s){return this.value<s?-1:this.value>s?1:0}}],[{key:"compare",value:function(s,u){return s<u?-1:s>u?1:0}},{key:"isNan",value:function(s){return Number.isNaN(s)}},{key:"valueOf",value:function(s){return new S(s)}}]),S}(),an=function(){function S(){t(this,S)}return d(S,null,[{key:"isWhitespace",value:function(s){return s<=32&&s>=0||s===127}},{key:"toUpperCase",value:function(s){return s.toUpperCase()}}]),S}(),$e=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"le",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<=s._lo}},{key:"extractSignificantDigits",value:function(s,u){var f=this.abs(),v=S.magnitude(f._hi),C=S.TEN.pow(v);(f=f.divide(C)).gt(S.TEN)?(f=f.divide(S.TEN),v+=1):f.lt(S.ONE)&&(f=f.multiply(S.TEN),v-=1);for(var B=v+1,j=new Lt,Q=S.MAX_PRINT_DIGITS-1,xe=0;xe<=Q;xe++){s&&xe===B&&j.append(".");var Ue=Math.trunc(f._hi);if(Ue<0)break;var je=!1,Et=0;Ue>9?(je=!0,Et="9"):Et="0"+Ue,j.append(Et),f=f.subtract(S.valueOf(Ue)).multiply(S.TEN),je&&f.selfAdd(S.TEN);var Zt=!0,Nt=S.magnitude(f._hi);if(Nt<0&&Math.abs(Nt)>=Q-xe&&(Zt=!1),!Zt)break}return u[0]=v,j.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return this.add(s.negate())}if(typeof arguments[0]=="number"){var u=arguments[0];return this.add(-u)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof S){var s=arguments[0];return this._hi===s._hi&&this._lo===s._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s._hi,-s._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(s){return this.le(s)?this:s}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof S){var s=arguments[0];return this.selfDivide(s._hi,s._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfDivide(u,0)}}else if(arguments.length===2){var f=arguments[0],v=arguments[1],C=null,B=null,j=null,Q=null,xe=null,Ue=null,je=null,Et=null;return xe=this._hi/f,Et=(C=(Ue=S.SPLIT*xe)-(C=Ue-xe))*(j=(Et=S.SPLIT*f)-(j=Et-f))-(je=xe*f)+C*(Q=f-j)+(B=xe-C)*j+B*Q,Et=xe+(Ue=(this._hi-je-Et+this._lo-xe*v)/f),this._hi=Et,this._lo=xe-Et+Ue,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof S){var s=arguments[0],u=null,f=null,v=null,C=null,B=null,j=null,Q=null,xe=null;f=(B=this._hi/s._hi)-(u=(j=S.SPLIT*B)-(u=j-B)),xe=u*(v=(xe=S.SPLIT*s._hi)-(v=xe-s._hi))-(Q=B*s._hi)+u*(C=s._hi-v)+f*v+f*C;var Ue=xe=B+(j=(this._hi-Q-xe+this._lo-B*s._lo)/s._hi),je=B-xe+j;return new S(Ue,je)}if(typeof arguments[0]=="number"){var Et=arguments[0];return Tt.isNaN(Et)?S.createNaN():S.copy(this).selfDivide(Et,0)}}},{key:"ge",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>=s._lo}},{key:"pow",value:function(s){if(s===0)return S.valueOf(1);var u=new S(this),f=S.valueOf(1),v=Math.abs(s);if(v>1)for(;v>0;)v%2==1&&f.selfMultiply(u),(v/=2)>0&&(u=u.sqr());else f=u;return s<0?f.reciprocal():f}},{key:"ceil",value:function(){if(this.isNaN())return S.NaN;var s=Math.ceil(this._hi),u=0;return s===this._hi&&(u=Math.ceil(this._lo)),new S(s,u)}},{key:"compareTo",value:function(s){var u=s;return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return this.init(s),this}if(typeof arguments[0]=="number"){var u=arguments[0];return this.init(u),this}}},{key:"max",value:function(s){return this.ge(s)?this:s}},{key:"sqrt",value:function(){if(this.isZero())return S.valueOf(0);if(this.isNegative())return S.NaN;var s=1/Math.sqrt(this._hi),u=this._hi*s,f=S.valueOf(u),v=this.subtract(f.sqr())._hi*(.5*s);return f.add(v)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof S){var s=arguments[0];return this.selfAdd(s._hi,s._lo)}if(typeof arguments[0]=="number"){var u=arguments[0],f=null,v=null,C=null,B=null,j=null,Q=null;return B=(C=this._hi+u)-(j=C-this._hi),v=(Q=(B=u-j+(this._hi-B))+this._lo)+(C-(f=C+Q)),this._hi=f+v,this._lo=v+(f-this._hi),this}}else if(arguments.length===2){var xe=arguments[0],Ue=arguments[1],je=null,Et=null,Zt=null,Nt=null,Rn=null,Nn=null,fn=null;Nt=this._hi+xe,Et=this._lo+Ue,Rn=Nt-(Nn=Nt-this._hi),Zt=Et-(fn=Et-this._lo);var Ii=(je=Nt+(Nn=(Rn=xe-Nn+(this._hi-Rn))+Et))+(Nn=(Zt=Ue-fn+(this._lo-Zt))+(Nn+(Nt-je))),Bi=Nn+(je-Ii);return this._hi=Ii,this._lo=Bi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof S){var s=arguments[0];return this.selfMultiply(s._hi,s._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfMultiply(u,0)}}else if(arguments.length===2){var f=arguments[0],v=arguments[1],C=null,B=null,j=null,Q=null,xe=null,Ue=null;C=(xe=S.SPLIT*this._hi)-this._hi,Ue=S.SPLIT*f,C=xe-C,B=this._hi-C,j=Ue-f;var je=(xe=this._hi*f)+(Ue=C*(j=Ue-j)-xe+C*(Q=f-j)+B*j+B*Q+(this._hi*v+this._lo*f)),Et=Ue+(C=xe-je);return this._hi=je,this._lo=Et,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return S.NaN;var s=Math.floor(this._hi),u=0;return s===this._hi&&(u=Math.floor(this._lo)),new S(s,u)}},{key:"negate",value:function(){return this.isNaN()?this:new S(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(s){if(s instanceof CloneNotSupportedException)return null;throw s}}},{key:"multiply",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return s.isNaN()?S.createNaN():S.copy(this).selfMultiply(s)}if(typeof arguments[0]=="number"){var u=arguments[0];return Tt.isNaN(u)?S.createNaN():S.copy(this).selfMultiply(u,0)}}},{key:"isNaN",value:function(){return Tt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var s=S.magnitude(this._hi);return s>=-3&&s<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var s=this.getSpecialNumberString();if(s!==null)return s;var u=new Array(1).fill(null),f=this.extractSignificantDigits(!0,u),v=u[0]+1,C=f;if(f.charAt(0)===".")C="0"+f;else if(v<0)C="0."+S.stringOfChar("0",-v)+f;else if(f.indexOf(".")===-1){var B=v-f.length;C=f+S.stringOfChar("0",B)+".0"}return this.isNegative()?"-"+C:C}},{key:"reciprocal",value:function(){var s,u,f,v,C=null,B=null,j=null,Q=null;s=(f=1/this._hi)-(C=(j=S.SPLIT*f)-(C=j-f)),B=(Q=S.SPLIT*this._hi)-this._hi;var xe=f+(j=(1-(v=f*this._hi)-(Q=C*(B=Q-B)-v+C*(u=this._hi-B)+s*B+s*u)-f*this._lo)/this._hi);return new S(xe,f-xe+j)}},{key:"toSciNotation",value:function(){if(this.isZero())return S.SCI_NOT_ZERO;var s=this.getSpecialNumberString();if(s!==null)return s;var u=new Array(1).fill(null),f=this.extractSignificantDigits(!1,u),v=S.SCI_NOT_EXPONENT_CHAR+u[0];if(f.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+f);var C="";f.length>1&&(C=f.substring(1));var B=f.charAt(0)+"."+C;return this.isNegative()?"-"+B+v:B+v}},{key:"abs",value:function(){return this.isNaN()?S.NaN:this.isNegative()?this.negate():new S(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(s){return this._hi<s._hi||this._hi===s._hi&&this._lo<s._lo}},{key:"add",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return S.copy(this).selfAdd(s)}if(typeof arguments[0]=="number"){var u=arguments[0];return S.copy(this).selfAdd(u)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this._hi=s,this._lo=0}else if(arguments[0]instanceof S){var u=arguments[0];this._hi=u._hi,this._lo=u._lo}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];this._hi=f,this._lo=v}}},{key:"gt",value:function(s){return this._hi>s._hi||this._hi===s._hi&&this._lo>s._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?S.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[de,Te,We]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this.init(s)}else if(arguments[0]instanceof S){var u=arguments[0];this.init(u)}else if(typeof arguments[0]=="string"){var f=arguments[0];S.constructor_.call(this,S.parse(f))}}else if(arguments.length===2){var v=arguments[0],C=arguments[1];this.init(v,C)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3];return S.determinant(S.valueOf(s),S.valueOf(u),S.valueOf(f),S.valueOf(v))}if(arguments[3]instanceof S&&arguments[2]instanceof S&&arguments[0]instanceof S&&arguments[1]instanceof S){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3],xe=C.multiply(Q).selfSubtract(B.multiply(j));return xe}}},{key:"sqr",value:function(s){return S.valueOf(s).selfMultiply(s)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var s=arguments[0];return S.parse(s)}if(typeof arguments[0]=="number"){var u=arguments[0];return new S(u)}}},{key:"sqrt",value:function(s){return S.valueOf(s).sqrt()}},{key:"parse",value:function(s){for(var u=0,f=s.length;an.isWhitespace(s.charAt(u));)u++;var v=!1;if(u<f){var C=s.charAt(u);C!=="-"&&C!=="+"||(u++,C==="-"&&(v=!0))}for(var B=new S,j=0,Q=0,xe=0,Ue=!1;!(u>=f);){var je=s.charAt(u);if(u++,an.isDigit(je)){var Et=je-"0";B.selfMultiply(S.TEN),B.selfAdd(Et),j++}else{if(je!=="."){if(je==="e"||je==="E"){var Zt=s.substring(u);try{xe=Dn.parseInt(Zt)}catch(Ii){throw Ii instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Zt+" in string "+s):Ii}break}throw new NumberFormatException("Unexpected character '"+je+"' at position "+u+" in string "+s)}Q=j,Ue=!0}}var Nt=B;Ue||(Q=j);var Rn=j-Q-xe;if(Rn===0)Nt=B;else if(Rn>0){var Nn=S.TEN.pow(Rn);Nt=B.divide(Nn)}else if(Rn<0){var fn=S.TEN.pow(-Rn);Nt=B.multiply(fn)}return v?Nt.negate():Nt}},{key:"createNaN",value:function(){return new S(Tt.NaN,Tt.NaN)}},{key:"copy",value:function(s){return new S(s)}},{key:"magnitude",value:function(s){var u=Math.abs(s),f=Math.log(u)/Math.log(10),v=Math.trunc(Math.floor(f));return 10*Math.pow(10,v)<=u&&(v+=1),v}},{key:"stringOfChar",value:function(s,u){for(var f=new Lt,v=0;v<u;v++)f.append(s);return f.toString()}}]),S}();$e.PI=new $e(3.141592653589793,12246467991473532e-32),$e.TWO_PI=new $e(6.283185307179586,24492935982947064e-32),$e.PI_2=new $e(1.5707963267948966,6123233995736766e-32),$e.E=new $e(2.718281828459045,14456468917292502e-32),$e.NaN=new $e(Tt.NaN,Tt.NaN),$e.EPS=123259516440783e-46,$e.SPLIT=134217729,$e.MAX_PRINT_DIGITS=32,$e.TEN=$e.valueOf(10),$e.ONE=$e.valueOf(1),$e.SCI_NOT_EXPONENT_CHAR="E",$e.SCI_NOT_ZERO="0.0E0";var On=function(){function S(){t(this,S)}return d(S,null,[{key:"orientationIndex",value:function(s,u,f){var v=S.orientationIndexFilter(s,u,f);if(v<=1)return v;var C=$e.valueOf(u.x).selfAdd(-s.x),B=$e.valueOf(u.y).selfAdd(-s.y),j=$e.valueOf(f.x).selfAdd(-u.x),Q=$e.valueOf(f.y).selfAdd(-u.y);return C.selfMultiply(Q).selfSubtract(B.selfMultiply(j)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof $e&&arguments[2]instanceof $e&&arguments[0]instanceof $e&&arguments[1]instanceof $e){var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3],C=s.multiply(v).selfSubtract(u.multiply(f));return C.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var B=arguments[0],j=arguments[1],Q=arguments[2],xe=arguments[3],Ue=$e.valueOf(B),je=$e.valueOf(j),Et=$e.valueOf(Q),Zt=$e.valueOf(xe),Nt=Ue.multiply(Zt).selfSubtract(je.multiply(Et));return Nt.signum()}}},{key:"intersection",value:function(s,u,f,v){var C=new $e(s.y).selfSubtract(u.y),B=new $e(u.x).selfSubtract(s.x),j=new $e(s.x).selfMultiply(u.y).selfSubtract(new $e(u.x).selfMultiply(s.y)),Q=new $e(f.y).selfSubtract(v.y),xe=new $e(v.x).selfSubtract(f.x),Ue=new $e(f.x).selfMultiply(v.y).selfSubtract(new $e(v.x).selfMultiply(f.y)),je=B.multiply(Ue).selfSubtract(xe.multiply(j)),Et=Q.multiply(j).selfSubtract(C.multiply(Ue)),Zt=C.multiply(xe).selfSubtract(Q.multiply(B)),Nt=je.selfDivide(Zt).doubleValue(),Rn=Et.selfDivide(Zt).doubleValue();return Tt.isNaN(Nt)||Tt.isInfinite(Nt)||Tt.isNaN(Rn)||Tt.isInfinite(Rn)?null:new qe(Nt,Rn)}},{key:"orientationIndexFilter",value:function(s,u,f){var v=null,C=(s.x-f.x)*(u.y-f.y),B=(s.y-f.y)*(u.x-f.x),j=C-B;if(C>0){if(B<=0)return S.signum(j);v=C+B}else{if(!(C<0)||B>=0)return S.signum(j);v=-C-B}var Q=S.DP_SAFE_EPSILON*v;return j>=Q||-j>=Q?S.signum(j):2}},{key:"signum",value:function(s){return s>0?1:s<0?-1:0}}]),S}();On.DP_SAFE_EPSILON=1e-15;var Mt=function(){function S(){t(this,S)}return d(S,[{key:"getM",value:function(s){if(this.hasM()){var u=this.getDimension()-this.getMeasures();return this.getOrdinate(s,u)}return Tt.NaN}},{key:"setOrdinate",value:function(s,u,f){}},{key:"getZ",value:function(s){return this.hasZ()?this.getOrdinate(s,2):Tt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(s,u){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(s){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(s){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(s){}},{key:"copy",value:function(){}},{key:"getY",value:function(s){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[We]}}]),S}();Mt.X=0,Mt.Y=1,Mt.Z=2,Mt.M=3;var Rt=function(){function S(){t(this,S)}return d(S,null,[{key:"index",value:function(s,u,f){return On.orientationIndex(s,u,f)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var s=arguments[0],u=s.length-1;if(u<3)throw new Le("Ring has fewer than 4 points, so orientation cannot be determined");for(var f=s[0],v=0,C=1;C<=u;C++){var B=s[C];B.y>f.y&&(f=B,v=C)}var j=v;do(j-=1)<0&&(j=u);while(s[j].equals2D(f)&&j!==v);var Q=v;do Q=(Q+1)%u;while(s[Q].equals2D(f)&&Q!==v);var xe=s[j],Ue=s[Q];if(xe.equals2D(f)||Ue.equals2D(f)||xe.equals2D(Ue))return!1;var je=S.index(xe,f,Ue),Et=null;return Et=je===0?xe.x>Ue.x:je>0,Et}if(St(arguments[0],Mt)){var Zt=arguments[0],Nt=Zt.size()-1;if(Nt<3)throw new Le("Ring has fewer than 4 points, so orientation cannot be determined");for(var Rn=Zt.getCoordinate(0),Nn=0,fn=1;fn<=Nt;fn++){var Ii=Zt.getCoordinate(fn);Ii.y>Rn.y&&(Rn=Ii,Nn=fn)}var Bi=null,vr=Nn;do(vr-=1)<0&&(vr=Nt),Bi=Zt.getCoordinate(vr);while(Bi.equals2D(Rn)&&vr!==Nn);var zr=null,Es=Nn;do Es=(Es+1)%Nt,zr=Zt.getCoordinate(Es);while(zr.equals2D(Rn)&&Es!==Nn);if(Bi.equals2D(Rn)||zr.equals2D(Rn)||Bi.equals2D(zr))return!1;var Xs=S.index(Bi,Rn,zr);return Xs===0?Bi.x>zr.x:Xs>0}}}]),S}();Rt.CLOCKWISE=-1,Rt.RIGHT=Rt.CLOCKWISE,Rt.COUNTERCLOCKWISE=1,Rt.LEFT=Rt.COUNTERCLOCKWISE,Rt.COLLINEAR=0,Rt.STRAIGHT=Rt.COLLINEAR;var Qn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(s,u){var f=this.getRightmostSideOfSegment(s,u);return f<0&&(f=this.getRightmostSideOfSegment(s,u-1)),f<0&&(this._minCoord=null,this.checkForRightmostCoordinate(s)),f}},{key:"findRightmostEdgeAtVertex",value:function(){var s=this._minDe.getEdge().getCoordinates();ht.isTrue(this._minIndex>0&&this._minIndex<s.length,"rightmost point expected to be interior vertex of edge");var u=s[this._minIndex-1],f=s[this._minIndex+1],v=Rt.index(this._minCoord,f,u),C=!1;(u.y<this._minCoord.y&&f.y<this._minCoord.y&&v===Rt.COUNTERCLOCKWISE||u.y>this._minCoord.y&&f.y>this._minCoord.y&&v===Rt.CLOCKWISE)&&(C=!0),C&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(s,u){var f=s.getEdge().getCoordinates();if(u<0||u+1>=f.length||f[u].y===f[u+1].y)return-1;var v=ut.LEFT;return f[u].y<f[u+1].y&&(v=ut.RIGHT),v}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(s){for(var u=s.getEdge().getCoordinates(),f=0;f<u.length-1;f++)(this._minCoord===null||u[f].x>this._minCoord.x)&&(this._minDe=s,this._minIndex=f,this._minCoord=u[f])}},{key:"findRightmostEdgeAtNode",value:function(){var s=this._minDe.getNode().getEdges();this._minDe=s.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(s){for(var u=s.iterator();u.hasNext();){var f=u.next();f.isForward()&&this.checkForRightmostCoordinate(f)}ht.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===ut.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),S}(),bt=function(S){g(u,S);var s=G(u);function u(f,v){var C;return t(this,u),(C=s.call(this,v?f+" [ "+v+" ]":f)).pt=v?new qe(v):void 0,C.name=Object.keys({TopologyException:u})[0],C}return d(u,[{key:"getCoordinate",value:function(){return this.pt}}]),u}(Cn),zt=function(){function S(){t(this,S),this.array=[]}return d(S,[{key:"addLast",value:function(s){this.array.push(s)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),S}(),xt=function(S,s){g(f,S);var u=G(f);function f(v){var C;return t(this,f),(C=u.call(this)).array=[],v instanceof ui&&C.addAll(v),C}return d(f,[{key:"interfaces_",get:function(){return[dt,ui]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(v){return arguments.length===1?this.array.push(v):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(v){var C,B=me(v);try{for(B.s();!(C=B.n()).done;){var j=C.value;this.array.push(j)}}catch(Q){B.e(Q)}finally{B.f()}}},{key:"set",value:function(v,C){var B=this.array[v];return this.array[v]=C,B}},{key:"iterator",value:function(){return new Fn(this)}},{key:"get",value:function(v){if(v<0||v>=this.size())throw new pe;return this.array[v]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(v){v?this.array.sort(function(C,B){return v.compare(C,B)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(v){for(var C=0,B=this.array.length;C<B;C++)if(this.array[C]===v)return!!this.array.splice(C,1);return!1}},{key:s,value:function(){return this.array.values()}}]),f}(dt,Symbol.iterator),Fn=function(){function S(s){t(this,S),this.arrayList=s,this.position=0}return d(S,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Gn;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(s){return this.arrayList.set(this.position-1,s)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),S}(),fi=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"clearVisitedEdges",value:function(){for(var s=this._dirEdgeList.iterator();s.hasNext();)s.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(s){for(var u=null,f=s.getEdges().iterator();f.hasNext();){var v=f.next();if(v.isVisited()||v.getSym().isVisited()){u=v;break}}if(u===null)throw new bt("unable to find edge to compute depths at "+s.getCoordinate());s.getEdges().computeDepths(u);for(var C=s.getEdges().iterator();C.hasNext();){var B=C.next();B.setVisited(!0),this.copySymDepths(B)}}},{key:"computeDepth",value:function(s){this.clearVisitedEdges();var u=this._finder.getEdge();u.getNode(),u.getLabel(),u.setEdgeDepths(ut.RIGHT,s),this.copySymDepths(u),this.computeDepths(u)}},{key:"create",value:function(s){this.addReachable(s),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var s=this._dirEdgeList.iterator();s.hasNext();){var u=s.next();u.getDepth(ut.RIGHT)>=1&&u.getDepth(ut.LEFT)<=0&&!u.isInteriorAreaEdge()&&u.setInResult(!0)}}},{key:"computeDepths",value:function(s){var u=new hi,f=new zt,v=s.getNode();for(f.addLast(v),u.add(v),s.setVisited(!0);!f.isEmpty();){var C=f.removeFirst();u.add(C),this.computeNodeDepth(C);for(var B=C.getEdges().iterator();B.hasNext();){var j=B.next().getSym();if(!j.isVisited()){var Q=j.getNode();u.contains(Q)||(f.addLast(Q),u.add(Q))}}}}},{key:"compareTo",value:function(s){var u=s;return this._rightMostCoord.x<u._rightMostCoord.x?-1:this._rightMostCoord.x>u._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var s=new bn,u=this._dirEdgeList.iterator();u.hasNext();)for(var f=u.next().getEdge().getCoordinates(),v=0;v<f.length-1;v++)s.expandToInclude(f[v]);this._env=s}return this._env}},{key:"addReachable",value:function(s){var u=new Ut;for(u.add(s);!u.empty();){var f=u.pop();this.add(f,u)}}},{key:"copySymDepths",value:function(s){var u=s.getSym();u.setDepth(ut.LEFT,s.getDepth(ut.RIGHT)),u.setDepth(ut.RIGHT,s.getDepth(ut.LEFT))}},{key:"add",value:function(s,u){s.setVisited(!0),this._nodes.add(s);for(var f=s.getEdges().iterator();f.hasNext();){var v=f.next();this._dirEdgeList.add(v);var C=v.getSym().getNode();C.isVisited()||u.push(C)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new xt,this._nodes=new xt,this._rightMostCoord=null,this._env=null,this._finder=new Qn}}]),S}(),Be=function(){function S(){t(this,S)}return d(S,null,[{key:"intersection",value:function(s,u,f,v){var C=s.x<u.x?s.x:u.x,B=s.y<u.y?s.y:u.y,j=s.x>u.x?s.x:u.x,Q=s.y>u.y?s.y:u.y,xe=f.x<v.x?f.x:v.x,Ue=f.y<v.y?f.y:v.y,je=f.x>v.x?f.x:v.x,Et=f.y>v.y?f.y:v.y,Zt=((C>xe?C:xe)+(j<je?j:je))/2,Nt=((B>Ue?B:Ue)+(Q<Et?Q:Et))/2,Rn=s.x-Zt,Nn=s.y-Nt,fn=u.x-Zt,Ii=u.y-Nt,Bi=f.x-Zt,vr=f.y-Nt,zr=v.x-Zt,Es=v.y-Nt,Xs=Nn-Ii,js=fn-Rn,mi=Rn*Ii-fn*Nn,cs=vr-Es,Sr=zr-Bi,Wa=Bi*Es-zr*vr,mo=Xs*Sr-cs*js,Do=(js*Wa-Sr*mi)/mo,ks=(cs*mi-Xs*Wa)/mo;return Tt.isNaN(Do)||Tt.isInfinite(Do)||Tt.isNaN(ks)||Tt.isInfinite(ks)?null:new qe(Do+Zt,ks+Nt)}}]),S}(),Ht=function(){function S(){t(this,S)}return d(S,null,[{key:"arraycopy",value:function(s,u,f,v,C){for(var B=0,j=u;j<u+C;j++)f[v+B]=s[j],B++}},{key:"getProperty",value:function(s){return{"line.separator":`
`}[s]}}]),S}(),Ct=function(){function S(){t(this,S)}return d(S,null,[{key:"log10",value:function(s){var u=Math.log(s);return Tt.isInfinite(u)||Tt.isNaN(u)?u:u/S.LOG_10}},{key:"min",value:function(s,u,f,v){var C=s;return u<C&&(C=u),f<C&&(C=f),v<C&&(C=v),C}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],u=arguments[1],f=arguments[2];return s<u?u:s>f?f:s}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var v=arguments[0],C=arguments[1],B=arguments[2];return v<C?C:v>B?B:v}}},{key:"wrap",value:function(s,u){return s<0?u- -s%u:s%u}},{key:"max",value:function(){if(arguments.length===3){var s=arguments[0],u=arguments[1],f=arguments[2],v=s;return u>v&&(v=u),f>v&&(v=f),v}if(arguments.length===4){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3],xe=C;return B>xe&&(xe=B),j>xe&&(xe=j),Q>xe&&(xe=Q),xe}}},{key:"average",value:function(s,u){return(s+u)/2}}]),S}();Ct.LOG_10=Math.log(10);var It=function(){function S(){t(this,S)}return d(S,null,[{key:"segmentToSegment",value:function(s,u,f,v){if(s.equals(u))return S.pointToSegment(s,f,v);if(f.equals(v))return S.pointToSegment(v,s,u);var C=!1;if(bn.intersects(s,u,f,v)){var B=(u.x-s.x)*(v.y-f.y)-(u.y-s.y)*(v.x-f.x);if(B===0)C=!0;else{var j=(s.y-f.y)*(v.x-f.x)-(s.x-f.x)*(v.y-f.y),Q=((s.y-f.y)*(u.x-s.x)-(s.x-f.x)*(u.y-s.y))/B,xe=j/B;(xe<0||xe>1||Q<0||Q>1)&&(C=!0)}}else C=!0;return C?Ct.min(S.pointToSegment(s,f,v),S.pointToSegment(u,f,v),S.pointToSegment(f,s,u),S.pointToSegment(v,s,u)):0}},{key:"pointToSegment",value:function(s,u,f){if(u.x===f.x&&u.y===f.y)return s.distance(u);var v=(f.x-u.x)*(f.x-u.x)+(f.y-u.y)*(f.y-u.y),C=((s.x-u.x)*(f.x-u.x)+(s.y-u.y)*(f.y-u.y))/v;if(C<=0)return s.distance(u);if(C>=1)return s.distance(f);var B=((u.y-s.y)*(f.x-u.x)-(u.x-s.x)*(f.y-u.y))/v;return Math.abs(B)*Math.sqrt(v)}},{key:"pointToLinePerpendicular",value:function(s,u,f){var v=(f.x-u.x)*(f.x-u.x)+(f.y-u.y)*(f.y-u.y),C=((u.y-s.y)*(f.x-u.x)-(u.x-s.x)*(f.y-u.y))/v;return Math.abs(C)*Math.sqrt(v)}},{key:"pointToSegmentString",value:function(s,u){if(u.length===0)throw new Le("Line array must contain at least one vertex");for(var f=s.distance(u[0]),v=0;v<u.length-1;v++){var C=S.pointToSegment(s,u[v],u[v+1]);C<f&&(f=C)}return f}}]),S}(),Yt=function(){function S(){t(this,S)}return d(S,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||St(arguments[0],Mt);else if(arguments.length!==2){if(arguments.length===3){var s=arguments[0],u=arguments[1];return this.create(s,u)}}}}]),S}(),Se=function(){function S(){t(this,S)}return d(S,[{key:"filter",value:function(s){}}]),S}(),te=function(){function S(){t(this,S)}return d(S,null,[{key:"ofLine",value:function(s){var u=s.size();if(u<=1)return 0;var f=0,v=new qe;s.getCoordinate(0,v);for(var C=v.x,B=v.y,j=1;j<u;j++){s.getCoordinate(j,v);var Q=v.x,xe=v.y,Ue=Q-C,je=xe-B;f+=Math.sqrt(Ue*Ue+je*je),C=Q,B=xe}return f}}]),S}(),ie=function S(){t(this,S)},fe=function(){function S(){t(this,S)}return d(S,null,[{key:"copyCoord",value:function(s,u,f,v){for(var C=Math.min(s.getDimension(),f.getDimension()),B=0;B<C;B++)f.setOrdinate(v,B,s.getOrdinate(u,B))}},{key:"isRing",value:function(s){var u=s.size();return u===0||!(u<=3)&&s.getOrdinate(0,Mt.X)===s.getOrdinate(u-1,Mt.X)&&s.getOrdinate(0,Mt.Y)===s.getOrdinate(u-1,Mt.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(St(arguments[0],Mt)&&Number.isInteger(arguments[1])){var s=arguments[0],u=arguments[1];S.scroll(s,u,S.isRing(s))}else if(St(arguments[0],Mt)&&arguments[1]instanceof qe){var f=arguments[0],v=arguments[1],C=S.indexOf(v,f);if(C<=0)return null;S.scroll(f,C)}}else if(arguments.length===3){var B=arguments[0],j=arguments[1],Q=arguments[2],xe=j;if(xe<=0)return null;for(var Ue=B.copy(),je=Q?B.size()-1:B.size(),Et=0;Et<je;Et++)for(var Zt=0;Zt<B.getDimension();Zt++)B.setOrdinate(Et,Zt,Ue.getOrdinate((j+Et)%je,Zt));if(Q)for(var Nt=0;Nt<B.getDimension();Nt++)B.setOrdinate(je,Nt,B.getOrdinate(0,Nt))}}},{key:"isEqual",value:function(s,u){var f=s.size();if(f!==u.size())return!1;for(var v=Math.min(s.getDimension(),u.getDimension()),C=0;C<f;C++)for(var B=0;B<v;B++){var j=s.getOrdinate(C,B),Q=u.getOrdinate(C,B);if(s.getOrdinate(C,B)!==u.getOrdinate(C,B)&&(!Tt.isNaN(j)||!Tt.isNaN(Q)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var s=arguments[0];return S.minCoordinateIndex(s,0,s.size()-1)}if(arguments.length===3){for(var u=arguments[0],f=arguments[1],v=arguments[2],C=-1,B=null,j=f;j<=v;j++){var Q=u.getCoordinate(j);(B===null||B.compareTo(Q)>0)&&(B=Q,C=j)}return C}}},{key:"extend",value:function(s,u,f){var v=s.create(f,u.getDimension()),C=u.size();if(S.copy(u,0,v,0,C),C>0)for(var B=C;B<f;B++)S.copy(u,C-1,v,B,1);return v}},{key:"reverse",value:function(s){for(var u=s.size()-1,f=Math.trunc(u/2),v=0;v<=f;v++)S.swap(s,v,u-v)}},{key:"swap",value:function(s,u,f){if(u===f)return null;for(var v=0;v<s.getDimension();v++){var C=s.getOrdinate(u,v);s.setOrdinate(u,v,s.getOrdinate(f,v)),s.setOrdinate(f,v,C)}}},{key:"copy",value:function(s,u,f,v,C){for(var B=0;B<C;B++)S.copyCoord(s,u+B,f,v+B)}},{key:"ensureValidRing",value:function(s,u){var f=u.size();return f===0?u:f<=3?S.createClosedRing(s,u,4):u.getOrdinate(0,Mt.X)===u.getOrdinate(f-1,Mt.X)&&u.getOrdinate(0,Mt.Y)===u.getOrdinate(f-1,Mt.Y)?u:S.createClosedRing(s,u,f+1)}},{key:"indexOf",value:function(s,u){for(var f=0;f<u.size();f++)if(s.x===u.getOrdinate(f,Mt.X)&&s.y===u.getOrdinate(f,Mt.Y))return f;return-1}},{key:"createClosedRing",value:function(s,u,f){var v=s.create(f,u.getDimension()),C=u.size();S.copy(u,0,v,0,C);for(var B=C;B<f;B++)S.copy(u,0,v,B,1);return v}},{key:"minCoordinate",value:function(s){for(var u=null,f=0;f<s.size();f++){var v=s.getCoordinate(f);(u===null||u.compareTo(v)>0)&&(u=v)}return u}}]),S}(),ce=function(){function S(){t(this,S)}return d(S,null,[{key:"toDimensionSymbol",value:function(s){switch(s){case S.FALSE:return S.SYM_FALSE;case S.TRUE:return S.SYM_TRUE;case S.DONTCARE:return S.SYM_DONTCARE;case S.P:return S.SYM_P;case S.L:return S.SYM_L;case S.A:return S.SYM_A}throw new Le("Unknown dimension value: "+s)}},{key:"toDimensionValue",value:function(s){switch(an.toUpperCase(s)){case S.SYM_FALSE:return S.FALSE;case S.SYM_TRUE:return S.TRUE;case S.SYM_DONTCARE:return S.DONTCARE;case S.SYM_P:return S.P;case S.SYM_L:return S.L;case S.SYM_A:return S.A}throw new Le("Unknown dimension symbol: "+s)}}]),S}();ce.P=0,ce.L=1,ce.A=2,ce.FALSE=-1,ce.TRUE=-2,ce.DONTCARE=-3,ce.SYM_FALSE="F",ce.SYM_TRUE="T",ce.SYM_DONTCARE="*",ce.SYM_P="0",ce.SYM_L="1",ce.SYM_A="2";var Ve=function(){function S(){t(this,S)}return d(S,[{key:"filter",value:function(s){}}]),S}(),Xe=function(){function S(){t(this,S)}return d(S,[{key:"filter",value:function(s,u){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),S}(),et=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new bn:this._points.expandEnvelope(new bn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new u(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];if(!this.isEquivalentClass(f))return!1;var C=f;if(this._points.size()!==C._points.size())return!1;for(var B=0;B<this._points.size();B++)if(!this.equal(this._points.getCoordinate(B),C._points.getCoordinate(B),v))return!1;return!0}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var f=0;f<Math.trunc(this._points.size()/2);f++){var v=this._points.size()-1-f;if(!this._points.getCoordinate(f).equals(this._points.getCoordinate(v))){if(this._points.getCoordinate(f).compareTo(this._points.getCoordinate(v))>0){var C=this._points.copy();fe.reverse(C),this._points=C}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ce.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var f=this._points.copy();return fe.reverse(f),this.getFactory().createLineString(f)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return nn.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return te.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var f=arguments[0],v=f,C=0,B=0;C<this._points.size()&&B<v._points.size();){var j=this._points.getCoordinate(C).compareTo(v._points.getCoordinate(B));if(j!==0)return j;C++,B++}return C<this._points.size()?1:B<v._points.size()?-1:0}if(arguments.length===2){var Q=arguments[0],xe=arguments[1],Ue=Q;return xe.compare(this._points,Ue._points)}}},{key:"apply",value:function(){if(St(arguments[0],Se))for(var f=arguments[0],v=0;v<this._points.size();v++)f.filter(this._points.getCoordinate(v));else if(St(arguments[0],Xe)){var C=arguments[0];if(this._points.size()===0)return null;for(var B=0;B<this._points.size()&&(C.filter(this._points,B),!C.isDone());B++);C.isGeometryChanged()&&this.geometryChanged()}else if(St(arguments[0],Ve)){var j=arguments[0];j.filter(this)}else if(St(arguments[0],Me)){var Q=arguments[0];Q.filter(this)}}},{key:"getBoundary",value:function(){throw new Kn}},{key:"isEquivalentClass",value:function(f){return f instanceof u}},{key:"getCoordinateN",value:function(f){return this._points.getCoordinate(f)}},{key:"getGeometryType",value:function(){return nn.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(f){if(f===null&&(f=this.getFactory().getCoordinateSequenceFactory().create([])),f.size()===1)throw new Le("Invalid number of points in LineString (found "+f.size()+" - must be 0 or >= 2)");this._points=f}},{key:"isCoordinate",value:function(f){for(var v=0;v<this._points.size();v++)if(this._points.getCoordinate(v).equals(f))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(f){return this.getFactory().createPoint(this._points.getCoordinate(f))}},{key:"interfaces_",get:function(){return[ie]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],v=arguments[1];nn.constructor_.call(this,v),this.init(f)}}}}]),u}(nn),Fe=function S(){t(this,S)},_t=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new bn;var f=new bn;return f.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),f}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new u(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];return!!this.isEquivalentClass(f)&&(!(!this.isEmpty()||!f.isEmpty())||this.isEmpty()===f.isEmpty()&&this.equal(f.getCoordinate(),this.getCoordinate(),v))}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return ce.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return nn.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0],v=f;return this.getCoordinate().compareTo(v.getCoordinate())}if(arguments.length===2){var C=arguments[0],B=arguments[1],j=C;return B.compare(this._coordinates,j._coordinates)}}},{key:"apply",value:function(){if(St(arguments[0],Se)){var f=arguments[0];if(this.isEmpty())return null;f.filter(this.getCoordinate())}else if(St(arguments[0],Xe)){var v=arguments[0];if(this.isEmpty())return null;v.filter(this._coordinates,0),v.isGeometryChanged()&&this.geometryChanged()}else if(St(arguments[0],Ve)){var C=arguments[0];C.filter(this)}else if(St(arguments[0],Me)){var B=arguments[0];B.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return nn.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(f){f===null&&(f=this.getFactory().getCoordinateSequenceFactory().create([])),ht.isTrue(f.size()<=1),this._coordinates=f}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Fe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var f=arguments[0],v=arguments[1];nn.constructor_.call(this,v),this.init(f)}}]),u}(nn),Pt=function(){function S(){t(this,S)}return d(S,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];return Math.abs(S.ofRingSigned(s))}if(St(arguments[0],Mt)){var u=arguments[0];return Math.abs(S.ofRingSigned(u))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var s=arguments[0];if(s.length<3)return 0;for(var u=0,f=s[0].x,v=1;v<s.length-1;v++){var C=s[v].x-f,B=s[v+1].y,j=s[v-1].y;u+=C*(j-B)}return u/2}if(St(arguments[0],Mt)){var Q=arguments[0],xe=Q.size();if(xe<3)return 0;var Ue=new qe,je=new qe,Et=new qe;Q.getCoordinate(0,je),Q.getCoordinate(1,Et);var Zt=je.x;Et.x-=Zt;for(var Nt=0,Rn=1;Rn<xe-1;Rn++)Ue.y=je.y,je.x=Et.x,je.y=Et.y,Q.getCoordinate(Rn+1,Et),Et.x-=Zt,Nt+=je.x*(Ue.y-Et.y);return Nt/2}}}]),S}(),ct=function(){function S(){t(this,S)}return d(S,null,[{key:"sort",value:function(){var s=arguments,u=arguments[0];if(arguments.length===1)u.sort(function(Zt,Nt){return Zt.compareTo(Nt)});else if(arguments.length===2)u.sort(function(Zt,Nt){return s[1].compare(Zt,Nt)});else if(arguments.length===3){var f=u.slice(arguments[1],arguments[2]);f.sort();var v=u.slice(0,arguments[1]).concat(f,u.slice(arguments[2],u.length));u.splice(0,u.length);var C,B=me(v);try{for(B.s();!(C=B.n()).done;){var j=C.value;u.push(j)}}catch(Zt){B.e(Zt)}finally{B.f()}}else if(arguments.length===4){var Q=u.slice(arguments[1],arguments[2]);Q.sort(function(Zt,Nt){return s[3].compare(Zt,Nt)});var xe=u.slice(0,arguments[1]).concat(Q,u.slice(arguments[2],u.length));u.splice(0,u.length);var Ue,je=me(xe);try{for(je.s();!(Ue=je.n()).done;){var Et=Ue.value;u.push(Et)}}catch(Zt){je.e(Zt)}finally{je.f()}}}},{key:"asList",value:function(s){var u,f=new xt,v=me(s);try{for(v.s();!(u=v.n()).done;){var C=u.value;f.add(C)}}catch(B){v.e(B)}finally{v.f()}return f}},{key:"copyOf",value:function(s,u){return s.slice(0,u)}}]),S}(),Xt=function S(){t(this,S)},yn=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var f=new Array(this.getNumPoints()).fill(null),v=-1,C=this._shell.getCoordinates(),B=0;B<C.length;B++)f[++v]=C[B];for(var j=0;j<this._holes.length;j++)for(var Q=this._holes[j].getCoordinates(),xe=0;xe<Q.length;xe++)f[++v]=Q[xe];return f}},{key:"getArea",value:function(){var f=0;f+=Pt.ofRing(this._shell.getCoordinateSequence());for(var v=0;v<this._holes.length;v++)f-=Pt.ofRing(this._holes[v].getCoordinateSequence());return f}},{key:"copyInternal",value:function(){for(var f=this._shell.copy(),v=new Array(this._holes.length).fill(null),C=0;C<this._holes.length;C++)v[C]=this._holes[C].copy();return new u(f,v,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var f=this._shell.getCoordinateSequence(),v=this.getEnvelopeInternal(),C=0;C<5;C++){var B=f.getX(C);if(B!==v.getMinX()&&B!==v.getMaxX())return!1;var j=f.getY(C);if(j!==v.getMinY()&&j!==v.getMaxY())return!1}for(var Q=f.getX(0),xe=f.getY(0),Ue=1;Ue<=4;Ue++){var je=f.getX(Ue),Et=f.getY(Ue);if(je!==Q==(Et!==xe))return!1;Q=je,xe=Et}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];if(!this.isEquivalentClass(f))return!1;var C=f,B=this._shell,j=C._shell;if(!B.equalsExact(j,v)||this._holes.length!==C._holes.length)return!1;for(var Q=0;Q<this._holes.length;Q++)if(!this._holes[Q].equalsExact(C._holes[Q],v))return!1;return!0}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var f=0;f<this._holes.length;f++)this._holes[f]=this.normalized(this._holes[f],!1);ct.sort(this._holes)}else if(arguments.length===2){var v=arguments[0],C=arguments[1];if(v.isEmpty())return null;var B=v.getCoordinateSequence(),j=fe.minCoordinateIndex(B,0,B.size()-2);fe.scroll(B,j,!0),Rt.isCCW(B)===C&&fe.reverse(B)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var f=this.getExteriorRing().reverse(),v=new Array(this.getNumInteriorRing()).fill(null),C=0;C<v.length;C++)v[C]=this.getInteriorRingN(C).reverse();return this.getFactory().createPolygon(f,v)}},{key:"getTypeCode",value:function(){return nn.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var f=0;f+=this._shell.getLength();for(var v=0;v<this._holes.length;v++)f+=this._holes[v].getLength();return f}},{key:"getNumPoints",value:function(){for(var f=this._shell.getNumPoints(),v=0;v<this._holes.length;v++)f+=this._holes[v].getNumPoints();return f}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(f,v){var C=f.copy();return this.normalize(C,v),C}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0],v=this._shell,C=f._shell;return v.compareToSameClass(C)}if(arguments.length===2){var B=arguments[0],j=arguments[1],Q=B,xe=this._shell,Ue=Q._shell,je=xe.compareToSameClass(Ue,j);if(je!==0)return je;for(var Et=this.getNumInteriorRing(),Zt=Q.getNumInteriorRing(),Nt=0;Nt<Et&&Nt<Zt;){var Rn=this.getInteriorRingN(Nt),Nn=Q.getInteriorRingN(Nt),fn=Rn.compareToSameClass(Nn,j);if(fn!==0)return fn;Nt++}return Nt<Et?1:Nt<Zt?-1:0}}},{key:"apply",value:function(){if(St(arguments[0],Se)){var f=arguments[0];this._shell.apply(f);for(var v=0;v<this._holes.length;v++)this._holes[v].apply(f)}else if(St(arguments[0],Xe)){var C=arguments[0];if(this._shell.apply(C),!C.isDone())for(var B=0;B<this._holes.length&&(this._holes[B].apply(C),!C.isDone());B++);C.isGeometryChanged()&&this.geometryChanged()}else if(St(arguments[0],Ve)){var j=arguments[0];j.filter(this)}else if(St(arguments[0],Me)){var Q=arguments[0];Q.filter(this),this._shell.apply(Q);for(var xe=0;xe<this._holes.length;xe++)this._holes[xe].apply(Q)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var f=new Array(this._holes.length+1).fill(null);f[0]=this._shell;for(var v=0;v<this._holes.length;v++)f[v+1]=this._holes[v];return f.length<=1?this.getFactory().createLinearRing(f[0].getCoordinateSequence()):this.getFactory().createMultiLineString(f)}},{key:"getGeometryType",value:function(){return nn.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(f){return this._holes[f]}},{key:"interfaces_",get:function(){return[Xt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var f=arguments[0],v=arguments[1],C=arguments[2];if(nn.constructor_.call(this,C),f===null&&(f=this.getFactory().createLinearRing()),v===null&&(v=[]),nn.hasNullElements(v))throw new Le("holes must not contain null elements");if(f.isEmpty()&&nn.hasNonEmptyElements(v))throw new Le("shell is empty but holes are not");this._shell=f,this._holes=v}}]),u}(nn),An=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.apply(this,arguments)}return u}(Ze),Hn=function(S){g(u,S);var s=G(u);function u(f){var v;return t(this,u),(v=s.call(this)).array=[],f instanceof ui&&v.addAll(f),v}return d(u,[{key:"contains",value:function(f){var v,C=me(this.array);try{for(C.s();!(v=C.n()).done;)if(v.value.compareTo(f)===0)return!0}catch(B){C.e(B)}finally{C.f()}return!1}},{key:"add",value:function(f){if(this.contains(f))return!1;for(var v=0,C=this.array.length;v<C;v++)if(this.array[v].compareTo(f)===1)return!!this.array.splice(v,0,f);return this.array.push(f),!0}},{key:"addAll",value:function(f){var v,C=me(f);try{for(C.s();!(v=C.n()).done;){var B=v.value;this.add(B)}}catch(j){C.e(j)}finally{C.f()}return!0}},{key:"remove",value:function(){throw new Kn}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new di(this.array)}}]),u}(An),di=function(){function S(s){t(this,S),this.array=s,this.position=0}return d(S,[{key:"next",value:function(){if(this.position===this.array.length)throw new Gn;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Kn}}]),S}(),kn=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"computeEnvelopeInternal",value:function(){for(var f=new bn,v=0;v<this._geometries.length;v++)f.expandToInclude(this._geometries[v].getEnvelopeInternal());return f}},{key:"getGeometryN",value:function(f){return this._geometries[f]}},{key:"getCoordinates",value:function(){for(var f=new Array(this.getNumPoints()).fill(null),v=-1,C=0;C<this._geometries.length;C++)for(var B=this._geometries[C].getCoordinates(),j=0;j<B.length;j++)f[++v]=B[j];return f}},{key:"getArea",value:function(){for(var f=0,v=0;v<this._geometries.length;v++)f+=this._geometries[v].getArea();return f}},{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),v=0;v<f.length;v++)f[v]=this._geometries[v].copy();return new u(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];if(!this.isEquivalentClass(f))return!1;var C=f;if(this._geometries.length!==C._geometries.length)return!1;for(var B=0;B<this._geometries.length;B++)if(!this._geometries[B].equalsExact(C._geometries[B],v))return!1;return!0}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var f=0;f<this._geometries.length;f++)this._geometries[f].normalize();ct.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var f=ce.FALSE,v=0;v<this._geometries.length;v++)f=Math.max(f,this._geometries[v].getBoundaryDimension());return f}},{key:"reverseInternal",value:function(){for(var f=this._geometries.length,v=new xt(f),C=0;C<f;C++)v.add(this._geometries[C].reverse());return this.getFactory().buildGeometry(v)}},{key:"getTypeCode",value:function(){return nn.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var f=ce.FALSE,v=0;v<this._geometries.length;v++)f=Math.max(f,this._geometries[v].getDimension());return f}},{key:"getLength",value:function(){for(var f=0,v=0;v<this._geometries.length;v++)f+=this._geometries[v].getLength();return f}},{key:"getNumPoints",value:function(){for(var f=0,v=0;v<this._geometries.length;v++)f+=this._geometries[v].getNumPoints();return f}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var f=arguments[0],v=new Hn(ct.asList(this._geometries)),C=new Hn(ct.asList(f._geometries));return this.compare(v,C)}if(arguments.length===2){for(var B=arguments[0],j=arguments[1],Q=B,xe=this.getNumGeometries(),Ue=Q.getNumGeometries(),je=0;je<xe&&je<Ue;){var Et=this.getGeometryN(je),Zt=Q.getGeometryN(je),Nt=Et.compareToSameClass(Zt,j);if(Nt!==0)return Nt;je++}return je<xe?1:je<Ue?-1:0}}},{key:"apply",value:function(){if(St(arguments[0],Se))for(var f=arguments[0],v=0;v<this._geometries.length;v++)this._geometries[v].apply(f);else if(St(arguments[0],Xe)){var C=arguments[0];if(this._geometries.length===0)return null;for(var B=0;B<this._geometries.length&&(this._geometries[B].apply(C),!C.isDone());B++);C.isGeometryChanged()&&this.geometryChanged()}else if(St(arguments[0],Ve)){var j=arguments[0];j.filter(this);for(var Q=0;Q<this._geometries.length;Q++)this._geometries[Q].apply(j)}else if(St(arguments[0],Me)){var xe=arguments[0];xe.filter(this);for(var Ue=0;Ue<this._geometries.length;Ue++)this._geometries[Ue].apply(xe)}}},{key:"getBoundary",value:function(){return nn.checkNotGeometryCollection(this),ht.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return nn.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var f=0;f<this._geometries.length;f++)if(!this._geometries[f].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var f=arguments[0],v=arguments[1];if(nn.constructor_.call(this,v),f===null&&(f=[]),nn.hasNullElements(f))throw new Le("geometries must not contain null elements");this._geometries=f}}}}]),u}(nn),Mi=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),v=0;v<f.length;v++)f[v]=this._geometries[v].copy();return new u(f,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];return!!this.isEquivalentClass(f)&&Z(_(u.prototype),"equalsExact",this).call(this,f,v)}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var f=arguments[0];return this._geometries[f].getCoordinate()}return Z(_(u.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return ce.FALSE}},{key:"getTypeCode",value:function(){return nn.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return nn.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Fe]}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];kn.constructor_.call(this,f,v)}}]),u}(kn),Li=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"copyInternal",value:function(){return new u(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return ce.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Z(_(u.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var f=this._points.copy();return fe.reverse(f),this.getFactory().createLinearRing(f)}},{key:"getTypeCode",value:function(){return nn.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Z(_(u.prototype),"isClosed",this).call(this))throw new Le("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<u.MINIMUM_VALID_SIZE)throw new Le("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return nn.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];et.constructor_.call(this,f,v),this.validateConstruction()}}]),u}(et);Li.MINIMUM_VALID_SIZE=4;var ve=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"setOrdinate",value:function(f,v){switch(f){case u.X:this.x=v;break;case u.Y:this.y=v;break;default:throw new Le("Invalid ordinate index: "+f)}}},{key:"getZ",value:function(){return qe.NULL_ORDINATE}},{key:"getOrdinate",value:function(f){switch(f){case u.X:return this.x;case u.Y:return this.y}throw new Le("Invalid ordinate index: "+f)}},{key:"setZ",value:function(f){throw new Le("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new u(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)qe.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof u){var f=arguments[0];qe.constructor_.call(this,f.x,f.y)}else if(arguments[0]instanceof qe){var v=arguments[0];qe.constructor_.call(this,v.x,v.y)}}else if(arguments.length===2){var C=arguments[0],B=arguments[1];qe.constructor_.call(this,C,B,qe.NULL_ORDINATE)}}}]),u}(qe);ve.X=0,ve.Y=1,ve.Z=-1,ve.M=-1;var Ge=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(f,v){switch(f){case u.X:this.x=v;break;case u.Y:this.y=v;break;case u.M:this._m=v;break;default:throw new Le("Invalid ordinate index: "+f)}}},{key:"setM",value:function(f){this._m=f}},{key:"getZ",value:function(){return qe.NULL_ORDINATE}},{key:"getOrdinate",value:function(f){switch(f){case u.X:return this.x;case u.Y:return this.y;case u.M:return this._m}throw new Le("Invalid ordinate index: "+f)}},{key:"setZ",value:function(f){throw new Le("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new u(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ(),this._m=f.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)qe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof u){var f=arguments[0];qe.constructor_.call(this,f.x,f.y),this._m=f._m}else if(arguments[0]instanceof qe){var v=arguments[0];qe.constructor_.call(this,v.x,v.y),this._m=this.getM()}}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];qe.constructor_.call(this,C,B,qe.NULL_ORDINATE),this._m=j}}}]),u}(qe);Ge.X=0,Ge.Y=1,Ge.Z=-1,Ge.M=2;var it=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(f,v){switch(f){case qe.X:this.x=v;break;case qe.Y:this.y=v;break;case qe.Z:this.z=v;break;case qe.M:this._m=v;break;default:throw new Le("Invalid ordinate index: "+f)}}},{key:"setM",value:function(f){this._m=f}},{key:"getOrdinate",value:function(f){switch(f){case qe.X:return this.x;case qe.Y:return this.y;case qe.Z:return this.getZ();case qe.M:return this.getM()}throw new Le("Invalid ordinate index: "+f)}},{key:"copy",value:function(){return new u(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(f){this.x=f.x,this.y=f.y,this.z=f.getZ(),this._m=f.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)qe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof u){var f=arguments[0];qe.constructor_.call(this,f),this._m=f._m}else if(arguments[0]instanceof qe){var v=arguments[0];qe.constructor_.call(this,v),this._m=this.getM()}}else if(arguments.length===4){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3];qe.constructor_.call(this,C,B,j),this._m=Q}}}]),u}(qe),at=function(){function S(){t(this,S)}return d(S,null,[{key:"measures",value:function(s){return s instanceof ve?0:s instanceof Ge||s instanceof it?1:0}},{key:"dimension",value:function(s){return s instanceof ve?2:s instanceof Ge?3:s instanceof it?4:3}},{key:"create",value:function(){if(arguments.length===1){var s=arguments[0];return S.create(s,0)}if(arguments.length===2){var u=arguments[0],f=arguments[1];return u===2?new ve:u===3&&f===0?new qe:u===3&&f===1?new Ge:u===4&&f===1?new it:new qe}}}]),S}(),Qe=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getCoordinate",value:function(f){return this.get(f)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&St(arguments[0],ui)){for(var f=arguments[0],v=arguments[1],C=!1,B=f.iterator();B.hasNext();)this.add(B.next(),v),C=!0;return C}return Z(_(u.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var f=Z(_(u.prototype),"clone",this).call(this),v=0;v<this.size();v++)f.add(v,this.get(v).clone());return f}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(u.coordArrayType);if(arguments.length===1){var f=arguments[0];if(f)return this.toArray(u.coordArrayType);for(var v=this.size(),C=new Array(v).fill(null),B=0;B<v;B++)C[B]=this.get(v-B-1);return C}}},{key:"add",value:function(){if(arguments.length===1){var f=arguments[0];return Z(_(u.prototype),"add",this).call(this,f)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var v=arguments[0],C=arguments[1];return this.add(v,C,!0),!0}if(arguments[0]instanceof qe&&typeof arguments[1]=="boolean"){var B=arguments[0],j=arguments[1];if(!j&&this.size()>=1){var Q=this.get(this.size()-1);if(Q.equals2D(B))return null}Z(_(u.prototype),"add",this).call(this,B)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var xe=arguments[0],Ue=arguments[1];return this.add(xe,Ue),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var je=arguments[0],Et=arguments[1],Zt=arguments[2];if(Zt)for(var Nt=0;Nt<je.length;Nt++)this.add(je[Nt],Et);else for(var Rn=je.length-1;Rn>=0;Rn--)this.add(je[Rn],Et);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof qe){var Nn=arguments[0],fn=arguments[1],Ii=arguments[2];if(!Ii){var Bi=this.size();if(Bi>0){if(Nn>0){var vr=this.get(Nn-1);if(vr.equals2D(fn))return null}if(Nn<Bi){var zr=this.get(Nn);if(zr.equals2D(fn))return null}}}Z(_(u.prototype),"add",this).call(this,Nn,fn)}}else if(arguments.length===4){var Es=arguments[0],Xs=arguments[1],js=arguments[2],mi=arguments[3],cs=1;js>mi&&(cs=-1);for(var Sr=js;Sr!==mi;Sr+=cs)this.add(Es[Sr],Xs);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var f=this.get(0).copy();this.add(f,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var f=arguments[0];this.ensureCapacity(f.length),this.add(f,!0)}else if(arguments.length===2){var v=arguments[0],C=arguments[1];this.ensureCapacity(v.length),this.add(v,C)}}}}]),u}(xt);Qe.coordArrayType=new Array(0).fill(null);var Dt=function(){function S(){t(this,S)}return d(S,null,[{key:"isRing",value:function(s){return!(s.length<4)&&!!s[0].equals2D(s[s.length-1])}},{key:"ptNotInList",value:function(s,u){for(var f=0;f<s.length;f++){var v=s[f];if(S.indexOf(v,u)<0)return v}return null}},{key:"scroll",value:function(s,u){var f=S.indexOf(u,s);if(f<0)return null;var v=new Array(s.length).fill(null);Ht.arraycopy(s,f,v,0,s.length-f),Ht.arraycopy(s,0,v,s.length-f,f),Ht.arraycopy(v,0,s,0,s.length)}},{key:"equals",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];if(s===u)return!0;if(s===null||u===null||s.length!==u.length)return!1;for(var f=0;f<s.length;f++)if(!s[f].equals(u[f]))return!1;return!0}if(arguments.length===3){var v=arguments[0],C=arguments[1],B=arguments[2];if(v===C)return!0;if(v===null||C===null||v.length!==C.length)return!1;for(var j=0;j<v.length;j++)if(B.compare(v[j],C[j])!==0)return!1;return!0}}},{key:"intersection",value:function(s,u){for(var f=new Qe,v=0;v<s.length;v++)u.intersects(s[v])&&f.add(s[v],!0);return f.toCoordinateArray()}},{key:"measures",value:function(s){if(s===null||s.length===0)return 0;var u,f=0,v=me(s);try{for(v.s();!(u=v.n()).done;){var C=u.value;f=Math.max(f,at.measures(C))}}catch(B){v.e(B)}finally{v.f()}return f}},{key:"hasRepeatedPoints",value:function(s){for(var u=1;u<s.length;u++)if(s[u-1].equals(s[u]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(s){return S.hasRepeatedPoints(s)?new Qe(s,!1).toCoordinateArray():s}},{key:"reverse",value:function(s){for(var u=s.length-1,f=Math.trunc(u/2),v=0;v<=f;v++){var C=s[v];s[v]=s[u-v],s[u-v]=C}}},{key:"removeNull",value:function(s){for(var u=0,f=0;f<s.length;f++)s[f]!==null&&u++;var v=new Array(u).fill(null);if(u===0)return v;for(var C=0,B=0;B<s.length;B++)s[B]!==null&&(v[C++]=s[B]);return v}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var s=arguments[0],u=new Array(s.length).fill(null),f=0;f<s.length;f++)u[f]=s[f].copy();return u}if(arguments.length===5)for(var v=arguments[0],C=arguments[1],B=arguments[2],j=arguments[3],Q=arguments[4],xe=0;xe<Q;xe++)B[j+xe]=v[C+xe].copy()}},{key:"isEqualReversed",value:function(s,u){for(var f=0;f<s.length;f++){var v=s[f],C=u[s.length-f-1];if(v.compareTo(C)!==0)return!1}return!0}},{key:"envelope",value:function(s){for(var u=new bn,f=0;f<s.length;f++)u.expandToInclude(s[f]);return u}},{key:"toCoordinateArray",value:function(s){return s.toArray(S.coordArrayType)}},{key:"dimension",value:function(s){if(s===null||s.length===0)return 3;var u,f=0,v=me(s);try{for(v.s();!(u=v.n()).done;){var C=u.value;f=Math.max(f,at.dimension(C))}}catch(B){v.e(B)}finally{v.f()}return f}},{key:"atLeastNCoordinatesOrNothing",value:function(s,u){return u.length>=s?u:[]}},{key:"indexOf",value:function(s,u){for(var f=0;f<u.length;f++)if(s.equals(u[f]))return f;return-1}},{key:"increasingDirection",value:function(s){for(var u=0;u<Math.trunc(s.length/2);u++){var f=s.length-1-u,v=s[u].compareTo(s[f]);if(v!==0)return v}return 1}},{key:"compare",value:function(s,u){for(var f=0;f<s.length&&f<u.length;){var v=s[f].compareTo(u[f]);if(v!==0)return v;f++}return f<u.length?-1:f<s.length?1:0}},{key:"minCoordinate",value:function(s){for(var u=null,f=0;f<s.length;f++)(u===null||u.compareTo(s[f])>0)&&(u=s[f]);return u}},{key:"extract",value:function(s,u,f){u=Ct.clamp(u,0,s.length);var v=(f=Ct.clamp(f,-1,s.length))-u+1;f<0&&(v=0),u>=s.length&&(v=0),f<u&&(v=0);var C=new Array(v).fill(null);if(v===0)return C;for(var B=0,j=u;j<=f;j++)C[B++]=s[j];return C}}]),S}(),en=function(){function S(){t(this,S)}return d(S,[{key:"compare",value:function(s,u){var f=s,v=u;return Dt.compare(f,v)}},{key:"interfaces_",get:function(){return[jt]}}]),S}(),Sn=function(){function S(){t(this,S)}return d(S,[{key:"compare",value:function(s,u){var f=s,v=u;if(f.length<v.length)return-1;if(f.length>v.length)return 1;if(f.length===0)return 0;var C=Dt.compare(f,v);return Dt.isEqualReversed(f,v)?0:C}},{key:"OLDcompare",value:function(s,u){var f=s,v=u;if(f.length<v.length)return-1;if(f.length>v.length)return 1;if(f.length===0)return 0;for(var C=Dt.increasingDirection(f),B=Dt.increasingDirection(v),j=C>0?0:f.length-1,Q=B>0?0:f.length-1,xe=0;xe<f.length;xe++){var Ue=f[j].compareTo(v[Q]);if(Ue!==0)return Ue;j+=C,Q+=B}return 0}},{key:"interfaces_",get:function(){return[jt]}}]),S}();Dt.ForwardComparator=en,Dt.BidirectionalComparator=Sn,Dt.coordArrayType=new Array(0).fill(null);var qt=function(){function S(s){t(this,S),this.str=s}return d(S,[{key:"append",value:function(s){this.str+=s}},{key:"setCharAt",value:function(s,u){this.str=this.str.substr(0,s)+u+this.str.substr(s+1)}},{key:"toString",value:function(){return this.str}}]),S}(),zn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getM",value:function(s){return this.hasM()?this._coordinates[s].getM():Tt.NaN}},{key:"setOrdinate",value:function(s,u,f){switch(u){case Mt.X:this._coordinates[s].x=f;break;case Mt.Y:this._coordinates[s].y=f;break;default:this._coordinates[s].setOrdinate(u,f)}}},{key:"getZ",value:function(s){return this.hasZ()?this._coordinates[s].getZ():Tt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(s,u){switch(u){case Mt.X:return this._coordinates[s].x;case Mt.Y:return this._coordinates[s].y;default:return this._coordinates[s].getOrdinate(u)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var s=arguments[0];return this._coordinates[s]}if(arguments.length===2){var u=arguments[0],f=arguments[1];f.setCoordinate(this._coordinates[u])}}},{key:"getCoordinateCopy",value:function(s){var u=this.createCoordinate();return u.setCoordinate(this._coordinates[s]),u}},{key:"createCoordinate",value:function(){return at.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(s){return this._coordinates[s].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(s){for(var u=0;u<this._coordinates.length;u++)s.expandToInclude(this._coordinates[u]);return s}},{key:"copy",value:function(){for(var s=new Array(this.size()).fill(null),u=0;u<this._coordinates.length;u++){var f=this.createCoordinate();f.setCoordinate(this._coordinates[u]),s[u]=f}return new S(s,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var s=new qt(17*this._coordinates.length);s.append("("),s.append(this._coordinates[0]);for(var u=1;u<this._coordinates.length;u++)s.append(", "),s.append(this._coordinates[u]);return s.append(")"),s.toString()}return"()"}},{key:"getY",value:function(s){return this._coordinates[s].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Mt,de]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];S.constructor_.call(this,s,Dt.dimension(s),Dt.measures(s))}else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var f=0;f<u;f++)this._coordinates[f]=new qe}else if(St(arguments[0],Mt)){var v=arguments[0];if(v===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=v.getDimension(),this._measures=v.getMeasures(),this._coordinates=new Array(v.size()).fill(null);for(var C=0;C<this._coordinates.length;C++)this._coordinates[C]=v.getCoordinateCopy(C)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var B=arguments[0],j=arguments[1];S.constructor_.call(this,B,j,Dt.measures(B))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Q=arguments[0],xe=arguments[1];this._coordinates=new Array(Q).fill(null),this._dimension=xe;for(var Ue=0;Ue<Q;Ue++)this._coordinates[Ue]=at.create(xe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var je=arguments[0],Et=arguments[1],Zt=arguments[2];this._dimension=Et,this._measures=Zt,this._coordinates=je===null?new Array(0).fill(null):je}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Nt=arguments[0],Rn=arguments[1],Nn=arguments[2];this._coordinates=new Array(Nt).fill(null),this._dimension=Rn,this._measures=Nn;for(var fn=0;fn<Nt;fn++)this._coordinates[fn]=this.createCoordinate()}}}}]),S}(),Un=function(){function S(){t(this,S)}return d(S,[{key:"readResolve",value:function(){return S.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return new zn(s)}if(St(arguments[0],Mt)){var u=arguments[0];return new zn(u)}}else{if(arguments.length===2){var f=arguments[0],v=arguments[1];return v>3&&(v=3),v<2&&(v=2),new zn(f,v)}if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2],Q=B-j;return j>1&&(j=1),Q>3&&(Q=3),Q<2&&(Q=2),new zn(C,Q+j,j)}}}},{key:"interfaces_",get:function(){return[Yt,de]}}],[{key:"instance",value:function(){return S.instanceObject}}]),S}();Un.instanceObject=new Un;var En=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),v=0;v<f.length;v++)f[v]=this._geometries[v].copy();return new u(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];return!!this.isEquivalentClass(f)&&Z(_(u.prototype),"equalsExact",this).call(this,f,v)}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return nn.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var f=new xt,v=0;v<this._geometries.length;v++)for(var C=this._geometries[v].getBoundary(),B=0;B<C.getNumGeometries();B++)f.add(C.getGeometryN(B));var j=new Array(f.size()).fill(null);return this.getFactory().createMultiLineString(f.toArray(j))}},{key:"getGeometryType",value:function(){return nn.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Xt]}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];kn.constructor_.call(this,f,v)}}]),u}(kn),Jn=function(){function S(){t(this,S)}return d(S,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),S}(),Qi=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),(f=s.call(this)).map=new Map,f}return d(u,[{key:"get",value:function(f){return this.map.get(f)||null}},{key:"put",value:function(f,v){return this.map.set(f,v),v}},{key:"values",value:function(){for(var f=new xt,v=this.map.values(),C=v.next();!C.done;)f.add(C.value),C=v.next();return f}},{key:"entrySet",value:function(){var f=new hi;return this.map.entries().forEach(function(v){return f.add(v)}),f}},{key:"size",value:function(){return this.map.size()}}]),u}(Jn),Yn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"equals",value:function(s){if(!(s instanceof S))return!1;var u=s;return this._modelType===u._modelType&&this._scale===u._scale}},{key:"compareTo",value:function(s){var u=s,f=this.getMaximumSignificantDigits(),v=u.getMaximumSignificantDigits();return Dn.compare(f,v)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===S.FLOATING||this._modelType===S.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var s="UNKNOWN";return this._modelType===S.FLOATING?s="Floating":this._modelType===S.FLOATING_SINGLE?s="Floating-Single":this._modelType===S.FIXED&&(s="Fixed (Scale="+this.getScale()+")"),s}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var s=arguments[0];return Tt.isNaN(s)||this._modelType===S.FLOATING_SINGLE?s:this._modelType===S.FIXED?Math.round(s*this._scale)/this._scale:s}if(arguments[0]instanceof qe){var u=arguments[0];if(this._modelType===S.FLOATING)return null;u.x=this.makePrecise(u.x),u.y=this.makePrecise(u.y)}}},{key:"getMaximumSignificantDigits",value:function(){var s=16;return this._modelType===S.FLOATING?s=16:this._modelType===S.FLOATING_SINGLE?s=6:this._modelType===S.FIXED&&(s=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),s}},{key:"setScale",value:function(s){this._scale=Math.abs(s)}},{key:"interfaces_",get:function(){return[de,Te]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=S.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof bi){var s=arguments[0];this._modelType=s,s===S.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var u=arguments[0];this._modelType=S.FIXED,this.setScale(u)}else if(arguments[0]instanceof S){var f=arguments[0];this._modelType=f._modelType,this._scale=f._scale}}}},{key:"mostPrecise",value:function(s,u){return s.compareTo(u)>=0?s:u}}]),S}(),bi=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"readResolve",value:function(){return S.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){this._name=null;var s=arguments[0];this._name=s,S.nameToTypeMap.put(s,this)}}]),S}();bi.nameToTypeMap=new Qi,Yn.Type=bi,Yn.FIXED=new bi("FIXED"),Yn.FLOATING=new bi("FLOATING"),Yn.FLOATING_SINGLE=new bi("FLOATING SINGLE"),Yn.maximumPreciseValue=9007199254740992;var pi=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"copyInternal",value:function(){for(var f=new Array(this._geometries.length).fill(null),v=0;v<f.length;v++)f[v]=this._geometries[v].copy();return new u(f,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof nn){var f=arguments[0],v=arguments[1];return!!this.isEquivalentClass(f)&&Z(_(u.prototype),"equalsExact",this).call(this,f,v)}return Z(_(u.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ce.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var f=0;f<this._geometries.length;f++)if(!this._geometries[f].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return nn.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Kn}},{key:"getGeometryType",value:function(){return nn.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[ie]}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];kn.constructor_.call(this,f,v)}}]),u}(kn),Tn=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"createEmpty",value:function(s){switch(s){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new Le("Invalid dimension: "+s)}}},{key:"toGeometry",value:function(s){return s.isNull()?this.createPoint():s.getMinX()===s.getMaxX()&&s.getMinY()===s.getMaxY()?this.createPoint(new qe(s.getMinX(),s.getMinY())):s.getMinX()===s.getMaxX()||s.getMinY()===s.getMaxY()?this.createLineString([new qe(s.getMinX(),s.getMinY()),new qe(s.getMaxX(),s.getMaxY())]):this.createPolygon(this.createLinearRing([new qe(s.getMinX(),s.getMinY()),new qe(s.getMinX(),s.getMaxY()),new qe(s.getMaxX(),s.getMaxY()),new qe(s.getMaxX(),s.getMinY()),new qe(s.getMinX(),s.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLineString(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(St(arguments[0],Mt)){var u=arguments[0];return new et(u,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new pi(null,this);if(arguments.length===1){var s=arguments[0];return new pi(s,this)}}},{key:"buildGeometry",value:function(s){for(var u=null,f=!1,v=!1,C=s.iterator();C.hasNext();){var B=C.next(),j=B.getTypeCode();u===null&&(u=j),j!==u&&(f=!0),B instanceof kn&&(v=!0)}if(u===null)return this.createGeometryCollection();if(f||v)return this.createGeometryCollection(S.toGeometryArray(s));var Q=s.iterator().next();if(s.size()>1){if(Q instanceof yn)return this.createMultiPolygon(S.toPolygonArray(s));if(Q instanceof et)return this.createMultiLineString(S.toLineStringArray(s));if(Q instanceof _t)return this.createMultiPoint(S.toPointArray(s));ht.shouldNeverReachHere("Unhandled geometry type: "+Q.getGeometryType())}return Q}},{key:"createMultiPointFromCoords",value:function(s){return this.createMultiPoint(s!==null?this.getCoordinateSequenceFactory().create(s):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof qe){var s=arguments[0];return this.createPoint(s!==null?this.getCoordinateSequenceFactory().create([s]):null)}if(St(arguments[0],Mt)){var u=arguments[0];return new _t(u,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(St(arguments[0],Mt)){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof Array){var u=arguments[0];return this.createPolygon(this.createLinearRing(u))}if(arguments[0]instanceof Li){var f=arguments[0];return this.createPolygon(f,null)}}else if(arguments.length===2){var v=arguments[0],C=arguments[1];return new yn(v,C,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new kn(null,this);if(arguments.length===1){var s=arguments[0];return new kn(s,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return this.createLinearRing(s!==null?this.getCoordinateSequenceFactory().create(s):null)}if(St(arguments[0],Mt)){var u=arguments[0];return new Li(u,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new En(null,this);if(arguments.length===1){var s=arguments[0];return new En(s,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Mi(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return new Mi(s,this)}if(St(arguments[0],Mt)){var u=arguments[0];if(u===null)return this.createMultiPoint(new Array(0).fill(null));for(var f=new Array(u.size()).fill(null),v=0;v<u.size();v++){var C=this.getCoordinateSequenceFactory().create(1,u.getDimension(),u.getMeasures());fe.copy(u,v,C,0,1),f[v]=this.createPoint(C)}return this.createMultiPoint(f)}}}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)S.constructor_.call(this,new Yn,0);else if(arguments.length===1){if(St(arguments[0],Yt)){var s=arguments[0];S.constructor_.call(this,new Yn,0,s)}else if(arguments[0]instanceof Yn){var u=arguments[0];S.constructor_.call(this,u,0,S.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];S.constructor_.call(this,f,v,S.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];this._precisionModel=C,this._coordinateSequenceFactory=j,this._SRID=B}}},{key:"toMultiPolygonArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toGeometryArray",value:function(s){if(s===null)return null;var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Un.instance()}},{key:"toMultiLineStringArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toLineStringArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toMultiPointArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toLinearRingArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toPointArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"toPolygonArray",value:function(s){var u=new Array(s.size()).fill(null);return s.toArray(u)}},{key:"createPointFromInternalCoord",value:function(s,u){return u.getPrecisionModel().makePrecise(s),u.getFactory().createPoint(s)}}]),S}(),oi="XY",si="XYZ",wr="XYM",Fi="XYZM",_r={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Gr="EMPTY",ki=1,Hi=2,ss=3,Ir=4,Nr=5,yi=6;for(var wa in _r)_r[wa].toUpperCase();var Ru=function(){function S(s){t(this,S),this.wkt=s,this.index_=-1}return d(S,[{key:"isAlpha_",value:function(s){return s>="a"&&s<="z"||s>="A"&&s<="Z"}},{key:"isNumeric_",value:function(s,u){return s>="0"&&s<="9"||s=="."&&!(u!==void 0&&u)}},{key:"isWhiteSpace_",value:function(s){return s==" "||s=="	"||s=="\r"||s==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var s,u=this.nextChar_(),f=this.index_,v=u;if(u=="(")s=Hi;else if(u==",")s=Nr;else if(u==")")s=ss;else if(this.isNumeric_(u)||u=="-")s=Ir,v=this.readNumber_();else if(this.isAlpha_(u))s=ki,v=this.readText_();else{if(this.isWhiteSpace_(u))return this.nextToken();if(u!=="")throw new Error("Unexpected character: "+u);s=yi}return{position:f,value:v,type:s}}},{key:"readNumber_",value:function(){var s,u=this.index_,f=!1,v=!1;do s=="."?f=!0:s!="e"&&s!="E"||(v=!0),s=this.nextChar_();while(this.isNumeric_(s,f)||!v&&(s=="e"||s=="E")||v&&(s=="-"||s=="+"));return parseFloat(this.wkt.substring(u,this.index_--))}},{key:"readText_",value:function(){var s,u=this.index_;do s=this.nextChar_();while(this.isAlpha_(s));return this.wkt.substring(u,this.index_--).toUpperCase()}}]),S}(),Co=function(){function S(s,u){t(this,S),this.lexer_=s,this.token_,this.layout_=oi,this.factory=u}return d(S,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(s){return this.token_.type==s}},{key:"match",value:function(s){var u=this.isTokenType(s);return u&&this.consume_(),u}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var s=oi,u=this.token_;if(this.isTokenType(ki)){var f=u.value;f==="Z"?s=si:f==="M"?s=wr:f==="ZM"&&(s=Fi),s!==oi&&this.consume_()}return s}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Hi)){var s=[];do s.push(this.parseGeometry_());while(this.match(Nr));if(this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Hi)){var s=this.parsePoint_();if(this.match(ss))return s}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Hi)){var s=this.parsePointList_();if(this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Hi)){var s=this.parseLineStringTextList_();if(this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var s;if(this.match(Hi)){if(s=this.token_.type==Hi?this.parsePointTextList_():this.parsePointList_(),this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Hi)){var s=this.parseLineStringTextList_();if(this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Hi)){var s=this.parsePolygonTextList_();if(this.match(ss))return s}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var s=[],u=this.layout_.length,f=0;f<u;++f){var v=this.token_;if(!this.match(Ir))break;s.push(v.value)}if(s.length==u)return s;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var s=[this.parsePoint_()];this.match(Nr);)s.push(this.parsePoint_());return s}},{key:"parsePointTextList_",value:function(){for(var s=[this.parsePointText_()];this.match(Nr);)s.push(this.parsePointText_());return s}},{key:"parseLineStringTextList_",value:function(){for(var s=[this.parseLineStringText_()];this.match(Nr);)s.push(this.parseLineStringText_());return s}},{key:"parsePolygonTextList_",value:function(){for(var s=[this.parsePolygonText_()];this.match(Nr);)s.push(this.parsePolygonText_());return s}},{key:"isEmptyGeometry_",value:function(){var s=this.isTokenType(ki)&&this.token_.value==Gr;return s&&this.consume_(),s}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var s=this.factory,u=function(Nn){return P(qe,re(Nn))},f=function(Nn){var fn=Nn.map(function(Ii){return s.createLinearRing(Ii.map(u))});return fn.length>1?s.createPolygon(fn[0],fn.slice(1)):s.createPolygon(fn[0])},v=this.token_;if(this.match(ki)){var C=v.value;if(this.layout_=this.parseGeometryLayout_(),C=="GEOMETRYCOLLECTION"){var B=this.parseGeometryCollectionText_();return s.createGeometryCollection(B)}switch(C){case"POINT":var j=this.parsePointText_();return j?s.createPoint(P(qe,re(j))):s.createPoint();case"LINESTRING":var Q=this.parseLineStringText_().map(u);return s.createLineString(Q);case"LINEARRING":var xe=this.parseLineStringText_().map(u);return s.createLinearRing(xe);case"POLYGON":var Ue=this.parsePolygonText_();return Ue&&Ue.length!==0?f(Ue):s.createPolygon();case"MULTIPOINT":var je=this.parseMultiPointText_();if(!je||je.length===0)return s.createMultiPoint();var Et=je.map(u).map(function(Nn){return s.createPoint(Nn)});return s.createMultiPoint(Et);case"MULTILINESTRING":var Zt=this.parseMultiLineStringText_().map(function(Nn){return s.createLineString(Nn.map(u))});return s.createMultiLineString(Zt);case"MULTIPOLYGON":var Nt=this.parseMultiPolygonText_();if(!Nt||Nt.length===0)return s.createMultiPolygon();var Rn=Nt.map(f);return s.createMultiPolygon(Rn);default:throw new Error("Invalid geometry type: "+C)}}throw new Error(this.formatErrorMessage_())}}]),S}();function ao(S){if(S.isEmpty())return"";var s=S.getCoordinate(),u=[s.x,s.y];return s.z===void 0||Number.isNaN(s.z)||u.push(s.z),s.m===void 0||Number.isNaN(s.m)||u.push(s.m),u.join(" ")}function sa(S){for(var s=S.getCoordinates().map(function(C){var B=[C.x,C.y];return C.z===void 0||Number.isNaN(C.z)||B.push(C.z),C.m===void 0||Number.isNaN(C.m)||B.push(C.m),B}),u=[],f=0,v=s.length;f<v;++f)u.push(s[f].join(" "));return u.join(", ")}function aa(S){var s=[];s.push("("+sa(S.getExteriorRing())+")");for(var u=0,f=S.getNumInteriorRing();u<f;++u)s.push("("+sa(S.getInteriorRingN(u))+")");return s.join(", ")}var Jo={Point:ao,LineString:sa,LinearRing:sa,Polygon:aa,MultiPoint:function(S){for(var s=[],u=0,f=S.getNumGeometries();u<f;++u)s.push("("+ao(S.getGeometryN(u))+")");return s.join(", ")},MultiLineString:function(S){for(var s=[],u=0,f=S.getNumGeometries();u<f;++u)s.push("("+sa(S.getGeometryN(u))+")");return s.join(", ")},MultiPolygon:function(S){for(var s=[],u=0,f=S.getNumGeometries();u<f;++u)s.push("("+aa(S.getGeometryN(u))+")");return s.join(", ")},GeometryCollection:function(S){for(var s=[],u=0,f=S.getNumGeometries();u<f;++u)s.push(oo(S.getGeometryN(u)));return s.join(", ")}};function oo(S){var s=S.getGeometryType(),u=Jo[s];s=s.toUpperCase();var f=function(v){var C="";if(v.isEmpty())return C;var B=v.getCoordinate();return B.z===void 0||Number.isNaN(B.z)||(C+="Z"),B.m===void 0||Number.isNaN(B.m)||(C+="M"),C}(S);return f.length>0&&(s+=" "+f),S.isEmpty()?s+" "+Gr:s+" ("+u(S)+")"}var Ro=function(){function S(s){t(this,S),this.geometryFactory=s||new Tn,this.precisionModel=this.geometryFactory.getPrecisionModel()}return d(S,[{key:"read",value:function(s){var u=new Ru(s);return new Co(u,this.geometryFactory).parse()}},{key:"write",value:function(s){return oo(s)}}]),S}(),Dl=function(){function S(s){t(this,S),this.parser=new Ro(s)}return d(S,[{key:"write",value:function(s){return this.parser.write(s)}}],[{key:"toLineString",value:function(s,u){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+s.x+" "+s.y+", "+u.x+" "+u.y+" )"}}]),S}(),er=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getIndexAlongSegment",value:function(s,u){return this.computeIntLineIndex(),this._intLineIndex[s][u]}},{key:"getTopologySummary",value:function(){var s=new qt;return this.isEndPoint()&&s.append(" endpoint"),this._isProper&&s.append(" proper"),this.isCollinear()&&s.append(" collinear"),s.toString()}},{key:"computeIntersection",value:function(s,u,f,v){this._inputLines[0][0]=s,this._inputLines[0][1]=u,this._inputLines[1][0]=f,this._inputLines[1][1]=v,this._result=this.computeIntersect(s,u,f,v)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var s=arguments[0],u=this.getEdgeDistance(s,0),f=this.getEdgeDistance(s,1);u>f?(this._intLineIndex[s][0]=0,this._intLineIndex[s][1]=1):(this._intLineIndex[s][0]=1,this._intLineIndex[s][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var s=arguments[0],u=0;u<this._result;u++)if(!this._intPt[u].equals2D(this._inputLines[s][0])&&!this._intPt[u].equals2D(this._inputLines[s][1]))return!0;return!1}}},{key:"getIntersection",value:function(s){return this._intPt[s]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==S.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(s,u){return S.computeEdgeDistance(this._intPt[u],this._inputLines[s][0],this._inputLines[s][1])}},{key:"isCollinear",value:function(){return this._result===S.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Dl.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Dl.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(s,u){return this._inputLines[s][u]}},{key:"isIntersection",value:function(s){for(var u=0;u<this._result;u++)if(this._intPt[u].equals2D(s))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(s,u){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[s][u]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new qe,this._intPt[1]=new qe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(s,u,f){var v=Math.abs(f.x-u.x),C=Math.abs(f.y-u.y),B=-1;if(s.equals(u))B=0;else if(s.equals(f))B=v>C?v:C;else{var j=Math.abs(s.x-u.x),Q=Math.abs(s.y-u.y);(B=v>C?j:Q)!==0||s.equals(u)||(B=Math.max(j,Q))}return ht.isTrue(!(B===0&&!s.equals(u)),"Bad distance calculation"),B}},{key:"nonRobustComputeEdgeDistance",value:function(s,u,f){var v=s.x-u.x,C=s.y-u.y,B=Math.sqrt(v*v+C*C);return ht.isTrue(!(B===0&&!s.equals(u)),"Invalid distance calculation"),B}}]),S}();er.DONT_INTERSECT=0,er.DO_INTERSECT=1,er.COLLINEAR=2,er.NO_INTERSECTION=0,er.POINT_INTERSECTION=1,er.COLLINEAR_INTERSECTION=2;var Sa=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.call(this)}return d(u,[{key:"isInSegmentEnvelopes",value:function(f){var v=new bn(this._inputLines[0][0],this._inputLines[0][1]),C=new bn(this._inputLines[1][0],this._inputLines[1][1]);return v.contains(f)&&C.contains(f)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Z(_(u.prototype),"computeIntersection",this).apply(this,arguments);var f=arguments[0],v=arguments[1],C=arguments[2];if(this._isProper=!1,bn.intersects(v,C,f)&&Rt.index(v,C,f)===0&&Rt.index(C,v,f)===0)return this._isProper=!0,(f.equals(v)||f.equals(C))&&(this._isProper=!1),this._result=er.POINT_INTERSECTION,null;this._result=er.NO_INTERSECTION}},{key:"intersection",value:function(f,v,C,B){var j=this.intersectionSafe(f,v,C,B);return this.isInSegmentEnvelopes(j)||(j=new qe(u.nearestEndpoint(f,v,C,B))),this._precisionModel!==null&&this._precisionModel.makePrecise(j),j}},{key:"checkDD",value:function(f,v,C,B,j){var Q=On.intersection(f,v,C,B),xe=this.isInSegmentEnvelopes(Q);Ht.out.println("DD in env = "+xe+"  --------------------- "+Q),j.distance(Q)>1e-4&&Ht.out.println("Distance = "+j.distance(Q))}},{key:"intersectionSafe",value:function(f,v,C,B){var j=Be.intersection(f,v,C,B);return j===null&&(j=u.nearestEndpoint(f,v,C,B)),j}},{key:"computeCollinearIntersection",value:function(f,v,C,B){var j=bn.intersects(f,v,C),Q=bn.intersects(f,v,B),xe=bn.intersects(C,B,f),Ue=bn.intersects(C,B,v);return j&&Q?(this._intPt[0]=C,this._intPt[1]=B,er.COLLINEAR_INTERSECTION):xe&&Ue?(this._intPt[0]=f,this._intPt[1]=v,er.COLLINEAR_INTERSECTION):j&&xe?(this._intPt[0]=C,this._intPt[1]=f,!C.equals(f)||Q||Ue?er.COLLINEAR_INTERSECTION:er.POINT_INTERSECTION):j&&Ue?(this._intPt[0]=C,this._intPt[1]=v,!C.equals(v)||Q||xe?er.COLLINEAR_INTERSECTION:er.POINT_INTERSECTION):Q&&xe?(this._intPt[0]=B,this._intPt[1]=f,!B.equals(f)||j||Ue?er.COLLINEAR_INTERSECTION:er.POINT_INTERSECTION):Q&&Ue?(this._intPt[0]=B,this._intPt[1]=v,!B.equals(v)||j||xe?er.COLLINEAR_INTERSECTION:er.POINT_INTERSECTION):er.NO_INTERSECTION}},{key:"computeIntersect",value:function(f,v,C,B){if(this._isProper=!1,!bn.intersects(f,v,C,B))return er.NO_INTERSECTION;var j=Rt.index(f,v,C),Q=Rt.index(f,v,B);if(j>0&&Q>0||j<0&&Q<0)return er.NO_INTERSECTION;var xe=Rt.index(C,B,f),Ue=Rt.index(C,B,v);return xe>0&&Ue>0||xe<0&&Ue<0?er.NO_INTERSECTION:j===0&&Q===0&&xe===0&&Ue===0?this.computeCollinearIntersection(f,v,C,B):(j===0||Q===0||xe===0||Ue===0?(this._isProper=!1,f.equals2D(C)||f.equals2D(B)?this._intPt[0]=f:v.equals2D(C)||v.equals2D(B)?this._intPt[0]=v:j===0?this._intPt[0]=new qe(C):Q===0?this._intPt[0]=new qe(B):xe===0?this._intPt[0]=new qe(f):Ue===0&&(this._intPt[0]=new qe(v))):(this._isProper=!0,this._intPt[0]=this.intersection(f,v,C,B)),er.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(f,v,C,B){var j=f,Q=It.pointToSegment(f,C,B),xe=It.pointToSegment(v,C,B);return xe<Q&&(Q=xe,j=v),(xe=It.pointToSegment(C,f,v))<Q&&(Q=xe,j=C),(xe=It.pointToSegment(B,f,v))<Q&&(Q=xe,j=B),j}}]),u}(er),Sc=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"countSegment",value:function(s,u){if(s.x<this._p.x&&u.x<this._p.x)return null;if(this._p.x===u.x&&this._p.y===u.y)return this._isPointOnSegment=!0,null;if(s.y===this._p.y&&u.y===this._p.y){var f=s.x,v=u.x;return f>v&&(f=u.x,v=s.x),this._p.x>=f&&this._p.x<=v&&(this._isPointOnSegment=!0),null}if(s.y>this._p.y&&u.y<=this._p.y||u.y>this._p.y&&s.y<=this._p.y){var C=Rt.index(s,u,this._p);if(C===Rt.COLLINEAR)return this._isPointOnSegment=!0,null;u.y<s.y&&(C=-C),C===Rt.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==ne.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?ne.BOUNDARY:this._crossingCount%2==1?ne.INTERIOR:ne.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var s=arguments[0];this._p=s}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof qe&&St(arguments[1],Mt)){for(var s=arguments[0],u=arguments[1],f=new S(s),v=new qe,C=new qe,B=1;B<u.size();B++)if(u.getCoordinate(B,v),u.getCoordinate(B-1,C),f.countSegment(v,C),f.isOnSegment())return f.getLocation();return f.getLocation()}if(arguments[0]instanceof qe&&arguments[1]instanceof Array){for(var j=arguments[0],Q=arguments[1],xe=new S(j),Ue=1;Ue<Q.length;Ue++){var je=Q[Ue],Et=Q[Ue-1];if(xe.countSegment(je,Et),xe.isOnSegment())return xe.getLocation()}return xe.getLocation()}}}]),S}(),oa=function(){function S(){t(this,S)}return d(S,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof qe&&St(arguments[1],Mt)){for(var s=arguments[0],u=arguments[1],f=new Sa,v=new qe,C=new qe,B=u.size(),j=1;j<B;j++)if(u.getCoordinate(j-1,v),u.getCoordinate(j,C),f.computeIntersection(s,v,C),f.hasIntersection())return!0;return!1}if(arguments[0]instanceof qe&&arguments[1]instanceof Array){for(var Q=arguments[0],xe=arguments[1],Ue=new Sa,je=1;je<xe.length;je++){var Et=xe[je-1],Zt=xe[je];if(Ue.computeIntersection(Q,Et,Zt),Ue.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(s,u){return Sc.locatePointInRing(s,u)}},{key:"isInRing",value:function(s,u){return S.locateInRing(s,u)!==ne.EXTERIOR}}]),S}(),Qr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"setAllLocations",value:function(s){for(var u=0;u<this.location.length;u++)this.location[u]=s}},{key:"isNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]!==ne.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(s){for(var u=0;u<this.location.length;u++)this.location[u]===ne.NONE&&(this.location[u]=s)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(s){if(s.location.length>this.location.length){var u=new Array(3).fill(null);u[ut.ON]=this.location[ut.ON],u[ut.LEFT]=ne.NONE,u[ut.RIGHT]=ne.NONE,this.location=u}for(var f=0;f<this.location.length;f++)this.location[f]===ne.NONE&&f<s.location.length&&(this.location[f]=s.location[f])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var s=this.location[ut.LEFT];this.location[ut.LEFT]=this.location[ut.RIGHT],this.location[ut.RIGHT]=s}},{key:"toString",value:function(){var s=new Lt;return this.location.length>1&&s.append(ne.toLocationSymbol(this.location[ut.LEFT])),s.append(ne.toLocationSymbol(this.location[ut.ON])),this.location.length>1&&s.append(ne.toLocationSymbol(this.location[ut.RIGHT])),s.toString()}},{key:"setLocations",value:function(s,u,f){this.location[ut.ON]=s,this.location[ut.LEFT]=u,this.location[ut.RIGHT]=f}},{key:"get",value:function(s){return s<this.location.length?this.location[s]:ne.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var s=0;s<this.location.length;s++)if(this.location[s]===ne.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var s=arguments[0];this.setLocation(ut.ON,s)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this.location[u]=f}}},{key:"init",value:function(s){this.location=new Array(s).fill(null),this.setAllLocations(ne.NONE)}},{key:"isEqualOnSide",value:function(s,u){return this.location[u]===s.location[u]}},{key:"allPositionsEqual",value:function(s){for(var u=0;u<this.location.length;u++)if(this.location[u]!==s)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];this.init(s.length)}else if(Number.isInteger(arguments[0])){var u=arguments[0];this.init(1),this.location[ut.ON]=u}else if(arguments[0]instanceof S){var f=arguments[0];if(this.init(f.location.length),f!==null)for(var v=0;v<this.location.length;v++)this.location[v]=f.location[v]}}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];this.init(3),this.location[ut.ON]=C,this.location[ut.LEFT]=B,this.location[ut.RIGHT]=j}}}]),S}(),sr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getGeometryCount",value:function(){var s=0;return this.elt[0].isNull()||s++,this.elt[1].isNull()||s++,s}},{key:"setAllLocations",value:function(s,u){this.elt[s].setAllLocations(u)}},{key:"isNull",value:function(s){return this.elt[s].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var s=arguments[0];this.setAllLocationsIfNull(0,s),this.setAllLocationsIfNull(1,s)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this.elt[u].setAllLocationsIfNull(f)}}},{key:"isLine",value:function(s){return this.elt[s].isLine()}},{key:"merge",value:function(s){for(var u=0;u<2;u++)this.elt[u]===null&&s.elt[u]!==null?this.elt[u]=new Qr(s.elt[u]):this.elt[u].merge(s.elt[u])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var s=arguments[0];return this.elt[s].get(ut.ON)}if(arguments.length===2){var u=arguments[0],f=arguments[1];return this.elt[u].get(f)}}},{key:"toString",value:function(){var s=new Lt;return this.elt[0]!==null&&(s.append("A:"),s.append(this.elt[0].toString())),this.elt[1]!==null&&(s.append(" B:"),s.append(this.elt[1].toString())),s.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var s=arguments[0];return this.elt[s].isArea()}}},{key:"isAnyNull",value:function(s){return this.elt[s].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];this.elt[s].setLocation(ut.ON,u)}else if(arguments.length===3){var f=arguments[0],v=arguments[1],C=arguments[2];this.elt[f].setLocation(v,C)}}},{key:"isEqualOnSide",value:function(s,u){return this.elt[0].isEqualOnSide(s.elt[0],u)&&this.elt[1].isEqualOnSide(s.elt[1],u)}},{key:"allPositionsEqual",value:function(s,u){return this.elt[s].allPositionsEqual(u)}},{key:"toLine",value:function(s){this.elt[s].isArea()&&(this.elt[s]=new Qr(this.elt[s].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new Qr(s),this.elt[1]=new Qr(s)}else if(arguments[0]instanceof S){var u=arguments[0];this.elt[0]=new Qr(u.elt[0]),this.elt[1]=new Qr(u.elt[1])}}else if(arguments.length===2){var f=arguments[0],v=arguments[1];this.elt[0]=new Qr(ne.NONE),this.elt[1]=new Qr(ne.NONE),this.elt[f].setLocation(v)}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];this.elt[0]=new Qr(C,B,j),this.elt[1]=new Qr(C,B,j)}else if(arguments.length===4){var Q=arguments[0],xe=arguments[1],Ue=arguments[2],je=arguments[3];this.elt[0]=new Qr(ne.NONE,ne.NONE,ne.NONE),this.elt[1]=new Qr(ne.NONE,ne.NONE,ne.NONE),this.elt[Q].setLocations(xe,Ue,je)}}},{key:"toLineLabel",value:function(s){for(var u=new S(ne.NONE),f=0;f<2;f++)u.setLocation(f,s.getLocation(f));return u}}]),S}(),Hr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var s=new Array(this._pts.size()).fill(null),u=0;u<this._pts.size();u++)s[u]=this._pts.get(u);this._ring=this._geometryFactory.createLinearRing(s),this._isHole=Rt.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(s){this._startDe=s;var u=s,f=!0;do{if(u===null)throw new bt("Found null DirectedEdge");if(u.getEdgeRing()===this)throw new bt("Directed Edge visited twice during ring-building at "+u.getCoordinate());this._edges.add(u);var v=u.getLabel();ht.isTrue(v.isArea()),this.mergeLabel(v),this.addPoints(u.getEdge(),u.isForward(),f),f=!1,this.setEdgeRing(u,this),u=this.getNext(u)}while(u!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(s){return this._pts.get(s)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var s=this._startDe;do{var u=s.getNode().getEdges().getOutgoingDegree(this);u>this._maxNodeDegree&&(this._maxNodeDegree=u),s=this.getNext(s)}while(s!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(s,u,f){var v=s.getCoordinates();if(u){var C=1;f&&(C=0);for(var B=C;B<v.length;B++)this._pts.add(v[B])}else{var j=v.length-2;f&&(j=v.length-1);for(var Q=j;Q>=0;Q--)this._pts.add(v[Q])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var s=this._startDe;do s.getEdge().setInResult(!0),s=s.getNext();while(s!==this._startDe)}},{key:"containsPoint",value:function(s){var u=this.getLinearRing();if(!u.getEnvelopeInternal().contains(s)||!oa.isInRing(s,u.getCoordinates()))return!1;for(var f=this._holes.iterator();f.hasNext();)if(f.next().containsPoint(s))return!1;return!0}},{key:"addHole",value:function(s){this._holes.add(s)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var s=arguments[0];this.mergeLabel(s,0),this.mergeLabel(s,1)}else if(arguments.length===2){var u=arguments[0],f=arguments[1],v=u.getLocation(f,ut.RIGHT);if(v===ne.NONE)return null;if(this._label.getLocation(f)===ne.NONE)return this._label.setLocation(f,v),null}}},{key:"setShell",value:function(s){this._shell=s,s!==null&&s.addHole(this)}},{key:"toPolygon",value:function(s){for(var u=new Array(this._holes.size()).fill(null),f=0;f<this._holes.size();f++)u[f]=this._holes.get(f).getLinearRing();return s.createPolygon(this.getLinearRing(),u)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new xt,this._pts=new xt,this._label=new sr(ne.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new xt,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],u=arguments[1];this._geometryFactory=u,this.computePoints(s),this.computeRing()}}}}]),S}(),Qo=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"setEdgeRing",value:function(f,v){f.setMinEdgeRing(v)}},{key:"getNext",value:function(f){return f.getNextMin()}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];Hr.constructor_.call(this,f,v)}}]),u}(Hr),Nl=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"buildMinimalRings",value:function(){var f=new xt,v=this._startDe;do{if(v.getMinEdgeRing()===null){var C=new Qo(v,this._geometryFactory);f.add(C)}v=v.getNext()}while(v!==this._startDe);return f}},{key:"setEdgeRing",value:function(f,v){f.setEdgeRing(v)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var f=this._startDe;do f.getNode().getEdges().linkMinimalDirectedEdges(this),f=f.getNext();while(f!==this._startDe)}},{key:"getNext",value:function(f){return f.getNext()}}],[{key:"constructor_",value:function(){var f=arguments[0],v=arguments[1];Hr.constructor_.call(this,f,v)}}]),u}(Hr),Pu=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"setVisited",value:function(s){this._isVisited=s}},{key:"setInResult",value:function(s){this._isInResult=s}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(s){this._label=s}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(s){this._isCovered=s,this._isCoveredSet=!0}},{key:"updateIM",value:function(s){ht.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(s)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this._label=s}}}}]),S}(),el=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"isIncidentEdgeInResult",value:function(){for(var f=this.getEdges().getEdges().iterator();f.hasNext();)if(f.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(f){f.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(f){}},{key:"computeMergedLocation",value:function(f,v){var C=ne.NONE;if(C=this._label.getLocation(v),!f.isNull(v)){var B=f.getLocation(v);C!==ne.BOUNDARY&&(C=B)}return C}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Z(_(u.prototype),"setLabel",this).apply(this,arguments);var f=arguments[0],v=arguments[1];this._label===null?this._label=new sr(f,v):this._label.setLocation(f,v)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof u){var f=arguments[0];this.mergeLabel(f._label)}else if(arguments[0]instanceof sr)for(var v=arguments[0],C=0;C<2;C++){var B=this.computeMergedLocation(v,C),j=this._label.getLocation(C);j===ne.NONE&&this._label.setLocation(C,B)}}},{key:"add",value:function(f){this._edges.insert(f),f.setNode(this)}},{key:"setLabelBoundary",value:function(f){if(this._label===null)return null;var v=ne.NONE;this._label!==null&&(v=this._label.getLocation(f));var C=null;switch(v){case ne.BOUNDARY:C=ne.INTERIOR;break;case ne.INTERIOR:default:C=ne.BOUNDARY}this._label.setLocation(f,C)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var f=arguments[0],v=arguments[1];this._coord=f,this._edges=v,this._label=new sr(0,ne.NONE)}}]),u}(Pu),Ea=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.apply(this,arguments)}return u}(Jn);function Lu(S){return S==null?0:S.color}function Ai(S){return S==null?null:S.parent}function la(S,s){S!==null&&(S.color=s)}function Ol(S){return S==null?null:S.left}function ku(S){return S==null?null:S.right}var zi=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),(f=s.call(this)).root_=null,f.size_=0,f}return d(u,[{key:"get",value:function(f){for(var v=this.root_;v!==null;){var C=f.compareTo(v.key);if(C<0)v=v.left;else{if(!(C>0))return v.value;v=v.right}}return null}},{key:"put",value:function(f,v){if(this.root_===null)return this.root_={key:f,value:v,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var C,B,j=this.root_;do if(C=j,(B=f.compareTo(j.key))<0)j=j.left;else{if(!(B>0)){var Q=j.value;return j.value=v,Q}j=j.right}while(j!==null);var xe={key:f,left:null,right:null,value:v,parent:C,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return B<0?C.left=xe:C.right=xe,this.fixAfterInsertion(xe),this.size_++,null}},{key:"fixAfterInsertion",value:function(f){var v;for(f.color=1;f!=null&&f!==this.root_&&f.parent.color===1;)Ai(f)===Ol(Ai(Ai(f)))?Lu(v=ku(Ai(Ai(f))))===1?(la(Ai(f),0),la(v,0),la(Ai(Ai(f)),1),f=Ai(Ai(f))):(f===ku(Ai(f))&&(f=Ai(f),this.rotateLeft(f)),la(Ai(f),0),la(Ai(Ai(f)),1),this.rotateRight(Ai(Ai(f)))):Lu(v=Ol(Ai(Ai(f))))===1?(la(Ai(f),0),la(v,0),la(Ai(Ai(f)),1),f=Ai(Ai(f))):(f===Ol(Ai(f))&&(f=Ai(f),this.rotateRight(f)),la(Ai(f),0),la(Ai(Ai(f)),1),this.rotateLeft(Ai(Ai(f))));this.root_.color=0}},{key:"values",value:function(){var f=new xt,v=this.getFirstEntry();if(v!==null)for(f.add(v.value);(v=u.successor(v))!==null;)f.add(v.value);return f}},{key:"entrySet",value:function(){var f=new hi,v=this.getFirstEntry();if(v!==null)for(f.add(v);(v=u.successor(v))!==null;)f.add(v);return f}},{key:"rotateLeft",value:function(f){if(f!=null){var v=f.right;f.right=v.left,v.left!=null&&(v.left.parent=f),v.parent=f.parent,f.parent==null?this.root_=v:f.parent.left===f?f.parent.left=v:f.parent.right=v,v.left=f,f.parent=v}}},{key:"rotateRight",value:function(f){if(f!=null){var v=f.left;f.left=v.right,v.right!=null&&(v.right.parent=f),v.parent=f.parent,f.parent==null?this.root_=v:f.parent.right===f?f.parent.right=v:f.parent.left=v,v.right=f,f.parent=v}}},{key:"getFirstEntry",value:function(){var f=this.root_;if(f!=null)for(;f.left!=null;)f=f.left;return f}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(f){for(var v=this.root_;v!==null;){var C=f.compareTo(v.key);if(C<0)v=v.left;else{if(!(C>0))return!0;v=v.right}}return!1}}],[{key:"successor",value:function(f){var v;if(f===null)return null;if(f.right!==null){for(v=f.right;v.left!==null;)v=v.left;return v}v=f.parent;for(var C=f;v!==null&&C===v.right;)C=v,v=v.parent;return v}}]),u}(Ea),Di=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"find",value:function(s){return this.nodeMap.get(s)}},{key:"addNode",value:function(){if(arguments[0]instanceof qe){var s=arguments[0],u=this.nodeMap.get(s);return u===null&&(u=this.nodeFact.createNode(s),this.nodeMap.put(s,u)),u}if(arguments[0]instanceof el){var f=arguments[0],v=this.nodeMap.get(f.getCoordinate());return v===null?(this.nodeMap.put(f.getCoordinate(),f),f):(v.mergeLabel(f),v)}}},{key:"print",value:function(s){for(var u=this.iterator();u.hasNext();)u.next().print(s)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(s){for(var u=new xt,f=this.iterator();f.hasNext();){var v=f.next();v.getLabel().getLocation(s)===ne.BOUNDARY&&u.add(v)}return u}},{key:"add",value:function(s){var u=s.getCoordinate();this.addNode(u).add(s)}}],[{key:"constructor_",value:function(){this.nodeMap=new zi,this.nodeFact=null;var s=arguments[0];this.nodeFact=s}}]),S}(),Wr=function(){function S(){t(this,S)}return d(S,null,[{key:"isNorthern",value:function(s){return s===S.NE||s===S.NW}},{key:"isOpposite",value:function(s,u){return s!==u&&(s-u+4)%4===2}},{key:"commonHalfPlane",value:function(s,u){if(s===u)return s;if((s-u+4)%4===2)return-1;var f=s<u?s:u;return f===0&&(s>u?s:u)===3?3:f}},{key:"isInHalfPlane",value:function(s,u){return u===S.SE?s===S.SE||s===S.SW:s===u||s===u+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],u=arguments[1];if(s===0&&u===0)throw new Le("Cannot compute the quadrant for point ( "+s+", "+u+" )");return s>=0?u>=0?S.NE:S.SE:u>=0?S.NW:S.SW}if(arguments[0]instanceof qe&&arguments[1]instanceof qe){var f=arguments[0],v=arguments[1];if(v.x===f.x&&v.y===f.y)throw new Le("Cannot compute the quadrant for two identical points "+f);return v.x>=f.x?v.y>=f.y?S.NE:S.SE:v.y>=f.y?S.NW:S.SW}}}]),S}();Wr.NE=0,Wr.NW=1,Wr.SW=2,Wr.SE=3;var tl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"compareDirection",value:function(s){return this._dx===s._dx&&this._dy===s._dy?0:this._quadrant>s._quadrant?1:this._quadrant<s._quadrant?-1:Rt.index(s._p0,s._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(s){this._node=s}},{key:"print",value:function(s){var u=Math.atan2(this._dy,this._dx),f=this.getClass().getName(),v=f.lastIndexOf("."),C=f.substring(v+1);s.print("  "+C+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label)}},{key:"compareTo",value:function(s){var u=s;return this.compareDirection(u)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var s=Math.atan2(this._dy,this._dx),u=this.getClass().getName(),f=u.lastIndexOf(".");return"  "+u.substring(f+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label}},{key:"computeLabel",value:function(s){}},{key:"init",value:function(s,u){this._p0=s,this._p1=u,this._dx=u.x-s.x,this._dy=u.y-s.y,this._quadrant=Wr.quadrant(this._dx,this._dy),ht.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var s=arguments[0];this._edge=s}else if(arguments.length===3){var u=arguments[0],f=arguments[1],v=arguments[2];S.constructor_.call(this,u,f,v,null)}else if(arguments.length===4){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3];S.constructor_.call(this,C),this.init(B,j),this._label=Q}}}]),S}(),nl=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(f){return this._depth[f]}},{key:"setVisited",value:function(f){this._isVisited=f}},{key:"computeDirectedLabel",value:function(){this._label=new sr(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(f,v){if(this._depth[f]!==-999&&this._depth[f]!==v)throw new bt("assigned depths do not match",this.getCoordinate());this._depth[f]=v}},{key:"isInteriorAreaEdge",value:function(){for(var f=!0,v=0;v<2;v++)this._label.isArea(v)&&this._label.getLocation(v,ut.LEFT)===ne.INTERIOR&&this._label.getLocation(v,ut.RIGHT)===ne.INTERIOR||(f=!1);return f}},{key:"setNextMin",value:function(f){this._nextMin=f}},{key:"print",value:function(f){Z(_(u.prototype),"print",this).call(this,f),f.print(" "+this._depth[ut.LEFT]+"/"+this._depth[ut.RIGHT]),f.print(" ("+this.getDepthDelta()+")"),this._isInResult&&f.print(" inResult")}},{key:"setMinEdgeRing",value:function(f){this._minEdgeRing=f}},{key:"isLineEdge",value:function(){var f=this._label.isLine(0)||this._label.isLine(1),v=!this._label.isArea(0)||this._label.allPositionsEqual(0,ne.EXTERIOR),C=!this._label.isArea(1)||this._label.allPositionsEqual(1,ne.EXTERIOR);return f&&v&&C}},{key:"setEdgeRing",value:function(f){this._edgeRing=f}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var f=this._edge.getDepthDelta();return this._isForward||(f=-f),f}},{key:"setInResult",value:function(f){this._isInResult=f}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(f){this.print(f),f.print(" "),this._isForward?this._edge.print(f):this._edge.printReverse(f)}},{key:"setSym",value:function(f){this._sym=f}},{key:"setVisitedEdge",value:function(f){this.setVisited(f),this._sym.setVisited(f)}},{key:"setEdgeDepths",value:function(f,v){var C=this.getEdge().getDepthDelta();this._isForward||(C=-C);var B=1;f===ut.LEFT&&(B=-1);var j=ut.opposite(f),Q=v+C*B;this.setDepth(f,v),this.setDepth(j,Q)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(f){this._next=f}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var f=arguments[0],v=arguments[1];if(tl.constructor_.call(this,f),this._isForward=v,v)this.init(f.getCoordinate(0),f.getCoordinate(1));else{var C=f.getNumPoints()-1;this.init(f.getCoordinate(C),f.getCoordinate(C-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(f,v){return f===ne.EXTERIOR&&v===ne.INTERIOR?1:f===ne.INTERIOR&&v===ne.EXTERIOR?-1:0}}]),u}(tl),Fl=function(){function S(){t(this,S)}return d(S,[{key:"createNode",value:function(s){return new el(s,null)}}]),S}(),Ws=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"printEdges",value:function(s){s.println("Edges:");for(var u=0;u<this._edges.size();u++){s.println("edge "+u+":");var f=this._edges.get(u);f.print(s),f.eiList.print(s)}}},{key:"find",value:function(s){return this._nodes.find(s)}},{key:"addNode",value:function(){if(arguments[0]instanceof el){var s=arguments[0];return this._nodes.addNode(s)}if(arguments[0]instanceof qe){var u=arguments[0];return this._nodes.addNode(u)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var s=this._nodes.iterator();s.hasNext();)s.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(s){Ht.out.println(s)}},{key:"isBoundaryNode",value:function(s,u){var f=this._nodes.find(u);if(f===null)return!1;var v=f.getLabel();return v!==null&&v.getLocation(s)===ne.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var s=this._nodes.iterator();s.hasNext();)s.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(s,u,f,v){return!!s.equals(f)&&Rt.index(s,u,v)===Rt.COLLINEAR&&Wr.quadrant(s,u)===Wr.quadrant(f,v)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(s){Ht.out.print(s)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(s,u){for(var f=0;f<this._edges.size();f++){var v=this._edges.get(f),C=v.getCoordinates();if(this.matchInSameDirection(s,u,C[0],C[1])||this.matchInSameDirection(s,u,C[C.length-1],C[C.length-2]))return v}return null}},{key:"insertEdge",value:function(s){this._edges.add(s)}},{key:"findEdgeEnd",value:function(s){for(var u=this.getEdgeEnds().iterator();u.hasNext();){var f=u.next();if(f.getEdge()===s)return f}return null}},{key:"addEdges",value:function(s){for(var u=s.iterator();u.hasNext();){var f=u.next();this._edges.add(f);var v=new nl(f,!0),C=new nl(f,!1);v.setSym(C),C.setSym(v),this.add(v),this.add(C)}}},{key:"add",value:function(s){this._nodes.add(s),this._edgeEndList.add(s)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(s,u){for(var f=0;f<this._edges.size();f++){var v=this._edges.get(f),C=v.getCoordinates();if(s.equals(C[0])&&u.equals(C[1]))return v}return null}}],[{key:"constructor_",value:function(){if(this._edges=new xt,this._nodes=null,this._edgeEndList=new xt,arguments.length===0)this._nodes=new Di(new Fl);else if(arguments.length===1){var s=arguments[0];this._nodes=new Di(s)}}},{key:"linkResultDirectedEdges",value:function(s){for(var u=s.iterator();u.hasNext();)u.next().getEdges().linkResultDirectedEdges()}}]),S}(),Du=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"sortShellsAndHoles",value:function(s,u,f){for(var v=s.iterator();v.hasNext();){var C=v.next();C.isHole()?f.add(C):u.add(C)}}},{key:"computePolygons",value:function(s){for(var u=new xt,f=s.iterator();f.hasNext();){var v=f.next().toPolygon(this._geometryFactory);u.add(v)}return u}},{key:"placeFreeHoles",value:function(s,u){for(var f=u.iterator();f.hasNext();){var v=f.next();if(v.getShell()===null){var C=S.findEdgeRingContaining(v,s);if(C===null)throw new bt("unable to assign hole to a shell",v.getCoordinate(0));v.setShell(C)}}}},{key:"buildMinimalEdgeRings",value:function(s,u,f){for(var v=new xt,C=s.iterator();C.hasNext();){var B=C.next();if(B.getMaxNodeDegree()>2){B.linkDirectedEdgesForMinimalEdgeRings();var j=B.buildMinimalRings(),Q=this.findShell(j);Q!==null?(this.placePolygonHoles(Q,j),u.add(Q)):f.addAll(j)}else v.add(B)}return v}},{key:"buildMaximalEdgeRings",value:function(s){for(var u=new xt,f=s.iterator();f.hasNext();){var v=f.next();if(v.isInResult()&&v.getLabel().isArea()&&v.getEdgeRing()===null){var C=new Nl(v,this._geometryFactory);u.add(C),C.setInResult()}}return u}},{key:"placePolygonHoles",value:function(s,u){for(var f=u.iterator();f.hasNext();){var v=f.next();v.isHole()&&v.setShell(s)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(s){for(var u=0,f=null,v=s.iterator();v.hasNext();){var C=v.next();C.isHole()||(f=C,u++)}return ht.isTrue(u<=1,"found two shells in MinimalEdgeRing list"),f}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];this.add(s.getEdgeEnds(),s.getNodes())}else if(arguments.length===2){var u=arguments[0],f=arguments[1];Ws.linkResultDirectedEdges(f);var v=this.buildMaximalEdgeRings(u),C=new xt,B=this.buildMinimalEdgeRings(v,this._shellList,C);this.sortShellsAndHoles(B,this._shellList,C),this.placeFreeHoles(this._shellList,C)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new xt;var s=arguments[0];this._geometryFactory=s}},{key:"findEdgeRingContaining",value:function(s,u){for(var f=s.getLinearRing(),v=f.getEnvelopeInternal(),C=f.getCoordinateN(0),B=null,j=null,Q=u.iterator();Q.hasNext();){var xe=Q.next(),Ue=xe.getLinearRing(),je=Ue.getEnvelopeInternal();if(!je.equals(v)&&je.contains(v)){C=Dt.ptNotInList(f.getCoordinates(),Ue.getCoordinates());var Et=!1;oa.isInRing(C,Ue.getCoordinates())&&(Et=!0),Et&&(B===null||j.contains(je))&&(j=(B=xe).getLinearRing().getEnvelopeInternal())}}return B}}]),S}(),za=function(){function S(){t(this,S)}return d(S,[{key:"getBounds",value:function(){}}]),S}(),ti=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[za,de]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var s=arguments[0],u=arguments[1];this._bounds=s,this._item=u}}]),S}(),ar=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"poll",value:function(){if(this.isEmpty())return null;var s=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),s}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(s){for(var u=null,f=this._items.get(s);2*s<=this._size&&((u=2*s)!==this._size&&this._items.get(u+1).compareTo(this._items.get(u))<0&&u++,this._items.get(u).compareTo(f)<0);s=u)this._items.set(s,this._items.get(u));this._items.set(s,f)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(s){this._items.add(null),this._size+=1;var u=this._size;for(this._items.set(0,s);s.compareTo(this._items.get(Math.trunc(u/2)))<0;u/=2)this._items.set(u,this._items.get(Math.trunc(u/2)));this._items.set(u,s)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new xt,this._items.add(null)}}]),S}(),Nu=function(){function S(){t(this,S)}return d(S,[{key:"insert",value:function(s,u){}},{key:"remove",value:function(s,u){}},{key:"query",value:function(){}}]),S}(),yr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(s){ht.isTrue(this._bounds===null),this._childBoundables.add(s)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[za,de]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new xt,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this._level=s}}}}]),S}(),lo={reverseOrder:function(){return{compare:function(S,s){return s.compareTo(S)}}},min:function(S){return lo.sort(S),S.get(0)},sort:function(S,s){var u=S.toArray();s?ct.sort(u,s):ct.sort(u);for(var f=S.iterator(),v=0,C=u.length;v<C;v++)f.next(),f.set(u[v])},singletonList:function(S){var s=new xt;return s.add(S),s}},Ba=function(){function S(){t(this,S)}return d(S,null,[{key:"maxDistance",value:function(s,u,f,v,C,B,j,Q){var xe=S.distance(s,u,C,B);return xe=Math.max(xe,S.distance(s,u,j,Q)),xe=Math.max(xe,S.distance(f,v,C,B)),xe=Math.max(xe,S.distance(f,v,j,Q))}},{key:"distance",value:function(s,u,f,v){var C=f-s,B=v-u;return Math.sqrt(C*C+B*B)}},{key:"maximumDistance",value:function(s,u){var f=Math.min(s.getMinX(),u.getMinX()),v=Math.min(s.getMinY(),u.getMinY()),C=Math.max(s.getMaxX(),u.getMaxX()),B=Math.max(s.getMaxY(),u.getMaxY());return S.distance(f,v,C,B)}},{key:"minMaxDistance",value:function(s,u){var f=s.getMinX(),v=s.getMinY(),C=s.getMaxX(),B=s.getMaxY(),j=u.getMinX(),Q=u.getMinY(),xe=u.getMaxX(),Ue=u.getMaxY(),je=S.maxDistance(f,v,f,B,j,Q,j,Ue);return je=Math.min(je,S.maxDistance(f,v,f,B,j,Q,xe,Q)),je=Math.min(je,S.maxDistance(f,v,f,B,xe,Ue,j,Ue)),je=Math.min(je,S.maxDistance(f,v,f,B,xe,Ue,xe,Q)),je=Math.min(je,S.maxDistance(f,v,C,v,j,Q,j,Ue)),je=Math.min(je,S.maxDistance(f,v,C,v,j,Q,xe,Q)),je=Math.min(je,S.maxDistance(f,v,C,v,xe,Ue,j,Ue)),je=Math.min(je,S.maxDistance(f,v,C,v,xe,Ue,xe,Q)),je=Math.min(je,S.maxDistance(C,B,f,B,j,Q,j,Ue)),je=Math.min(je,S.maxDistance(C,B,f,B,j,Q,xe,Q)),je=Math.min(je,S.maxDistance(C,B,f,B,xe,Ue,j,Ue)),je=Math.min(je,S.maxDistance(C,B,f,B,xe,Ue,xe,Q)),je=Math.min(je,S.maxDistance(C,B,C,v,j,Q,j,Ue)),je=Math.min(je,S.maxDistance(C,B,C,v,j,Q,xe,Q)),je=Math.min(je,S.maxDistance(C,B,C,v,xe,Ue,j,Ue)),je=Math.min(je,S.maxDistance(C,B,C,v,xe,Ue,xe,Q))}}]),S}(),qr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"maximumDistance",value:function(){return Ba.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(s,u){var f=S.isComposite(this._boundable1),v=S.isComposite(this._boundable2);if(f&&v)return S.area(this._boundable1)>S.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,s,u),null):(this.expand(this._boundable2,this._boundable1,!0,s,u),null);if(f)return this.expand(this._boundable1,this._boundable2,!1,s,u),null;if(v)return this.expand(this._boundable2,this._boundable1,!0,s,u),null;throw new Le("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(S.isComposite(this._boundable1)||S.isComposite(this._boundable2))}},{key:"compareTo",value:function(s){var u=s;return this._distance<u._distance?-1:this._distance>u._distance?1:0}},{key:"expand",value:function(s,u,f,v,C){for(var B=s.getChildBoundables().iterator();B.hasNext();){var j=B.next(),Q=null;(Q=f?new S(u,j,this._itemDistance):new S(j,u,this._itemDistance)).getDistance()<C&&v.add(Q)}}},{key:"getBoundable",value:function(s){return s===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var s=arguments[0],u=arguments[1],f=arguments[2];this._boundable1=s,this._boundable2=u,this._itemDistance=f,this._distance=this.distance()}},{key:"area",value:function(s){return s.getBounds().getArea()}},{key:"isComposite",value:function(s){return s instanceof yr}}]),S}(),zl=function(){function S(){t(this,S)}return d(S,[{key:"visitItem",value:function(s){}}]),S}(),uo=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"queryInternal",value:function(){if(St(arguments[2],zl)&&arguments[0]instanceof Object&&arguments[1]instanceof yr)for(var s=arguments[0],u=arguments[1],f=arguments[2],v=u.getChildBoundables(),C=0;C<v.size();C++){var B=v.get(C);this.getIntersectsOp().intersects(B.getBounds(),s)&&(B instanceof yr?this.queryInternal(s,B,f):B instanceof ti?f.visitItem(B.getItem()):ht.shouldNeverReachHere())}else if(St(arguments[2],dt)&&arguments[0]instanceof Object&&arguments[1]instanceof yr)for(var j=arguments[0],Q=arguments[1],xe=arguments[2],Ue=Q.getChildBoundables(),je=0;je<Ue.size();je++){var Et=Ue.get(je);this.getIntersectsOp().intersects(Et.getBounds(),j)&&(Et instanceof yr?this.queryInternal(j,Et,xe):Et instanceof ti?xe.add(Et.getItem()):ht.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(s){return s.get(s.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var s=arguments[0],u=0,f=s.getChildBoundables().iterator();f.hasNext();){var v=f.next();v instanceof yr?u+=this.size(v):v instanceof ti&&(u+=1)}return u}}},{key:"removeItem",value:function(s,u){for(var f=null,v=s.getChildBoundables().iterator();v.hasNext();){var C=v.next();C instanceof ti&&C.getItem()===u&&(f=C)}return f!==null&&(s.getChildBoundables().remove(f),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var s=this.itemsTree(this._root);return s===null?new xt:s}if(arguments.length===1){for(var u=arguments[0],f=new xt,v=u.getChildBoundables().iterator();v.hasNext();){var C=v.next();if(C instanceof yr){var B=this.itemsTree(C);B!==null&&f.add(B)}else C instanceof ti?f.add(C.getItem()):ht.shouldNeverReachHere()}return f.size()<=0?null:f}}},{key:"insert",value:function(s,u){ht.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ti(s,u))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var s=arguments[0],u=new xt;return this.boundablesAtLevel(s,this._root,u),u}if(arguments.length===3){var f=arguments[0],v=arguments[1],C=arguments[2];if(ht.isTrue(f>-2),v.getLevel()===f)return C.add(v),null;for(var B=v.getChildBoundables().iterator();B.hasNext();){var j=B.next();j instanceof yr?this.boundablesAtLevel(f,j,C):(ht.isTrue(j instanceof ti),f===-1&&C.add(j))}return null}}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];this.build();var u=new xt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.queryInternal(s,this._root,u),u}if(arguments.length===2){var f=arguments[0],v=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.queryInternal(f,this._root,v)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.remove(s,this._root,u)}if(arguments.length===3){var f=arguments[0],v=arguments[1],C=arguments[2],B=this.removeItem(v,C);if(B)return!0;for(var j=null,Q=v.getChildBoundables().iterator();Q.hasNext();){var xe=Q.next();if(this.getIntersectsOp().intersects(xe.getBounds(),f)&&xe instanceof yr&&(B=this.remove(f,xe,C))){j=xe;break}}return j!==null&&j.getChildBoundables().isEmpty()&&v.getChildBoundables().remove(j),B}}},{key:"createHigherLevels",value:function(s,u){ht.isTrue(!s.isEmpty());var f=this.createParentBoundables(s,u+1);return f.size()===1?f.get(0):this.createHigherLevels(f,u+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var s=arguments[0],u=0,f=s.getChildBoundables().iterator();f.hasNext();){var v=f.next();if(v instanceof yr){var C=this.depth(v);C>u&&(u=C)}}return u+1}}},{key:"createParentBoundables",value:function(s,u){ht.isTrue(!s.isEmpty());var f=new xt;f.add(this.createNode(u));var v=new xt(s);lo.sort(v,this.getComparator());for(var C=v.iterator();C.hasNext();){var B=C.next();this.lastNode(f).getChildBoundables().size()===this.getNodeCapacity()&&f.add(this.createNode(u)),this.lastNode(f).addChildBoundable(B)}return f}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new xt,this._nodeCapacity=null,arguments.length===0)S.constructor_.call(this,S.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];ht.isTrue(s>1,"Node capacity must be greater than 1"),this._nodeCapacity=s}}},{key:"compareDoubles",value:function(s,u){return s>u?1:s<u?-1:0}}]),S}();uo.IntersectsOp=function(){},uo.DEFAULT_NODE_CAPACITY=10;var Ou=function(){function S(){t(this,S)}return d(S,[{key:"distance",value:function(s,u){}}]),S}(),ys=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"createParentBoundablesFromVerticalSlices",value:function(f,v){ht.isTrue(f.length>0);for(var C=new xt,B=0;B<f.length;B++)C.addAll(this.createParentBoundablesFromVerticalSlice(f[B],v));return C}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var f=arguments[0],v=arguments[1];return this.nearestNeighbourK(f,Tt.POSITIVE_INFINITY,v)}if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2],Q=B,xe=new ar;xe.add(C);for(var Ue=new ar;!xe.isEmpty()&&Q>=0;){var je=xe.poll(),Et=je.getDistance();if(Et>=Q)break;if(je.isLeaves())if(Ue.size()<j)Ue.add(je);else{var Zt=Ue.peek();Zt.getDistance()>Et&&(Ue.poll(),Ue.add(je));var Nt=Ue.peek();Q=Nt.getDistance()}else je.expandToQueue(xe,Q)}return u.getItems(Ue)}}},{key:"createNode",value:function(f){return new Bl(f)}},{key:"size",value:function(){return arguments.length===0?Z(_(u.prototype),"size",this).call(this):Z(_(u.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof bn))return Z(_(u.prototype),"insert",this).apply(this,arguments);var f=arguments[0],v=arguments[1];if(f.isNull())return null;Z(_(u.prototype),"insert",this).call(this,f,v)}},{key:"getIntersectsOp",value:function(){return u.intersectsOp}},{key:"verticalSlices",value:function(f,v){for(var C=Math.trunc(Math.ceil(f.size()/v)),B=new Array(v).fill(null),j=f.iterator(),Q=0;Q<v;Q++){B[Q]=new xt;for(var xe=0;j.hasNext()&&xe<C;){var Ue=j.next();B[Q].add(Ue),xe++}}return B}},{key:"query",value:function(){if(arguments.length===1){var f=arguments[0];return Z(_(u.prototype),"query",this).call(this,f)}if(arguments.length===2){var v=arguments[0],C=arguments[1];Z(_(u.prototype),"query",this).call(this,v,C)}}},{key:"getComparator",value:function(){return u.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(f,v){return Z(_(u.prototype),"createParentBoundables",this).call(this,f,v)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof bn){var f=arguments[0],v=arguments[1];return Z(_(u.prototype),"remove",this).call(this,f,v)}return Z(_(u.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Z(_(u.prototype),"depth",this).call(this):Z(_(u.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(f,v){ht.isTrue(!f.isEmpty());var C=Math.trunc(Math.ceil(f.size()/this.getNodeCapacity())),B=new xt(f);lo.sort(B,u.xComparator);var j=this.verticalSlices(B,Math.trunc(Math.ceil(Math.sqrt(C))));return this.createParentBoundablesFromVerticalSlices(j,v)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(St(arguments[0],Ou)){var f=arguments[0];if(this.isEmpty())return null;var v=new qr(this.getRoot(),this.getRoot(),f);return this.nearestNeighbour(v)}if(arguments[0]instanceof qr){var C=arguments[0],B=Tt.POSITIVE_INFINITY,j=null,Q=new ar;for(Q.add(C);!Q.isEmpty()&&B>0;){var xe=Q.poll(),Ue=xe.getDistance();if(Ue>=B)break;xe.isLeaves()?(B=Ue,j=xe):xe.expandToQueue(Q,B)}return j===null?null:[j.getBoundable(0).getItem(),j.getBoundable(1).getItem()]}}else{if(arguments.length===2){var je=arguments[0],Et=arguments[1];if(this.isEmpty()||je.isEmpty())return null;var Zt=new qr(this.getRoot(),je.getRoot(),Et);return this.nearestNeighbour(Zt)}if(arguments.length===3){var Nt=arguments[0],Rn=arguments[1],Nn=arguments[2],fn=new ti(Nt,Rn),Ii=new qr(this.getRoot(),fn,Nn);return this.nearestNeighbour(Ii)[0]}if(arguments.length===4){var Bi=arguments[0],vr=arguments[1],zr=arguments[2],Es=arguments[3],Xs=new ti(Bi,vr),js=new qr(this.getRoot(),Xs,zr);return this.nearestNeighbourK(js,Es)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var f=arguments[0],v=arguments[1],C=Tt.POSITIVE_INFINITY,B=new ar;for(B.add(f);!B.isEmpty();){var j=B.poll(),Q=j.getDistance();if(Q>v)return!1;if(j.maximumDistance()<=v)return!0;if(j.isLeaves()){if((C=Q)<=v)return!0}else j.expandToQueue(B,C)}return!1}if(arguments.length===3){var xe=arguments[0],Ue=arguments[1],je=arguments[2],Et=new qr(this.getRoot(),xe.getRoot(),Ue);return this.isWithinDistance(Et,je)}}},{key:"interfaces_",get:function(){return[Nu,de]}}],[{key:"constructor_",value:function(){if(arguments.length===0)u.constructor_.call(this,u.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var f=arguments[0];uo.constructor_.call(this,f)}}},{key:"centreX",value:function(f){return u.avg(f.getMinX(),f.getMaxX())}},{key:"avg",value:function(f,v){return(f+v)/2}},{key:"getItems",value:function(f){for(var v=new Array(f.size()).fill(null),C=0;!f.isEmpty();){var B=f.poll();v[C]=B.getBoundable(0).getItem(),C++}return v}},{key:"centreY",value:function(f){return u.avg(f.getMinY(),f.getMaxY())}}]),u}(uo),Bl=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"computeBounds",value:function(){for(var f=null,v=this.getChildBoundables().iterator();v.hasNext();){var C=v.next();f===null?f=new bn(C.getBounds()):f.expandToInclude(C.getBounds())}return f}}],[{key:"constructor_",value:function(){var f=arguments[0];yr.constructor_.call(this,f)}}]),u}(yr);ys.STRtreeNode=Bl,ys.xComparator=new(function(){function S(){t(this,S)}return d(S,[{key:"interfaces_",get:function(){return[jt]}},{key:"compare",value:function(s,u){return uo.compareDoubles(ys.centreX(s.getBounds()),ys.centreX(u.getBounds()))}}]),S}()),ys.yComparator=new(function(){function S(){t(this,S)}return d(S,[{key:"interfaces_",get:function(){return[jt]}},{key:"compare",value:function(s,u){return uo.compareDoubles(ys.centreY(s.getBounds()),ys.centreY(u.getBounds()))}}]),S}()),ys.intersectsOp=new(function(){function S(){t(this,S)}return d(S,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(s,u){return s.intersects(u)}}]),S}()),ys.DEFAULT_NODE_CAPACITY=10;var Fu=function(){function S(){t(this,S)}return d(S,null,[{key:"relativeSign",value:function(s,u){return s<u?-1:s>u?1:0}},{key:"compare",value:function(s,u,f){if(u.equals2D(f))return 0;var v=S.relativeSign(u.x,f.x),C=S.relativeSign(u.y,f.y);switch(s){case 0:return S.compareValue(v,C);case 1:return S.compareValue(C,v);case 2:return S.compareValue(C,-v);case 3:return S.compareValue(-v,C);case 4:return S.compareValue(-v,-C);case 5:return S.compareValue(-C,-v);case 6:return S.compareValue(-C,v);case 7:return S.compareValue(v,-C)}return ht.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(s,u){return s<0?-1:s>0?1:u<0?-1:u>0?1:0}}]),S}(),us=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(s){s.print(this.coord),s.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(s){var u=s;return this.segmentIndex<u.segmentIndex?-1:this.segmentIndex>u.segmentIndex?1:this.coord.equals2D(u.coord)?0:this._isInterior?u._isInterior?Fu.compare(this._segmentOctant,this.coord,u.coord):1:-1}},{key:"isEndPoint",value:function(s){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===s}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3];this._segString=s,this.coord=new qe(u),this.segmentIndex=f,this._segmentOctant=v,this._isInterior=!u.equals2D(s.getCoordinate(f))}}]),S}(),Ec=function(){function S(){t(this,S)}return d(S,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),S}(),Or=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getSplitCoordinates",value:function(){var s=new Qe;this.addEndpoints();for(var u=this.iterator(),f=u.next();u.hasNext();){var v=u.next();this.addEdgeCoordinates(f,v,s),f=v}return s.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var s=new xt;this.findCollapsesFromInsertedNodes(s),this.findCollapsesFromExistingVertices(s);for(var u=s.iterator();u.hasNext();){var f=u.next().intValue();this.add(this._edge.getCoordinate(f),f)}}},{key:"createSplitEdgePts",value:function(s,u){var f=u.segmentIndex-s.segmentIndex+2;if(f===2)return[new qe(s.coord),new qe(u.coord)];var v=this._edge.getCoordinate(u.segmentIndex),C=u.isInterior()||!u.coord.equals2D(v);C||f--;var B=new Array(f).fill(null),j=0;B[j++]=new qe(s.coord);for(var Q=s.segmentIndex+1;Q<=u.segmentIndex;Q++)B[j++]=this._edge.getCoordinate(Q);return C&&(B[j]=new qe(u.coord)),B}},{key:"print",value:function(s){s.println("Intersections:");for(var u=this.iterator();u.hasNext();)u.next().print(s)}},{key:"findCollapsesFromExistingVertices",value:function(s){for(var u=0;u<this._edge.size()-2;u++){var f=this._edge.getCoordinate(u);this._edge.getCoordinate(u+1);var v=this._edge.getCoordinate(u+2);f.equals2D(v)&&s.add(Dn.valueOf(u+1))}}},{key:"addEdgeCoordinates",value:function(s,u,f){var v=this.createSplitEdgePts(s,u);f.add(v,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(s){this.addEndpoints(),this.addCollapsedNodes();for(var u=this.iterator(),f=u.next();u.hasNext();){var v=u.next(),C=this.createSplitEdge(f,v);s.add(C),f=v}}},{key:"findCollapseIndex",value:function(s,u,f){if(!s.coord.equals2D(u.coord))return!1;var v=u.segmentIndex-s.segmentIndex;return u.isInterior()||v--,v===1&&(f[0]=s.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(s){for(var u=new Array(1).fill(null),f=this.iterator(),v=f.next();f.hasNext();){var C=f.next();this.findCollapseIndex(v,C,u)&&s.add(Dn.valueOf(u[0])),v=C}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var s=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(s),s)}},{key:"createSplitEdge",value:function(s,u){var f=this.createSplitEdgePts(s,u);return new qs(f,this._edge.getData())}},{key:"add",value:function(s,u){var f=new us(this._edge,s,u,this._edge.getSegmentOctant(u)),v=this._nodeMap.get(f);return v!==null?(ht.isTrue(v.coord.equals2D(s),"Found equal nodes with different coordinates"),v):(this._nodeMap.put(f,f),f)}},{key:"checkSplitEdgesCorrectness",value:function(s){var u=this._edge.getCoordinates(),f=s.get(0).getCoordinate(0);if(!f.equals2D(u[0]))throw new Cn("bad split edge start point at "+f);var v=s.get(s.size()-1).getCoordinates(),C=v[v.length-1];if(!C.equals2D(u[u.length-1]))throw new Cn("bad split edge end point at "+C)}}],[{key:"constructor_",value:function(){this._nodeMap=new zi,this._edge=null;var s=arguments[0];this._edge=s}}]),S}(),Tc=function(){function S(){t(this,S)}return d(S,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],u=arguments[1];if(s===0&&u===0)throw new Le("Cannot compute the octant for point ( "+s+", "+u+" )");var f=Math.abs(s),v=Math.abs(u);return s>=0?u>=0?f>=v?0:1:f>=v?7:6:u>=0?f>=v?3:2:f>=v?4:5}if(arguments[0]instanceof qe&&arguments[1]instanceof qe){var C=arguments[0],B=arguments[1],j=B.x-C.x,Q=B.y-C.y;if(j===0&&Q===0)throw new Le("Cannot compute the octant for two identical points "+C);return S.octant(j,Q)}}}]),S}(),Mc=function(){function S(){t(this,S)}return d(S,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(s){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(s){}},{key:"getData",value:function(){}}]),S}(),Ua=function(){function S(){t(this,S)}return d(S,[{key:"addIntersection",value:function(s,u){}},{key:"interfaces_",get:function(){return[Mc]}}]),S}(),qs=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(s){return this._pts[s]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(s){return s===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(s),this.getCoordinate(s+1))}},{key:"setData",value:function(s){this._data=s}},{key:"safeOctant",value:function(s,u){return s.equals2D(u)?0:Tc.octant(s,u)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];this.addIntersectionNode(s,u)}else if(arguments.length===4){var f=arguments[0],v=arguments[1],C=arguments[3],B=new qe(f.getIntersection(C));this.addIntersection(B,v)}}},{key:"toString",value:function(){return Dl.toLineString(new zn(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(s,u){var f=u,v=f+1;if(v<this._pts.length){var C=this._pts[v];s.equals2D(C)&&(f=v)}return this._nodeList.add(s,f)}},{key:"addIntersections",value:function(s,u,f){for(var v=0;v<s.getIntersectionNum();v++)this.addIntersection(s,u,f,v)}},{key:"interfaces_",get:function(){return[Ua]}}],[{key:"constructor_",value:function(){this._nodeList=new Or(this),this._pts=null,this._data=null;var s=arguments[0],u=arguments[1];this._pts=s,this._data=u}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var s=arguments[0],u=new xt;return S.getNodedSubstrings(s,u),u}if(arguments.length===2)for(var f=arguments[0],v=arguments[1],C=f.iterator();C.hasNext();){var B=C.next();B.getNodeList().addSplitEdges(v)}}}]),S}(),Cr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof S){var s=arguments[0],u=Rt.index(this.p0,this.p1,s.p0),f=Rt.index(this.p0,this.p1,s.p1);return u>=0&&f>=0||u<=0&&f<=0?Math.max(u,f):0}if(arguments[0]instanceof qe){var v=arguments[0];return Rt.index(this.p0,this.p1,v)}}},{key:"toGeometry",value:function(s){return s.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(s){if(!(s instanceof S))return!1;var u=s;return this.p0.equals(u.p0)&&this.p1.equals(u.p1)}},{key:"intersection",value:function(s){var u=new Sa;return u.computeIntersection(this.p0,this.p1,s.p0,s.p1),u.hasIntersection()?u.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof qe){var s=arguments[0];if(s.equals(this.p0)||s.equals(this.p1))return new qe(s);var u=this.projectionFactor(s),f=new qe;return f.x=this.p0.x+u*(this.p1.x-this.p0.x),f.y=this.p0.y+u*(this.p1.y-this.p0.y),f}if(arguments[0]instanceof S){var v=arguments[0],C=this.projectionFactor(v.p0),B=this.projectionFactor(v.p1);if(C>=1&&B>=1||C<=0&&B<=0)return null;var j=this.project(v.p0);C<0&&(j=this.p0),C>1&&(j=this.p1);var Q=this.project(v.p1);return B<0&&(Q=this.p0),B>1&&(Q=this.p1),new S(j,Q)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(s){return s===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(s){return It.pointToLinePerpendicular(s,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return S.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(s){if(s.equals(this.p0))return 0;if(s.equals(this.p1))return 1;var u=this.p1.x-this.p0.x,f=this.p1.y-this.p0.y,v=u*u+f*f;return v<=0?Tt.NaN:((s.x-this.p0.x)*u+(s.y-this.p0.y)*f)/v}},{key:"closestPoints",value:function(s){var u=this.intersection(s);if(u!==null)return[u,u];var f=new Array(2).fill(null),v=Tt.MAX_VALUE,C=null,B=this.closestPoint(s.p0);v=B.distance(s.p0),f[0]=B,f[1]=s.p0;var j=this.closestPoint(s.p1);(C=j.distance(s.p1))<v&&(v=C,f[0]=j,f[1]=s.p1);var Q=s.closestPoint(this.p0);(C=Q.distance(this.p0))<v&&(v=C,f[0]=this.p0,f[1]=Q);var xe=s.closestPoint(this.p1);return(C=xe.distance(this.p1))<v&&(v=C,f[0]=this.p1,f[1]=xe),f}},{key:"closestPoint",value:function(s){var u=this.projectionFactor(s);return u>0&&u<1?this.project(s):this.p0.distance(s)<this.p1.distance(s)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(s){var u=s,f=this.p0.compareTo(u.p0);return f!==0?f:this.p1.compareTo(u.p1)}},{key:"reverse",value:function(){var s=this.p0;this.p0=this.p1,this.p1=s}},{key:"equalsTopo",value:function(s){return this.p0.equals(s.p0)&&this.p1.equals(s.p1)||this.p0.equals(s.p1)&&this.p1.equals(s.p0)}},{key:"lineIntersection",value:function(s){return Be.intersection(this.p0,this.p1,s.p0,s.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(s,u){var f=this.p0.x+s*(this.p1.x-this.p0.x),v=this.p0.y+s*(this.p1.y-this.p0.y),C=this.p1.x-this.p0.x,B=this.p1.y-this.p0.y,j=Math.sqrt(C*C+B*B),Q=0,xe=0;if(u!==0){if(j<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Q=u*C/j,xe=u*B/j}return new qe(f-xe,v+Q)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var s=arguments[0];this.setCoordinates(s.p0,s.p1)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this.p0.x=u.x,this.p0.y=u.y,this.p1.x=f.x,this.p1.y=f.y}}},{key:"segmentFraction",value:function(s){var u=this.projectionFactor(s);return u<0?u=0:(u>1||Tt.isNaN(u))&&(u=1),u}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(s){var u=this.p1.getY()-this.p0.getY(),f=this.p0.getX()-this.p1.getX(),v=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),C=u*u+f*f,B=u*u-f*f,j=s.getX(),Q=s.getY();return new qe((-B*j-2*u*f*Q-2*u*v)/C,(B*Q-2*u*f*j-2*f*v)/C)}},{key:"distance",value:function(){if(arguments[0]instanceof S){var s=arguments[0];return It.segmentToSegment(this.p0,this.p1,s.p0,s.p1)}if(arguments[0]instanceof qe){var u=arguments[0];return It.pointToSegment(u,this.p0,this.p1)}}},{key:"pointAlong",value:function(s){var u=new qe;return u.x=this.p0.x+s*(this.p1.x-this.p0.x),u.y=this.p0.y+s*(this.p1.y-this.p0.y),u}},{key:"hashCode",value:function(){var s=Tt.doubleToLongBits(this.p0.x);s^=31*Tt.doubleToLongBits(this.p0.y);var u=Math.trunc(s)^Math.trunc(s>>32),f=Tt.doubleToLongBits(this.p1.x);return f^=31*Tt.doubleToLongBits(this.p1.y),u^(Math.trunc(f)^Math.trunc(f>>32))}},{key:"interfaces_",get:function(){return[Te,de]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)S.constructor_.call(this,new qe,new qe);else if(arguments.length===1){var s=arguments[0];S.constructor_.call(this,s.p0,s.p1)}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this.p0=u,this.p1=f}else if(arguments.length===4){var v=arguments[0],C=arguments[1],B=arguments[2],j=arguments[3];S.constructor_.call(this,new qe(v,C),new qe(B,j))}}},{key:"midPoint",value:function(s,u){return new qe((s.x+u.x)/2,(s.y+u.y)/2)}}]),S}(),or=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3];s.getLineSegment(u,this._overlapSeg1),f.getLineSegment(v,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Cr,this._overlapSeg2=new Cr}}]),S}(),Ls=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getLineSegment",value:function(s,u){u.p0=this._pts[s],u.p1=this._pts[s+1]}},{key:"computeSelect",value:function(s,u,f,v){var C=this._pts[u],B=this._pts[f];if(f-u==1)return v.select(this,u),null;if(!s.intersects(C,B))return null;var j=Math.trunc((u+f)/2);u<j&&this.computeSelect(s,u,j,v),j<f&&this.computeSelect(s,j,f,v)}},{key:"getCoordinates",value:function(){for(var s=new Array(this._end-this._start+1).fill(null),u=0,f=this._start;f<=this._end;f++)s[u++]=this._pts[f];return s}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1];this.computeOverlaps(this._start,this._end,s,s._start,s._end,u)}else if(arguments.length===6){var f=arguments[0],v=arguments[1],C=arguments[2],B=arguments[3],j=arguments[4],Q=arguments[5];if(v-f==1&&j-B==1)return Q.overlap(this,f,C,B),null;if(!this.overlaps(f,v,C,B,j))return null;var xe=Math.trunc((f+v)/2),Ue=Math.trunc((B+j)/2);f<xe&&(B<Ue&&this.computeOverlaps(f,xe,C,B,Ue,Q),Ue<j&&this.computeOverlaps(f,xe,C,Ue,j,Q)),xe<v&&(B<Ue&&this.computeOverlaps(xe,v,C,B,Ue,Q),Ue<j&&this.computeOverlaps(xe,v,C,Ue,j,Q))}}},{key:"setId",value:function(s){this._id=s}},{key:"select",value:function(s,u){this.computeSelect(s,this._start,this._end,u)}},{key:"getEnvelope",value:function(){if(this._env===null){var s=this._pts[this._start],u=this._pts[this._end];this._env=new bn(s,u)}return this._env}},{key:"overlaps",value:function(s,u,f,v,C){return bn.intersects(this._pts[s],this._pts[u],f._pts[v],f._pts[C])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3];this._pts=s,this._start=u,this._end=f,this._context=v}}]),S}(),zu=function(){function S(){t(this,S)}return d(S,null,[{key:"findChainEnd",value:function(s,u){for(var f=u;f<s.length-1&&s[f].equals2D(s[f+1]);)f++;if(f>=s.length-1)return s.length-1;for(var v=Wr.quadrant(s[f],s[f+1]),C=u+1;C<s.length&&!(!s[C-1].equals2D(s[C])&&Wr.quadrant(s[C-1],s[C])!==v);)C++;return C-1}},{key:"getChains",value:function(){if(arguments.length===1){var s=arguments[0];return S.getChains(s,null)}if(arguments.length===2){var u=arguments[0],f=arguments[1],v=new xt,C=0;do{var B=S.findChainEnd(u,C),j=new Ls(u,C,B,f);v.add(j),C=B}while(C<u.length-1);return v}}}]),S}(),Bu=function(){function S(){t(this,S)}return d(S,[{key:"computeNodes",value:function(s){}},{key:"getNodedSubstrings",value:function(){}}]),S}(),il=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"setSegmentIntersector",value:function(s){this._segInt=s}},{key:"interfaces_",get:function(){return[Bu]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setSegmentIntersector(s)}}}}]),S}(),Ul=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return qs.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(f){for(var v=zu.getChains(f.getCoordinates(),f).iterator();v.hasNext();){var C=v.next();C.setId(this._idCounter++),this._index.insert(C.getEnvelope(),C),this._monoChains.add(C)}}},{key:"computeNodes",value:function(f){this._nodedSegStrings=f;for(var v=f.iterator();v.hasNext();)this.add(v.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var f=new Uu(this._segInt),v=this._monoChains.iterator();v.hasNext();)for(var C=v.next(),B=this._index.query(C.getEnvelope()).iterator();B.hasNext();){var j=B.next();if(j.getId()>C.getId()&&(C.computeOverlaps(j,f),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new xt,this._index=new ys,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var f=arguments[0];il.constructor_.call(this,f)}}}}]),u}(il),Uu=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"overlap",value:function(){if(arguments.length!==4)return Z(_(u.prototype),"overlap",this).apply(this,arguments);var f=arguments[0],v=arguments[1],C=arguments[2],B=arguments[3],j=f.getContext(),Q=C.getContext();this._si.processIntersections(j,v,Q,B)}}],[{key:"constructor_",value:function(){this._si=null;var f=arguments[0];this._si=f}}]),u}(or);Ul.SegmentOverlapAction=Uu;var vs=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"isDeletable",value:function(s,u,f,v){var C=this._inputLine[s],B=this._inputLine[u],j=this._inputLine[f];return!!this.isConcave(C,B,j)&&!!this.isShallow(C,B,j,v)&&this.isShallowSampled(C,B,s,f,v)}},{key:"deleteShallowConcavities",value:function(){for(var s=1,u=this.findNextNonDeletedIndex(s),f=this.findNextNonDeletedIndex(u),v=!1;f<this._inputLine.length;){var C=!1;this.isDeletable(s,u,f,this._distanceTol)&&(this._isDeleted[u]=S.DELETE,C=!0,v=!0),s=C?f:u,u=this.findNextNonDeletedIndex(s),f=this.findNextNonDeletedIndex(u)}return v}},{key:"isShallowConcavity",value:function(s,u,f,v){return Rt.index(s,u,f)===this._angleOrientation&&It.pointToSegment(u,s,f)<v}},{key:"isShallowSampled",value:function(s,u,f,v,C){var B=Math.trunc((v-f)/S.NUM_PTS_TO_CHECK);B<=0&&(B=1);for(var j=f;j<v;j+=B)if(!this.isShallow(s,u,this._inputLine[j],C))return!1;return!0}},{key:"isConcave",value:function(s,u,f){var v=Rt.index(s,u,f)===this._angleOrientation;return v}},{key:"simplify",value:function(s){this._distanceTol=Math.abs(s),s<0&&(this._angleOrientation=Rt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var u=!1;do u=this.deleteShallowConcavities();while(u);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(s){for(var u=s+1;u<this._inputLine.length&&this._isDeleted[u]===S.DELETE;)u++;return u}},{key:"isShallow",value:function(s,u,f,v){return It.pointToSegment(u,s,f)<v}},{key:"collapseLine",value:function(){for(var s=new Qe,u=0;u<this._inputLine.length;u++)this._isDeleted[u]!==S.DELETE&&s.add(this._inputLine[u]);return s.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Rt.COUNTERCLOCKWISE;var s=arguments[0];this._inputLine=s}},{key:"simplify",value:function(s,u){return new S(s).simplify(u)}}]),S}();vs.INIT=0,vs.DELETE=1,vs.KEEP=1,vs.NUM_PTS_TO_CHECK=10;var Vl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getCoordinates",value:function(){return this._ptList.toArray(S.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(s){this._precisionModel=s}},{key:"addPt",value:function(s){var u=new qe(s);if(this._precisionModel.makePrecise(u),this.isRedundant(u))return null;this._ptList.add(u)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(s,u){if(u)for(var f=0;f<s.length;f++)this.addPt(s[f]);else for(var v=s.length-1;v>=0;v--)this.addPt(s[v])}},{key:"isRedundant",value:function(s){if(this._ptList.size()<1)return!1;var u=this._ptList.get(this._ptList.size()-1);return s.distance(u)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Tn().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var s=new qe(this._ptList.get(0)),u=this._ptList.get(this._ptList.size()-1);if(s.equals(u))return null;this._ptList.add(s)}},{key:"setMinimumVertexDistance",value:function(s){this._minimimVertexDistance=s}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new xt}}]),S}();Vl.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Rr=function(){function S(){t(this,S)}return d(S,null,[{key:"toDegrees",value:function(s){return 180*s/Math.PI}},{key:"normalize",value:function(s){for(;s>Math.PI;)s-=S.PI_TIMES_2;for(;s<=-Math.PI;)s+=S.PI_TIMES_2;return s}},{key:"angle",value:function(){if(arguments.length===1){var s=arguments[0];return Math.atan2(s.y,s.x)}if(arguments.length===2){var u=arguments[0],f=arguments[1],v=f.x-u.x,C=f.y-u.y;return Math.atan2(C,v)}}},{key:"isAcute",value:function(s,u,f){var v=s.x-u.x,C=s.y-u.y;return v*(f.x-u.x)+C*(f.y-u.y)>0}},{key:"isObtuse",value:function(s,u,f){var v=s.x-u.x,C=s.y-u.y;return v*(f.x-u.x)+C*(f.y-u.y)<0}},{key:"interiorAngle",value:function(s,u,f){var v=S.angle(u,s),C=S.angle(u,f);return Math.abs(C-v)}},{key:"normalizePositive",value:function(s){if(s<0){for(;s<0;)s+=S.PI_TIMES_2;s>=S.PI_TIMES_2&&(s=0)}else{for(;s>=S.PI_TIMES_2;)s-=S.PI_TIMES_2;s<0&&(s=0)}return s}},{key:"angleBetween",value:function(s,u,f){var v=S.angle(u,s),C=S.angle(u,f);return S.diff(v,C)}},{key:"diff",value:function(s,u){var f=null;return(f=s<u?u-s:s-u)>Math.PI&&(f=2*Math.PI-f),f}},{key:"toRadians",value:function(s){return s*Math.PI/180}},{key:"getTurn",value:function(s,u){var f=Math.sin(u-s);return f>0?S.COUNTERCLOCKWISE:f<0?S.CLOCKWISE:S.NONE}},{key:"angleBetweenOriented",value:function(s,u,f){var v=S.angle(u,s),C=S.angle(u,f)-v;return C<=-Math.PI?C+S.PI_TIMES_2:C>Math.PI?C-S.PI_TIMES_2:C}}]),S}();Rr.PI_TIMES_2=2*Math.PI,Rr.PI_OVER_2=Math.PI/2,Rr.PI_OVER_4=Math.PI/4,Rr.COUNTERCLOCKWISE=Rt.COUNTERCLOCKWISE,Rr.CLOCKWISE=Rt.CLOCKWISE,Rr.NONE=Rt.COLLINEAR;var Fr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"addNextSegment",value:function(s,u){if(this._s0=this._s1,this._s1=this._s2,this._s2=s,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var f=Rt.index(this._s0,this._s1,this._s2),v=f===Rt.CLOCKWISE&&this._side===ut.LEFT||f===Rt.COUNTERCLOCKWISE&&this._side===ut.RIGHT;f===0?this.addCollinear(u):v?this.addOutsideTurn(f,u):this.addInsideTurn(f,u)}},{key:"addLineEndCap",value:function(s,u){var f=new Cr(s,u),v=new Cr;this.computeOffsetSegment(f,ut.LEFT,this._distance,v);var C=new Cr;this.computeOffsetSegment(f,ut.RIGHT,this._distance,C);var B=u.x-s.x,j=u.y-s.y,Q=Math.atan2(j,B);switch(this._bufParams.getEndCapStyle()){case le.CAP_ROUND:this._segList.addPt(v.p1),this.addDirectedFillet(u,Q+Math.PI/2,Q-Math.PI/2,Rt.CLOCKWISE,this._distance),this._segList.addPt(C.p1);break;case le.CAP_FLAT:this._segList.addPt(v.p1),this._segList.addPt(C.p1);break;case le.CAP_SQUARE:var xe=new qe;xe.x=Math.abs(this._distance)*Math.cos(Q),xe.y=Math.abs(this._distance)*Math.sin(Q);var Ue=new qe(v.p1.x+xe.x,v.p1.y+xe.y),je=new qe(C.p1.x+xe.x,C.p1.y+xe.y);this._segList.addPt(Ue),this._segList.addPt(je)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(s,u,f,v){var C=Be.intersection(u.p0,u.p1,f.p0,f.p1);if(C!==null&&(v<=0?1:C.distance(s)/Math.abs(v))<=this._bufParams.getMitreLimit())return this._segList.addPt(C),null;this.addLimitedMitreJoin(u,f,v,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(s,u){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*S.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===le.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===le.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(u&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,s,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(s){this._segList.addPt(new qe(s.x+this._distance,s.y+this._distance)),this._segList.addPt(new qe(s.x+this._distance,s.y-this._distance)),this._segList.addPt(new qe(s.x-this._distance,s.y-this._distance)),this._segList.addPt(new qe(s.x-this._distance,s.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(s,u){this._segList.addPts(s,u)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(s,u,f,v,C){var B=u.x-s.x,j=u.y-s.y,Q=Math.atan2(j,B),xe=f.x-s.x,Ue=f.y-s.y,je=Math.atan2(Ue,xe);v===Rt.CLOCKWISE?Q<=je&&(Q+=2*Math.PI):Q>=je&&(Q-=2*Math.PI),this._segList.addPt(u),this.addDirectedFillet(s,Q,je,v,C),this._segList.addPt(f)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(s,u,f){this._s1=s,this._s2=u,this._side=f,this._seg1.setCoordinates(s,u),this.computeOffsetSegment(this._seg1,f,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(s,u,f,v){var C=this._seg0.p1,B=Rr.angle(C,this._seg0.p0),j=Rr.angleBetweenOriented(this._seg0.p0,C,this._seg1.p1)/2,Q=Rr.normalize(B+j),xe=Rr.normalize(Q+Math.PI),Ue=v*f,je=f-Ue*Math.abs(Math.sin(j)),Et=C.x+Ue*Math.cos(xe),Zt=C.y+Ue*Math.sin(xe),Nt=new qe(Et,Zt),Rn=new Cr(C,Nt),Nn=Rn.pointAlongOffset(1,je),fn=Rn.pointAlongOffset(1,-je);this._side===ut.LEFT?(this._segList.addPt(Nn),this._segList.addPt(fn)):(this._segList.addPt(fn),this._segList.addPt(Nn))}},{key:"addDirectedFillet",value:function(s,u,f,v,C){var B=v===Rt.CLOCKWISE?-1:1,j=Math.abs(u-f),Q=Math.trunc(j/this._filletAngleQuantum+.5);if(Q<1)return null;for(var xe=j/Q,Ue=new qe,je=0;je<Q;je++){var Et=u+B*je*xe;Ue.x=s.x+C*Math.cos(Et),Ue.y=s.y+C*Math.sin(Et),this._segList.addPt(Ue)}}},{key:"computeOffsetSegment",value:function(s,u,f,v){var C=u===ut.LEFT?1:-1,B=s.p1.x-s.p0.x,j=s.p1.y-s.p0.y,Q=Math.sqrt(B*B+j*j),xe=C*f*B/Q,Ue=C*f*j/Q;v.p0.x=s.p0.x-Ue,v.p0.y=s.p0.y+xe,v.p1.x=s.p1.x-Ue,v.p1.y=s.p1.y+xe}},{key:"addInsideTurn",value:function(s,u){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*S.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var f=new qe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(f);var v=new qe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(v)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(s){var u=new qe(s.x+this._distance,s.y);this._segList.addPt(u),this.addDirectedFillet(s,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(s,u){this._segList.addPt(s.p1),this._segList.addPt(u.p0)}},{key:"init",value:function(s){this._distance=s,this._maxCurveSegmentError=s*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Vl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(s*S.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(s){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===le.JOIN_BEVEL||this._bufParams.getJoinStyle()===le.JOIN_MITRE?(s&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Rt.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Cr,this._seg1=new Cr,this._offset0=new Cr,this._offset1=new Cr,this._side=0,this._hasNarrowConcaveAngle=!1;var s=arguments[0],u=arguments[1],f=arguments[2];this._precisionModel=s,this._bufParams=u,this._li=new Sa,this._filletAngleQuantum=Math.PI/2/u.getQuadrantSegments(),u.getQuadrantSegments()>=8&&u.getJoinStyle()===le.JOIN_ROUND&&(this._closingSegLengthFactor=S.MAX_CLOSING_SEG_LEN_FACTOR),this.init(f)}}]),S}();Fr.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Fr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Fr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Fr.MAX_CLOSING_SEG_LEN_FACTOR=80;var rl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getOffsetCurve",value:function(s,u){if(this._distance=u,u===0)return null;var f=u<0,v=Math.abs(u),C=this.getSegGen(v);s.length<=1?this.computePointCurve(s[0],C):this.computeOffsetCurve(s,f,C);var B=C.getCoordinates();return f&&Dt.reverse(B),B}},{key:"computeSingleSidedBufferCurve",value:function(s,u,f){var v=this.simplifyTolerance(this._distance);if(u){f.addSegments(s,!0);var C=vs.simplify(s,-v),B=C.length-1;f.initSideSegments(C[B],C[B-1],ut.LEFT),f.addFirstSegment();for(var j=B-2;j>=0;j--)f.addNextSegment(C[j],!0)}else{f.addSegments(s,!1);var Q=vs.simplify(s,v),xe=Q.length-1;f.initSideSegments(Q[0],Q[1],ut.LEFT),f.addFirstSegment();for(var Ue=2;Ue<=xe;Ue++)f.addNextSegment(Q[Ue],!0)}f.addLastSegment(),f.closeRing()}},{key:"computeRingBufferCurve",value:function(s,u,f){var v=this.simplifyTolerance(this._distance);u===ut.RIGHT&&(v=-v);var C=vs.simplify(s,v),B=C.length-1;f.initSideSegments(C[B-1],C[0],u);for(var j=1;j<=B;j++){var Q=j!==1;f.addNextSegment(C[j],Q)}f.closeRing()}},{key:"computeLineBufferCurve",value:function(s,u){var f=this.simplifyTolerance(this._distance),v=vs.simplify(s,f),C=v.length-1;u.initSideSegments(v[0],v[1],ut.LEFT);for(var B=2;B<=C;B++)u.addNextSegment(v[B],!0);u.addLastSegment(),u.addLineEndCap(v[C-1],v[C]);var j=vs.simplify(s,-f),Q=j.length-1;u.initSideSegments(j[Q],j[Q-1],ut.LEFT);for(var xe=Q-2;xe>=0;xe--)u.addNextSegment(j[xe],!0);u.addLastSegment(),u.addLineEndCap(j[1],j[0]),u.closeRing()}},{key:"computePointCurve",value:function(s,u){switch(this._bufParams.getEndCapStyle()){case le.CAP_ROUND:u.createCircle(s);break;case le.CAP_SQUARE:u.createSquare(s)}}},{key:"getLineCurve",value:function(s,u){if(this._distance=u,this.isLineOffsetEmpty(u))return null;var f=Math.abs(u),v=this.getSegGen(f);if(s.length<=1)this.computePointCurve(s[0],v);else if(this._bufParams.isSingleSided()){var C=u<0;this.computeSingleSidedBufferCurve(s,C,v)}else this.computeLineBufferCurve(s,v);return v.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(s){return s*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(s,u,f){if(this._distance=f,s.length<=2)return this.getLineCurve(s,f);if(f===0)return S.copyCoordinates(s);var v=this.getSegGen(f);return this.computeRingBufferCurve(s,u,v),v.getCoordinates()}},{key:"computeOffsetCurve",value:function(s,u,f){var v=this.simplifyTolerance(this._distance);if(u){var C=vs.simplify(s,-v),B=C.length-1;f.initSideSegments(C[B],C[B-1],ut.LEFT),f.addFirstSegment();for(var j=B-2;j>=0;j--)f.addNextSegment(C[j],!0)}else{var Q=vs.simplify(s,v),xe=Q.length-1;f.initSideSegments(Q[0],Q[1],ut.LEFT),f.addFirstSegment();for(var Ue=2;Ue<=xe;Ue++)f.addNextSegment(Q[Ue],!0)}f.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(s){return s===0||s<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(s){return new Fr(this._precisionModel,this._bufParams,s)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var s=arguments[0],u=arguments[1];this._precisionModel=s,this._bufParams=u}},{key:"copyCoordinates",value:function(s){for(var u=new Array(s.length).fill(null),f=0;f<u.length;f++)u[f]=new qe(s[f]);return u}}]),S}(),sl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var s=arguments[0],u=new xt,f=this._subgraphs.iterator();f.hasNext();){var v=f.next(),C=v.getEnvelope();s.y<C.getMinY()||s.y>C.getMaxY()||this.findStabbedSegments(s,v.getDirectedEdges(),u)}return u}if(arguments.length===3){if(St(arguments[2],dt)&&arguments[0]instanceof qe&&arguments[1]instanceof nl)for(var B=arguments[0],j=arguments[1],Q=arguments[2],xe=j.getEdge().getCoordinates(),Ue=0;Ue<xe.length-1;Ue++){this._seg.p0=xe[Ue],this._seg.p1=xe[Ue+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var je=Math.max(this._seg.p0.x,this._seg.p1.x);if(!(je<B.x)&&!(this._seg.isHorizontal()||B.y<this._seg.p0.y||B.y>this._seg.p1.y||Rt.index(this._seg.p0,this._seg.p1,B)===Rt.RIGHT)){var Et=j.getDepth(ut.LEFT);this._seg.p0.equals(xe[Ue])||(Et=j.getDepth(ut.RIGHT));var Zt=new al(this._seg,Et);Q.add(Zt)}}else if(St(arguments[2],dt)&&arguments[0]instanceof qe&&St(arguments[1],dt))for(var Nt=arguments[0],Rn=arguments[1],Nn=arguments[2],fn=Rn.iterator();fn.hasNext();){var Ii=fn.next();Ii.isForward()&&this.findStabbedSegments(Nt,Ii,Nn)}}}},{key:"getDepth",value:function(s){var u=this.findStabbedSegments(s);return u.size()===0?0:lo.min(u)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Cr;var s=arguments[0];this._subgraphs=s}}]),S}(),al=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"compareTo",value:function(s){var u=s;if(this._upwardSeg.minX()>=u._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=u._upwardSeg.minX())return-1;var f=this._upwardSeg.orientationIndex(u._upwardSeg);return f!==0||(f=-1*u._upwardSeg.orientationIndex(this._upwardSeg))!==0?f:this._upwardSeg.compareTo(u._upwardSeg)}},{key:"compareX",value:function(s,u){var f=s.p0.compareTo(u.p0);return f!==0?f:s.p1.compareTo(u.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var s=arguments[0],u=arguments[1];this._upwardSeg=new Cr(s),this._leftDepth=u}}]),S}();sl.DepthSegment=al;var ol=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,null,[{key:"constructor_",value:function(){ye.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),u}(ye),co=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getY",value:function(){var s=this.y/this.w;if(Tt.isNaN(s)||Tt.isInfinite(s))throw new ol;return s}},{key:"getX",value:function(){var s=this.x/this.w;if(Tt.isNaN(s)||Tt.isInfinite(s))throw new ol;return s}},{key:"getCoordinate",value:function(){var s=new qe;return s.x=this.getX(),s.y=this.getY(),s}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var u=arguments[0],f=arguments[1];this.x=u,this.y=f,this.w=1}else if(arguments[0]instanceof S&&arguments[1]instanceof S){var v=arguments[0],C=arguments[1];this.x=v.y*C.w-C.y*v.w,this.y=C.x*v.w-v.x*C.w,this.w=v.x*C.y-C.x*v.y}else if(arguments[0]instanceof qe&&arguments[1]instanceof qe){var B=arguments[0],j=arguments[1];this.x=B.y-j.y,this.y=j.x-B.x,this.w=B.x*j.y-j.x*B.y}}else if(arguments.length===3){var Q=arguments[0],xe=arguments[1],Ue=arguments[2];this.x=Q,this.y=xe,this.w=Ue}else if(arguments.length===4){var je=arguments[0],Et=arguments[1],Zt=arguments[2],Nt=arguments[3],Rn=je.y-Et.y,Nn=Et.x-je.x,fn=je.x*Et.y-Et.x*je.y,Ii=Zt.y-Nt.y,Bi=Nt.x-Zt.x,vr=Zt.x*Nt.y-Nt.x*Zt.y;this.x=Nn*vr-Bi*fn,this.y=Ii*fn-Rn*vr,this.w=Rn*Bi-Ii*Nn}}}]),S}(),Wi=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"area",value:function(){return S.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return S.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(s){if(s===null)throw new Le("Supplied point is null.");return S.interpolateZ(s,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return S.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return S.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return S.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return S.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return S.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return S.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var s=arguments[0],u=arguments[1],f=arguments[2];this.p0=s,this.p1=u,this.p2=f}},{key:"area",value:function(s,u,f){return Math.abs(((f.x-s.x)*(u.y-s.y)-(u.x-s.x)*(f.y-s.y))/2)}},{key:"signedArea",value:function(s,u,f){return((f.x-s.x)*(u.y-s.y)-(u.x-s.x)*(f.y-s.y))/2}},{key:"det",value:function(s,u,f,v){return s*v-u*f}},{key:"interpolateZ",value:function(s,u,f,v){var C=u.x,B=u.y,j=f.x-C,Q=v.x-C,xe=f.y-B,Ue=v.y-B,je=j*Ue-Q*xe,Et=s.x-C,Zt=s.y-B,Nt=(Ue*Et-Q*Zt)/je,Rn=(-xe*Et+j*Zt)/je;return u.getZ()+Nt*(f.getZ()-u.getZ())+Rn*(v.getZ()-u.getZ())}},{key:"longestSideLength",value:function(s,u,f){var v=s.distance(u),C=u.distance(f),B=f.distance(s),j=v;return C>j&&(j=C),B>j&&(j=B),j}},{key:"circumcentreDD",value:function(s,u,f){var v=$e.valueOf(s.x).subtract(f.x),C=$e.valueOf(s.y).subtract(f.y),B=$e.valueOf(u.x).subtract(f.x),j=$e.valueOf(u.y).subtract(f.y),Q=$e.determinant(v,C,B,j).multiply(2),xe=v.sqr().add(C.sqr()),Ue=B.sqr().add(j.sqr()),je=$e.determinant(C,xe,j,Ue),Et=$e.determinant(v,xe,B,Ue),Zt=$e.valueOf(f.x).subtract(je.divide(Q)).doubleValue(),Nt=$e.valueOf(f.y).add(Et.divide(Q)).doubleValue();return new qe(Zt,Nt)}},{key:"isAcute",value:function(s,u,f){return!!Rr.isAcute(s,u,f)&&!!Rr.isAcute(u,f,s)&&!!Rr.isAcute(f,s,u)}},{key:"circumcentre",value:function(s,u,f){var v=f.x,C=f.y,B=s.x-v,j=s.y-C,Q=u.x-v,xe=u.y-C,Ue=2*S.det(B,j,Q,xe),je=S.det(j,B*B+j*j,xe,Q*Q+xe*xe),Et=S.det(B,B*B+j*j,Q,Q*Q+xe*xe);return new qe(v-je/Ue,C+Et/Ue)}},{key:"perpendicularBisector",value:function(s,u){var f=u.x-s.x,v=u.y-s.y,C=new co(s.x+f/2,s.y+v/2,1),B=new co(s.x-v+f/2,s.y+f+v/2,1);return new co(C,B)}},{key:"angleBisector",value:function(s,u,f){var v=u.distance(s),C=v/(v+u.distance(f)),B=f.x-s.x,j=f.y-s.y;return new qe(s.x+C*B,s.y+C*j)}},{key:"area3D",value:function(s,u,f){var v=u.x-s.x,C=u.y-s.y,B=u.getZ()-s.getZ(),j=f.x-s.x,Q=f.y-s.y,xe=f.getZ()-s.getZ(),Ue=C*xe-B*Q,je=B*j-v*xe,Et=v*Q-C*j,Zt=Ue*Ue+je*je+Et*Et,Nt=Math.sqrt(Zt)/2;return Nt}},{key:"centroid",value:function(s,u,f){var v=(s.x+u.x+f.x)/3,C=(s.y+u.y+f.y)/3;return new qe(v,C)}},{key:"inCentre",value:function(s,u,f){var v=u.distance(f),C=s.distance(f),B=s.distance(u),j=v+C+B,Q=(v*s.x+C*u.x+B*f.x)/j,xe=(v*s.y+C*u.y+B*f.y)/j;return new qe(Q,xe)}}]),S}(),Vu=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"addRingSide",value:function(s,u,f,v,C){if(u===0&&s.length<Li.MINIMUM_VALID_SIZE)return null;var B=v,j=C;s.length>=Li.MINIMUM_VALID_SIZE&&Rt.isCCW(s)&&(B=C,j=v,f=ut.opposite(f));var Q=this._curveBuilder.getRingCurve(s,f,u);this.addCurve(Q,B,j)}},{key:"addRingBothSides",value:function(s,u){this.addRingSide(s,u,ut.LEFT,ne.EXTERIOR,ne.INTERIOR),this.addRingSide(s,u,ut.RIGHT,ne.INTERIOR,ne.EXTERIOR)}},{key:"addPoint",value:function(s){if(this._distance<=0)return null;var u=s.getCoordinates(),f=this._curveBuilder.getLineCurve(u,this._distance);this.addCurve(f,ne.EXTERIOR,ne.INTERIOR)}},{key:"addPolygon",value:function(s){var u=this._distance,f=ut.LEFT;this._distance<0&&(u=-this._distance,f=ut.RIGHT);var v=s.getExteriorRing(),C=Dt.removeRepeatedPoints(v.getCoordinates());if(this._distance<0&&this.isErodedCompletely(v,this._distance)||this._distance<=0&&C.length<3)return null;this.addRingSide(C,u,f,ne.EXTERIOR,ne.INTERIOR);for(var B=0;B<s.getNumInteriorRing();B++){var j=s.getInteriorRingN(B),Q=Dt.removeRepeatedPoints(j.getCoordinates());this._distance>0&&this.isErodedCompletely(j,-this._distance)||this.addRingSide(Q,u,ut.opposite(f),ne.INTERIOR,ne.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(s,u){var f=new Wi(s[0],s[1],s[2]),v=f.inCentre();return It.pointToSegment(v,f.p0,f.p1)<Math.abs(u)}},{key:"addLineString",value:function(s){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var u=Dt.removeRepeatedPoints(s.getCoordinates());if(Dt.isRing(u)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(u,this._distance);else{var f=this._curveBuilder.getLineCurve(u,this._distance);this.addCurve(f,ne.EXTERIOR,ne.INTERIOR)}}},{key:"addCurve",value:function(s,u,f){if(s===null||s.length<2)return null;var v=new qs(s,new sr(0,ne.BOUNDARY,u,f));this._curveList.add(v)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(s){if(s.isEmpty())return null;if(s instanceof yn)this.addPolygon(s);else if(s instanceof et)this.addLineString(s);else if(s instanceof _t)this.addPoint(s);else if(s instanceof Mi)this.addCollection(s);else if(s instanceof pi)this.addCollection(s);else if(s instanceof En)this.addCollection(s);else{if(!(s instanceof kn))throw new Kn(s.getGeometryType());this.addCollection(s)}}},{key:"isErodedCompletely",value:function(s,u){var f=s.getCoordinates();if(f.length<4)return u<0;if(f.length===4)return this.isTriangleErodedCompletely(f,u);var v=s.getEnvelopeInternal(),C=Math.min(v.getHeight(),v.getWidth());return u<0&&2*Math.abs(u)>C}},{key:"addCollection",value:function(s){for(var u=0;u<s.getNumGeometries();u++){var f=s.getGeometryN(u);this.add(f)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new xt;var s=arguments[0],u=arguments[1],f=arguments[2];this._inputGeom=s,this._distance=u,this._curveBuilder=f}}]),S}(),ai=function(){function S(){t(this,S)}return d(S,[{key:"locate",value:function(s){}}]),S}(),ll=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,S.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Gn;var s=this._parent.getGeometryN(this._index++);return s instanceof kn?(this._subcollectionIterator=new S(s),this._subcollectionIterator.next()):s}},{key:"remove",value:function(){throw new Kn(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[Ec]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var s=arguments[0];this._parent=s,this._atStart=!0,this._index=0,this._max=s.getNumGeometries()}},{key:"isAtomic",value:function(s){return!(s instanceof kn)}}]),S}(),tr=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"locate",value:function(s){return S.locate(s,this._geom)}},{key:"interfaces_",get:function(){return[ai]}}],[{key:"constructor_",value:function(){this._geom=null;var s=arguments[0];this._geom=s}},{key:"locatePointInPolygon",value:function(s,u){if(u.isEmpty())return ne.EXTERIOR;var f=u.getExteriorRing(),v=S.locatePointInRing(s,f);if(v!==ne.INTERIOR)return v;for(var C=0;C<u.getNumInteriorRing();C++){var B=u.getInteriorRingN(C),j=S.locatePointInRing(s,B);if(j===ne.BOUNDARY)return ne.BOUNDARY;if(j===ne.INTERIOR)return ne.EXTERIOR}return ne.INTERIOR}},{key:"locatePointInRing",value:function(s,u){return u.getEnvelopeInternal().intersects(s)?oa.locateInRing(s,u.getCoordinates()):ne.EXTERIOR}},{key:"containsPointInPolygon",value:function(s,u){return ne.EXTERIOR!==S.locatePointInPolygon(s,u)}},{key:"locateInGeometry",value:function(s,u){if(u instanceof yn)return S.locatePointInPolygon(s,u);if(u instanceof kn)for(var f=new ll(u);f.hasNext();){var v=f.next();if(v!==u){var C=S.locateInGeometry(s,v);if(C!==ne.EXTERIOR)return C}}return ne.EXTERIOR}},{key:"isContained",value:function(s,u){return ne.EXTERIOR!==S.locate(s,u)}},{key:"locate",value:function(s,u){return u.isEmpty()?ne.EXTERIOR:u.getEnvelopeInternal().intersects(s)?S.locateInGeometry(s,u):ne.EXTERIOR}}]),S}(),$i=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getNextCW",value:function(s){this.getEdges();var u=this._edgeList.indexOf(s),f=u-1;return u===0&&(f=this._edgeList.size()-1),this._edgeList.get(f)}},{key:"propagateSideLabels",value:function(s){for(var u=ne.NONE,f=this.iterator();f.hasNext();){var v=f.next().getLabel();v.isArea(s)&&v.getLocation(s,ut.LEFT)!==ne.NONE&&(u=v.getLocation(s,ut.LEFT))}if(u===ne.NONE)return null;for(var C=u,B=this.iterator();B.hasNext();){var j=B.next(),Q=j.getLabel();if(Q.getLocation(s,ut.ON)===ne.NONE&&Q.setLocation(s,ut.ON,C),Q.isArea(s)){var xe=Q.getLocation(s,ut.LEFT),Ue=Q.getLocation(s,ut.RIGHT);if(Ue!==ne.NONE){if(Ue!==C)throw new bt("side location conflict",j.getCoordinate());xe===ne.NONE&&ht.shouldNeverReachHere("found single null side (at "+j.getCoordinate()+")"),C=xe}else ht.isTrue(Q.getLocation(s,ut.LEFT)===ne.NONE,"found single null side"),Q.setLocation(s,ut.RIGHT,C),Q.setLocation(s,ut.LEFT,C)}}}},{key:"getCoordinate",value:function(){var s=this.iterator();return s.hasNext()?s.next().getCoordinate():null}},{key:"print",value:function(s){Ht.out.println("EdgeEndStar:   "+this.getCoordinate());for(var u=this.iterator();u.hasNext();)u.next().print(s)}},{key:"isAreaLabelsConsistent",value:function(s){return this.computeEdgeEndLabels(s.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(s){var u=this.getEdges();if(u.size()<=0)return!0;var f=u.size()-1,v=u.get(f).getLabel().getLocation(s,ut.LEFT);ht.isTrue(v!==ne.NONE,"Found unlabelled area edge");for(var C=v,B=this.iterator();B.hasNext();){var j=B.next().getLabel();ht.isTrue(j.isArea(s),"Found non-area edge");var Q=j.getLocation(s,ut.LEFT),xe=j.getLocation(s,ut.RIGHT);if(Q===xe||xe!==C)return!1;C=Q}return!0}},{key:"findIndex",value:function(s){this.iterator();for(var u=0;u<this._edgeList.size();u++)if(this._edgeList.get(u)===s)return u;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new xt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(s,u,f){return this._ptInAreaLocation[s]===ne.NONE&&(this._ptInAreaLocation[s]=tr.locate(u,f[s].getGeometry())),this._ptInAreaLocation[s]}},{key:"toString",value:function(){var s=new Lt;s.append("EdgeEndStar:   "+this.getCoordinate()),s.append(`
`);for(var u=this.iterator();u.hasNext();){var f=u.next();s.append(f),s.append(`
`)}return s.toString()}},{key:"computeEdgeEndLabels",value:function(s){for(var u=this.iterator();u.hasNext();)u.next().computeLabel(s)}},{key:"computeLabelling",value:function(s){this.computeEdgeEndLabels(s[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var u=[!1,!1],f=this.iterator();f.hasNext();)for(var v=f.next().getLabel(),C=0;C<2;C++)v.isLine(C)&&v.getLocation(C)===ne.BOUNDARY&&(u[C]=!0);for(var B=this.iterator();B.hasNext();)for(var j=B.next(),Q=j.getLabel(),xe=0;xe<2;xe++)if(Q.isAnyNull(xe)){var Ue=ne.NONE;if(u[xe])Ue=ne.EXTERIOR;else{var je=j.getCoordinate();Ue=this.getLocation(xe,je,s)}Q.setAllLocationsIfNull(xe,Ue)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(s,u){this._edgeMap.put(s,u),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new zi,this._edgeList=null,this._ptInAreaLocation=[ne.NONE,ne.NONE]}}]),S}(),$r=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var f=null,v=null,C=this._SCANNING_FOR_INCOMING,B=0;B<this._resultAreaEdgeList.size();B++){var j=this._resultAreaEdgeList.get(B),Q=j.getSym();if(j.getLabel().isArea())switch(f===null&&j.isInResult()&&(f=j),C){case this._SCANNING_FOR_INCOMING:if(!Q.isInResult())continue;v=Q,C=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!j.isInResult())continue;v.setNext(j),C=this._SCANNING_FOR_INCOMING}}if(C===this._LINKING_TO_OUTGOING){if(f===null)throw new bt("no outgoing dirEdge found",this.getCoordinate());ht.isTrue(f.isInResult(),"unable to link last incoming dirEdge"),v.setNext(f)}}},{key:"insert",value:function(f){var v=f;this.insertEdgeEnd(v,v)}},{key:"getRightmostEdge",value:function(){var f=this.getEdges(),v=f.size();if(v<1)return null;var C=f.get(0);if(v===1)return C;var B=f.get(v-1),j=C.getQuadrant(),Q=B.getQuadrant();return Wr.isNorthern(j)&&Wr.isNorthern(Q)?C:Wr.isNorthern(j)||Wr.isNorthern(Q)?C.getDy()!==0?C:B.getDy()!==0?B:(ht.shouldNeverReachHere("found two horizontal edges incident on node"),null):B}},{key:"print",value:function(f){Ht.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var v=this.iterator();v.hasNext();){var C=v.next();f.print("out "),C.print(f),f.println(),f.print("in "),C.getSym().print(f),f.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new xt;for(var f=this.iterator();f.hasNext();){var v=f.next();(v.isInResult()||v.getSym().isInResult())&&this._resultAreaEdgeList.add(v)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(f){for(var v=this.iterator();v.hasNext();){var C=v.next().getLabel();C.setAllLocationsIfNull(0,f.getLocation(0)),C.setAllLocationsIfNull(1,f.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var f=null,v=null,C=this._edgeList.size()-1;C>=0;C--){var B=this._edgeList.get(C),j=B.getSym();v===null&&(v=j),f!==null&&j.setNext(f),f=B}v.setNext(f)}},{key:"computeDepths",value:function(){if(arguments.length===1){var f=arguments[0],v=this.findIndex(f),C=f.getDepth(ut.LEFT),B=f.getDepth(ut.RIGHT),j=this.computeDepths(v+1,this._edgeList.size(),C),Q=this.computeDepths(0,v,j);if(Q!==B)throw new bt("depth mismatch at "+f.getCoordinate())}else if(arguments.length===3){for(var xe=arguments[0],Ue=arguments[1],je=arguments[2],Et=je,Zt=xe;Zt<Ue;Zt++){var Nt=this._edgeList.get(Zt);Nt.setEdgeDepths(ut.RIGHT,Et),Et=Nt.getDepth(ut.LEFT)}return Et}}},{key:"mergeSymLabels",value:function(){for(var f=this.iterator();f.hasNext();){var v=f.next();v.getLabel().merge(v.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(f){for(var v=null,C=null,B=this._SCANNING_FOR_INCOMING,j=this._resultAreaEdgeList.size()-1;j>=0;j--){var Q=this._resultAreaEdgeList.get(j),xe=Q.getSym();switch(v===null&&Q.getEdgeRing()===f&&(v=Q),B){case this._SCANNING_FOR_INCOMING:if(xe.getEdgeRing()!==f)continue;C=xe,B=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(Q.getEdgeRing()!==f)continue;C.setNextMin(Q),B=this._SCANNING_FOR_INCOMING}}B===this._LINKING_TO_OUTGOING&&(ht.isTrue(v!==null,"found null for first outgoing dirEdge"),ht.isTrue(v.getEdgeRing()===f,"unable to link last incoming dirEdge"),C.setNextMin(v))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var f=0,v=this.iterator();v.hasNext();){var C=v.next();C.isInResult()&&f++}return f}if(arguments.length===1){for(var B=arguments[0],j=0,Q=this.iterator();Q.hasNext();){var xe=Q.next();xe.getEdgeRing()===B&&j++}return j}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var f=ne.NONE,v=this.iterator();v.hasNext();){var C=v.next(),B=C.getSym();if(!C.isLineEdge()){if(C.isInResult()){f=ne.INTERIOR;break}if(B.isInResult()){f=ne.EXTERIOR;break}}}if(f===ne.NONE)return null;for(var j=f,Q=this.iterator();Q.hasNext();){var xe=Q.next(),Ue=xe.getSym();xe.isLineEdge()?xe.getEdge().setCovered(j===ne.INTERIOR):(xe.isInResult()&&(j=ne.EXTERIOR),Ue.isInResult()&&(j=ne.INTERIOR))}}},{key:"computeLabelling",value:function(f){Z(_(u.prototype),"computeLabelling",this).call(this,f),this._label=new sr(ne.NONE);for(var v=this.iterator();v.hasNext();)for(var C=v.next().getEdge().getLabel(),B=0;B<2;B++){var j=C.getLocation(B);j!==ne.INTERIOR&&j!==ne.BOUNDARY||this._label.setLocation(B,ne.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),u}($i),Gl=function(S){g(u,S);var s=G(u);function u(){return t(this,u),s.call(this)}return d(u,[{key:"createNode",value:function(f){return new el(f,new $r)}}]),u}(Fl),Va=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"compareTo",value:function(s){var u=s;return S.compareOriented(this._pts,this._orientation,u._pts,u._orientation)}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=S.orientation(s)}},{key:"orientation",value:function(s){return Dt.increasingDirection(s)===1}},{key:"compareOriented",value:function(s,u,f,v){for(var C=u?1:-1,B=v?1:-1,j=u?s.length:-1,Q=v?f.length:-1,xe=u?0:s.length-1,Ue=v?0:f.length-1;;){var je=s[xe].compareTo(f[Ue]);if(je!==0)return je;var Et=(xe+=C)===j,Zt=(Ue+=B)===Q;if(Et&&!Zt)return-1;if(!Et&&Zt)return 1;if(Et&&Zt)return 0}}}]),S}(),ul=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"print",value:function(s){s.print("MULTILINESTRING ( ");for(var u=0;u<this._edges.size();u++){var f=this._edges.get(u);u>0&&s.print(","),s.print("(");for(var v=f.getCoordinates(),C=0;C<v.length;C++)C>0&&s.print(","),s.print(v[C].x+" "+v[C].y);s.println(")")}s.print(")  ")}},{key:"addAll",value:function(s){for(var u=s.iterator();u.hasNext();)this.add(u.next())}},{key:"findEdgeIndex",value:function(s){for(var u=0;u<this._edges.size();u++)if(this._edges.get(u).equals(s))return u;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(s){return this._edges.get(s)}},{key:"findEqualEdge",value:function(s){var u=new Va(s.getCoordinates());return this._ocaMap.get(u)}},{key:"add",value:function(s){this._edges.add(s);var u=new Va(s.getCoordinates());this._ocaMap.put(u,s)}}],[{key:"constructor_",value:function(){this._edges=new xt,this._ocaMap=new zi}}]),S}(),Po=function(){function S(){t(this,S)}return d(S,[{key:"processIntersections",value:function(s,u,f,v){}},{key:"isDone",value:function(){}}]),S}(),Hl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"isTrivialIntersection",value:function(s,u,f,v){if(s===f&&this._li.getIntersectionNum()===1){if(S.isAdjacentSegments(u,v))return!0;if(s.isClosed()){var C=s.size()-1;if(u===0&&v===C||v===0&&u===C)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(s,u,f,v){if(s===f&&u===v)return null;this.numTests++;var C=s.getCoordinates()[u],B=s.getCoordinates()[u+1],j=f.getCoordinates()[v],Q=f.getCoordinates()[v+1];this._li.computeIntersection(C,B,j,Q),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(s,u,f,v)||(this._hasIntersection=!0,s.addIntersections(this._li,u,0),f.addIntersections(this._li,v,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Po]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var s=arguments[0];this._li=s}},{key:"isAdjacentSegments",value:function(s,u){return Math.abs(s-u)===1}}]),S}(),Gu=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(s){s.print(this.coord),s.print(" seg # = "+this.segmentIndex),s.println(" dist = "+this.dist)}},{key:"compareTo",value:function(s){var u=s;return this.compare(u.segmentIndex,u.dist)}},{key:"isEndPoint",value:function(s){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===s}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(s,u){return this.segmentIndex<s?-1:this.segmentIndex>s?1:this.dist<u?-1:this.dist>u?1:0}},{key:"interfaces_",get:function(){return[Te]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var s=arguments[0],u=arguments[1],f=arguments[2];this.coord=new qe(s),this.segmentIndex=u,this.dist=f}}]),S}(),Ga=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"print",value:function(s){s.println("Intersections:");for(var u=this.iterator();u.hasNext();)u.next().print(s)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(s){this.addEndpoints();for(var u=this.iterator(),f=u.next();u.hasNext();){var v=u.next(),C=this.createSplitEdge(f,v);s.add(C),f=v}}},{key:"addEndpoints",value:function(){var s=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[s],s,0)}},{key:"createSplitEdge",value:function(s,u){var f=u.segmentIndex-s.segmentIndex+2,v=this.edge.pts[u.segmentIndex],C=u.dist>0||!u.coord.equals2D(v);C||f--;var B=new Array(f).fill(null),j=0;B[j++]=new qe(s.coord);for(var Q=s.segmentIndex+1;Q<=u.segmentIndex;Q++)B[j++]=this.edge.pts[Q];return C&&(B[j]=u.coord),new ua(B,new sr(this.edge._label))}},{key:"add",value:function(s,u,f){var v=new Gu(s,u,f),C=this._nodeMap.get(v);return C!==null?C:(this._nodeMap.put(v,v),v)}},{key:"isIntersection",value:function(s){for(var u=this.iterator();u.hasNext();)if(u.next().coord.equals(s))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new zi,this.edge=null;var s=arguments[0];this.edge=s}}]),S}(),ho=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])||S.isTrue(this._matrix[ne.INTERIOR][ne.BOUNDARY])||S.isTrue(this._matrix[ne.BOUNDARY][ne.INTERIOR])||S.isTrue(this._matrix[ne.BOUNDARY][ne.BOUNDARY]))&&this._matrix[ne.EXTERIOR][ne.INTERIOR]===ce.FALSE&&this._matrix[ne.EXTERIOR][ne.BOUNDARY]===ce.FALSE}},{key:"isCoveredBy",value:function(){return(S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])||S.isTrue(this._matrix[ne.INTERIOR][ne.BOUNDARY])||S.isTrue(this._matrix[ne.BOUNDARY][ne.INTERIOR])||S.isTrue(this._matrix[ne.BOUNDARY][ne.BOUNDARY]))&&this._matrix[ne.INTERIOR][ne.EXTERIOR]===ce.FALSE&&this._matrix[ne.BOUNDARY][ne.EXTERIOR]===ce.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var s=arguments[0],u=0;u<s.length;u++){var f=Math.trunc(u/3),v=u%3;this._matrix[f][v]=ce.toDimensionValue(s.charAt(u))}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];this._matrix[C][B]=j}}},{key:"isContains",value:function(){return S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&this._matrix[ne.EXTERIOR][ne.INTERIOR]===ce.FALSE&&this._matrix[ne.EXTERIOR][ne.BOUNDARY]===ce.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var s=arguments[0],u=0;u<s.length;u++){var f=Math.trunc(u/3),v=u%3;this.setAtLeast(f,v,ce.toDimensionValue(s.charAt(u)))}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];this._matrix[C][B]<j&&(this._matrix[C][B]=j)}}},{key:"setAtLeastIfValid",value:function(s,u,f){s>=0&&u>=0&&this.setAtLeast(s,u,f)}},{key:"isWithin",value:function(){return S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&this._matrix[ne.INTERIOR][ne.EXTERIOR]===ce.FALSE&&this._matrix[ne.BOUNDARY][ne.EXTERIOR]===ce.FALSE}},{key:"isTouches",value:function(s,u){return s>u?this.isTouches(u,s):(s===ce.A&&u===ce.A||s===ce.L&&u===ce.L||s===ce.L&&u===ce.A||s===ce.P&&u===ce.A||s===ce.P&&u===ce.L)&&this._matrix[ne.INTERIOR][ne.INTERIOR]===ce.FALSE&&(S.isTrue(this._matrix[ne.INTERIOR][ne.BOUNDARY])||S.isTrue(this._matrix[ne.BOUNDARY][ne.INTERIOR])||S.isTrue(this._matrix[ne.BOUNDARY][ne.BOUNDARY]))}},{key:"isOverlaps",value:function(s,u){return s===ce.P&&u===ce.P||s===ce.A&&u===ce.A?S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&S.isTrue(this._matrix[ne.INTERIOR][ne.EXTERIOR])&&S.isTrue(this._matrix[ne.EXTERIOR][ne.INTERIOR]):s===ce.L&&u===ce.L&&this._matrix[ne.INTERIOR][ne.INTERIOR]===1&&S.isTrue(this._matrix[ne.INTERIOR][ne.EXTERIOR])&&S.isTrue(this._matrix[ne.EXTERIOR][ne.INTERIOR])}},{key:"isEquals",value:function(s,u){return s===u&&S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&this._matrix[ne.INTERIOR][ne.EXTERIOR]===ce.FALSE&&this._matrix[ne.BOUNDARY][ne.EXTERIOR]===ce.FALSE&&this._matrix[ne.EXTERIOR][ne.INTERIOR]===ce.FALSE&&this._matrix[ne.EXTERIOR][ne.BOUNDARY]===ce.FALSE}},{key:"toString",value:function(){for(var s=new qt("123456789"),u=0;u<3;u++)for(var f=0;f<3;f++)s.setCharAt(3*u+f,ce.toDimensionSymbol(this._matrix[u][f]));return s.toString()}},{key:"setAll",value:function(s){for(var u=0;u<3;u++)for(var f=0;f<3;f++)this._matrix[u][f]=s}},{key:"get",value:function(s,u){return this._matrix[s][u]}},{key:"transpose",value:function(){var s=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=s,s=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=s,s=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=s,this}},{key:"matches",value:function(s){if(s.length!==9)throw new Le("Should be length 9: "+s);for(var u=0;u<3;u++)for(var f=0;f<3;f++)if(!S.matches(this._matrix[u][f],s.charAt(3*u+f)))return!1;return!0}},{key:"add",value:function(s){for(var u=0;u<3;u++)for(var f=0;f<3;f++)this.setAtLeast(u,f,s.get(u,f))}},{key:"isDisjoint",value:function(){return this._matrix[ne.INTERIOR][ne.INTERIOR]===ce.FALSE&&this._matrix[ne.INTERIOR][ne.BOUNDARY]===ce.FALSE&&this._matrix[ne.BOUNDARY][ne.INTERIOR]===ce.FALSE&&this._matrix[ne.BOUNDARY][ne.BOUNDARY]===ce.FALSE}},{key:"isCrosses",value:function(s,u){return s===ce.P&&u===ce.L||s===ce.P&&u===ce.A||s===ce.L&&u===ce.A?S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&S.isTrue(this._matrix[ne.INTERIOR][ne.EXTERIOR]):s===ce.L&&u===ce.P||s===ce.A&&u===ce.P||s===ce.A&&u===ce.L?S.isTrue(this._matrix[ne.INTERIOR][ne.INTERIOR])&&S.isTrue(this._matrix[ne.EXTERIOR][ne.INTERIOR]):s===ce.L&&u===ce.L&&this._matrix[ne.INTERIOR][ne.INTERIOR]===0}},{key:"interfaces_",get:function(){return[We]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(ce.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var s=arguments[0];S.constructor_.call(this),this.set(s)}else if(arguments[0]instanceof S){var u=arguments[0];S.constructor_.call(this),this._matrix[ne.INTERIOR][ne.INTERIOR]=u._matrix[ne.INTERIOR][ne.INTERIOR],this._matrix[ne.INTERIOR][ne.BOUNDARY]=u._matrix[ne.INTERIOR][ne.BOUNDARY],this._matrix[ne.INTERIOR][ne.EXTERIOR]=u._matrix[ne.INTERIOR][ne.EXTERIOR],this._matrix[ne.BOUNDARY][ne.INTERIOR]=u._matrix[ne.BOUNDARY][ne.INTERIOR],this._matrix[ne.BOUNDARY][ne.BOUNDARY]=u._matrix[ne.BOUNDARY][ne.BOUNDARY],this._matrix[ne.BOUNDARY][ne.EXTERIOR]=u._matrix[ne.BOUNDARY][ne.EXTERIOR],this._matrix[ne.EXTERIOR][ne.INTERIOR]=u._matrix[ne.EXTERIOR][ne.INTERIOR],this._matrix[ne.EXTERIOR][ne.BOUNDARY]=u._matrix[ne.EXTERIOR][ne.BOUNDARY],this._matrix[ne.EXTERIOR][ne.EXTERIOR]=u._matrix[ne.EXTERIOR][ne.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var s=arguments[0],u=arguments[1];return u===ce.SYM_DONTCARE||u===ce.SYM_TRUE&&(s>=0||s===ce.TRUE)||u===ce.SYM_FALSE&&s===ce.FALSE||u===ce.SYM_P&&s===ce.P||u===ce.SYM_L&&s===ce.L||u===ce.SYM_A&&s===ce.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var f=arguments[0],v=arguments[1],C=new S(f);return C.matches(v)}}},{key:"isTrue",value:function(s){return s>=0||s===ce.TRUE}}]),S}(),xs=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(s){return s===null||s.length===0?null:(this.ensureCapacity(this._size+s.length),Ht.arraycopy(s,0,this._data,this._size,s.length),void(this._size+=s.length))}},{key:"ensureCapacity",value:function(s){if(s<=this._data.length)return null;var u=Math.max(s,2*this._data.length);this._data=ct.copyOf(this._data,u)}},{key:"toArray",value:function(){var s=new Array(this._size).fill(null);return Ht.arraycopy(this._data,0,s,0,this._size),s}},{key:"add",value:function(s){this.ensureCapacity(this._size+1),this._data[this._size]=s,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)S.constructor_.call(this,10);else if(arguments.length===1){var s=arguments[0];this._data=new Array(s).fill(null)}}}]),S}(),Ha=function(){function S(){t(this,S)}return d(S,[{key:"getChainStartIndices",value:function(s){var u=0,f=new xs(Math.trunc(s.length/2));f.add(u);do{var v=this.findChainEnd(s,u);f.add(v),u=v}while(u<s.length-1);return f.toArray()}},{key:"findChainEnd",value:function(s,u){for(var f=Wr.quadrant(s[u],s[u+1]),v=u+1;v<s.length&&Wr.quadrant(s[v-1],s[v])===f;)v++;return v-1}},{key:"OLDgetChainStartIndices",value:function(s){var u=0,f=new xt;f.add(u);do{var v=this.findChainEnd(s,u);f.add(v),u=v}while(u<s.length-1);return S.toIntArray(f)}}],[{key:"toIntArray",value:function(s){for(var u=new Array(s.size()).fill(null),f=0;f<u.length;f++)u[f]=s.get(f).intValue();return u}}]),S}(),Wl=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(s){var u=this.pts[this.startIndex[s]].x,f=this.pts[this.startIndex[s+1]].x;return u>f?u:f}},{key:"getMinX",value:function(s){var u=this.pts[this.startIndex[s]].x,f=this.pts[this.startIndex[s+1]].x;return u<f?u:f}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var s=arguments[0],u=arguments[1],f=arguments[2],v=arguments[3];this.computeIntersectsForChain(this.startIndex[s],this.startIndex[s+1],u,u.startIndex[f],u.startIndex[f+1],v)}else if(arguments.length===6){var C=arguments[0],B=arguments[1],j=arguments[2],Q=arguments[3],xe=arguments[4],Ue=arguments[5];if(B-C==1&&xe-Q==1)return Ue.addIntersections(this.e,C,j.e,Q),null;if(!this.overlaps(C,B,j,Q,xe))return null;var je=Math.trunc((C+B)/2),Et=Math.trunc((Q+xe)/2);C<je&&(Q<Et&&this.computeIntersectsForChain(C,je,j,Q,Et,Ue),Et<xe&&this.computeIntersectsForChain(C,je,j,Et,xe,Ue)),je<B&&(Q<Et&&this.computeIntersectsForChain(je,B,j,Q,Et,Ue),Et<xe&&this.computeIntersectsForChain(je,B,j,Et,xe,Ue))}}},{key:"overlaps",value:function(s,u,f,v,C){return bn.intersects(this.pts[s],this.pts[u],f.pts[v],f.pts[C])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(s,u){for(var f=0;f<this.startIndex.length-1;f++)for(var v=0;v<s.startIndex.length-1;v++)this.computeIntersectsForChain(f,s,v,u)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var s=arguments[0];this.e=s,this.pts=s.getCoordinates();var u=new Ha;this.startIndex=u.getChainStartIndices(this.pts)}}]),S}(),ql=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"getDepth",value:function(s,u){return this._depth[s][u]}},{key:"setDepth",value:function(s,u,f){this._depth[s][u]=f}},{key:"isNull",value:function(){if(arguments.length===0){for(var s=0;s<2;s++)for(var u=0;u<3;u++)if(this._depth[s][u]!==S.NULL_VALUE)return!1;return!0}if(arguments.length===1){var f=arguments[0];return this._depth[f][1]===S.NULL_VALUE}if(arguments.length===2){var v=arguments[0],C=arguments[1];return this._depth[v][C]===S.NULL_VALUE}}},{key:"normalize",value:function(){for(var s=0;s<2;s++)if(!this.isNull(s)){var u=this._depth[s][1];this._depth[s][2]<u&&(u=this._depth[s][2]),u<0&&(u=0);for(var f=1;f<3;f++){var v=0;this._depth[s][f]>u&&(v=1),this._depth[s][f]=v}}}},{key:"getDelta",value:function(s){return this._depth[s][ut.RIGHT]-this._depth[s][ut.LEFT]}},{key:"getLocation",value:function(s,u){return this._depth[s][u]<=0?ne.EXTERIOR:ne.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var s=arguments[0],u=0;u<2;u++)for(var f=1;f<3;f++){var v=s.getLocation(u,f);v!==ne.EXTERIOR&&v!==ne.INTERIOR||(this.isNull(u,f)?this._depth[u][f]=S.depthAtLocation(v):this._depth[u][f]+=S.depthAtLocation(v))}else if(arguments.length===3){var C=arguments[0],B=arguments[1],j=arguments[2];j===ne.INTERIOR&&this._depth[C][B]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var s=0;s<2;s++)for(var u=0;u<3;u++)this._depth[s][u]=S.NULL_VALUE}},{key:"depthAtLocation",value:function(s){return s===ne.EXTERIOR?0:s===ne.INTERIOR?1:S.NULL_VALUE}}]),S}();ql.NULL_VALUE=-1;var ua=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var f=new Array(2).fill(null);return f[0]=this.pts[0],f[1]=this.pts[1],new u(f,sr.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(f){this._isIsolated=f}},{key:"setName",value:function(f){this._name=f}},{key:"equals",value:function(f){if(!(f instanceof u))return!1;var v=f;if(this.pts.length!==v.pts.length)return!1;for(var C=!0,B=!0,j=this.pts.length,Q=0;Q<this.pts.length;Q++)if(this.pts[Q].equals2D(v.pts[Q])||(C=!1),this.pts[Q].equals2D(v.pts[--j])||(B=!1),!C&&!B)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var f=arguments[0];return this.pts[f]}}},{key:"print",value:function(f){f.print("edge "+this._name+": "),f.print("LINESTRING (");for(var v=0;v<this.pts.length;v++)v>0&&f.print(","),f.print(this.pts[v].x+" "+this.pts[v].y);f.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(f){u.updateIM(this._label,f)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(f){f.print("edge "+this._name+": ");for(var v=this.pts.length-1;v>=0;v--)f.print(this.pts[v]+" ");f.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Wl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new bn;for(var f=0;f<this.pts.length;f++)this._env.expandToInclude(this.pts[f])}return this._env}},{key:"addIntersection",value:function(f,v,C,B){var j=new qe(f.getIntersection(B)),Q=v,xe=f.getEdgeDistance(C,B),Ue=Q+1;if(Ue<this.pts.length){var je=this.pts[Ue];j.equals2D(je)&&(Q=Ue,xe=0)}this.eiList.add(j,Q,xe)}},{key:"toString",value:function(){var f=new qt;f.append("edge "+this._name+": "),f.append("LINESTRING (");for(var v=0;v<this.pts.length;v++)v>0&&f.append(","),f.append(this.pts[v].x+" "+this.pts[v].y);return f.append(")  "+this._label+" "+this._depthDelta),f.toString()}},{key:"isPointwiseEqual",value:function(f){if(this.pts.length!==f.pts.length)return!1;for(var v=0;v<this.pts.length;v++)if(!this.pts[v].equals2D(f.pts[v]))return!1;return!0}},{key:"setDepthDelta",value:function(f){this._depthDelta=f}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(f,v,C){for(var B=0;B<f.getIntersectionNum();B++)this.addIntersection(f,v,C,B)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ga(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ql,this._depthDelta=0,arguments.length===1){var f=arguments[0];u.constructor_.call(this,f,null)}else if(arguments.length===2){var v=arguments[0],C=arguments[1];this.pts=v,this._label=C}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof ho&&arguments[0]instanceof sr))return Z(_(u),"updateIM",this).apply(this,arguments);var f=arguments[0],v=arguments[1];v.setAtLeastIfValid(f.getLocation(0,ut.ON),f.getLocation(1,ut.ON),1),f.isArea()&&(v.setAtLeastIfValid(f.getLocation(0,ut.LEFT),f.getLocation(1,ut.LEFT),2),v.setAtLeastIfValid(f.getLocation(0,ut.RIGHT),f.getLocation(1,ut.RIGHT),2))}}]),u}(Pu),Lo=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"setWorkingPrecisionModel",value:function(s){this._workingPrecisionModel=s}},{key:"insertUniqueEdge",value:function(s){var u=this._edgeList.findEqualEdge(s);if(u!==null){var f=u.getLabel(),v=s.getLabel();u.isPointwiseEqual(s)||(v=new sr(s.getLabel())).flip(),f.merge(v);var C=S.depthDelta(v),B=u.getDepthDelta()+C;u.setDepthDelta(B)}else this._edgeList.add(s),s.setDepthDelta(S.depthDelta(s.getLabel()))}},{key:"buildSubgraphs",value:function(s,u){for(var f=new xt,v=s.iterator();v.hasNext();){var C=v.next(),B=C.getRightmostCoordinate(),j=new sl(f).getDepth(B);C.computeDepth(j),C.findResultEdges(),f.add(C),u.add(C.getDirectedEdges(),C.getNodes())}}},{key:"createSubgraphs",value:function(s){for(var u=new xt,f=s.getNodes().iterator();f.hasNext();){var v=f.next();if(!v.isVisited()){var C=new fi;C.create(v),u.add(C)}}return lo.sort(u,lo.reverseOrder()),u}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(s){if(this._workingNoder!==null)return this._workingNoder;var u=new Ul,f=new Sa;return f.setPrecisionModel(s),u.setSegmentIntersector(new Hl(f)),u}},{key:"buffer",value:function(s,u){var f=this._workingPrecisionModel;f===null&&(f=s.getPrecisionModel()),this._geomFact=s.getFactory();var v=new rl(f,this._bufParams),C=new Vu(s,u,v).getCurves();if(C.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(C,f),this._graph=new Ws(new Gl),this._graph.addEdges(this._edgeList.getEdges());var B=this.createSubgraphs(this._graph),j=new Du(this._geomFact);this.buildSubgraphs(B,j);var Q=j.getPolygons();return Q.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(Q)}},{key:"computeNodedEdges",value:function(s,u){var f=this.getNoder(u);f.computeNodes(s);for(var v=f.getNodedSubstrings().iterator();v.hasNext();){var C=v.next(),B=C.getCoordinates();if(B.length!==2||!B[0].equals2D(B[1])){var j=C.getData(),Q=new ua(C.getCoordinates(),new sr(j));this.insertUniqueEdge(Q)}}}},{key:"setNoder",value:function(s){this._workingNoder=s}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ul;var s=arguments[0];this._bufParams=s}},{key:"depthDelta",value:function(s){var u=s.getLocation(0,ut.LEFT),f=s.getLocation(0,ut.RIGHT);return u===ne.INTERIOR&&f===ne.EXTERIOR?1:u===ne.EXTERIOR&&f===ne.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(s){for(var u=new Tn,f=new xt;s.hasNext();){var v=s.next(),C=u.createLineString(v.getCoordinates());f.add(C)}return u.buildGeometry(f)}}]),S}(),$s=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"rescale",value:function(){if(St(arguments[0],ui))for(var s=arguments[0],u=s.iterator();u.hasNext();){var f=u.next();this.rescale(f.getCoordinates())}else if(arguments[0]instanceof Array){for(var v=arguments[0],C=0;C<v.length;C++)v[C].x=v[C].x/this._scaleFactor+this._offsetX,v[C].y=v[C].y/this._scaleFactor+this._offsetY;v.length===2&&v[0].equals2D(v[1])&&Ht.out.println(v)}}},{key:"scale",value:function(){if(St(arguments[0],ui)){for(var s=arguments[0],u=new xt(s.size()),f=s.iterator();f.hasNext();){var v=f.next();u.add(new qs(this.scale(v.getCoordinates()),v.getData()))}return u}if(arguments[0]instanceof Array){for(var C=arguments[0],B=new Array(C.length).fill(null),j=0;j<C.length;j++)B[j]=new qe(Math.round((C[j].x-this._offsetX)*this._scaleFactor),Math.round((C[j].y-this._offsetY)*this._scaleFactor),C[j].getZ());var Q=Dt.removeRepeatedPoints(B);return Q}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var s=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(s),s}},{key:"computeNodes",value:function(s){var u=s;this._isScaled&&(u=this.scale(s)),this._noder.computeNodes(u)}},{key:"interfaces_",get:function(){return[Bu]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var s=arguments[0],u=arguments[1];S.constructor_.call(this,s,u,0,0)}else if(arguments.length===4){var f=arguments[0],v=arguments[1];this._noder=f,this._scaleFactor=v,this._isScaled=!this.isIntegerPrecision()}}}]),S}(),Ta=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var u=s.next(),f=u.getCoordinates();this.checkEndPtVertexIntersections(f[0],this._segStrings),this.checkEndPtVertexIntersections(f[f.length-1],this._segStrings)}else if(arguments.length===2){for(var v=arguments[0],C=arguments[1],B=C.iterator();B.hasNext();)for(var j=B.next(),Q=j.getCoordinates(),xe=1;xe<Q.length-1;xe++)if(Q[xe].equals(v))throw new Cn("found endpt/interior pt intersection at index "+xe+" :pt "+v)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();)for(var u=s.next(),f=this._segStrings.iterator();f.hasNext();){var v=f.next();this.checkInteriorIntersections(u,v)}else if(arguments.length===2)for(var C=arguments[0],B=arguments[1],j=C.getCoordinates(),Q=B.getCoordinates(),xe=0;xe<j.length-1;xe++)for(var Ue=0;Ue<Q.length-1;Ue++)this.checkInteriorIntersections(C,xe,B,Ue);else if(arguments.length===4){var je=arguments[0],Et=arguments[1],Zt=arguments[2],Nt=arguments[3];if(je===Zt&&Et===Nt)return null;var Rn=je.getCoordinates()[Et],Nn=je.getCoordinates()[Et+1],fn=Zt.getCoordinates()[Nt],Ii=Zt.getCoordinates()[Nt+1];if(this._li.computeIntersection(Rn,Nn,fn,Ii),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Rn,Nn)||this.hasInteriorIntersection(this._li,fn,Ii)))throw new Cn("found non-noded intersection at "+Rn+"-"+Nn+" and "+fn+"-"+Ii)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var u=s.next();this.checkCollapses(u)}else if(arguments.length===1)for(var f=arguments[0],v=f.getCoordinates(),C=0;C<v.length-2;C++)this.checkCollapse(v[C],v[C+1],v[C+2])}},{key:"hasInteriorIntersection",value:function(s,u,f){for(var v=0;v<s.getIntersectionNum();v++){var C=s.getIntersection(v);if(!C.equals(u)&&!C.equals(f))return!0}return!1}},{key:"checkCollapse",value:function(s,u,f){if(s.equals(f))throw new Cn("found non-noded collapse at "+S.fact.createLineString([s,u,f]))}}],[{key:"constructor_",value:function(){this._li=new Sa,this._segStrings=null;var s=arguments[0];this._segStrings=s}}]),S}();Ta.fact=new Tn;var ko=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"intersectsScaled",value:function(s,u){var f=Math.min(s.x,u.x),v=Math.max(s.x,u.x),C=Math.min(s.y,u.y),B=Math.max(s.y,u.y),j=this._maxx<f||this._minx>v||this._maxy<C||this._miny>B;if(j)return!1;var Q=this.intersectsToleranceSquare(s,u);return ht.isTrue(!(j&&Q),"Found bad envelope test"),Q}},{key:"initCorners",value:function(s){var u=.5;this._minx=s.x-u,this._maxx=s.x+u,this._miny=s.y-u,this._maxy=s.y+u,this._corner[0]=new qe(this._maxx,this._maxy),this._corner[1]=new qe(this._minx,this._maxy),this._corner[2]=new qe(this._minx,this._miny),this._corner[3]=new qe(this._maxx,this._miny)}},{key:"intersects",value:function(s,u){return this._scaleFactor===1?this.intersectsScaled(s,u):(this.copyScaled(s,this._p0Scaled),this.copyScaled(u,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(s){return Math.round(s*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(s,u){u.x=this.scale(s.x),u.y=this.scale(s.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var s=S.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new bn(this._originalPt.x-s,this._originalPt.x+s,this._originalPt.y-s,this._originalPt.y+s)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(s,u){return this._li.computeIntersection(s,u,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,u,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,u,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(s,u,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(s,u){var f=!1,v=!1;return this._li.computeIntersection(s,u,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(s,u,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(f=!0),this._li.computeIntersection(s,u,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(v=!0),this._li.computeIntersection(s,u,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!f||!v)||!!s.equals(this._pt)||!!u.equals(this._pt))))}},{key:"addSnappedNode",value:function(s,u){var f=s.getCoordinate(u),v=s.getCoordinate(u+1);return!!this.intersects(f,v)&&(s.addIntersection(this.getCoordinate(),u),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var s=arguments[0],u=arguments[1],f=arguments[2];if(this._originalPt=s,this._pt=s,this._scaleFactor=u,this._li=f,u<=0)throw new Le("Scale factor must be non-zero");u!==1&&(this._pt=new qe(this.scale(s.x),this.scale(s.y)),this._p0Scaled=new qe,this._p1Scaled=new qe),this.initCorners(this._pt)}}]),S}();ko.SAFE_ENV_EXPANSION_FACTOR=.75;var Ac=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var s=arguments[0],u=arguments[1];s.getLineSegment(u,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Cr}}]),S}(),fo=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"snap",value:function(){if(arguments.length===1){var s=arguments[0];return this.snap(s,null,-1)}if(arguments.length===3){var u=arguments[0],f=arguments[1],v=arguments[2],C=u.getSafeEnvelope(),B=new bs(u,f,v);return this._index.query(C,new(function(){function j(){t(this,j)}return d(j,[{key:"interfaces_",get:function(){return[zl]}},{key:"visitItem",value:function(Q){Q.select(C,B)}}]),j}())),B.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var s=arguments[0];this._index=s}}]),S}(),bs=function(S){g(u,S);var s=G(u);function u(){var f;return t(this,u),f=s.call(this),u.constructor_.apply(D(f),arguments),f}return d(u,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Ls))return Z(_(u.prototype),"select",this).apply(this,arguments);var f=arguments[0],v=arguments[1],C=f.getContext();if(this._parentEdge===C&&(v===this._hotPixelVertexIndex||v+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(C,v)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var f=arguments[0],v=arguments[1],C=arguments[2];this._hotPixel=f,this._parentEdge=v,this._hotPixelVertexIndex=C}}]),u}(Ac);fo.HotPixelSnapAction=bs;var ws=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"processIntersections",value:function(s,u,f,v){if(s===f&&u===v)return null;var C=s.getCoordinates()[u],B=s.getCoordinates()[u+1],j=f.getCoordinates()[v],Q=f.getCoordinates()[v+1];if(this._li.computeIntersection(C,B,j,Q),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var xe=0;xe<this._li.getIntersectionNum();xe++)this._interiorIntersections.add(this._li.getIntersection(xe));s.addIntersections(this._li,u,0),f.addIntersections(this._li,v,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Po]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var s=arguments[0];this._li=s,this._interiorIntersections=new xt}}]),S}(),po=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"checkCorrectness",value:function(s){var u=qs.getNodedSubstrings(s),f=new Ta(u);try{f.checkValid()}catch(v){if(!(v instanceof ye))throw v;v.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return qs.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(s,u){var f=this.findInteriorIntersections(s,u);this.computeIntersectionSnaps(f),this.computeVertexSnaps(s)}},{key:"findInteriorIntersections",value:function(s,u){var f=new ws(u);return this._noder.setSegmentIntersector(f),this._noder.computeNodes(s),f.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(St(arguments[0],ui))for(var s=arguments[0],u=s.iterator();u.hasNext();){var f=u.next();this.computeVertexSnaps(f)}else if(arguments[0]instanceof qs)for(var v=arguments[0],C=v.getCoordinates(),B=0;B<C.length;B++){var j=new ko(C[B],this._scaleFactor,this._li),Q=this._pointSnapper.snap(j,v,B);Q&&v.addIntersection(C[B],B)}}},{key:"computeNodes",value:function(s){this._nodedSegStrings=s,this._noder=new Ul,this._pointSnapper=new fo(this._noder.getIndex()),this.snapRound(s,this._li)}},{key:"computeIntersectionSnaps",value:function(s){for(var u=s.iterator();u.hasNext();){var f=u.next(),v=new ko(f,this._scaleFactor,this._li);this._pointSnapper.snap(v)}}},{key:"interfaces_",get:function(){return[Bu]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var s=arguments[0];this._pm=s,this._li=new Sa,this._li.setPrecisionModel(s),this._scaleFactor=s.getScale()}}]),S}(),ci=function(){function S(){t(this,S),S.constructor_.apply(this,arguments)}return d(S,[{key:"bufferFixedPrecision",value:function(s){var u=new $s(new po(new Yn(1)),s.getScale()),f=new Lo(this._bufParams);f.setWorkingPrecisionModel(s),f.setNoder(u),this._resultGeometry=f.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var s=S.MAX_PRECISION_DIGITS;s>=0;s--){try{this.bufferReducedPrecision(s)}catch(C){if(!(C instanceof bt))throw C;this._saveException=C}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var u=arguments[0],f=S.precisionScaleFactor(this._argGeom,this._distance,u),v=new Yn(f);this.bufferFixedPrecision(v)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var s=this._argGeom.getFactory().getPrecisionModel();s.getType()===Yn.FIXED?this.bufferFixedPrecision(s):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(s){this._bufParams.setQuadrantSegments(s)}},{key:"bufferOriginalPrecision",value:function(){try{var s=new Lo(this._bufParams);this._resultGeometry=s.buffer(this._argGeom,this._distance)}catch(u){if(!(u instanceof Cn))throw u;this._saveException=u}}},{key:"getResultGeometry",value:function(s){return this._distance=s,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(s){this._bufParams.setEndCapStyle(s)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new le,this._resultGeometry=null,this._saveException=null,arguments.length===1){var s=arguments[0];this._argGeom=s}else if(arguments.length===2){var u=arguments[0],f=arguments[1];this._argGeom=u,this._bufParams=f}}},{key:"bufferOp",value:function(){if(arguments.length===2){var s=arguments[0],u=arguments[1],f=new S(s),v=f.getResultGeometry(u);return v}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof nn&&typeof arguments[1]=="number"){var C=arguments[0],B=arguments[1],j=arguments[2],Q=new S(C);Q.setQuadrantSegments(j);var xe=Q.getResultGeometry(B);return xe}if(arguments[2]instanceof le&&arguments[0]instanceof nn&&typeof arguments[1]=="number"){var Ue=arguments[0],je=arguments[1],Et=arguments[2],Zt=new S(Ue,Et),Nt=Zt.getResultGeometry(je);return Nt}}else if(arguments.length===4){var Rn=arguments[0],Nn=arguments[1],fn=arguments[2],Ii=arguments[3],Bi=new S(Rn);Bi.setQuadrantSegments(fn),Bi.setEndCapStyle(Ii);var vr=Bi.getResultGeometry(Nn);return vr}}},{key:"precisionScaleFactor",value:function(s,u,f){var v=s.getEnvelopeInternal(),C=Ct.max(Math.abs(v.getMaxX()),Math.abs(v.getMaxY()),Math.abs(v.getMinX()),Math.abs(v.getMinY()))+2*(u>0?u:0),B=f-Math.trunc(Math.log(C)/Math.log(10)+1);return Math.pow(10,B)}}]),S}();ci.CAP_ROUND=le.CAP_ROUND,ci.CAP_BUTT=le.CAP_FLAT,ci.CAP_FLAT=le.CAP_FLAT,ci.CAP_SQUARE=le.CAP_SQUARE,ci.MAX_PRECISION_DIGITS=12;var cl=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Hu=function(){function S(s){t(this,S),this.geometryFactory=s||new Tn}return d(S,[{key:"read",value:function(s){var u,f=(u=typeof s=="string"?JSON.parse(s):s).type;if(!Ss[f])throw new Error("Unknown GeoJSON type: "+u.type);return cl.indexOf(f)!==-1?Ss[f].call(this,u.coordinates):f==="GeometryCollection"?Ss[f].call(this,u.geometries):Ss[f].call(this,u)}},{key:"write",value:function(s){var u=s.getGeometryType();if(!es[u])throw new Error("Geometry is not supported");return es[u].call(this,s)}}]),S}(),Ss={Feature:function(S){var s={};for(var u in S)s[u]=S[u];if(S.geometry){var f=S.geometry.type;if(!Ss[f])throw new Error("Unknown GeoJSON type: "+S.type);s.geometry=this.read(S.geometry)}return S.bbox&&(s.bbox=Ss.bbox.call(this,S.bbox)),s},FeatureCollection:function(S){var s={};if(S.features){s.features=[];for(var u=0;u<S.features.length;++u)s.features.push(this.read(S.features[u]))}return S.bbox&&(s.bbox=this.parse.bbox.call(this,S.bbox)),s},coordinates:function(S){for(var s=[],u=0;u<S.length;++u){var f=S[u];s.push(P(qe,re(f)))}return s},bbox:function(S){return this.geometryFactory.createLinearRing([new qe(S[0],S[1]),new qe(S[2],S[1]),new qe(S[2],S[3]),new qe(S[0],S[3]),new qe(S[0],S[1])])},Point:function(S){var s=P(qe,re(S));return this.geometryFactory.createPoint(s)},MultiPoint:function(S){for(var s=[],u=0;u<S.length;++u)s.push(Ss.Point.call(this,S[u]));return this.geometryFactory.createMultiPoint(s)},LineString:function(S){var s=Ss.coordinates.call(this,S);return this.geometryFactory.createLineString(s)},MultiLineString:function(S){for(var s=[],u=0;u<S.length;++u)s.push(Ss.LineString.call(this,S[u]));return this.geometryFactory.createMultiLineString(s)},Polygon:function(S){for(var s=Ss.coordinates.call(this,S[0]),u=this.geometryFactory.createLinearRing(s),f=[],v=1;v<S.length;++v){var C=S[v],B=Ss.coordinates.call(this,C),j=this.geometryFactory.createLinearRing(B);f.push(j)}return this.geometryFactory.createPolygon(u,f)},MultiPolygon:function(S){for(var s=[],u=0;u<S.length;++u){var f=S[u];s.push(Ss.Polygon.call(this,f))}return this.geometryFactory.createMultiPolygon(s)},GeometryCollection:function(S){for(var s=[],u=0;u<S.length;++u){var f=S[u];s.push(this.read(f))}return this.geometryFactory.createGeometryCollection(s)}},es={coordinate:function(S){var s=[S.x,S.y];return S.z&&s.push(S.z),S.m&&s.push(S.m),s},Point:function(S){return{type:"Point",coordinates:es.coordinate.call(this,S.getCoordinate())}},MultiPoint:function(S){for(var s=[],u=0;u<S._geometries.length;++u){var f=S._geometries[u],v=es.Point.call(this,f);s.push(v.coordinates)}return{type:"MultiPoint",coordinates:s}},LineString:function(S){for(var s=[],u=S.getCoordinates(),f=0;f<u.length;++f){var v=u[f];s.push(es.coordinate.call(this,v))}return{type:"LineString",coordinates:s}},MultiLineString:function(S){for(var s=[],u=0;u<S._geometries.length;++u){var f=S._geometries[u],v=es.LineString.call(this,f);s.push(v.coordinates)}return{type:"MultiLineString",coordinates:s}},Polygon:function(S){var s=[],u=es.LineString.call(this,S._shell);s.push(u.coordinates);for(var f=0;f<S._holes.length;++f){var v=S._holes[f],C=es.LineString.call(this,v);s.push(C.coordinates)}return{type:"Polygon",coordinates:s}},MultiPolygon:function(S){for(var s=[],u=0;u<S._geometries.length;++u){var f=S._geometries[u],v=es.Polygon.call(this,f);s.push(v.coordinates)}return{type:"MultiPolygon",coordinates:s}},GeometryCollection:function(S){for(var s=[],u=0;u<S._geometries.length;++u){var f=S._geometries[u],v=f.getGeometryType();s.push(es[v].call(this,f))}return{type:"GeometryCollection",geometries:s}}};return{BufferOp:ci,GeoJSONReader:function(){function S(s){t(this,S),this.parser=new Hu(s||new Tn)}return d(S,[{key:"read",value:function(s){return this.parser.read(s)}}]),S}(),GeoJSONWriter:function(){function S(){t(this,S),this.parser=new Hu(this.geometryFactory)}return d(S,[{key:"write",value:function(s){return this.parser.write(s)}}]),S}()}})})(tM);var TL=tM.exports;const ML=qy(TL);function bh(){return new Cy}function Cy(){this.reset()}Cy.prototype={constructor:Cy,reset:function(){this.s=this.t=0},add:function(l){Yw(p_,l,this.t),Yw(this,p_.s,this.s),this.s?this.t+=p_.t:this.s=p_.t},valueOf:function(){return this.s}};var p_=new Cy;function Yw(l,e,t){var a=l.s=e+t,d=a-e,g=a-d;l.t=e-g+(t-d)}var Ar=1e-6,Ji=Math.PI,vu=Ji/2,Kw=Ji/4,wu=Ji*2,nh=180/Ji,jo=Ji/180,Gs=Math.abs,AL=Math.atan,Wd=Math.atan2,Yr=Math.cos,Kr=Math.sin,ap=Math.sqrt;function nM(l){return l>1?0:l<-1?Ji:Math.acos(l)}function yf(l){return l>1?vu:l<-1?-vu:Math.asin(l)}function gm(){}function Ry(l,e){l&&Qw.hasOwnProperty(l.type)&&Qw[l.type](l,e)}var Jw={Feature:function(l,e){Ry(l.geometry,e)},FeatureCollection:function(l,e){for(var t=l.features,a=-1,d=t.length;++a<d;)Ry(t[a].geometry,e)}},Qw={Sphere:function(l,e){e.sphere()},Point:function(l,e){l=l.coordinates,e.point(l[0],l[1],l[2])},MultiPoint:function(l,e){for(var t=l.coordinates,a=-1,d=t.length;++a<d;)l=t[a],e.point(l[0],l[1],l[2])},LineString:function(l,e){Ux(l.coordinates,e,0)},MultiLineString:function(l,e){for(var t=l.coordinates,a=-1,d=t.length;++a<d;)Ux(t[a],e,0)},Polygon:function(l,e){eS(l.coordinates,e)},MultiPolygon:function(l,e){for(var t=l.coordinates,a=-1,d=t.length;++a<d;)eS(t[a],e)},GeometryCollection:function(l,e){for(var t=l.geometries,a=-1,d=t.length;++a<d;)Ry(t[a],e)}};function Ux(l,e,t){var a=-1,d=l.length-t,g;for(e.lineStart();++a<d;)g=l[a],e.point(g[0],g[1],g[2]);e.lineEnd()}function eS(l,e){var t=-1,a=l.length;for(e.polygonStart();++t<a;)Ux(l[t],e,1);e.polygonEnd()}function IL(l,e){l&&Jw.hasOwnProperty(l.type)?Jw[l.type](l,e):Ry(l,e)}bh();bh();function Vx(l){return[Wd(l[1],l[0]),yf(l[2])]}function qd(l){var e=l[0],t=l[1],a=Yr(t);return[a*Yr(e),a*Kr(e),Kr(t)]}function m_(l,e){return l[0]*e[0]+l[1]*e[1]+l[2]*e[2]}function Py(l,e){return[l[1]*e[2]-l[2]*e[1],l[2]*e[0]-l[0]*e[2],l[0]*e[1]-l[1]*e[0]]}function L0(l,e){l[0]+=e[0],l[1]+=e[1],l[2]+=e[2]}function g_(l,e){return[l[0]*e,l[1]*e,l[2]*e]}function Gx(l){var e=ap(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);l[0]/=e,l[1]/=e,l[2]/=e}bh();function iM(l,e){function t(a,d){return a=l(a,d),e(a[0],a[1])}return l.invert&&e.invert&&(t.invert=function(a,d){return a=e.invert(a,d),a&&l.invert(a[0],a[1])}),t}function Hx(l,e){return[l>Ji?l-wu:l<-Ji?l+wu:l,e]}Hx.invert=Hx;function CL(l,e,t){return(l%=wu)?e||t?iM(nS(l),iS(e,t)):nS(l):e||t?iS(e,t):Hx}function tS(l){return function(e,t){return e+=l,[e>Ji?e-wu:e<-Ji?e+wu:e,t]}}function nS(l){var e=tS(l);return e.invert=tS(-l),e}function iS(l,e){var t=Yr(l),a=Kr(l),d=Yr(e),g=Kr(e);function _(c,I){var P=Yr(I),F=Yr(c)*P,D=Kr(c)*P,N=Kr(I),G=N*t+F*a;return[Wd(D*d-G*g,F*t-N*a),yf(G*d+D*g)]}return _.invert=function(c,I){var P=Yr(I),F=Yr(c)*P,D=Kr(c)*P,N=Kr(I),G=N*d-D*g;return[Wd(D*d+N*g,F*t+G*a),yf(G*t-F*a)]},_}function RL(l,e,t,a,d,g){if(t){var _=Yr(e),c=Kr(e),I=a*t;d==null?(d=e+a*wu,g=e-I/2):(d=rS(_,d),g=rS(_,g),(a>0?d<g:d>g)&&(d+=a*wu));for(var P,F=d;a>0?F>g:F<g;F-=I)P=Vx([_,-c*Yr(F),-c*Kr(F)]),l.point(P[0],P[1])}}function rS(l,e){e=qd(e),e[0]-=l,Gx(e);var t=nM(-e[1]);return((-e[2]<0?-t:t)+wu-Ar)%wu}function rM(){var l=[],e;return{point:function(t,a){e.push([t,a])},lineStart:function(){l.push(e=[])},lineEnd:gm,rejoin:function(){l.length>1&&l.push(l.pop().concat(l.shift()))},result:function(){var t=l;return l=[],e=null,t}}}function PL(l,e,t,a,d,g){var _=l[0],c=l[1],I=e[0],P=e[1],F=0,D=1,N=I-_,G=P-c,Z;if(Z=t-_,!(!N&&Z>0)){if(Z/=N,N<0){if(Z<F)return;Z<D&&(D=Z)}else if(N>0){if(Z>D)return;Z>F&&(F=Z)}if(Z=d-_,!(!N&&Z<0)){if(Z/=N,N<0){if(Z>D)return;Z>F&&(F=Z)}else if(N>0){if(Z<F)return;Z<D&&(D=Z)}if(Z=a-c,!(!G&&Z>0)){if(Z/=G,G<0){if(Z<F)return;Z<D&&(D=Z)}else if(G>0){if(Z>D)return;Z>F&&(F=Z)}if(Z=g-c,!(!G&&Z<0)){if(Z/=G,G<0){if(Z>D)return;Z>F&&(F=Z)}else if(G>0){if(Z<F)return;Z<D&&(D=Z)}return F>0&&(l[0]=_+F*N,l[1]=c+F*G),D<1&&(e[0]=_+D*N,e[1]=c+D*G),!0}}}}}function sy(l,e){return Gs(l[0]-e[0])<Ar&&Gs(l[1]-e[1])<Ar}function __(l,e,t,a){this.x=l,this.z=e,this.o=t,this.e=a,this.v=!1,this.n=this.p=null}function sM(l,e,t,a,d){var g=[],_=[],c,I;if(l.forEach(function(Z){if(!((re=Z.length-1)<=0)){var re,$=Z[0],X=Z[re],me;if(sy($,X)){for(d.lineStart(),c=0;c<re;++c)d.point(($=Z[c])[0],$[1]);d.lineEnd();return}g.push(me=new __($,Z,null,!0)),_.push(me.o=new __($,null,me,!1)),g.push(me=new __(X,Z,null,!1)),_.push(me.o=new __(X,null,me,!0))}}),!!g.length){for(_.sort(e),sS(g),sS(_),c=0,I=_.length;c<I;++c)_[c].e=t=!t;for(var P=g[0],F,D;;){for(var N=P,G=!0;N.v;)if((N=N.n)===P)return;F=N.z,d.lineStart();do{if(N.v=N.o.v=!0,N.e){if(G)for(c=0,I=F.length;c<I;++c)d.point((D=F[c])[0],D[1]);else a(N.x,N.n.x,1,d);N=N.n}else{if(G)for(F=N.p.z,c=F.length-1;c>=0;--c)d.point((D=F[c])[0],D[1]);else a(N.x,N.p.x,-1,d);N=N.p}N=N.o,F=N.z,G=!G}while(!N.v);d.lineEnd()}}}function sS(l){if(e=l.length){for(var e,t=0,a=l[0],d;++t<e;)a.n=d=l[t],d.p=a,a=d;a.n=d=l[0],d.p=a}}function aM(l,e){return l<e?-1:l>e?1:l>=e?0:NaN}function LL(l){return l.length===1&&(l=kL(l)),{left:function(e,t,a,d){for(a==null&&(a=0),d==null&&(d=e.length);a<d;){var g=a+d>>>1;l(e[g],t)<0?a=g+1:d=g}return a},right:function(e,t,a,d){for(a==null&&(a=0),d==null&&(d=e.length);a<d;){var g=a+d>>>1;l(e[g],t)>0?d=g:a=g+1}return a}}}function kL(l){return function(e,t){return aM(l(e),t)}}LL(aM);function oM(l){for(var e=l.length,t,a=-1,d=0,g,_;++a<e;)d+=l[a].length;for(g=new Array(d);--e>=0;)for(_=l[e],t=_.length;--t>=0;)g[--d]=_[t];return g}var _m=1e9,y_=-_m;function DL(l,e,t,a){function d(P,F){return l<=P&&P<=t&&e<=F&&F<=a}function g(P,F,D,N){var G=0,Z=0;if(P==null||(G=_(P,D))!==(Z=_(F,D))||I(P,F)<0^D>0)do N.point(G===0||G===3?l:t,G>1?a:e);while((G=(G+D+4)%4)!==Z);else N.point(F[0],F[1])}function _(P,F){return Gs(P[0]-l)<Ar?F>0?0:3:Gs(P[0]-t)<Ar?F>0?2:1:Gs(P[1]-e)<Ar?F>0?1:0:F>0?3:2}function c(P,F){return I(P.x,F.x)}function I(P,F){var D=_(P,1),N=_(F,1);return D!==N?D-N:D===0?F[1]-P[1]:D===1?P[0]-F[0]:D===2?P[1]-F[1]:F[0]-P[0]}return function(P){var F=P,D=rM(),N,G,Z,re,$,X,me,le,ye,Le,Me,Te={point:We,lineStart:vt,lineEnd:st,polygonStart:be,polygonEnd:Oe};function We(mt,gt){d(mt,gt)&&F.point(mt,gt)}function de(){for(var mt=0,gt=0,wt=G.length;gt<wt;++gt)for(var yt=G[gt],Jt=1,Tt=yt.length,jt=yt[0],Cn,jn,ht=jt[0],Ft=jt[1];Jt<Tt;++Jt)Cn=ht,jn=Ft,jt=yt[Jt],ht=jt[0],Ft=jt[1],jn<=a?Ft>a&&(ht-Cn)*(a-jn)>(Ft-jn)*(l-Cn)&&++mt:Ft<=a&&(ht-Cn)*(a-jn)<(Ft-jn)*(l-Cn)&&--mt;return mt}function be(){F=D,N=[],G=[],Me=!0}function Oe(){var mt=de(),gt=Me&&mt,wt=(N=oM(N)).length;(gt||wt)&&(P.polygonStart(),gt&&(P.lineStart(),g(null,null,1,P),P.lineEnd()),wt&&sM(N,c,mt,g,P),P.polygonEnd()),F=P,N=G=Z=null}function vt(){Te.point=Je,G&&G.push(Z=[]),Le=!0,ye=!1,me=le=NaN}function st(){N&&(Je(re,$),X&&ye&&D.rejoin(),N.push(D.result())),Te.point=We,ye&&F.lineEnd()}function Je(mt,gt){var wt=d(mt,gt);if(G&&Z.push([mt,gt]),Le)re=mt,$=gt,X=wt,Le=!1,wt&&(F.lineStart(),F.point(mt,gt));else if(wt&&ye)F.point(mt,gt);else{var yt=[me=Math.max(y_,Math.min(_m,me)),le=Math.max(y_,Math.min(_m,le))],Jt=[mt=Math.max(y_,Math.min(_m,mt)),gt=Math.max(y_,Math.min(_m,gt))];PL(yt,Jt,l,e,t,a)?(ye||(F.lineStart(),F.point(yt[0],yt[1])),F.point(Jt[0],Jt[1]),wt||F.lineEnd(),Me=!1):wt&&(F.lineStart(),F.point(mt,gt),Me=!1)}me=mt,le=gt,ye=wt}return Te}}var k0=bh();function NL(l,e){var t=e[0],a=e[1],d=[Kr(t),-Yr(t),0],g=0,_=0;k0.reset();for(var c=0,I=l.length;c<I;++c)if(F=(P=l[c]).length)for(var P,F,D=P[F-1],N=D[0],G=D[1]/2+Kw,Z=Kr(G),re=Yr(G),$=0;$<F;++$,N=me,Z=ye,re=Le,D=X){var X=P[$],me=X[0],le=X[1]/2+Kw,ye=Kr(le),Le=Yr(le),Me=me-N,Te=Me>=0?1:-1,We=Te*Me,de=We>Ji,be=Z*ye;if(k0.add(Wd(be*Te*Kr(We),re*Le+be*Yr(We))),g+=de?Me+Te*wu:Me,de^N>=t^me>=t){var Oe=Py(qd(D),qd(X));Gx(Oe);var vt=Py(d,Oe);Gx(vt);var st=(de^Me>=0?-1:1)*yf(vt[2]);(a>st||a===st&&(Oe[0]||Oe[1]))&&(_+=de^Me>=0?1:-1)}}return(g<-Ar||g<Ar&&k0<-Ar)^_&1}bh();function aS(l){return l}bh();bh();var $d=1/0,Ly=$d,Cm=-$d,ky=Cm,oS={point:OL,lineStart:gm,lineEnd:gm,polygonStart:gm,polygonEnd:gm,result:function(){var l=[[$d,Ly],[Cm,ky]];return Cm=ky=-(Ly=$d=1/0),l}};function OL(l,e){l<$d&&($d=l),l>Cm&&(Cm=l),e<Ly&&(Ly=e),e>ky&&(ky=e)}bh();function lM(l,e,t,a){return function(d,g){var _=e(g),c=d.invert(a[0],a[1]),I=rM(),P=e(I),F=!1,D,N,G,Z={point:re,lineStart:X,lineEnd:me,polygonStart:function(){Z.point=le,Z.lineStart=ye,Z.lineEnd=Le,N=[],D=[]},polygonEnd:function(){Z.point=re,Z.lineStart=X,Z.lineEnd=me,N=oM(N);var Me=NL(D,c);N.length?(F||(g.polygonStart(),F=!0),sM(N,zL,Me,t,g)):Me&&(F||(g.polygonStart(),F=!0),g.lineStart(),t(null,null,1,g),g.lineEnd()),F&&(g.polygonEnd(),F=!1),N=D=null},sphere:function(){g.polygonStart(),g.lineStart(),t(null,null,1,g),g.lineEnd(),g.polygonEnd()}};function re(Me,Te){var We=d(Me,Te);l(Me=We[0],Te=We[1])&&g.point(Me,Te)}function $(Me,Te){var We=d(Me,Te);_.point(We[0],We[1])}function X(){Z.point=$,_.lineStart()}function me(){Z.point=re,_.lineEnd()}function le(Me,Te){G.push([Me,Te]);var We=d(Me,Te);P.point(We[0],We[1])}function ye(){P.lineStart(),G=[]}function Le(){le(G[0][0],G[0][1]),P.lineEnd();var Me=P.clean(),Te=I.result(),We,de=Te.length,be,Oe,vt;if(G.pop(),D.push(G),G=null,!!de){if(Me&1){if(Oe=Te[0],(be=Oe.length-1)>0){for(F||(g.polygonStart(),F=!0),g.lineStart(),We=0;We<be;++We)g.point((vt=Oe[We])[0],vt[1]);g.lineEnd()}return}de>1&&Me&2&&Te.push(Te.pop().concat(Te.shift())),N.push(Te.filter(FL))}}return Z}}function FL(l){return l.length>1}function zL(l,e){return((l=l.x)[0]<0?l[1]-vu-Ar:vu-l[1])-((e=e.x)[0]<0?e[1]-vu-Ar:vu-e[1])}const lS=lM(function(){return!0},BL,VL,[-Ji,-vu]);function BL(l){var e=NaN,t=NaN,a=NaN,d;return{lineStart:function(){l.lineStart(),d=1},point:function(g,_){var c=g>0?Ji:-Ji,I=Gs(g-e);Gs(I-Ji)<Ar?(l.point(e,t=(t+_)/2>0?vu:-vu),l.point(a,t),l.lineEnd(),l.lineStart(),l.point(c,t),l.point(g,t),d=0):a!==c&&I>=Ji&&(Gs(e-a)<Ar&&(e-=a*Ar),Gs(g-c)<Ar&&(g-=c*Ar),t=UL(e,t,g,_),l.point(a,t),l.lineEnd(),l.lineStart(),l.point(c,t),d=0),l.point(e=g,t=_),a=c},lineEnd:function(){l.lineEnd(),e=t=NaN},clean:function(){return 2-d}}}function UL(l,e,t,a){var d,g,_=Kr(l-t);return Gs(_)>Ar?AL((Kr(e)*(g=Yr(a))*Kr(t)-Kr(a)*(d=Yr(e))*Kr(l))/(d*g*_)):(e+a)/2}function VL(l,e,t,a){var d;if(l==null)d=t*vu,a.point(-Ji,d),a.point(0,d),a.point(Ji,d),a.point(Ji,0),a.point(Ji,-d),a.point(0,-d),a.point(-Ji,-d),a.point(-Ji,0),a.point(-Ji,d);else if(Gs(l[0]-e[0])>Ar){var g=l[0]<e[0]?Ji:-Ji;d=t*g/2,a.point(-g,d),a.point(0,d),a.point(g,d)}else a.point(e[0],e[1])}function GL(l,e){var t=Yr(l),a=t>0,d=Gs(t)>Ar;function g(F,D,N,G){RL(G,l,e,N,F,D)}function _(F,D){return Yr(F)*Yr(D)>t}function c(F){var D,N,G,Z,re;return{lineStart:function(){Z=G=!1,re=1},point:function($,X){var me=[$,X],le,ye=_($,X),Le=a?ye?0:P($,X):ye?P($+($<0?Ji:-Ji),X):0;if(!D&&(Z=G=ye)&&F.lineStart(),ye!==G&&(le=I(D,me),(!le||sy(D,le)||sy(me,le))&&(me[0]+=Ar,me[1]+=Ar,ye=_(me[0],me[1]))),ye!==G)re=0,ye?(F.lineStart(),le=I(me,D),F.point(le[0],le[1])):(le=I(D,me),F.point(le[0],le[1]),F.lineEnd()),D=le;else if(d&&D&&a^ye){var Me;!(Le&N)&&(Me=I(me,D,!0))&&(re=0,a?(F.lineStart(),F.point(Me[0][0],Me[0][1]),F.point(Me[1][0],Me[1][1]),F.lineEnd()):(F.point(Me[1][0],Me[1][1]),F.lineEnd(),F.lineStart(),F.point(Me[0][0],Me[0][1])))}ye&&(!D||!sy(D,me))&&F.point(me[0],me[1]),D=me,G=ye,N=Le},lineEnd:function(){G&&F.lineEnd(),D=null},clean:function(){return re|(Z&&G)<<1}}}function I(F,D,N){var G=qd(F),Z=qd(D),re=[1,0,0],$=Py(G,Z),X=m_($,$),me=$[0],le=X-me*me;if(!le)return!N&&F;var ye=t*X/le,Le=-t*me/le,Me=Py(re,$),Te=g_(re,ye),We=g_($,Le);L0(Te,We);var de=Me,be=m_(Te,de),Oe=m_(de,de),vt=be*be-Oe*(m_(Te,Te)-1);if(!(vt<0)){var st=ap(vt),Je=g_(de,(-be-st)/Oe);if(L0(Je,Te),Je=Vx(Je),!N)return Je;var mt=F[0],gt=D[0],wt=F[1],yt=D[1],Jt;gt<mt&&(Jt=mt,mt=gt,gt=Jt);var Tt=gt-mt,jt=Gs(Tt-Ji)<Ar,Cn=jt||Tt<Ar;if(!jt&&yt<wt&&(Jt=wt,wt=yt,yt=Jt),Cn?jt?wt+yt>0^Je[1]<(Gs(Je[0]-mt)<Ar?wt:yt):wt<=Je[1]&&Je[1]<=yt:Tt>Ji^(mt<=Je[0]&&Je[0]<=gt)){var jn=g_(de,(-be+st)/Oe);return L0(jn,Te),[Je,Vx(jn)]}}}function P(F,D){var N=a?l:Ji-l,G=0;return F<-N?G|=1:F>N&&(G|=2),D<-N?G|=4:D>N&&(G|=8),G}return lM(_,c,g,a?[0,-l]:[-Ji,l-Ji])}function uM(l){return function(e){var t=new Wx;for(var a in l)t[a]=l[a];return t.stream=e,t}}function Wx(){}Wx.prototype={constructor:Wx,point:function(l,e){this.stream.point(l,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function cM(l,e,t){var a=e[1][0]-e[0][0],d=e[1][1]-e[0][1],g=l.clipExtent&&l.clipExtent();l.scale(150).translate([0,0]),g!=null&&l.clipExtent(null),IL(t,l.stream(oS));var _=oS.result(),c=Math.min(a/(_[1][0]-_[0][0]),d/(_[1][1]-_[0][1])),I=+e[0][0]+(a-c*(_[1][0]+_[0][0]))/2,P=+e[0][1]+(d-c*(_[1][1]+_[0][1]))/2;return g!=null&&l.clipExtent(g),l.scale(c*150).translate([I,P])}function HL(l,e,t){return cM(l,[[0,0],e],t)}var uS=16,WL=Yr(30*jo);function cS(l,e){return+e?$L(l,e):qL(l)}function qL(l){return uM({point:function(e,t){e=l(e,t),this.stream.point(e[0],e[1])}})}function $L(l,e){function t(a,d,g,_,c,I,P,F,D,N,G,Z,re,$){var X=P-a,me=F-d,le=X*X+me*me;if(le>4*e&&re--){var ye=_+N,Le=c+G,Me=I+Z,Te=ap(ye*ye+Le*Le+Me*Me),We=yf(Me/=Te),de=Gs(Gs(Me)-1)<Ar||Gs(g-D)<Ar?(g+D)/2:Wd(Le,ye),be=l(de,We),Oe=be[0],vt=be[1],st=Oe-a,Je=vt-d,mt=me*st-X*Je;(mt*mt/le>e||Gs((X*st+me*Je)/le-.5)>.3||_*N+c*G+I*Z<WL)&&(t(a,d,g,_,c,I,Oe,vt,de,ye/=Te,Le/=Te,Me,re,$),$.point(Oe,vt),t(Oe,vt,de,ye,Le,Me,P,F,D,N,G,Z,re,$))}}return function(a){var d,g,_,c,I,P,F,D,N,G,Z,re,$={point:X,lineStart:me,lineEnd:ye,polygonStart:function(){a.polygonStart(),$.lineStart=Le},polygonEnd:function(){a.polygonEnd(),$.lineStart=me}};function X(We,de){We=l(We,de),a.point(We[0],We[1])}function me(){D=NaN,$.point=le,a.lineStart()}function le(We,de){var be=qd([We,de]),Oe=l(We,de);t(D,N,F,G,Z,re,D=Oe[0],N=Oe[1],F=We,G=be[0],Z=be[1],re=be[2],uS,a),a.point(D,N)}function ye(){$.point=X,a.lineEnd()}function Le(){me(),$.point=Me,$.lineEnd=Te}function Me(We,de){le(d=We,de),g=D,_=N,c=G,I=Z,P=re,$.point=le}function Te(){t(D,N,F,G,Z,re,g,_,d,c,I,P,uS,a),$.lineEnd=ye,ye()}return $}}var XL=uM({point:function(l,e){this.stream.point(l*jo,e*jo)}});function jL(l){return ZL(function(){return l})()}function ZL(l){var e,t=150,a=480,d=250,g,_,c=0,I=0,P=0,F=0,D=0,N,G,Z=null,re=lS,$=null,X,me,le,ye=aS,Le=.5,Me=cS(Oe,Le),Te,We;function de(Je){return Je=G(Je[0]*jo,Je[1]*jo),[Je[0]*t+g,_-Je[1]*t]}function be(Je){return Je=G.invert((Je[0]-g)/t,(_-Je[1])/t),Je&&[Je[0]*nh,Je[1]*nh]}function Oe(Je,mt){return Je=e(Je,mt),[Je[0]*t+g,_-Je[1]*t]}de.stream=function(Je){return Te&&We===Je?Te:Te=XL(re(N,Me(ye(We=Je))))},de.clipAngle=function(Je){return arguments.length?(re=+Je?GL(Z=Je*jo,6*jo):(Z=null,lS),st()):Z*nh},de.clipExtent=function(Je){return arguments.length?(ye=Je==null?($=X=me=le=null,aS):DL($=+Je[0][0],X=+Je[0][1],me=+Je[1][0],le=+Je[1][1]),st()):$==null?null:[[$,X],[me,le]]},de.scale=function(Je){return arguments.length?(t=+Je,vt()):t},de.translate=function(Je){return arguments.length?(a=+Je[0],d=+Je[1],vt()):[a,d]},de.center=function(Je){return arguments.length?(c=Je[0]%360*jo,I=Je[1]%360*jo,vt()):[c*nh,I*nh]},de.rotate=function(Je){return arguments.length?(P=Je[0]%360*jo,F=Je[1]%360*jo,D=Je.length>2?Je[2]%360*jo:0,vt()):[P*nh,F*nh,D*nh]},de.precision=function(Je){return arguments.length?(Me=cS(Oe,Le=Je*Je),st()):ap(Le)},de.fitExtent=function(Je,mt){return cM(de,Je,mt)},de.fitSize=function(Je,mt){return HL(de,Je,mt)};function vt(){G=iM(N=CL(P,F,D),e);var Je=e(c,I);return g=a-Je[0]*t,_=d+Je[1]*t,st()}function st(){return Te=We=null,de}return function(){return e=l.apply(this,arguments),de.invert=e.invert&&be,vt()}}function hM(l){return function(e,t){var a=Yr(e),d=Yr(t),g=l(a*d);return[g*d*Kr(e),g*Kr(t)]}}function fM(l){return function(e,t){var a=ap(e*e+t*t),d=l(a),g=Kr(d),_=Yr(d);return[Wd(e*g,a*_),yf(a&&t*g/a)]}}var YL=hM(function(l){return ap(2/(1+l))});YL.invert=fM(function(l){return 2*yf(l/2)});var dM=hM(function(l){return(l=nM(l))&&l/Kr(l)});dM.invert=fM(function(l){return l});function KL(){return jL(dM).scale(79.4188).clipAngle(180-.001)}function hS(l,e){return[l,e]}hS.invert=hS;var JL=Object.defineProperty,op=(l,e)=>JL(l,"name",{value:e,configurable:!0}),{BufferOp:QL,GeoJSONReader:ek,GeoJSONWriter:tk}=ML;function pM(l,e,t){t=t||{};var a=t.units||"kilometers",d=t.steps||8;if(!l)throw new Error("geojson is required");if(typeof t!="object")throw new Error("options must be an object");if(typeof d!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(d<=0)throw new Error("steps must be greater than 0");var g=[];switch(l.type){case"GeometryCollection":return zm(l,function(_){var c=Em(_,e,a,d);c&&g.push(c)}),_f(g);case"FeatureCollection":return Iy(l,function(_){var c=Em(_,e,a,d);c&&Iy(c,function(I){I&&g.push(I)})}),_f(g)}return Em(l,e,a,d)}op(pM,"buffer");function Em(l,e,t,a){var d=l.properties||{},g=l.type==="Feature"?l.geometry:l;if(g.type==="GeometryCollection"){var _=[];return zm(l,function(re){var $=Em(re,e,t,a);$&&_.push($)}),_f(_)}var c=mM(g),I={type:g.type,coordinates:Q1(g.coordinates,c)},P=new ek,F=P.read(I),D=Z1(jy(e,t),"meters"),N=QL.bufferOp(F,D,a),G=new tk;if(N=G.write(N),!J1(N.coordinates)){var Z={type:N.type,coordinates:eb(N.coordinates,c)};return kl(Z,d)}}op(Em,"bufferFeature");function J1(l){return Array.isArray(l[0])?J1(l[0]):isNaN(l[0])}op(J1,"coordsIsNaN");function Q1(l,e){return typeof l[0]!="object"?e(l):l.map(function(t){return Q1(t,e)})}op(Q1,"projectCoords");function eb(l,e){return typeof l[0]!="object"?e.invert(l):l.map(function(t){return eb(t,e)})}op(eb,"unprojectCoords");function mM(l){var e=K1(l).geometry.coordinates,t=[-e[0],-e[1]];return KL().rotate(t).scale(to)}op(mM,"defineProjection");/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const tb="167",nk=0,fS=1,ik=2,gM=1,rk=2,mc=3,xc=0,so=1,Al=2,gh=0,Nd=1,dS=2,pS=3,mS=4,sk=5,cf=100,ak=101,ok=102,lk=103,uk=104,ck=200,hk=201,fk=202,dk=203,qx=204,$x=205,pk=206,mk=207,gk=208,_k=209,yk=210,vk=211,xk=212,bk=213,wk=214,Sk=0,Ek=1,Tk=2,Dy=3,Mk=4,Ak=5,Ik=6,Ck=7,_M=0,Rk=1,Pk=2,_h=0,Lk=1,kk=2,Dk=3,Nk=4,Ok=5,Fk=6,zk=7,gS="attached",Bk="detached",yM=300,Xd=301,jd=302,Xx=303,jx=304,Yy=306,Zd=1e3,dh=1001,Ny=1002,Oa=1003,vM=1004,ym=1005,Io=1006,ay=1007,_c=1008,bc=1009,xM=1010,bM=1011,Rm=1012,nb=1013,vf=1014,Rl=1015,Bm=1016,ib=1017,rb=1018,Yd=1020,wM=35902,SM=1021,EM=1022,Yo=1023,TM=1024,MM=1025,Od=1026,Kd=1027,sb=1028,ab=1029,AM=1030,ob=1031,lb=1033,oy=33776,ly=33777,uy=33778,cy=33779,Zx=35840,Yx=35841,Kx=35842,Jx=35843,Qx=36196,e1=37492,t1=37496,n1=37808,i1=37809,r1=37810,s1=37811,a1=37812,o1=37813,l1=37814,u1=37815,c1=37816,h1=37817,f1=37818,d1=37819,p1=37820,m1=37821,hy=36492,g1=36494,_1=36495,IM=36283,y1=36284,v1=36285,x1=36286,Pm=2300,Lm=2301,D0=2302,_S=2400,yS=2401,vS=2402,Uk=2500,Vk=0,CM=1,b1=2,Gk=3200,Hk=3201,RM=0,Wk=1,hh="",Na="srgb",ia="srgb-linear",ub="display-p3",Ky="display-p3-linear",Oy="linear",Dr="srgb",Fy="rec709",zy="p3",dd=7680,xS=519,qk=512,$k=513,Xk=514,PM=515,jk=516,Zk=517,Yk=518,Kk=519,w1=35044,bS="300 es",yc=2e3,By=2001;class lp{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const a=this._listeners;a[e]===void 0&&(a[e]=[]),a[e].indexOf(t)===-1&&a[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const a=this._listeners;return a[e]!==void 0&&a[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const d=this._listeners[e];if(d!==void 0){const g=d.indexOf(t);g!==-1&&d.splice(g,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const a=this._listeners[e.type];if(a!==void 0){e.target=this;const d=a.slice(0);for(let g=0,_=d.length;g<_;g++)d[g].call(this,e);e.target=null}}}const ya=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wS=1234567;const Tm=Math.PI/180,Jd=180/Math.PI;function Ll(){const l=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,a=Math.random()*4294967295|0;return(ya[l&255]+ya[l>>8&255]+ya[l>>16&255]+ya[l>>24&255]+"-"+ya[e&255]+ya[e>>8&255]+"-"+ya[e>>16&15|64]+ya[e>>24&255]+"-"+ya[t&63|128]+ya[t>>8&255]+"-"+ya[t>>16&255]+ya[t>>24&255]+ya[a&255]+ya[a>>8&255]+ya[a>>16&255]+ya[a>>24&255]).toLowerCase()}function xa(l,e,t){return Math.max(e,Math.min(t,l))}function cb(l,e){return(l%e+e)%e}function Jk(l,e,t,a,d){return a+(l-e)*(d-a)/(t-e)}function Qk(l,e,t){return l!==e?(t-l)/(e-l):0}function Mm(l,e,t){return(1-t)*l+t*e}function eD(l,e,t,a){return Mm(l,e,1-Math.exp(-t*a))}function tD(l,e=1){return e-Math.abs(cb(l,e*2)-e)}function nD(l,e,t){return l<=e?0:l>=t?1:(l=(l-e)/(t-e),l*l*(3-2*l))}function iD(l,e,t){return l<=e?0:l>=t?1:(l=(l-e)/(t-e),l*l*l*(l*(l*6-15)+10))}function rD(l,e){return l+Math.floor(Math.random()*(e-l+1))}function sD(l,e){return l+Math.random()*(e-l)}function aD(l){return l*(.5-Math.random())}function oD(l){l!==void 0&&(wS=l);let e=wS+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function lD(l){return l*Tm}function uD(l){return l*Jd}function cD(l){return(l&l-1)===0&&l!==0}function hD(l){return Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function fD(l){return Math.pow(2,Math.floor(Math.log(l)/Math.LN2))}function dD(l,e,t,a,d){const g=Math.cos,_=Math.sin,c=g(t/2),I=_(t/2),P=g((e+a)/2),F=_((e+a)/2),D=g((e-a)/2),N=_((e-a)/2),G=g((a-e)/2),Z=_((a-e)/2);switch(d){case"XYX":l.set(c*F,I*D,I*N,c*P);break;case"YZY":l.set(I*N,c*F,I*D,c*P);break;case"ZXZ":l.set(I*D,I*N,c*F,c*P);break;case"XZX":l.set(c*F,I*Z,I*G,c*P);break;case"YXY":l.set(I*G,c*F,I*Z,c*P);break;case"ZYZ":l.set(I*Z,I*G,c*F,c*P);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+d)}}function Il(l,e){switch(e.constructor){case Float32Array:return l;case Uint32Array:return l/4294967295;case Uint16Array:return l/65535;case Uint8Array:return l/255;case Int32Array:return Math.max(l/2147483647,-1);case Int16Array:return Math.max(l/32767,-1);case Int8Array:return Math.max(l/127,-1);default:throw new Error("Invalid component type.")}}function hr(l,e){switch(e.constructor){case Float32Array:return l;case Uint32Array:return Math.round(l*4294967295);case Uint16Array:return Math.round(l*65535);case Uint8Array:return Math.round(l*255);case Int32Array:return Math.round(l*2147483647);case Int16Array:return Math.round(l*32767);case Int8Array:return Math.round(l*127);default:throw new Error("Invalid component type.")}}const pD={DEG2RAD:Tm,RAD2DEG:Jd,generateUUID:Ll,clamp:xa,euclideanModulo:cb,mapLinear:Jk,inverseLerp:Qk,lerp:Mm,damp:eD,pingpong:tD,smoothstep:nD,smootherstep:iD,randInt:rD,randFloat:sD,randFloatSpread:aD,seededRandom:oD,degToRad:lD,radToDeg:uD,isPowerOfTwo:cD,ceilPowerOfTwo:hD,floorPowerOfTwo:fD,setQuaternionFromProperEuler:dD,normalize:hr,denormalize:Il};class Pi{constructor(e=0,t=0){Pi.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,a=this.y,d=e.elements;return this.x=d[0]*t+d[3]*a+d[6],this.y=d[1]*t+d[4]*a+d[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const a=this.dot(e)/t;return Math.acos(xa(a,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,a=this.y-e.y;return t*t+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,a){return this.x=e.x+(t.x-e.x)*a,this.y=e.y+(t.y-e.y)*a,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const a=Math.cos(t),d=Math.sin(t),g=this.x-e.x,_=this.y-e.y;return this.x=g*a-_*d+e.x,this.y=g*d+_*a+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ei{constructor(e,t,a,d,g,_,c,I,P){Ei.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,a,d,g,_,c,I,P)}set(e,t,a,d,g,_,c,I,P){const F=this.elements;return F[0]=e,F[1]=d,F[2]=c,F[3]=t,F[4]=g,F[5]=I,F[6]=a,F[7]=_,F[8]=P,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,a=e.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],this}extractBasis(e,t,a){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),a.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const a=e.elements,d=t.elements,g=this.elements,_=a[0],c=a[3],I=a[6],P=a[1],F=a[4],D=a[7],N=a[2],G=a[5],Z=a[8],re=d[0],$=d[3],X=d[6],me=d[1],le=d[4],ye=d[7],Le=d[2],Me=d[5],Te=d[8];return g[0]=_*re+c*me+I*Le,g[3]=_*$+c*le+I*Me,g[6]=_*X+c*ye+I*Te,g[1]=P*re+F*me+D*Le,g[4]=P*$+F*le+D*Me,g[7]=P*X+F*ye+D*Te,g[2]=N*re+G*me+Z*Le,g[5]=N*$+G*le+Z*Me,g[8]=N*X+G*ye+Z*Te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],a=e[1],d=e[2],g=e[3],_=e[4],c=e[5],I=e[6],P=e[7],F=e[8];return t*_*F-t*c*P-a*g*F+a*c*I+d*g*P-d*_*I}invert(){const e=this.elements,t=e[0],a=e[1],d=e[2],g=e[3],_=e[4],c=e[5],I=e[6],P=e[7],F=e[8],D=F*_-c*P,N=c*I-F*g,G=P*g-_*I,Z=t*D+a*N+d*G;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0);const re=1/Z;return e[0]=D*re,e[1]=(d*P-F*a)*re,e[2]=(c*a-d*_)*re,e[3]=N*re,e[4]=(F*t-d*I)*re,e[5]=(d*g-c*t)*re,e[6]=G*re,e[7]=(a*I-P*t)*re,e[8]=(_*t-a*g)*re,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,a,d,g,_,c){const I=Math.cos(g),P=Math.sin(g);return this.set(a*I,a*P,-a*(I*_+P*c)+_+e,-d*P,d*I,-d*(-P*_+I*c)+c+t,0,0,1),this}scale(e,t){return this.premultiply(N0.makeScale(e,t)),this}rotate(e){return this.premultiply(N0.makeRotation(-e)),this}translate(e,t){return this.premultiply(N0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),a=Math.sin(e);return this.set(t,-a,0,a,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,a=e.elements;for(let d=0;d<9;d++)if(t[d]!==a[d])return!1;return!0}fromArray(e,t=0){for(let a=0;a<9;a++)this.elements[a]=e[a+t];return this}toArray(e=[],t=0){const a=this.elements;return e[t]=a[0],e[t+1]=a[1],e[t+2]=a[2],e[t+3]=a[3],e[t+4]=a[4],e[t+5]=a[5],e[t+6]=a[6],e[t+7]=a[7],e[t+8]=a[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const N0=new Ei;function LM(l){for(let e=l.length-1;e>=0;--e)if(l[e]>=65535)return!0;return!1}function km(l){return document.createElementNS("http://www.w3.org/1999/xhtml",l)}function mD(){const l=km("canvas");return l.style.display="block",l}const SS={};function Fd(l){l in SS||(SS[l]=!0,console.warn(l))}function gD(l,e,t){return new Promise(function(a,d){function g(){switch(l.clientWaitSync(e,l.SYNC_FLUSH_COMMANDS_BIT,0)){case l.WAIT_FAILED:d();break;case l.TIMEOUT_EXPIRED:setTimeout(g,t);break;default:a()}}setTimeout(g,t)})}const ES=new Ei().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),TS=new Ei().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),sm={[ia]:{transfer:Oy,primaries:Fy,luminanceCoefficients:[.2126,.7152,.0722],toReference:l=>l,fromReference:l=>l},[Na]:{transfer:Dr,primaries:Fy,luminanceCoefficients:[.2126,.7152,.0722],toReference:l=>l.convertSRGBToLinear(),fromReference:l=>l.convertLinearToSRGB()},[Ky]:{transfer:Oy,primaries:zy,luminanceCoefficients:[.2289,.6917,.0793],toReference:l=>l.applyMatrix3(TS),fromReference:l=>l.applyMatrix3(ES)},[ub]:{transfer:Dr,primaries:zy,luminanceCoefficients:[.2289,.6917,.0793],toReference:l=>l.convertSRGBToLinear().applyMatrix3(TS),fromReference:l=>l.applyMatrix3(ES).convertLinearToSRGB()}},_D=new Set([ia,Ky]),Ki={enabled:!0,_workingColorSpace:ia,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(l){if(!_D.has(l))throw new Error(`Unsupported working color space, "${l}".`);this._workingColorSpace=l},convert:function(l,e,t){if(this.enabled===!1||e===t||!e||!t)return l;const a=sm[e].toReference,d=sm[t].fromReference;return d(a(l))},fromWorkingColorSpace:function(l,e){return this.convert(l,this._workingColorSpace,e)},toWorkingColorSpace:function(l,e){return this.convert(l,e,this._workingColorSpace)},getPrimaries:function(l){return sm[l].primaries},getTransfer:function(l){return l===hh?Oy:sm[l].transfer},getLuminanceCoefficients:function(l,e=this._workingColorSpace){return l.fromArray(sm[e].luminanceCoefficients)}};function zd(l){return l<.04045?l*.0773993808:Math.pow(l*.9478672986+.0521327014,2.4)}function O0(l){return l<.0031308?l*12.92:1.055*Math.pow(l,.41666)-.055}let pd;class yD{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{pd===void 0&&(pd=km("canvas")),pd.width=e.width,pd.height=e.height;const a=pd.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),t=pd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=km("canvas");t.width=e.width,t.height=e.height;const a=t.getContext("2d");a.drawImage(e,0,0,e.width,e.height);const d=a.getImageData(0,0,e.width,e.height),g=d.data;for(let _=0;_<g.length;_++)g[_]=zd(g[_]/255)*255;return a.putImageData(d,0,0),t}else if(e.data){const t=e.data.slice(0);for(let a=0;a<t.length;a++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[a]=Math.floor(zd(t[a]/255)*255):t[a]=zd(t[a]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let vD=0;class kM{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:vD++}),this.uuid=Ll(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const a={uuid:this.uuid,url:""},d=this.data;if(d!==null){let g;if(Array.isArray(d)){g=[];for(let _=0,c=d.length;_<c;_++)d[_].isDataTexture?g.push(F0(d[_].image)):g.push(F0(d[_]))}else g=F0(d);a.url=g}return t||(e.images[this.uuid]=a),a}}function F0(l){return typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&l instanceof ImageBitmap?yD.getDataURL(l):l.data?{data:Array.from(l.data),width:l.width,height:l.height,type:l.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xD=0;class Hs extends lp{constructor(e=Hs.DEFAULT_IMAGE,t=Hs.DEFAULT_MAPPING,a=dh,d=dh,g=Io,_=_c,c=Yo,I=bc,P=Hs.DEFAULT_ANISOTROPY,F=hh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xD++}),this.uuid=Ll(),this.name="",this.source=new kM(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=a,this.wrapT=d,this.magFilter=g,this.minFilter=_,this.anisotropy=P,this.format=c,this.internalFormat=null,this.type=I,this.offset=new Pi(0,0),this.repeat=new Pi(1,1),this.center=new Pi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ei,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=F,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const a={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(a.userData=this.userData),t||(e.textures[this.uuid]=a),a}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==yM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Zd:e.x=e.x-Math.floor(e.x);break;case dh:e.x=e.x<0?0:1;break;case Ny:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Zd:e.y=e.y-Math.floor(e.y);break;case dh:e.y=e.y<0?0:1;break;case Ny:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Hs.DEFAULT_IMAGE=null;Hs.DEFAULT_MAPPING=yM;Hs.DEFAULT_ANISOTROPY=1;class gr{constructor(e=0,t=0,a=0,d=1){gr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=a,this.w=d}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,a,d){return this.x=e,this.y=t,this.z=a,this.w=d,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,a=this.y,d=this.z,g=this.w,_=e.elements;return this.x=_[0]*t+_[4]*a+_[8]*d+_[12]*g,this.y=_[1]*t+_[5]*a+_[9]*d+_[13]*g,this.z=_[2]*t+_[6]*a+_[10]*d+_[14]*g,this.w=_[3]*t+_[7]*a+_[11]*d+_[15]*g,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,a,d,g;const I=e.elements,P=I[0],F=I[4],D=I[8],N=I[1],G=I[5],Z=I[9],re=I[2],$=I[6],X=I[10];if(Math.abs(F-N)<.01&&Math.abs(D-re)<.01&&Math.abs(Z-$)<.01){if(Math.abs(F+N)<.1&&Math.abs(D+re)<.1&&Math.abs(Z+$)<.1&&Math.abs(P+G+X-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const le=(P+1)/2,ye=(G+1)/2,Le=(X+1)/2,Me=(F+N)/4,Te=(D+re)/4,We=(Z+$)/4;return le>ye&&le>Le?le<.01?(a=0,d=.707106781,g=.707106781):(a=Math.sqrt(le),d=Me/a,g=Te/a):ye>Le?ye<.01?(a=.707106781,d=0,g=.707106781):(d=Math.sqrt(ye),a=Me/d,g=We/d):Le<.01?(a=.707106781,d=.707106781,g=0):(g=Math.sqrt(Le),a=Te/g,d=We/g),this.set(a,d,g,t),this}let me=Math.sqrt(($-Z)*($-Z)+(D-re)*(D-re)+(N-F)*(N-F));return Math.abs(me)<.001&&(me=1),this.x=($-Z)/me,this.y=(D-re)/me,this.z=(N-F)/me,this.w=Math.acos((P+G+X-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,a){return this.x=e.x+(t.x-e.x)*a,this.y=e.y+(t.y-e.y)*a,this.z=e.z+(t.z-e.z)*a,this.w=e.w+(t.w-e.w)*a,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bD extends lp{constructor(e=1,t=1,a={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new gr(0,0,e,t),this.scissorTest=!1,this.viewport=new gr(0,0,e,t);const d={width:e,height:t,depth:1};a=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Io,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},a);const g=new Hs(d,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.colorSpace);g.flipY=!1,g.generateMipmaps=a.generateMipmaps,g.internalFormat=a.internalFormat,this.textures=[];const _=a.count;for(let c=0;c<_;c++)this.textures[c]=g.clone(),this.textures[c].isRenderTargetTexture=!0;this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this.resolveDepthBuffer=a.resolveDepthBuffer,this.resolveStencilBuffer=a.resolveStencilBuffer,this.depthTexture=a.depthTexture,this.samples=a.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,a=1){if(this.width!==e||this.height!==t||this.depth!==a){this.width=e,this.height=t,this.depth=a;for(let d=0,g=this.textures.length;d<g;d++)this.textures[d].image.width=e,this.textures[d].image.height=t,this.textures[d].image.depth=a;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let a=0,d=e.textures.length;a<d;a++)this.textures[a]=e.textures[a].clone(),this.textures[a].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new kM(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xf extends bD{constructor(e=1,t=1,a={}){super(e,t,a),this.isWebGLRenderTarget=!0}}class DM extends Hs{constructor(e=null,t=1,a=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:a,depth:d},this.magFilter=Oa,this.minFilter=Oa,this.wrapR=dh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class wD extends Hs{constructor(e=null,t=1,a=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:a,depth:d},this.magFilter=Oa,this.minFilter=Oa,this.wrapR=dh,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class wh{constructor(e=0,t=0,a=0,d=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=a,this._w=d}static slerpFlat(e,t,a,d,g,_,c){let I=a[d+0],P=a[d+1],F=a[d+2],D=a[d+3];const N=g[_+0],G=g[_+1],Z=g[_+2],re=g[_+3];if(c===0){e[t+0]=I,e[t+1]=P,e[t+2]=F,e[t+3]=D;return}if(c===1){e[t+0]=N,e[t+1]=G,e[t+2]=Z,e[t+3]=re;return}if(D!==re||I!==N||P!==G||F!==Z){let $=1-c;const X=I*N+P*G+F*Z+D*re,me=X>=0?1:-1,le=1-X*X;if(le>Number.EPSILON){const Le=Math.sqrt(le),Me=Math.atan2(Le,X*me);$=Math.sin($*Me)/Le,c=Math.sin(c*Me)/Le}const ye=c*me;if(I=I*$+N*ye,P=P*$+G*ye,F=F*$+Z*ye,D=D*$+re*ye,$===1-c){const Le=1/Math.sqrt(I*I+P*P+F*F+D*D);I*=Le,P*=Le,F*=Le,D*=Le}}e[t]=I,e[t+1]=P,e[t+2]=F,e[t+3]=D}static multiplyQuaternionsFlat(e,t,a,d,g,_){const c=a[d],I=a[d+1],P=a[d+2],F=a[d+3],D=g[_],N=g[_+1],G=g[_+2],Z=g[_+3];return e[t]=c*Z+F*D+I*G-P*N,e[t+1]=I*Z+F*N+P*D-c*G,e[t+2]=P*Z+F*G+c*N-I*D,e[t+3]=F*Z-c*D-I*N-P*G,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,a,d){return this._x=e,this._y=t,this._z=a,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const a=e._x,d=e._y,g=e._z,_=e._order,c=Math.cos,I=Math.sin,P=c(a/2),F=c(d/2),D=c(g/2),N=I(a/2),G=I(d/2),Z=I(g/2);switch(_){case"XYZ":this._x=N*F*D+P*G*Z,this._y=P*G*D-N*F*Z,this._z=P*F*Z+N*G*D,this._w=P*F*D-N*G*Z;break;case"YXZ":this._x=N*F*D+P*G*Z,this._y=P*G*D-N*F*Z,this._z=P*F*Z-N*G*D,this._w=P*F*D+N*G*Z;break;case"ZXY":this._x=N*F*D-P*G*Z,this._y=P*G*D+N*F*Z,this._z=P*F*Z+N*G*D,this._w=P*F*D-N*G*Z;break;case"ZYX":this._x=N*F*D-P*G*Z,this._y=P*G*D+N*F*Z,this._z=P*F*Z-N*G*D,this._w=P*F*D+N*G*Z;break;case"YZX":this._x=N*F*D+P*G*Z,this._y=P*G*D+N*F*Z,this._z=P*F*Z-N*G*D,this._w=P*F*D-N*G*Z;break;case"XZY":this._x=N*F*D-P*G*Z,this._y=P*G*D-N*F*Z,this._z=P*F*Z+N*G*D,this._w=P*F*D+N*G*Z;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+_)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const a=t/2,d=Math.sin(a);return this._x=e.x*d,this._y=e.y*d,this._z=e.z*d,this._w=Math.cos(a),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,a=t[0],d=t[4],g=t[8],_=t[1],c=t[5],I=t[9],P=t[2],F=t[6],D=t[10],N=a+c+D;if(N>0){const G=.5/Math.sqrt(N+1);this._w=.25/G,this._x=(F-I)*G,this._y=(g-P)*G,this._z=(_-d)*G}else if(a>c&&a>D){const G=2*Math.sqrt(1+a-c-D);this._w=(F-I)/G,this._x=.25*G,this._y=(d+_)/G,this._z=(g+P)/G}else if(c>D){const G=2*Math.sqrt(1+c-a-D);this._w=(g-P)/G,this._x=(d+_)/G,this._y=.25*G,this._z=(I+F)/G}else{const G=2*Math.sqrt(1+D-a-c);this._w=(_-d)/G,this._x=(g+P)/G,this._y=(I+F)/G,this._z=.25*G}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let a=e.dot(t)+1;return a<Number.EPSILON?(a=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=a):(this._x=0,this._y=-e.z,this._z=e.y,this._w=a)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=a),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(xa(this.dot(e),-1,1)))}rotateTowards(e,t){const a=this.angleTo(e);if(a===0)return this;const d=Math.min(1,t/a);return this.slerp(e,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const a=e._x,d=e._y,g=e._z,_=e._w,c=t._x,I=t._y,P=t._z,F=t._w;return this._x=a*F+_*c+d*P-g*I,this._y=d*F+_*I+g*c-a*P,this._z=g*F+_*P+a*I-d*c,this._w=_*F-a*c-d*I-g*P,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const a=this._x,d=this._y,g=this._z,_=this._w;let c=_*e._w+a*e._x+d*e._y+g*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=_,this._x=a,this._y=d,this._z=g,this;const I=1-c*c;if(I<=Number.EPSILON){const G=1-t;return this._w=G*_+t*this._w,this._x=G*a+t*this._x,this._y=G*d+t*this._y,this._z=G*g+t*this._z,this.normalize(),this}const P=Math.sqrt(I),F=Math.atan2(P,c),D=Math.sin((1-t)*F)/P,N=Math.sin(t*F)/P;return this._w=_*D+this._w*N,this._x=a*D+this._x*N,this._y=d*D+this._y*N,this._z=g*D+this._z*N,this._onChangeCallback(),this}slerpQuaternions(e,t,a){return this.copy(e).slerp(t,a)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),a=Math.random(),d=Math.sqrt(1-a),g=Math.sqrt(a);return this.set(d*Math.sin(e),d*Math.cos(e),g*Math.sin(t),g*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class lt{constructor(e=0,t=0,a=0){lt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=a}set(e,t,a){return a===void 0&&(a=this.z),this.x=e,this.y=t,this.z=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(MS.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(MS.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,a=this.y,d=this.z,g=e.elements;return this.x=g[0]*t+g[3]*a+g[6]*d,this.y=g[1]*t+g[4]*a+g[7]*d,this.z=g[2]*t+g[5]*a+g[8]*d,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,a=this.y,d=this.z,g=e.elements,_=1/(g[3]*t+g[7]*a+g[11]*d+g[15]);return this.x=(g[0]*t+g[4]*a+g[8]*d+g[12])*_,this.y=(g[1]*t+g[5]*a+g[9]*d+g[13])*_,this.z=(g[2]*t+g[6]*a+g[10]*d+g[14])*_,this}applyQuaternion(e){const t=this.x,a=this.y,d=this.z,g=e.x,_=e.y,c=e.z,I=e.w,P=2*(_*d-c*a),F=2*(c*t-g*d),D=2*(g*a-_*t);return this.x=t+I*P+_*D-c*F,this.y=a+I*F+c*P-g*D,this.z=d+I*D+g*F-_*P,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,a=this.y,d=this.z,g=e.elements;return this.x=g[0]*t+g[4]*a+g[8]*d,this.y=g[1]*t+g[5]*a+g[9]*d,this.z=g[2]*t+g[6]*a+g[10]*d,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const a=this.length();return this.divideScalar(a||1).multiplyScalar(Math.max(e,Math.min(t,a)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,a){return this.x=e.x+(t.x-e.x)*a,this.y=e.y+(t.y-e.y)*a,this.z=e.z+(t.z-e.z)*a,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const a=e.x,d=e.y,g=e.z,_=t.x,c=t.y,I=t.z;return this.x=d*I-g*c,this.y=g*_-a*I,this.z=a*c-d*_,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const a=e.dot(this)/t;return this.copy(e).multiplyScalar(a)}projectOnPlane(e){return z0.copy(this).projectOnVector(e),this.sub(z0)}reflect(e){return this.sub(z0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const a=this.dot(e)/t;return Math.acos(xa(a,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,a=this.y-e.y,d=this.z-e.z;return t*t+a*a+d*d}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,a){const d=Math.sin(t)*e;return this.x=d*Math.sin(a),this.y=Math.cos(t)*e,this.z=d*Math.cos(a),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,a){return this.x=e*Math.sin(t),this.y=a,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),d=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=a,this.z=d,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,a=Math.sqrt(1-t*t);return this.x=a*Math.cos(e),this.y=t,this.z=a*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const z0=new lt,MS=new wh;class wc{constructor(e=new lt(1/0,1/0,1/0),t=new lt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,a=e.length;t<a;t+=3)this.expandByPoint(Sl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,a=e.count;t<a;t++)this.expandByPoint(Sl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,a=e.length;t<a;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const a=Sl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(a),this.max.copy(e).add(a),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const a=e.geometry;if(a!==void 0){const g=a.getAttribute("position");if(t===!0&&g!==void 0&&e.isInstancedMesh!==!0)for(let _=0,c=g.count;_<c;_++)e.isMesh===!0?e.getVertexPosition(_,Sl):Sl.fromBufferAttribute(g,_),Sl.applyMatrix4(e.matrixWorld),this.expandByPoint(Sl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),v_.copy(e.boundingBox)):(a.boundingBox===null&&a.computeBoundingBox(),v_.copy(a.boundingBox)),v_.applyMatrix4(e.matrixWorld),this.union(v_)}const d=e.children;for(let g=0,_=d.length;g<_;g++)this.expandByObject(d[g],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Sl),Sl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,a;return e.normal.x>0?(t=e.normal.x*this.min.x,a=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,a=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,a+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,a+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,a+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,a+=e.normal.z*this.min.z),t<=-e.constant&&a>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(am),x_.subVectors(this.max,am),md.subVectors(e.a,am),gd.subVectors(e.b,am),_d.subVectors(e.c,am),ih.subVectors(gd,md),rh.subVectors(_d,gd),ef.subVectors(md,_d);let t=[0,-ih.z,ih.y,0,-rh.z,rh.y,0,-ef.z,ef.y,ih.z,0,-ih.x,rh.z,0,-rh.x,ef.z,0,-ef.x,-ih.y,ih.x,0,-rh.y,rh.x,0,-ef.y,ef.x,0];return!B0(t,md,gd,_d,x_)||(t=[1,0,0,0,1,0,0,0,1],!B0(t,md,gd,_d,x_))?!1:(b_.crossVectors(ih,rh),t=[b_.x,b_.y,b_.z],B0(t,md,gd,_d,x_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Sl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Sl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(uc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),uc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),uc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),uc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),uc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),uc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),uc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),uc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(uc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const uc=[new lt,new lt,new lt,new lt,new lt,new lt,new lt,new lt],Sl=new lt,v_=new wc,md=new lt,gd=new lt,_d=new lt,ih=new lt,rh=new lt,ef=new lt,am=new lt,x_=new lt,b_=new lt,tf=new lt;function B0(l,e,t,a,d){for(let g=0,_=l.length-3;g<=_;g+=3){tf.fromArray(l,g);const c=d.x*Math.abs(tf.x)+d.y*Math.abs(tf.y)+d.z*Math.abs(tf.z),I=e.dot(tf),P=t.dot(tf),F=a.dot(tf);if(Math.max(-Math.max(I,P,F),Math.min(I,P,F))>c)return!1}return!0}const SD=new wc,om=new lt,U0=new lt;class Mu{constructor(e=new lt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const a=this.center;t!==void 0?a.copy(t):SD.setFromPoints(e).getCenter(a);let d=0;for(let g=0,_=e.length;g<_;g++)d=Math.max(d,a.distanceToSquared(e[g]));return this.radius=Math.sqrt(d),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const a=this.center.distanceToSquared(e);return t.copy(e),a>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;om.subVectors(e,this.center);const t=om.lengthSq();if(t>this.radius*this.radius){const a=Math.sqrt(t),d=(a-this.radius)*.5;this.center.addScaledVector(om,d/a),this.radius+=d}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(U0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(om.copy(e.center).add(U0)),this.expandByPoint(om.copy(e.center).sub(U0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const cc=new lt,V0=new lt,w_=new lt,sh=new lt,G0=new lt,S_=new lt,H0=new lt;class Jy{constructor(e=new lt,t=new lt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,cc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const a=t.dot(this.direction);return a<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,a)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=cc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(cc.copy(this.origin).addScaledVector(this.direction,t),cc.distanceToSquared(e))}distanceSqToSegment(e,t,a,d){V0.copy(e).add(t).multiplyScalar(.5),w_.copy(t).sub(e).normalize(),sh.copy(this.origin).sub(V0);const g=e.distanceTo(t)*.5,_=-this.direction.dot(w_),c=sh.dot(this.direction),I=-sh.dot(w_),P=sh.lengthSq(),F=Math.abs(1-_*_);let D,N,G,Z;if(F>0)if(D=_*I-c,N=_*c-I,Z=g*F,D>=0)if(N>=-Z)if(N<=Z){const re=1/F;D*=re,N*=re,G=D*(D+_*N+2*c)+N*(_*D+N+2*I)+P}else N=g,D=Math.max(0,-(_*N+c)),G=-D*D+N*(N+2*I)+P;else N=-g,D=Math.max(0,-(_*N+c)),G=-D*D+N*(N+2*I)+P;else N<=-Z?(D=Math.max(0,-(-_*g+c)),N=D>0?-g:Math.min(Math.max(-g,-I),g),G=-D*D+N*(N+2*I)+P):N<=Z?(D=0,N=Math.min(Math.max(-g,-I),g),G=N*(N+2*I)+P):(D=Math.max(0,-(_*g+c)),N=D>0?g:Math.min(Math.max(-g,-I),g),G=-D*D+N*(N+2*I)+P);else N=_>0?-g:g,D=Math.max(0,-(_*N+c)),G=-D*D+N*(N+2*I)+P;return a&&a.copy(this.origin).addScaledVector(this.direction,D),d&&d.copy(V0).addScaledVector(w_,N),G}intersectSphere(e,t){cc.subVectors(e.center,this.origin);const a=cc.dot(this.direction),d=cc.dot(cc)-a*a,g=e.radius*e.radius;if(d>g)return null;const _=Math.sqrt(g-d),c=a-_,I=a+_;return I<0?null:c<0?this.at(I,t):this.at(c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const a=-(this.origin.dot(e.normal)+e.constant)/t;return a>=0?a:null}intersectPlane(e,t){const a=this.distanceToPlane(e);return a===null?null:this.at(a,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let a,d,g,_,c,I;const P=1/this.direction.x,F=1/this.direction.y,D=1/this.direction.z,N=this.origin;return P>=0?(a=(e.min.x-N.x)*P,d=(e.max.x-N.x)*P):(a=(e.max.x-N.x)*P,d=(e.min.x-N.x)*P),F>=0?(g=(e.min.y-N.y)*F,_=(e.max.y-N.y)*F):(g=(e.max.y-N.y)*F,_=(e.min.y-N.y)*F),a>_||g>d||((g>a||isNaN(a))&&(a=g),(_<d||isNaN(d))&&(d=_),D>=0?(c=(e.min.z-N.z)*D,I=(e.max.z-N.z)*D):(c=(e.max.z-N.z)*D,I=(e.min.z-N.z)*D),a>I||c>d)||((c>a||a!==a)&&(a=c),(I<d||d!==d)&&(d=I),d<0)?null:this.at(a>=0?a:d,t)}intersectsBox(e){return this.intersectBox(e,cc)!==null}intersectTriangle(e,t,a,d,g){G0.subVectors(t,e),S_.subVectors(a,e),H0.crossVectors(G0,S_);let _=this.direction.dot(H0),c;if(_>0){if(d)return null;c=1}else if(_<0)c=-1,_=-_;else return null;sh.subVectors(this.origin,e);const I=c*this.direction.dot(S_.crossVectors(sh,S_));if(I<0)return null;const P=c*this.direction.dot(G0.cross(sh));if(P<0||I+P>_)return null;const F=-c*sh.dot(H0);return F<0?null:this.at(F/_,g)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xi{constructor(e,t,a,d,g,_,c,I,P,F,D,N,G,Z,re,$){xi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,a,d,g,_,c,I,P,F,D,N,G,Z,re,$)}set(e,t,a,d,g,_,c,I,P,F,D,N,G,Z,re,$){const X=this.elements;return X[0]=e,X[4]=t,X[8]=a,X[12]=d,X[1]=g,X[5]=_,X[9]=c,X[13]=I,X[2]=P,X[6]=F,X[10]=D,X[14]=N,X[3]=G,X[7]=Z,X[11]=re,X[15]=$,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new xi().fromArray(this.elements)}copy(e){const t=this.elements,a=e.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],this}copyPosition(e){const t=this.elements,a=e.elements;return t[12]=a[12],t[13]=a[13],t[14]=a[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,a){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}makeBasis(e,t,a){return this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,a=e.elements,d=1/yd.setFromMatrixColumn(e,0).length(),g=1/yd.setFromMatrixColumn(e,1).length(),_=1/yd.setFromMatrixColumn(e,2).length();return t[0]=a[0]*d,t[1]=a[1]*d,t[2]=a[2]*d,t[3]=0,t[4]=a[4]*g,t[5]=a[5]*g,t[6]=a[6]*g,t[7]=0,t[8]=a[8]*_,t[9]=a[9]*_,t[10]=a[10]*_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,a=e.x,d=e.y,g=e.z,_=Math.cos(a),c=Math.sin(a),I=Math.cos(d),P=Math.sin(d),F=Math.cos(g),D=Math.sin(g);if(e.order==="XYZ"){const N=_*F,G=_*D,Z=c*F,re=c*D;t[0]=I*F,t[4]=-I*D,t[8]=P,t[1]=G+Z*P,t[5]=N-re*P,t[9]=-c*I,t[2]=re-N*P,t[6]=Z+G*P,t[10]=_*I}else if(e.order==="YXZ"){const N=I*F,G=I*D,Z=P*F,re=P*D;t[0]=N+re*c,t[4]=Z*c-G,t[8]=_*P,t[1]=_*D,t[5]=_*F,t[9]=-c,t[2]=G*c-Z,t[6]=re+N*c,t[10]=_*I}else if(e.order==="ZXY"){const N=I*F,G=I*D,Z=P*F,re=P*D;t[0]=N-re*c,t[4]=-_*D,t[8]=Z+G*c,t[1]=G+Z*c,t[5]=_*F,t[9]=re-N*c,t[2]=-_*P,t[6]=c,t[10]=_*I}else if(e.order==="ZYX"){const N=_*F,G=_*D,Z=c*F,re=c*D;t[0]=I*F,t[4]=Z*P-G,t[8]=N*P+re,t[1]=I*D,t[5]=re*P+N,t[9]=G*P-Z,t[2]=-P,t[6]=c*I,t[10]=_*I}else if(e.order==="YZX"){const N=_*I,G=_*P,Z=c*I,re=c*P;t[0]=I*F,t[4]=re-N*D,t[8]=Z*D+G,t[1]=D,t[5]=_*F,t[9]=-c*F,t[2]=-P*F,t[6]=G*D+Z,t[10]=N-re*D}else if(e.order==="XZY"){const N=_*I,G=_*P,Z=c*I,re=c*P;t[0]=I*F,t[4]=-D,t[8]=P*F,t[1]=N*D+re,t[5]=_*F,t[9]=G*D-Z,t[2]=Z*D-G,t[6]=c*F,t[10]=re*D+N}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ED,e,TD)}lookAt(e,t,a){const d=this.elements;return Mo.subVectors(e,t),Mo.lengthSq()===0&&(Mo.z=1),Mo.normalize(),ah.crossVectors(a,Mo),ah.lengthSq()===0&&(Math.abs(a.z)===1?Mo.x+=1e-4:Mo.z+=1e-4,Mo.normalize(),ah.crossVectors(a,Mo)),ah.normalize(),E_.crossVectors(Mo,ah),d[0]=ah.x,d[4]=E_.x,d[8]=Mo.x,d[1]=ah.y,d[5]=E_.y,d[9]=Mo.y,d[2]=ah.z,d[6]=E_.z,d[10]=Mo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const a=e.elements,d=t.elements,g=this.elements,_=a[0],c=a[4],I=a[8],P=a[12],F=a[1],D=a[5],N=a[9],G=a[13],Z=a[2],re=a[6],$=a[10],X=a[14],me=a[3],le=a[7],ye=a[11],Le=a[15],Me=d[0],Te=d[4],We=d[8],de=d[12],be=d[1],Oe=d[5],vt=d[9],st=d[13],Je=d[2],mt=d[6],gt=d[10],wt=d[14],yt=d[3],Jt=d[7],Tt=d[11],jt=d[15];return g[0]=_*Me+c*be+I*Je+P*yt,g[4]=_*Te+c*Oe+I*mt+P*Jt,g[8]=_*We+c*vt+I*gt+P*Tt,g[12]=_*de+c*st+I*wt+P*jt,g[1]=F*Me+D*be+N*Je+G*yt,g[5]=F*Te+D*Oe+N*mt+G*Jt,g[9]=F*We+D*vt+N*gt+G*Tt,g[13]=F*de+D*st+N*wt+G*jt,g[2]=Z*Me+re*be+$*Je+X*yt,g[6]=Z*Te+re*Oe+$*mt+X*Jt,g[10]=Z*We+re*vt+$*gt+X*Tt,g[14]=Z*de+re*st+$*wt+X*jt,g[3]=me*Me+le*be+ye*Je+Le*yt,g[7]=me*Te+le*Oe+ye*mt+Le*Jt,g[11]=me*We+le*vt+ye*gt+Le*Tt,g[15]=me*de+le*st+ye*wt+Le*jt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],a=e[4],d=e[8],g=e[12],_=e[1],c=e[5],I=e[9],P=e[13],F=e[2],D=e[6],N=e[10],G=e[14],Z=e[3],re=e[7],$=e[11],X=e[15];return Z*(+g*I*D-d*P*D-g*c*N+a*P*N+d*c*G-a*I*G)+re*(+t*I*G-t*P*N+g*_*N-d*_*G+d*P*F-g*I*F)+$*(+t*P*D-t*c*G-g*_*D+a*_*G+g*c*F-a*P*F)+X*(-d*c*F-t*I*D+t*c*N+d*_*D-a*_*N+a*I*F)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,a){const d=this.elements;return e.isVector3?(d[12]=e.x,d[13]=e.y,d[14]=e.z):(d[12]=e,d[13]=t,d[14]=a),this}invert(){const e=this.elements,t=e[0],a=e[1],d=e[2],g=e[3],_=e[4],c=e[5],I=e[6],P=e[7],F=e[8],D=e[9],N=e[10],G=e[11],Z=e[12],re=e[13],$=e[14],X=e[15],me=D*$*P-re*N*P+re*I*G-c*$*G-D*I*X+c*N*X,le=Z*N*P-F*$*P-Z*I*G+_*$*G+F*I*X-_*N*X,ye=F*re*P-Z*D*P+Z*c*G-_*re*G-F*c*X+_*D*X,Le=Z*D*I-F*re*I-Z*c*N+_*re*N+F*c*$-_*D*$,Me=t*me+a*le+d*ye+g*Le;if(Me===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Te=1/Me;return e[0]=me*Te,e[1]=(re*N*g-D*$*g-re*d*G+a*$*G+D*d*X-a*N*X)*Te,e[2]=(c*$*g-re*I*g+re*d*P-a*$*P-c*d*X+a*I*X)*Te,e[3]=(D*I*g-c*N*g-D*d*P+a*N*P+c*d*G-a*I*G)*Te,e[4]=le*Te,e[5]=(F*$*g-Z*N*g+Z*d*G-t*$*G-F*d*X+t*N*X)*Te,e[6]=(Z*I*g-_*$*g-Z*d*P+t*$*P+_*d*X-t*I*X)*Te,e[7]=(_*N*g-F*I*g+F*d*P-t*N*P-_*d*G+t*I*G)*Te,e[8]=ye*Te,e[9]=(Z*D*g-F*re*g-Z*a*G+t*re*G+F*a*X-t*D*X)*Te,e[10]=(_*re*g-Z*c*g+Z*a*P-t*re*P-_*a*X+t*c*X)*Te,e[11]=(F*c*g-_*D*g-F*a*P+t*D*P+_*a*G-t*c*G)*Te,e[12]=Le*Te,e[13]=(F*re*d-Z*D*d+Z*a*N-t*re*N-F*a*$+t*D*$)*Te,e[14]=(Z*c*d-_*re*d-Z*a*I+t*re*I+_*a*$-t*c*$)*Te,e[15]=(_*D*d-F*c*d+F*a*I-t*D*I-_*a*N+t*c*N)*Te,this}scale(e){const t=this.elements,a=e.x,d=e.y,g=e.z;return t[0]*=a,t[4]*=d,t[8]*=g,t[1]*=a,t[5]*=d,t[9]*=g,t[2]*=a,t[6]*=d,t[10]*=g,t[3]*=a,t[7]*=d,t[11]*=g,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],d=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,a,d))}makeTranslation(e,t,a){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),a=Math.sin(e);return this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),a=Math.sin(e);return this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),a=Math.sin(e);return this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const a=Math.cos(t),d=Math.sin(t),g=1-a,_=e.x,c=e.y,I=e.z,P=g*_,F=g*c;return this.set(P*_+a,P*c-d*I,P*I+d*c,0,P*c+d*I,F*c+a,F*I-d*_,0,P*I-d*c,F*I+d*_,g*I*I+a,0,0,0,0,1),this}makeScale(e,t,a){return this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1),this}makeShear(e,t,a,d,g,_){return this.set(1,a,g,0,e,1,_,0,t,d,1,0,0,0,0,1),this}compose(e,t,a){const d=this.elements,g=t._x,_=t._y,c=t._z,I=t._w,P=g+g,F=_+_,D=c+c,N=g*P,G=g*F,Z=g*D,re=_*F,$=_*D,X=c*D,me=I*P,le=I*F,ye=I*D,Le=a.x,Me=a.y,Te=a.z;return d[0]=(1-(re+X))*Le,d[1]=(G+ye)*Le,d[2]=(Z-le)*Le,d[3]=0,d[4]=(G-ye)*Me,d[5]=(1-(N+X))*Me,d[6]=($+me)*Me,d[7]=0,d[8]=(Z+le)*Te,d[9]=($-me)*Te,d[10]=(1-(N+re))*Te,d[11]=0,d[12]=e.x,d[13]=e.y,d[14]=e.z,d[15]=1,this}decompose(e,t,a){const d=this.elements;let g=yd.set(d[0],d[1],d[2]).length();const _=yd.set(d[4],d[5],d[6]).length(),c=yd.set(d[8],d[9],d[10]).length();this.determinant()<0&&(g=-g),e.x=d[12],e.y=d[13],e.z=d[14],El.copy(this);const P=1/g,F=1/_,D=1/c;return El.elements[0]*=P,El.elements[1]*=P,El.elements[2]*=P,El.elements[4]*=F,El.elements[5]*=F,El.elements[6]*=F,El.elements[8]*=D,El.elements[9]*=D,El.elements[10]*=D,t.setFromRotationMatrix(El),a.x=g,a.y=_,a.z=c,this}makePerspective(e,t,a,d,g,_,c=yc){const I=this.elements,P=2*g/(t-e),F=2*g/(a-d),D=(t+e)/(t-e),N=(a+d)/(a-d);let G,Z;if(c===yc)G=-(_+g)/(_-g),Z=-2*_*g/(_-g);else if(c===By)G=-_/(_-g),Z=-_*g/(_-g);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return I[0]=P,I[4]=0,I[8]=D,I[12]=0,I[1]=0,I[5]=F,I[9]=N,I[13]=0,I[2]=0,I[6]=0,I[10]=G,I[14]=Z,I[3]=0,I[7]=0,I[11]=-1,I[15]=0,this}makeOrthographic(e,t,a,d,g,_,c=yc){const I=this.elements,P=1/(t-e),F=1/(a-d),D=1/(_-g),N=(t+e)*P,G=(a+d)*F;let Z,re;if(c===yc)Z=(_+g)*D,re=-2*D;else if(c===By)Z=g*D,re=-1*D;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return I[0]=2*P,I[4]=0,I[8]=0,I[12]=-N,I[1]=0,I[5]=2*F,I[9]=0,I[13]=-G,I[2]=0,I[6]=0,I[10]=re,I[14]=-Z,I[3]=0,I[7]=0,I[11]=0,I[15]=1,this}equals(e){const t=this.elements,a=e.elements;for(let d=0;d<16;d++)if(t[d]!==a[d])return!1;return!0}fromArray(e,t=0){for(let a=0;a<16;a++)this.elements[a]=e[a+t];return this}toArray(e=[],t=0){const a=this.elements;return e[t]=a[0],e[t+1]=a[1],e[t+2]=a[2],e[t+3]=a[3],e[t+4]=a[4],e[t+5]=a[5],e[t+6]=a[6],e[t+7]=a[7],e[t+8]=a[8],e[t+9]=a[9],e[t+10]=a[10],e[t+11]=a[11],e[t+12]=a[12],e[t+13]=a[13],e[t+14]=a[14],e[t+15]=a[15],e}}const yd=new lt,El=new xi,ED=new lt(0,0,0),TD=new lt(1,1,1),ah=new lt,E_=new lt,Mo=new lt,AS=new xi,IS=new wh;class Su{constructor(e=0,t=0,a=0,d=Su.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=a,this._order=d}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,a,d=this._order){return this._x=e,this._y=t,this._z=a,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,a=!0){const d=e.elements,g=d[0],_=d[4],c=d[8],I=d[1],P=d[5],F=d[9],D=d[2],N=d[6],G=d[10];switch(t){case"XYZ":this._y=Math.asin(xa(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-F,G),this._z=Math.atan2(-_,g)):(this._x=Math.atan2(N,P),this._z=0);break;case"YXZ":this._x=Math.asin(-xa(F,-1,1)),Math.abs(F)<.9999999?(this._y=Math.atan2(c,G),this._z=Math.atan2(I,P)):(this._y=Math.atan2(-D,g),this._z=0);break;case"ZXY":this._x=Math.asin(xa(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(-D,G),this._z=Math.atan2(-_,P)):(this._y=0,this._z=Math.atan2(I,g));break;case"ZYX":this._y=Math.asin(-xa(D,-1,1)),Math.abs(D)<.9999999?(this._x=Math.atan2(N,G),this._z=Math.atan2(I,g)):(this._x=0,this._z=Math.atan2(-_,P));break;case"YZX":this._z=Math.asin(xa(I,-1,1)),Math.abs(I)<.9999999?(this._x=Math.atan2(-F,P),this._y=Math.atan2(-D,g)):(this._x=0,this._y=Math.atan2(c,G));break;case"XZY":this._z=Math.asin(-xa(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(N,P),this._y=Math.atan2(c,g)):(this._x=Math.atan2(-F,G),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,a===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,a){return AS.makeRotationFromQuaternion(e),this.setFromRotationMatrix(AS,t,a)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return IS.setFromEuler(this),this.setFromQuaternion(IS,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Su.DEFAULT_ORDER="XYZ";class NM{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let MD=0;const CS=new lt,vd=new wh,hc=new xi,T_=new lt,lm=new lt,AD=new lt,ID=new wh,RS=new lt(1,0,0),PS=new lt(0,1,0),LS=new lt(0,0,1),kS={type:"added"},CD={type:"removed"},xd={type:"childadded",child:null},W0={type:"childremoved",child:null};class Jr extends lp{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:MD++}),this.uuid=Ll(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Jr.DEFAULT_UP.clone();const e=new lt,t=new Su,a=new wh,d=new lt(1,1,1);function g(){a.setFromEuler(t,!1)}function _(){t.setFromQuaternion(a,void 0,!1)}t._onChange(g),a._onChange(_),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new xi},normalMatrix:{value:new Ei}}),this.matrix=new xi,this.matrixWorld=new xi,this.matrixAutoUpdate=Jr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Jr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new NM,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return vd.setFromAxisAngle(e,t),this.quaternion.multiply(vd),this}rotateOnWorldAxis(e,t){return vd.setFromAxisAngle(e,t),this.quaternion.premultiply(vd),this}rotateX(e){return this.rotateOnAxis(RS,e)}rotateY(e){return this.rotateOnAxis(PS,e)}rotateZ(e){return this.rotateOnAxis(LS,e)}translateOnAxis(e,t){return CS.copy(e).applyQuaternion(this.quaternion),this.position.add(CS.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(RS,e)}translateY(e){return this.translateOnAxis(PS,e)}translateZ(e){return this.translateOnAxis(LS,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hc.copy(this.matrixWorld).invert())}lookAt(e,t,a){e.isVector3?T_.copy(e):T_.set(e,t,a);const d=this.parent;this.updateWorldMatrix(!0,!1),lm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hc.lookAt(lm,T_,this.up):hc.lookAt(T_,lm,this.up),this.quaternion.setFromRotationMatrix(hc),d&&(hc.extractRotation(d.matrixWorld),vd.setFromRotationMatrix(hc),this.quaternion.premultiply(vd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(kS),xd.child=e,this.dispatchEvent(xd),xd.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(CD),W0.child=e,this.dispatchEvent(W0),W0.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),hc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hc.multiply(e.parent.matrixWorld)),e.applyMatrix4(hc),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(kS),xd.child=e,this.dispatchEvent(xd),xd.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let a=0,d=this.children.length;a<d;a++){const _=this.children[a].getObjectByProperty(e,t);if(_!==void 0)return _}}getObjectsByProperty(e,t,a=[]){this[e]===t&&a.push(this);const d=this.children;for(let g=0,_=d.length;g<_;g++)d[g].getObjectsByProperty(e,t,a);return a}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lm,e,AD),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lm,ID,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let a=0,d=t.length;a<d;a++)t[a].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let a=0,d=t.length;a<d;a++)t[a].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let a=0,d=t.length;a<d;a++)t[a].updateMatrixWorld(e)}updateWorldMatrix(e,t){const a=this.parent;if(e===!0&&a!==null&&a.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const d=this.children;for(let g=0,_=d.length;g<_;g++)d[g].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",a={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},a.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const d={};d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(d.type="BatchedMesh",d.perObjectFrustumCulled=this.perObjectFrustumCulled,d.sortObjects=this.sortObjects,d.drawRanges=this._drawRanges,d.reservedRanges=this._reservedRanges,d.visibility=this._visibility,d.active=this._active,d.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),d.maxInstanceCount=this._maxInstanceCount,d.maxVertexCount=this._maxVertexCount,d.maxIndexCount=this._maxIndexCount,d.geometryInitialized=this._geometryInitialized,d.geometryCount=this._geometryCount,d.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(d.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(d.boundingSphere={center:d.boundingSphere.center.toArray(),radius:d.boundingSphere.radius}),this.boundingBox!==null&&(d.boundingBox={min:d.boundingBox.min.toArray(),max:d.boundingBox.max.toArray()}));function g(c,I){return c[I.uuid]===void 0&&(c[I.uuid]=I.toJSON(e)),I.uuid}if(this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(d.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=g(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const I=c.shapes;if(Array.isArray(I))for(let P=0,F=I.length;P<F;P++){const D=I[P];g(e.shapes,D)}else g(e.shapes,I)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(g(e.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let I=0,P=this.material.length;I<P;I++)c.push(g(e.materials,this.material[I]));d.material=c}else d.material=g(e.materials,this.material);if(this.children.length>0){d.children=[];for(let c=0;c<this.children.length;c++)d.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){d.animations=[];for(let c=0;c<this.animations.length;c++){const I=this.animations[c];d.animations.push(g(e.animations,I))}}if(t){const c=_(e.geometries),I=_(e.materials),P=_(e.textures),F=_(e.images),D=_(e.shapes),N=_(e.skeletons),G=_(e.animations),Z=_(e.nodes);c.length>0&&(a.geometries=c),I.length>0&&(a.materials=I),P.length>0&&(a.textures=P),F.length>0&&(a.images=F),D.length>0&&(a.shapes=D),N.length>0&&(a.skeletons=N),G.length>0&&(a.animations=G),Z.length>0&&(a.nodes=Z)}return a.object=d,a;function _(c){const I=[];for(const P in c){const F=c[P];delete F.metadata,I.push(F)}return I}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let a=0;a<e.children.length;a++){const d=e.children[a];this.add(d.clone())}return this}}Jr.DEFAULT_UP=new lt(0,1,0);Jr.DEFAULT_MATRIX_AUTO_UPDATE=!0;Jr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Tl=new lt,fc=new lt,q0=new lt,dc=new lt,bd=new lt,wd=new lt,DS=new lt,$0=new lt,X0=new lt,j0=new lt;class _u{constructor(e=new lt,t=new lt,a=new lt){this.a=e,this.b=t,this.c=a}static getNormal(e,t,a,d){d.subVectors(a,t),Tl.subVectors(e,t),d.cross(Tl);const g=d.lengthSq();return g>0?d.multiplyScalar(1/Math.sqrt(g)):d.set(0,0,0)}static getBarycoord(e,t,a,d,g){Tl.subVectors(d,t),fc.subVectors(a,t),q0.subVectors(e,t);const _=Tl.dot(Tl),c=Tl.dot(fc),I=Tl.dot(q0),P=fc.dot(fc),F=fc.dot(q0),D=_*P-c*c;if(D===0)return g.set(0,0,0),null;const N=1/D,G=(P*I-c*F)*N,Z=(_*F-c*I)*N;return g.set(1-G-Z,Z,G)}static containsPoint(e,t,a,d){return this.getBarycoord(e,t,a,d,dc)===null?!1:dc.x>=0&&dc.y>=0&&dc.x+dc.y<=1}static getInterpolation(e,t,a,d,g,_,c,I){return this.getBarycoord(e,t,a,d,dc)===null?(I.x=0,I.y=0,"z"in I&&(I.z=0),"w"in I&&(I.w=0),null):(I.setScalar(0),I.addScaledVector(g,dc.x),I.addScaledVector(_,dc.y),I.addScaledVector(c,dc.z),I)}static isFrontFacing(e,t,a,d){return Tl.subVectors(a,t),fc.subVectors(e,t),Tl.cross(fc).dot(d)<0}set(e,t,a){return this.a.copy(e),this.b.copy(t),this.c.copy(a),this}setFromPointsAndIndices(e,t,a,d){return this.a.copy(e[t]),this.b.copy(e[a]),this.c.copy(e[d]),this}setFromAttributeAndIndices(e,t,a,d){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,a),this.c.fromBufferAttribute(e,d),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Tl.subVectors(this.c,this.b),fc.subVectors(this.a,this.b),Tl.cross(fc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return _u.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return _u.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,a,d,g){return _u.getInterpolation(e,this.a,this.b,this.c,t,a,d,g)}containsPoint(e){return _u.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return _u.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const a=this.a,d=this.b,g=this.c;let _,c;bd.subVectors(d,a),wd.subVectors(g,a),$0.subVectors(e,a);const I=bd.dot($0),P=wd.dot($0);if(I<=0&&P<=0)return t.copy(a);X0.subVectors(e,d);const F=bd.dot(X0),D=wd.dot(X0);if(F>=0&&D<=F)return t.copy(d);const N=I*D-F*P;if(N<=0&&I>=0&&F<=0)return _=I/(I-F),t.copy(a).addScaledVector(bd,_);j0.subVectors(e,g);const G=bd.dot(j0),Z=wd.dot(j0);if(Z>=0&&G<=Z)return t.copy(g);const re=G*P-I*Z;if(re<=0&&P>=0&&Z<=0)return c=P/(P-Z),t.copy(a).addScaledVector(wd,c);const $=F*Z-G*D;if($<=0&&D-F>=0&&G-Z>=0)return DS.subVectors(g,d),c=(D-F)/(D-F+(G-Z)),t.copy(d).addScaledVector(DS,c);const X=1/($+re+N);return _=re*X,c=N*X,t.copy(a).addScaledVector(bd,_).addScaledVector(wd,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const OM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oh={h:0,s:0,l:0},M_={h:0,s:0,l:0};function Z0(l,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?l+(e-l)*6*t:t<1/2?e:t<2/3?l+(e-l)*6*(2/3-t):l}let _i=class{constructor(e,t,a){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,a)}set(e,t,a){if(t===void 0&&a===void 0){const d=e;d&&d.isColor?this.copy(d):typeof d=="number"?this.setHex(d):typeof d=="string"&&this.setStyle(d)}else this.setRGB(e,t,a);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Na){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Ki.toWorkingColorSpace(this,t),this}setRGB(e,t,a,d=Ki.workingColorSpace){return this.r=e,this.g=t,this.b=a,Ki.toWorkingColorSpace(this,d),this}setHSL(e,t,a,d=Ki.workingColorSpace){if(e=cb(e,1),t=xa(t,0,1),a=xa(a,0,1),t===0)this.r=this.g=this.b=a;else{const g=a<=.5?a*(1+t):a+t-a*t,_=2*a-g;this.r=Z0(_,g,e+1/3),this.g=Z0(_,g,e),this.b=Z0(_,g,e-1/3)}return Ki.toWorkingColorSpace(this,d),this}setStyle(e,t=Na){function a(g){g!==void 0&&parseFloat(g)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let d;if(d=/^(\w+)\(([^\)]*)\)/.exec(e)){let g;const _=d[1],c=d[2];switch(_){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return a(g[4]),this.setRGB(Math.min(255,parseInt(g[1],10))/255,Math.min(255,parseInt(g[2],10))/255,Math.min(255,parseInt(g[3],10))/255,t);if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return a(g[4]),this.setRGB(Math.min(100,parseInt(g[1],10))/100,Math.min(100,parseInt(g[2],10))/100,Math.min(100,parseInt(g[3],10))/100,t);break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return a(g[4]),this.setHSL(parseFloat(g[1])/360,parseFloat(g[2])/100,parseFloat(g[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(e)){const g=d[1],_=g.length;if(_===3)return this.setRGB(parseInt(g.charAt(0),16)/15,parseInt(g.charAt(1),16)/15,parseInt(g.charAt(2),16)/15,t);if(_===6)return this.setHex(parseInt(g,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Na){const a=OM[e.toLowerCase()];return a!==void 0?this.setHex(a,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zd(e.r),this.g=zd(e.g),this.b=zd(e.b),this}copyLinearToSRGB(e){return this.r=O0(e.r),this.g=O0(e.g),this.b=O0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Na){return Ki.fromWorkingColorSpace(va.copy(this),e),Math.round(xa(va.r*255,0,255))*65536+Math.round(xa(va.g*255,0,255))*256+Math.round(xa(va.b*255,0,255))}getHexString(e=Na){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ki.workingColorSpace){Ki.fromWorkingColorSpace(va.copy(this),t);const a=va.r,d=va.g,g=va.b,_=Math.max(a,d,g),c=Math.min(a,d,g);let I,P;const F=(c+_)/2;if(c===_)I=0,P=0;else{const D=_-c;switch(P=F<=.5?D/(_+c):D/(2-_-c),_){case a:I=(d-g)/D+(d<g?6:0);break;case d:I=(g-a)/D+2;break;case g:I=(a-d)/D+4;break}I/=6}return e.h=I,e.s=P,e.l=F,e}getRGB(e,t=Ki.workingColorSpace){return Ki.fromWorkingColorSpace(va.copy(this),t),e.r=va.r,e.g=va.g,e.b=va.b,e}getStyle(e=Na){Ki.fromWorkingColorSpace(va.copy(this),e);const t=va.r,a=va.g,d=va.b;return e!==Na?`color(${e} ${t.toFixed(3)} ${a.toFixed(3)} ${d.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(a*255)},${Math.round(d*255)})`}offsetHSL(e,t,a){return this.getHSL(oh),this.setHSL(oh.h+e,oh.s+t,oh.l+a)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,a){return this.r=e.r+(t.r-e.r)*a,this.g=e.g+(t.g-e.g)*a,this.b=e.b+(t.b-e.b)*a,this}lerpHSL(e,t){this.getHSL(oh),e.getHSL(M_);const a=Mm(oh.h,M_.h,t),d=Mm(oh.s,M_.s,t),g=Mm(oh.l,M_.l,t);return this.setHSL(a,d,g),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,a=this.g,d=this.b,g=e.elements;return this.r=g[0]*t+g[3]*a+g[6]*d,this.g=g[1]*t+g[4]*a+g[7]*d,this.b=g[2]*t+g[5]*a+g[8]*d,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const va=new _i;_i.NAMES=OM;let RD=0;class xu extends lp{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:RD++}),this.uuid=Ll(),this.name="",this.type="Material",this.blending=Nd,this.side=xc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=qx,this.blendDst=$x,this.blendEquation=cf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new _i(0,0,0),this.blendAlpha=0,this.depthFunc=Dy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=xS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=dd,this.stencilZFail=dd,this.stencilZPass=dd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const a=e[t];if(a===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const d=this[t];if(d===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}d&&d.isColor?d.set(a):d&&d.isVector3&&a&&a.isVector3?d.copy(a):this[t]=a}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const a={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.color&&this.color.isColor&&(a.color=this.color.getHex()),this.roughness!==void 0&&(a.roughness=this.roughness),this.metalness!==void 0&&(a.metalness=this.metalness),this.sheen!==void 0&&(a.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(a.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(a.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(a.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(a.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(a.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(a.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(a.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(a.shininess=this.shininess),this.clearcoat!==void 0&&(a.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(a.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(a.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(a.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(a.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,a.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(a.dispersion=this.dispersion),this.iridescence!==void 0&&(a.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(a.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(a.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(a.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(a.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(a.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(a.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(a.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(a.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(a.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(a.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(a.lightMap=this.lightMap.toJSON(e).uuid,a.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(a.aoMap=this.aoMap.toJSON(e).uuid,a.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(a.bumpMap=this.bumpMap.toJSON(e).uuid,a.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(a.normalMap=this.normalMap.toJSON(e).uuid,a.normalMapType=this.normalMapType,a.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(a.displacementMap=this.displacementMap.toJSON(e).uuid,a.displacementScale=this.displacementScale,a.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(a.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(a.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(a.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(a.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(a.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(a.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(a.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(a.combine=this.combine)),this.envMapRotation!==void 0&&(a.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(a.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(a.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(a.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(a.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(a.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(a.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(a.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(a.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(a.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(a.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(a.size=this.size),this.shadowSide!==null&&(a.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(a.sizeAttenuation=this.sizeAttenuation),this.blending!==Nd&&(a.blending=this.blending),this.side!==xc&&(a.side=this.side),this.vertexColors===!0&&(a.vertexColors=!0),this.opacity<1&&(a.opacity=this.opacity),this.transparent===!0&&(a.transparent=!0),this.blendSrc!==qx&&(a.blendSrc=this.blendSrc),this.blendDst!==$x&&(a.blendDst=this.blendDst),this.blendEquation!==cf&&(a.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(a.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(a.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(a.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(a.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(a.blendAlpha=this.blendAlpha),this.depthFunc!==Dy&&(a.depthFunc=this.depthFunc),this.depthTest===!1&&(a.depthTest=this.depthTest),this.depthWrite===!1&&(a.depthWrite=this.depthWrite),this.colorWrite===!1&&(a.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(a.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==xS&&(a.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(a.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(a.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==dd&&(a.stencilFail=this.stencilFail),this.stencilZFail!==dd&&(a.stencilZFail=this.stencilZFail),this.stencilZPass!==dd&&(a.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(a.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(a.rotation=this.rotation),this.polygonOffset===!0&&(a.polygonOffset=!0),this.polygonOffsetFactor!==0&&(a.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(a.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(a.linewidth=this.linewidth),this.dashSize!==void 0&&(a.dashSize=this.dashSize),this.gapSize!==void 0&&(a.gapSize=this.gapSize),this.scale!==void 0&&(a.scale=this.scale),this.dithering===!0&&(a.dithering=!0),this.alphaTest>0&&(a.alphaTest=this.alphaTest),this.alphaHash===!0&&(a.alphaHash=!0),this.alphaToCoverage===!0&&(a.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(a.premultipliedAlpha=!0),this.forceSinglePass===!0&&(a.forceSinglePass=!0),this.wireframe===!0&&(a.wireframe=!0),this.wireframeLinewidth>1&&(a.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(a.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(a.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(a.flatShading=!0),this.visible===!1&&(a.visible=!1),this.toneMapped===!1&&(a.toneMapped=!1),this.fog===!1&&(a.fog=!1),Object.keys(this.userData).length>0&&(a.userData=this.userData);function d(g){const _=[];for(const c in g){const I=g[c];delete I.metadata,_.push(I)}return _}if(t){const g=d(e.textures),_=d(e.images);g.length>0&&(a.textures=g),_.length>0&&(a.images=_)}return a}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let a=null;if(t!==null){const d=t.length;a=new Array(d);for(let g=0;g!==d;++g)a[g]=t[g].clone()}return this.clippingPlanes=a,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class ph extends xu{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new _i(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Su,this.combine=_M,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _s=new lt,A_=new Pi;class Fa{constructor(e,t,a=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=a,this.usage=w1,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Rl,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Fd("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,a){e*=this.itemSize,a*=t.itemSize;for(let d=0,g=this.itemSize;d<g;d++)this.array[e+d]=t.array[a+d];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,a=this.count;t<a;t++)A_.fromBufferAttribute(this,t),A_.applyMatrix3(e),this.setXY(t,A_.x,A_.y);else if(this.itemSize===3)for(let t=0,a=this.count;t<a;t++)_s.fromBufferAttribute(this,t),_s.applyMatrix3(e),this.setXYZ(t,_s.x,_s.y,_s.z);return this}applyMatrix4(e){for(let t=0,a=this.count;t<a;t++)_s.fromBufferAttribute(this,t),_s.applyMatrix4(e),this.setXYZ(t,_s.x,_s.y,_s.z);return this}applyNormalMatrix(e){for(let t=0,a=this.count;t<a;t++)_s.fromBufferAttribute(this,t),_s.applyNormalMatrix(e),this.setXYZ(t,_s.x,_s.y,_s.z);return this}transformDirection(e){for(let t=0,a=this.count;t<a;t++)_s.fromBufferAttribute(this,t),_s.transformDirection(e),this.setXYZ(t,_s.x,_s.y,_s.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let a=this.array[e*this.itemSize+t];return this.normalized&&(a=Il(a,this.array)),a}setComponent(e,t,a){return this.normalized&&(a=hr(a,this.array)),this.array[e*this.itemSize+t]=a,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Il(t,this.array)),t}setX(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Il(t,this.array)),t}setY(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Il(t,this.array)),t}setZ(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Il(t,this.array)),t}setW(e,t){return this.normalized&&(t=hr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,a){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array)),this.array[e+0]=t,this.array[e+1]=a,this}setXYZ(e,t,a,d){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array),d=hr(d,this.array)),this.array[e+0]=t,this.array[e+1]=a,this.array[e+2]=d,this}setXYZW(e,t,a,d,g){return e*=this.itemSize,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array),d=hr(d,this.array),g=hr(g,this.array)),this.array[e+0]=t,this.array[e+1]=a,this.array[e+2]=d,this.array[e+3]=g,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==w1&&(e.usage=this.usage),e}}class FM extends Fa{constructor(e,t,a){super(new Uint16Array(e),t,a)}}class zM extends Fa{constructor(e,t,a){super(new Uint32Array(e),t,a)}}class vc extends Fa{constructor(e,t,a){super(new Float32Array(e),t,a)}}let PD=0;const Xo=new xi,Y0=new Jr,Sd=new lt,Ao=new wc,um=new wc,Us=new lt;class Au extends lp{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:PD++}),this.uuid=Ll(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(LM(e)?zM:FM)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,a=0){this.groups.push({start:e,count:t,materialIndex:a})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const a=this.attributes.normal;if(a!==void 0){const g=new Ei().getNormalMatrix(e);a.applyNormalMatrix(g),a.needsUpdate=!0}const d=this.attributes.tangent;return d!==void 0&&(d.transformDirection(e),d.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Xo.makeRotationFromQuaternion(e),this.applyMatrix4(Xo),this}rotateX(e){return Xo.makeRotationX(e),this.applyMatrix4(Xo),this}rotateY(e){return Xo.makeRotationY(e),this.applyMatrix4(Xo),this}rotateZ(e){return Xo.makeRotationZ(e),this.applyMatrix4(Xo),this}translate(e,t,a){return Xo.makeTranslation(e,t,a),this.applyMatrix4(Xo),this}scale(e,t,a){return Xo.makeScale(e,t,a),this.applyMatrix4(Xo),this}lookAt(e){return Y0.lookAt(e),Y0.updateMatrix(),this.applyMatrix4(Y0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Sd).negate(),this.translate(Sd.x,Sd.y,Sd.z),this}setFromPoints(e){const t=[];for(let a=0,d=e.length;a<d;a++){const g=e[a];t.push(g.x,g.y,g.z||0)}return this.setAttribute("position",new vc(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new wc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new lt(-1/0,-1/0,-1/0),new lt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let a=0,d=t.length;a<d;a++){const g=t[a];Ao.setFromBufferAttribute(g),this.morphTargetsRelative?(Us.addVectors(this.boundingBox.min,Ao.min),this.boundingBox.expandByPoint(Us),Us.addVectors(this.boundingBox.max,Ao.max),this.boundingBox.expandByPoint(Us)):(this.boundingBox.expandByPoint(Ao.min),this.boundingBox.expandByPoint(Ao.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Mu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new lt,1/0);return}if(e){const a=this.boundingSphere.center;if(Ao.setFromBufferAttribute(e),t)for(let g=0,_=t.length;g<_;g++){const c=t[g];um.setFromBufferAttribute(c),this.morphTargetsRelative?(Us.addVectors(Ao.min,um.min),Ao.expandByPoint(Us),Us.addVectors(Ao.max,um.max),Ao.expandByPoint(Us)):(Ao.expandByPoint(um.min),Ao.expandByPoint(um.max))}Ao.getCenter(a);let d=0;for(let g=0,_=e.count;g<_;g++)Us.fromBufferAttribute(e,g),d=Math.max(d,a.distanceToSquared(Us));if(t)for(let g=0,_=t.length;g<_;g++){const c=t[g],I=this.morphTargetsRelative;for(let P=0,F=c.count;P<F;P++)Us.fromBufferAttribute(c,P),I&&(Sd.fromBufferAttribute(e,P),Us.add(Sd)),d=Math.max(d,a.distanceToSquared(Us))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const a=t.position,d=t.normal,g=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Fa(new Float32Array(4*a.count),4));const _=this.getAttribute("tangent"),c=[],I=[];for(let We=0;We<a.count;We++)c[We]=new lt,I[We]=new lt;const P=new lt,F=new lt,D=new lt,N=new Pi,G=new Pi,Z=new Pi,re=new lt,$=new lt;function X(We,de,be){P.fromBufferAttribute(a,We),F.fromBufferAttribute(a,de),D.fromBufferAttribute(a,be),N.fromBufferAttribute(g,We),G.fromBufferAttribute(g,de),Z.fromBufferAttribute(g,be),F.sub(P),D.sub(P),G.sub(N),Z.sub(N);const Oe=1/(G.x*Z.y-Z.x*G.y);isFinite(Oe)&&(re.copy(F).multiplyScalar(Z.y).addScaledVector(D,-G.y).multiplyScalar(Oe),$.copy(D).multiplyScalar(G.x).addScaledVector(F,-Z.x).multiplyScalar(Oe),c[We].add(re),c[de].add(re),c[be].add(re),I[We].add($),I[de].add($),I[be].add($))}let me=this.groups;me.length===0&&(me=[{start:0,count:e.count}]);for(let We=0,de=me.length;We<de;++We){const be=me[We],Oe=be.start,vt=be.count;for(let st=Oe,Je=Oe+vt;st<Je;st+=3)X(e.getX(st+0),e.getX(st+1),e.getX(st+2))}const le=new lt,ye=new lt,Le=new lt,Me=new lt;function Te(We){Le.fromBufferAttribute(d,We),Me.copy(Le);const de=c[We];le.copy(de),le.sub(Le.multiplyScalar(Le.dot(de))).normalize(),ye.crossVectors(Me,de);const Oe=ye.dot(I[We])<0?-1:1;_.setXYZW(We,le.x,le.y,le.z,Oe)}for(let We=0,de=me.length;We<de;++We){const be=me[We],Oe=be.start,vt=be.count;for(let st=Oe,Je=Oe+vt;st<Je;st+=3)Te(e.getX(st+0)),Te(e.getX(st+1)),Te(e.getX(st+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let a=this.getAttribute("normal");if(a===void 0)a=new Fa(new Float32Array(t.count*3),3),this.setAttribute("normal",a);else for(let N=0,G=a.count;N<G;N++)a.setXYZ(N,0,0,0);const d=new lt,g=new lt,_=new lt,c=new lt,I=new lt,P=new lt,F=new lt,D=new lt;if(e)for(let N=0,G=e.count;N<G;N+=3){const Z=e.getX(N+0),re=e.getX(N+1),$=e.getX(N+2);d.fromBufferAttribute(t,Z),g.fromBufferAttribute(t,re),_.fromBufferAttribute(t,$),F.subVectors(_,g),D.subVectors(d,g),F.cross(D),c.fromBufferAttribute(a,Z),I.fromBufferAttribute(a,re),P.fromBufferAttribute(a,$),c.add(F),I.add(F),P.add(F),a.setXYZ(Z,c.x,c.y,c.z),a.setXYZ(re,I.x,I.y,I.z),a.setXYZ($,P.x,P.y,P.z)}else for(let N=0,G=t.count;N<G;N+=3)d.fromBufferAttribute(t,N+0),g.fromBufferAttribute(t,N+1),_.fromBufferAttribute(t,N+2),F.subVectors(_,g),D.subVectors(d,g),F.cross(D),a.setXYZ(N+0,F.x,F.y,F.z),a.setXYZ(N+1,F.x,F.y,F.z),a.setXYZ(N+2,F.x,F.y,F.z);this.normalizeNormals(),a.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,a=e.count;t<a;t++)Us.fromBufferAttribute(e,t),Us.normalize(),e.setXYZ(t,Us.x,Us.y,Us.z)}toNonIndexed(){function e(c,I){const P=c.array,F=c.itemSize,D=c.normalized,N=new P.constructor(I.length*F);let G=0,Z=0;for(let re=0,$=I.length;re<$;re++){c.isInterleavedBufferAttribute?G=I[re]*c.data.stride+c.offset:G=I[re]*F;for(let X=0;X<F;X++)N[Z++]=P[G++]}return new Fa(N,F,D)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Au,a=this.index.array,d=this.attributes;for(const c in d){const I=d[c],P=e(I,a);t.setAttribute(c,P)}const g=this.morphAttributes;for(const c in g){const I=[],P=g[c];for(let F=0,D=P.length;F<D;F++){const N=P[F],G=e(N,a);I.push(G)}t.morphAttributes[c]=I}t.morphTargetsRelative=this.morphTargetsRelative;const _=this.groups;for(let c=0,I=_.length;c<I;c++){const P=_[c];t.addGroup(P.start,P.count,P.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const I=this.parameters;for(const P in I)I[P]!==void 0&&(e[P]=I[P]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const a=this.attributes;for(const I in a){const P=a[I];e.data.attributes[I]=P.toJSON(e.data)}const d={};let g=!1;for(const I in this.morphAttributes){const P=this.morphAttributes[I],F=[];for(let D=0,N=P.length;D<N;D++){const G=P[D];F.push(G.toJSON(e.data))}F.length>0&&(d[I]=F,g=!0)}g&&(e.data.morphAttributes=d,e.data.morphTargetsRelative=this.morphTargetsRelative);const _=this.groups;_.length>0&&(e.data.groups=JSON.parse(JSON.stringify(_)));const c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const a=e.index;a!==null&&this.setIndex(a.clone(t));const d=e.attributes;for(const P in d){const F=d[P];this.setAttribute(P,F.clone(t))}const g=e.morphAttributes;for(const P in g){const F=[],D=g[P];for(let N=0,G=D.length;N<G;N++)F.push(D[N].clone(t));this.morphAttributes[P]=F}this.morphTargetsRelative=e.morphTargetsRelative;const _=e.groups;for(let P=0,F=_.length;P<F;P++){const D=_[P];this.addGroup(D.start,D.count,D.materialIndex)}const c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());const I=e.boundingSphere;return I!==null&&(this.boundingSphere=I.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const NS=new xi,nf=new Jy,I_=new Mu,OS=new lt,Ed=new lt,Td=new lt,Md=new lt,K0=new lt,C_=new lt,R_=new Pi,P_=new Pi,L_=new Pi,FS=new lt,zS=new lt,BS=new lt,k_=new lt,D_=new lt;class io extends Jr{constructor(e=new Au,t=new ph){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,a=Object.keys(t);if(a.length>0){const d=t[a[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,_=d.length;g<_;g++){const c=d[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=g}}}}getVertexPosition(e,t){const a=this.geometry,d=a.attributes.position,g=a.morphAttributes.position,_=a.morphTargetsRelative;t.fromBufferAttribute(d,e);const c=this.morphTargetInfluences;if(g&&c){C_.set(0,0,0);for(let I=0,P=g.length;I<P;I++){const F=c[I],D=g[I];F!==0&&(K0.fromBufferAttribute(D,e),_?C_.addScaledVector(K0,F):C_.addScaledVector(K0.sub(t),F))}t.add(C_)}return t}raycast(e,t){const a=this.geometry,d=this.material,g=this.matrixWorld;d!==void 0&&(a.boundingSphere===null&&a.computeBoundingSphere(),I_.copy(a.boundingSphere),I_.applyMatrix4(g),nf.copy(e.ray).recast(e.near),!(I_.containsPoint(nf.origin)===!1&&(nf.intersectSphere(I_,OS)===null||nf.origin.distanceToSquared(OS)>(e.far-e.near)**2))&&(NS.copy(g).invert(),nf.copy(e.ray).applyMatrix4(NS),!(a.boundingBox!==null&&nf.intersectsBox(a.boundingBox)===!1)&&this._computeIntersections(e,t,nf)))}_computeIntersections(e,t,a){let d;const g=this.geometry,_=this.material,c=g.index,I=g.attributes.position,P=g.attributes.uv,F=g.attributes.uv1,D=g.attributes.normal,N=g.groups,G=g.drawRange;if(c!==null)if(Array.isArray(_))for(let Z=0,re=N.length;Z<re;Z++){const $=N[Z],X=_[$.materialIndex],me=Math.max($.start,G.start),le=Math.min(c.count,Math.min($.start+$.count,G.start+G.count));for(let ye=me,Le=le;ye<Le;ye+=3){const Me=c.getX(ye),Te=c.getX(ye+1),We=c.getX(ye+2);d=N_(this,X,e,a,P,F,D,Me,Te,We),d&&(d.faceIndex=Math.floor(ye/3),d.face.materialIndex=$.materialIndex,t.push(d))}}else{const Z=Math.max(0,G.start),re=Math.min(c.count,G.start+G.count);for(let $=Z,X=re;$<X;$+=3){const me=c.getX($),le=c.getX($+1),ye=c.getX($+2);d=N_(this,_,e,a,P,F,D,me,le,ye),d&&(d.faceIndex=Math.floor($/3),t.push(d))}}else if(I!==void 0)if(Array.isArray(_))for(let Z=0,re=N.length;Z<re;Z++){const $=N[Z],X=_[$.materialIndex],me=Math.max($.start,G.start),le=Math.min(I.count,Math.min($.start+$.count,G.start+G.count));for(let ye=me,Le=le;ye<Le;ye+=3){const Me=ye,Te=ye+1,We=ye+2;d=N_(this,X,e,a,P,F,D,Me,Te,We),d&&(d.faceIndex=Math.floor(ye/3),d.face.materialIndex=$.materialIndex,t.push(d))}}else{const Z=Math.max(0,G.start),re=Math.min(I.count,G.start+G.count);for(let $=Z,X=re;$<X;$+=3){const me=$,le=$+1,ye=$+2;d=N_(this,_,e,a,P,F,D,me,le,ye),d&&(d.faceIndex=Math.floor($/3),t.push(d))}}}}function LD(l,e,t,a,d,g,_,c){let I;if(e.side===so?I=a.intersectTriangle(_,g,d,!0,c):I=a.intersectTriangle(d,g,_,e.side===xc,c),I===null)return null;D_.copy(c),D_.applyMatrix4(l.matrixWorld);const P=t.ray.origin.distanceTo(D_);return P<t.near||P>t.far?null:{distance:P,point:D_.clone(),object:l}}function N_(l,e,t,a,d,g,_,c,I,P){l.getVertexPosition(c,Ed),l.getVertexPosition(I,Td),l.getVertexPosition(P,Md);const F=LD(l,e,t,a,Ed,Td,Md,k_);if(F){d&&(R_.fromBufferAttribute(d,c),P_.fromBufferAttribute(d,I),L_.fromBufferAttribute(d,P),F.uv=_u.getInterpolation(k_,Ed,Td,Md,R_,P_,L_,new Pi)),g&&(R_.fromBufferAttribute(g,c),P_.fromBufferAttribute(g,I),L_.fromBufferAttribute(g,P),F.uv1=_u.getInterpolation(k_,Ed,Td,Md,R_,P_,L_,new Pi)),_&&(FS.fromBufferAttribute(_,c),zS.fromBufferAttribute(_,I),BS.fromBufferAttribute(_,P),F.normal=_u.getInterpolation(k_,Ed,Td,Md,FS,zS,BS,new lt),F.normal.dot(a.direction)>0&&F.normal.multiplyScalar(-1));const D={a:c,b:I,c:P,normal:new lt,materialIndex:0};_u.getNormal(Ed,Td,Md,D.normal),F.face=D}return F}class Um extends Au{constructor(e=1,t=1,a=1,d=1,g=1,_=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:a,widthSegments:d,heightSegments:g,depthSegments:_};const c=this;d=Math.floor(d),g=Math.floor(g),_=Math.floor(_);const I=[],P=[],F=[],D=[];let N=0,G=0;Z("z","y","x",-1,-1,a,t,e,_,g,0),Z("z","y","x",1,-1,a,t,-e,_,g,1),Z("x","z","y",1,1,e,a,t,d,_,2),Z("x","z","y",1,-1,e,a,-t,d,_,3),Z("x","y","z",1,-1,e,t,a,d,g,4),Z("x","y","z",-1,-1,e,t,-a,d,g,5),this.setIndex(I),this.setAttribute("position",new vc(P,3)),this.setAttribute("normal",new vc(F,3)),this.setAttribute("uv",new vc(D,2));function Z(re,$,X,me,le,ye,Le,Me,Te,We,de){const be=ye/Te,Oe=Le/We,vt=ye/2,st=Le/2,Je=Me/2,mt=Te+1,gt=We+1;let wt=0,yt=0;const Jt=new lt;for(let Tt=0;Tt<gt;Tt++){const jt=Tt*Oe-st;for(let Cn=0;Cn<mt;Cn++){const jn=Cn*be-vt;Jt[re]=jn*me,Jt[$]=jt*le,Jt[X]=Je,P.push(Jt.x,Jt.y,Jt.z),Jt[re]=0,Jt[$]=0,Jt[X]=Me>0?1:-1,F.push(Jt.x,Jt.y,Jt.z),D.push(Cn/Te),D.push(1-Tt/We),wt+=1}}for(let Tt=0;Tt<We;Tt++)for(let jt=0;jt<Te;jt++){const Cn=N+jt+mt*Tt,jn=N+jt+mt*(Tt+1),ht=N+(jt+1)+mt*(Tt+1),Ft=N+(jt+1)+mt*Tt;I.push(Cn,jn,Ft),I.push(jn,ht,Ft),yt+=6}c.addGroup(G,yt,de),G+=yt,N+=wt}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Um(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Qd(l){const e={};for(const t in l){e[t]={};for(const a in l[t]){const d=l[t][a];d&&(d.isColor||d.isMatrix3||d.isMatrix4||d.isVector2||d.isVector3||d.isVector4||d.isTexture||d.isQuaternion)?d.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][a]=null):e[t][a]=d.clone():Array.isArray(d)?e[t][a]=d.slice():e[t][a]=d}}return e}function Da(l){const e={};for(let t=0;t<l.length;t++){const a=Qd(l[t]);for(const d in a)e[d]=a[d]}return e}function kD(l){const e=[];for(let t=0;t<l.length;t++)e.push(l[t].clone());return e}function BM(l){const e=l.getRenderTarget();return e===null?l.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Ki.workingColorSpace}const DD={clone:Qd,merge:Da};var ND=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,OD=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class yh extends xu{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ND,this.fragmentShader=OD,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qd(e.uniforms),this.uniformsGroups=kD(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const d in this.uniforms){const _=this.uniforms[d].value;_&&_.isTexture?t.uniforms[d]={type:"t",value:_.toJSON(e).uuid}:_&&_.isColor?t.uniforms[d]={type:"c",value:_.getHex()}:_&&_.isVector2?t.uniforms[d]={type:"v2",value:_.toArray()}:_&&_.isVector3?t.uniforms[d]={type:"v3",value:_.toArray()}:_&&_.isVector4?t.uniforms[d]={type:"v4",value:_.toArray()}:_&&_.isMatrix3?t.uniforms[d]={type:"m3",value:_.toArray()}:_&&_.isMatrix4?t.uniforms[d]={type:"m4",value:_.toArray()}:t.uniforms[d]={value:_}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const a={};for(const d in this.extensions)this.extensions[d]===!0&&(a[d]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}class hb extends Jr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new xi,this.projectionMatrix=new xi,this.projectionMatrixInverse=new xi,this.coordinateSystem=yc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const lh=new lt,US=new Pi,VS=new Pi;class no extends hb{constructor(e=50,t=1,a=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=a,this.far=d,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Jd*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Tm*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Jd*2*Math.atan(Math.tan(Tm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,a){lh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(lh.x,lh.y).multiplyScalar(-e/lh.z),lh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),a.set(lh.x,lh.y).multiplyScalar(-e/lh.z)}getViewSize(e,t){return this.getViewBounds(e,US,VS),t.subVectors(VS,US)}setViewOffset(e,t,a,d,g,_){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=a,this.view.offsetY=d,this.view.width=g,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Tm*.5*this.fov)/this.zoom,a=2*t,d=this.aspect*a,g=-.5*d;const _=this.view;if(this.view!==null&&this.view.enabled){const I=_.fullWidth,P=_.fullHeight;g+=_.offsetX*d/I,t-=_.offsetY*a/P,d*=_.width/I,a*=_.height/P}const c=this.filmOffset;c!==0&&(g+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(g,g+d,t,t-a,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ad=-90,Id=1;class FD extends Jr{constructor(e,t,a){super(),this.type="CubeCamera",this.renderTarget=a,this.coordinateSystem=null,this.activeMipmapLevel=0;const d=new no(Ad,Id,e,t);d.layers=this.layers,this.add(d);const g=new no(Ad,Id,e,t);g.layers=this.layers,this.add(g);const _=new no(Ad,Id,e,t);_.layers=this.layers,this.add(_);const c=new no(Ad,Id,e,t);c.layers=this.layers,this.add(c);const I=new no(Ad,Id,e,t);I.layers=this.layers,this.add(I);const P=new no(Ad,Id,e,t);P.layers=this.layers,this.add(P)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[a,d,g,_,c,I]=t;for(const P of t)this.remove(P);if(e===yc)a.up.set(0,1,0),a.lookAt(1,0,0),d.up.set(0,1,0),d.lookAt(-1,0,0),g.up.set(0,0,-1),g.lookAt(0,1,0),_.up.set(0,0,1),_.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),I.up.set(0,1,0),I.lookAt(0,0,-1);else if(e===By)a.up.set(0,-1,0),a.lookAt(-1,0,0),d.up.set(0,-1,0),d.lookAt(1,0,0),g.up.set(0,0,1),g.lookAt(0,1,0),_.up.set(0,0,-1),_.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),I.up.set(0,-1,0),I.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const P of t)this.add(P),P.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:a,activeMipmapLevel:d}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[g,_,c,I,P,F]=this.children,D=e.getRenderTarget(),N=e.getActiveCubeFace(),G=e.getActiveMipmapLevel(),Z=e.xr.enabled;e.xr.enabled=!1;const re=a.texture.generateMipmaps;a.texture.generateMipmaps=!1,e.setRenderTarget(a,0,d),e.render(t,g),e.setRenderTarget(a,1,d),e.render(t,_),e.setRenderTarget(a,2,d),e.render(t,c),e.setRenderTarget(a,3,d),e.render(t,I),e.setRenderTarget(a,4,d),e.render(t,P),a.texture.generateMipmaps=re,e.setRenderTarget(a,5,d),e.render(t,F),e.setRenderTarget(D,N,G),e.xr.enabled=Z,a.texture.needsPMREMUpdate=!0}}class UM extends Hs{constructor(e,t,a,d,g,_,c,I,P,F){e=e!==void 0?e:[],t=t!==void 0?t:Xd,super(e,t,a,d,g,_,c,I,P,F),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class zD extends xf{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const a={width:e,height:e,depth:1},d=[a,a,a,a,a,a];this.texture=new UM(d,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Io}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const a={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},d=new Um(5,5,5),g=new yh({name:"CubemapFromEquirect",uniforms:Qd(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:so,blending:gh});g.uniforms.tEquirect.value=t;const _=new io(d,g),c=t.minFilter;return t.minFilter===_c&&(t.minFilter=Io),new FD(1,10,this).update(e,_),t.minFilter=c,_.geometry.dispose(),_.material.dispose(),this}clear(e,t,a,d){const g=e.getRenderTarget();for(let _=0;_<6;_++)e.setRenderTarget(this,_),e.clear(t,a,d);e.setRenderTarget(g)}}const J0=new lt,BD=new lt,UD=new Ei;class lf{constructor(e=new lt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,a,d){return this.normal.set(e,t,a),this.constant=d,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,a){const d=J0.subVectors(a,t).cross(BD.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(d,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const a=e.delta(J0),d=this.normal.dot(a);if(d===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const g=-(e.start.dot(this.normal)+this.constant)/d;return g<0||g>1?null:t.copy(e.start).addScaledVector(a,g)}intersectsLine(e){const t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return t<0&&a>0||a<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const a=t||UD.getNormalMatrix(e),d=this.coplanarPoint(J0).applyMatrix4(e),g=this.normal.applyMatrix3(a).normalize();return this.constant=-d.dot(g),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const rf=new Mu,O_=new lt;class fb{constructor(e=new lf,t=new lf,a=new lf,d=new lf,g=new lf,_=new lf){this.planes=[e,t,a,d,g,_]}set(e,t,a,d,g,_){const c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(a),c[3].copy(d),c[4].copy(g),c[5].copy(_),this}copy(e){const t=this.planes;for(let a=0;a<6;a++)t[a].copy(e.planes[a]);return this}setFromProjectionMatrix(e,t=yc){const a=this.planes,d=e.elements,g=d[0],_=d[1],c=d[2],I=d[3],P=d[4],F=d[5],D=d[6],N=d[7],G=d[8],Z=d[9],re=d[10],$=d[11],X=d[12],me=d[13],le=d[14],ye=d[15];if(a[0].setComponents(I-g,N-P,$-G,ye-X).normalize(),a[1].setComponents(I+g,N+P,$+G,ye+X).normalize(),a[2].setComponents(I+_,N+F,$+Z,ye+me).normalize(),a[3].setComponents(I-_,N-F,$-Z,ye-me).normalize(),a[4].setComponents(I-c,N-D,$-re,ye-le).normalize(),t===yc)a[5].setComponents(I+c,N+D,$+re,ye+le).normalize();else if(t===By)a[5].setComponents(c,D,re,le).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),rf.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),rf.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(rf)}intersectsSprite(e){return rf.center.set(0,0,0),rf.radius=.7071067811865476,rf.applyMatrix4(e.matrixWorld),this.intersectsSphere(rf)}intersectsSphere(e){const t=this.planes,a=e.center,d=-e.radius;for(let g=0;g<6;g++)if(t[g].distanceToPoint(a)<d)return!1;return!0}intersectsBox(e){const t=this.planes;for(let a=0;a<6;a++){const d=t[a];if(O_.x=d.normal.x>0?e.max.x:e.min.x,O_.y=d.normal.y>0?e.max.y:e.min.y,O_.z=d.normal.z>0?e.max.z:e.min.z,d.distanceToPoint(O_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let a=0;a<6;a++)if(t[a].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function VM(){let l=null,e=!1,t=null,a=null;function d(g,_){t(g,_),a=l.requestAnimationFrame(d)}return{start:function(){e!==!0&&t!==null&&(a=l.requestAnimationFrame(d),e=!0)},stop:function(){l.cancelAnimationFrame(a),e=!1},setAnimationLoop:function(g){t=g},setContext:function(g){l=g}}}function VD(l){const e=new WeakMap;function t(c,I){const P=c.array,F=c.usage,D=P.byteLength,N=l.createBuffer();l.bindBuffer(I,N),l.bufferData(I,P,F),c.onUploadCallback();let G;if(P instanceof Float32Array)G=l.FLOAT;else if(P instanceof Uint16Array)c.isFloat16BufferAttribute?G=l.HALF_FLOAT:G=l.UNSIGNED_SHORT;else if(P instanceof Int16Array)G=l.SHORT;else if(P instanceof Uint32Array)G=l.UNSIGNED_INT;else if(P instanceof Int32Array)G=l.INT;else if(P instanceof Int8Array)G=l.BYTE;else if(P instanceof Uint8Array)G=l.UNSIGNED_BYTE;else if(P instanceof Uint8ClampedArray)G=l.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+P);return{buffer:N,type:G,bytesPerElement:P.BYTES_PER_ELEMENT,version:c.version,size:D}}function a(c,I,P){const F=I.array,D=I._updateRange,N=I.updateRanges;if(l.bindBuffer(P,c),D.count===-1&&N.length===0&&l.bufferSubData(P,0,F),N.length!==0){for(let G=0,Z=N.length;G<Z;G++){const re=N[G];l.bufferSubData(P,re.start*F.BYTES_PER_ELEMENT,F,re.start,re.count)}I.clearUpdateRanges()}D.count!==-1&&(l.bufferSubData(P,D.offset*F.BYTES_PER_ELEMENT,F,D.offset,D.count),D.count=-1),I.onUploadCallback()}function d(c){return c.isInterleavedBufferAttribute&&(c=c.data),e.get(c)}function g(c){c.isInterleavedBufferAttribute&&(c=c.data);const I=e.get(c);I&&(l.deleteBuffer(I.buffer),e.delete(c))}function _(c,I){if(c.isInterleavedBufferAttribute&&(c=c.data),c.isGLBufferAttribute){const F=e.get(c);(!F||F.version<c.version)&&e.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}const P=e.get(c);if(P===void 0)e.set(c,t(c,I));else if(P.version<c.version){if(P.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");a(P.buffer,c,I),P.version=c.version}}return{get:d,remove:g,update:_}}class Vm extends Au{constructor(e=1,t=1,a=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:a,heightSegments:d};const g=e/2,_=t/2,c=Math.floor(a),I=Math.floor(d),P=c+1,F=I+1,D=e/c,N=t/I,G=[],Z=[],re=[],$=[];for(let X=0;X<F;X++){const me=X*N-_;for(let le=0;le<P;le++){const ye=le*D-g;Z.push(ye,-me,0),re.push(0,0,1),$.push(le/c),$.push(1-X/I)}}for(let X=0;X<I;X++)for(let me=0;me<c;me++){const le=me+P*X,ye=me+P*(X+1),Le=me+1+P*(X+1),Me=me+1+P*X;G.push(le,ye,Me),G.push(ye,Le,Me)}this.setIndex(G),this.setAttribute("position",new vc(Z,3)),this.setAttribute("normal",new vc(re,3)),this.setAttribute("uv",new vc($,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vm(e.width,e.height,e.widthSegments,e.heightSegments)}}var GD=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,HD=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,WD=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,qD=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$D=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,XD=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,jD=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,ZD=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,YD=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,KD=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,JD=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,QD=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,eN=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,tN=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,nN=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,iN=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,rN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,sN=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,aN=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,oN=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,lN=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,uN=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,cN=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,hN=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,fN=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dN=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,pN=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,mN=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,gN=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,_N=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,yN="gl_FragColor = linearToOutputTexel( gl_FragColor );",vN=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,xN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,bN=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,wN=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,SN=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,EN=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,TN=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,MN=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,AN=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,IN=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,CN=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,RN=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,PN=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,LN=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,kN=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,DN=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,NN=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,ON=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,FN=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,zN=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,BN=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,UN=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,VN=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,GN=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,HN=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,WN=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,qN=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$N=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,XN=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,jN=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ZN=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,YN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,KN=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,JN=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QN=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,eO=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,tO=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,nO=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,iO=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,rO=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,sO=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,aO=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,oO=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,lO=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uO=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,cO=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,hO=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,fO=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,dO=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,pO=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,mO=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,gO=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,_O=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,yO=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,vO=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,xO=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,bO=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,wO=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,SO=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,EO=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,TO=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,MO=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,AO=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,IO=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,CO=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,RO=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,PO=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,LO=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,kO=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,DO=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NO=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,OO=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,FO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,zO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,BO=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,UO=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const VO=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,GO=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,HO=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,WO=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qO=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$O=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,XO=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,jO=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,ZO=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,YO=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,KO=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,JO=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QO=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eF=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,tF=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,nF=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iF=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rF=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sF=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,aF=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oF=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,lF=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,uF=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,cF=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hF=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fF=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dF=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pF=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mF=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,gF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,_F=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yF=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vF=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Si={alphahash_fragment:GD,alphahash_pars_fragment:HD,alphamap_fragment:WD,alphamap_pars_fragment:qD,alphatest_fragment:$D,alphatest_pars_fragment:XD,aomap_fragment:jD,aomap_pars_fragment:ZD,batching_pars_vertex:YD,batching_vertex:KD,begin_vertex:JD,beginnormal_vertex:QD,bsdfs:eN,iridescence_fragment:tN,bumpmap_pars_fragment:nN,clipping_planes_fragment:iN,clipping_planes_pars_fragment:rN,clipping_planes_pars_vertex:sN,clipping_planes_vertex:aN,color_fragment:oN,color_pars_fragment:lN,color_pars_vertex:uN,color_vertex:cN,common:hN,cube_uv_reflection_fragment:fN,defaultnormal_vertex:dN,displacementmap_pars_vertex:pN,displacementmap_vertex:mN,emissivemap_fragment:gN,emissivemap_pars_fragment:_N,colorspace_fragment:yN,colorspace_pars_fragment:vN,envmap_fragment:xN,envmap_common_pars_fragment:bN,envmap_pars_fragment:wN,envmap_pars_vertex:SN,envmap_physical_pars_fragment:DN,envmap_vertex:EN,fog_vertex:TN,fog_pars_vertex:MN,fog_fragment:AN,fog_pars_fragment:IN,gradientmap_pars_fragment:CN,lightmap_pars_fragment:RN,lights_lambert_fragment:PN,lights_lambert_pars_fragment:LN,lights_pars_begin:kN,lights_toon_fragment:NN,lights_toon_pars_fragment:ON,lights_phong_fragment:FN,lights_phong_pars_fragment:zN,lights_physical_fragment:BN,lights_physical_pars_fragment:UN,lights_fragment_begin:VN,lights_fragment_maps:GN,lights_fragment_end:HN,logdepthbuf_fragment:WN,logdepthbuf_pars_fragment:qN,logdepthbuf_pars_vertex:$N,logdepthbuf_vertex:XN,map_fragment:jN,map_pars_fragment:ZN,map_particle_fragment:YN,map_particle_pars_fragment:KN,metalnessmap_fragment:JN,metalnessmap_pars_fragment:QN,morphinstance_vertex:eO,morphcolor_vertex:tO,morphnormal_vertex:nO,morphtarget_pars_vertex:iO,morphtarget_vertex:rO,normal_fragment_begin:sO,normal_fragment_maps:aO,normal_pars_fragment:oO,normal_pars_vertex:lO,normal_vertex:uO,normalmap_pars_fragment:cO,clearcoat_normal_fragment_begin:hO,clearcoat_normal_fragment_maps:fO,clearcoat_pars_fragment:dO,iridescence_pars_fragment:pO,opaque_fragment:mO,packing:gO,premultiplied_alpha_fragment:_O,project_vertex:yO,dithering_fragment:vO,dithering_pars_fragment:xO,roughnessmap_fragment:bO,roughnessmap_pars_fragment:wO,shadowmap_pars_fragment:SO,shadowmap_pars_vertex:EO,shadowmap_vertex:TO,shadowmask_pars_fragment:MO,skinbase_vertex:AO,skinning_pars_vertex:IO,skinning_vertex:CO,skinnormal_vertex:RO,specularmap_fragment:PO,specularmap_pars_fragment:LO,tonemapping_fragment:kO,tonemapping_pars_fragment:DO,transmission_fragment:NO,transmission_pars_fragment:OO,uv_pars_fragment:FO,uv_pars_vertex:zO,uv_vertex:BO,worldpos_vertex:UO,background_vert:VO,background_frag:GO,backgroundCube_vert:HO,backgroundCube_frag:WO,cube_vert:qO,cube_frag:$O,depth_vert:XO,depth_frag:jO,distanceRGBA_vert:ZO,distanceRGBA_frag:YO,equirect_vert:KO,equirect_frag:JO,linedashed_vert:QO,linedashed_frag:eF,meshbasic_vert:tF,meshbasic_frag:nF,meshlambert_vert:iF,meshlambert_frag:rF,meshmatcap_vert:sF,meshmatcap_frag:aF,meshnormal_vert:oF,meshnormal_frag:lF,meshphong_vert:uF,meshphong_frag:cF,meshphysical_vert:hF,meshphysical_frag:fF,meshtoon_vert:dF,meshtoon_frag:pF,points_vert:mF,points_frag:gF,shadow_vert:_F,shadow_frag:yF,sprite_vert:vF,sprite_frag:xF},xn={common:{diffuse:{value:new _i(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ei},alphaMap:{value:null},alphaMapTransform:{value:new Ei},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ei}},envmap:{envMap:{value:null},envMapRotation:{value:new Ei},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ei}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ei}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ei},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ei},normalScale:{value:new Pi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ei},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ei}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ei}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ei}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new _i(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new _i(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ei},alphaTest:{value:0},uvTransform:{value:new Ei}},sprite:{diffuse:{value:new _i(16777215)},opacity:{value:1},center:{value:new Pi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ei},alphaMap:{value:null},alphaMapTransform:{value:new Ei},alphaTest:{value:0}}},gu={basic:{uniforms:Da([xn.common,xn.specularmap,xn.envmap,xn.aomap,xn.lightmap,xn.fog]),vertexShader:Si.meshbasic_vert,fragmentShader:Si.meshbasic_frag},lambert:{uniforms:Da([xn.common,xn.specularmap,xn.envmap,xn.aomap,xn.lightmap,xn.emissivemap,xn.bumpmap,xn.normalmap,xn.displacementmap,xn.fog,xn.lights,{emissive:{value:new _i(0)}}]),vertexShader:Si.meshlambert_vert,fragmentShader:Si.meshlambert_frag},phong:{uniforms:Da([xn.common,xn.specularmap,xn.envmap,xn.aomap,xn.lightmap,xn.emissivemap,xn.bumpmap,xn.normalmap,xn.displacementmap,xn.fog,xn.lights,{emissive:{value:new _i(0)},specular:{value:new _i(1118481)},shininess:{value:30}}]),vertexShader:Si.meshphong_vert,fragmentShader:Si.meshphong_frag},standard:{uniforms:Da([xn.common,xn.envmap,xn.aomap,xn.lightmap,xn.emissivemap,xn.bumpmap,xn.normalmap,xn.displacementmap,xn.roughnessmap,xn.metalnessmap,xn.fog,xn.lights,{emissive:{value:new _i(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Si.meshphysical_vert,fragmentShader:Si.meshphysical_frag},toon:{uniforms:Da([xn.common,xn.aomap,xn.lightmap,xn.emissivemap,xn.bumpmap,xn.normalmap,xn.displacementmap,xn.gradientmap,xn.fog,xn.lights,{emissive:{value:new _i(0)}}]),vertexShader:Si.meshtoon_vert,fragmentShader:Si.meshtoon_frag},matcap:{uniforms:Da([xn.common,xn.bumpmap,xn.normalmap,xn.displacementmap,xn.fog,{matcap:{value:null}}]),vertexShader:Si.meshmatcap_vert,fragmentShader:Si.meshmatcap_frag},points:{uniforms:Da([xn.points,xn.fog]),vertexShader:Si.points_vert,fragmentShader:Si.points_frag},dashed:{uniforms:Da([xn.common,xn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Si.linedashed_vert,fragmentShader:Si.linedashed_frag},depth:{uniforms:Da([xn.common,xn.displacementmap]),vertexShader:Si.depth_vert,fragmentShader:Si.depth_frag},normal:{uniforms:Da([xn.common,xn.bumpmap,xn.normalmap,xn.displacementmap,{opacity:{value:1}}]),vertexShader:Si.meshnormal_vert,fragmentShader:Si.meshnormal_frag},sprite:{uniforms:Da([xn.sprite,xn.fog]),vertexShader:Si.sprite_vert,fragmentShader:Si.sprite_frag},background:{uniforms:{uvTransform:{value:new Ei},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Si.background_vert,fragmentShader:Si.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ei}},vertexShader:Si.backgroundCube_vert,fragmentShader:Si.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Si.cube_vert,fragmentShader:Si.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Si.equirect_vert,fragmentShader:Si.equirect_frag},distanceRGBA:{uniforms:Da([xn.common,xn.displacementmap,{referencePosition:{value:new lt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Si.distanceRGBA_vert,fragmentShader:Si.distanceRGBA_frag},shadow:{uniforms:Da([xn.lights,xn.fog,{color:{value:new _i(0)},opacity:{value:1}}]),vertexShader:Si.shadow_vert,fragmentShader:Si.shadow_frag}};gu.physical={uniforms:Da([gu.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ei},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ei},clearcoatNormalScale:{value:new Pi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ei},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ei},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ei},sheen:{value:0},sheenColor:{value:new _i(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ei},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ei},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ei},transmissionSamplerSize:{value:new Pi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ei},attenuationDistance:{value:0},attenuationColor:{value:new _i(0)},specularColor:{value:new _i(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ei},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ei},anisotropyVector:{value:new Pi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ei}}]),vertexShader:Si.meshphysical_vert,fragmentShader:Si.meshphysical_frag};const F_={r:0,b:0,g:0},sf=new Su,bF=new xi;function wF(l,e,t,a,d,g,_){const c=new _i(0);let I=g===!0?0:1,P,F,D=null,N=0,G=null;function Z(me){let le=me.isScene===!0?me.background:null;return le&&le.isTexture&&(le=(me.backgroundBlurriness>0?t:e).get(le)),le}function re(me){let le=!1;const ye=Z(me);ye===null?X(c,I):ye&&ye.isColor&&(X(ye,1),le=!0);const Le=l.xr.getEnvironmentBlendMode();Le==="additive"?a.buffers.color.setClear(0,0,0,1,_):Le==="alpha-blend"&&a.buffers.color.setClear(0,0,0,0,_),(l.autoClear||le)&&(a.buffers.depth.setTest(!0),a.buffers.depth.setMask(!0),a.buffers.color.setMask(!0),l.clear(l.autoClearColor,l.autoClearDepth,l.autoClearStencil))}function $(me,le){const ye=Z(le);ye&&(ye.isCubeTexture||ye.mapping===Yy)?(F===void 0&&(F=new io(new Um(1,1,1),new yh({name:"BackgroundCubeMaterial",uniforms:Qd(gu.backgroundCube.uniforms),vertexShader:gu.backgroundCube.vertexShader,fragmentShader:gu.backgroundCube.fragmentShader,side:so,depthTest:!1,depthWrite:!1,fog:!1})),F.geometry.deleteAttribute("normal"),F.geometry.deleteAttribute("uv"),F.onBeforeRender=function(Le,Me,Te){this.matrixWorld.copyPosition(Te.matrixWorld)},Object.defineProperty(F.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),d.update(F)),sf.copy(le.backgroundRotation),sf.x*=-1,sf.y*=-1,sf.z*=-1,ye.isCubeTexture&&ye.isRenderTargetTexture===!1&&(sf.y*=-1,sf.z*=-1),F.material.uniforms.envMap.value=ye,F.material.uniforms.flipEnvMap.value=ye.isCubeTexture&&ye.isRenderTargetTexture===!1?-1:1,F.material.uniforms.backgroundBlurriness.value=le.backgroundBlurriness,F.material.uniforms.backgroundIntensity.value=le.backgroundIntensity,F.material.uniforms.backgroundRotation.value.setFromMatrix4(bF.makeRotationFromEuler(sf)),F.material.toneMapped=Ki.getTransfer(ye.colorSpace)!==Dr,(D!==ye||N!==ye.version||G!==l.toneMapping)&&(F.material.needsUpdate=!0,D=ye,N=ye.version,G=l.toneMapping),F.layers.enableAll(),me.unshift(F,F.geometry,F.material,0,0,null)):ye&&ye.isTexture&&(P===void 0&&(P=new io(new Vm(2,2),new yh({name:"BackgroundMaterial",uniforms:Qd(gu.background.uniforms),vertexShader:gu.background.vertexShader,fragmentShader:gu.background.fragmentShader,side:xc,depthTest:!1,depthWrite:!1,fog:!1})),P.geometry.deleteAttribute("normal"),Object.defineProperty(P.material,"map",{get:function(){return this.uniforms.t2D.value}}),d.update(P)),P.material.uniforms.t2D.value=ye,P.material.uniforms.backgroundIntensity.value=le.backgroundIntensity,P.material.toneMapped=Ki.getTransfer(ye.colorSpace)!==Dr,ye.matrixAutoUpdate===!0&&ye.updateMatrix(),P.material.uniforms.uvTransform.value.copy(ye.matrix),(D!==ye||N!==ye.version||G!==l.toneMapping)&&(P.material.needsUpdate=!0,D=ye,N=ye.version,G=l.toneMapping),P.layers.enableAll(),me.unshift(P,P.geometry,P.material,0,0,null))}function X(me,le){me.getRGB(F_,BM(l)),a.buffers.color.setClear(F_.r,F_.g,F_.b,le,_)}return{getClearColor:function(){return c},setClearColor:function(me,le=1){c.set(me),I=le,X(c,I)},getClearAlpha:function(){return I},setClearAlpha:function(me){I=me,X(c,I)},render:re,addToRenderList:$}}function SF(l,e){const t=l.getParameter(l.MAX_VERTEX_ATTRIBS),a={},d=N(null);let g=d,_=!1;function c(be,Oe,vt,st,Je){let mt=!1;const gt=D(st,vt,Oe);g!==gt&&(g=gt,P(g.object)),mt=G(be,st,vt,Je),mt&&Z(be,st,vt,Je),Je!==null&&e.update(Je,l.ELEMENT_ARRAY_BUFFER),(mt||_)&&(_=!1,ye(be,Oe,vt,st),Je!==null&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e.get(Je).buffer))}function I(){return l.createVertexArray()}function P(be){return l.bindVertexArray(be)}function F(be){return l.deleteVertexArray(be)}function D(be,Oe,vt){const st=vt.wireframe===!0;let Je=a[be.id];Je===void 0&&(Je={},a[be.id]=Je);let mt=Je[Oe.id];mt===void 0&&(mt={},Je[Oe.id]=mt);let gt=mt[st];return gt===void 0&&(gt=N(I()),mt[st]=gt),gt}function N(be){const Oe=[],vt=[],st=[];for(let Je=0;Je<t;Je++)Oe[Je]=0,vt[Je]=0,st[Je]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Oe,enabledAttributes:vt,attributeDivisors:st,object:be,attributes:{},index:null}}function G(be,Oe,vt,st){const Je=g.attributes,mt=Oe.attributes;let gt=0;const wt=vt.getAttributes();for(const yt in wt)if(wt[yt].location>=0){const Tt=Je[yt];let jt=mt[yt];if(jt===void 0&&(yt==="instanceMatrix"&&be.instanceMatrix&&(jt=be.instanceMatrix),yt==="instanceColor"&&be.instanceColor&&(jt=be.instanceColor)),Tt===void 0||Tt.attribute!==jt||jt&&Tt.data!==jt.data)return!0;gt++}return g.attributesNum!==gt||g.index!==st}function Z(be,Oe,vt,st){const Je={},mt=Oe.attributes;let gt=0;const wt=vt.getAttributes();for(const yt in wt)if(wt[yt].location>=0){let Tt=mt[yt];Tt===void 0&&(yt==="instanceMatrix"&&be.instanceMatrix&&(Tt=be.instanceMatrix),yt==="instanceColor"&&be.instanceColor&&(Tt=be.instanceColor));const jt={};jt.attribute=Tt,Tt&&Tt.data&&(jt.data=Tt.data),Je[yt]=jt,gt++}g.attributes=Je,g.attributesNum=gt,g.index=st}function re(){const be=g.newAttributes;for(let Oe=0,vt=be.length;Oe<vt;Oe++)be[Oe]=0}function $(be){X(be,0)}function X(be,Oe){const vt=g.newAttributes,st=g.enabledAttributes,Je=g.attributeDivisors;vt[be]=1,st[be]===0&&(l.enableVertexAttribArray(be),st[be]=1),Je[be]!==Oe&&(l.vertexAttribDivisor(be,Oe),Je[be]=Oe)}function me(){const be=g.newAttributes,Oe=g.enabledAttributes;for(let vt=0,st=Oe.length;vt<st;vt++)Oe[vt]!==be[vt]&&(l.disableVertexAttribArray(vt),Oe[vt]=0)}function le(be,Oe,vt,st,Je,mt,gt){gt===!0?l.vertexAttribIPointer(be,Oe,vt,Je,mt):l.vertexAttribPointer(be,Oe,vt,st,Je,mt)}function ye(be,Oe,vt,st){re();const Je=st.attributes,mt=vt.getAttributes(),gt=Oe.defaultAttributeValues;for(const wt in mt){const yt=mt[wt];if(yt.location>=0){let Jt=Je[wt];if(Jt===void 0&&(wt==="instanceMatrix"&&be.instanceMatrix&&(Jt=be.instanceMatrix),wt==="instanceColor"&&be.instanceColor&&(Jt=be.instanceColor)),Jt!==void 0){const Tt=Jt.normalized,jt=Jt.itemSize,Cn=e.get(Jt);if(Cn===void 0)continue;const jn=Cn.buffer,ht=Cn.type,Ft=Cn.bytesPerElement,mn=ht===l.INT||ht===l.UNSIGNED_INT||Jt.gpuType===nb;if(Jt.isInterleavedBufferAttribute){const cn=Jt.data,qe=cn.stride,Wn=Jt.offset;if(cn.isInstancedInterleavedBuffer){for(let bn=0;bn<yt.locationSize;bn++)X(yt.location+bn,cn.meshPerAttribute);be.isInstancedMesh!==!0&&st._maxInstanceCount===void 0&&(st._maxInstanceCount=cn.meshPerAttribute*cn.count)}else for(let bn=0;bn<yt.locationSize;bn++)$(yt.location+bn);l.bindBuffer(l.ARRAY_BUFFER,jn);for(let bn=0;bn<yt.locationSize;bn++)le(yt.location+bn,jt/yt.locationSize,ht,Tt,qe*Ft,(Wn+jt/yt.locationSize*bn)*Ft,mn)}else{if(Jt.isInstancedBufferAttribute){for(let cn=0;cn<yt.locationSize;cn++)X(yt.location+cn,Jt.meshPerAttribute);be.isInstancedMesh!==!0&&st._maxInstanceCount===void 0&&(st._maxInstanceCount=Jt.meshPerAttribute*Jt.count)}else for(let cn=0;cn<yt.locationSize;cn++)$(yt.location+cn);l.bindBuffer(l.ARRAY_BUFFER,jn);for(let cn=0;cn<yt.locationSize;cn++)le(yt.location+cn,jt/yt.locationSize,ht,Tt,jt*Ft,jt/yt.locationSize*cn*Ft,mn)}}else if(gt!==void 0){const Tt=gt[wt];if(Tt!==void 0)switch(Tt.length){case 2:l.vertexAttrib2fv(yt.location,Tt);break;case 3:l.vertexAttrib3fv(yt.location,Tt);break;case 4:l.vertexAttrib4fv(yt.location,Tt);break;default:l.vertexAttrib1fv(yt.location,Tt)}}}}me()}function Le(){We();for(const be in a){const Oe=a[be];for(const vt in Oe){const st=Oe[vt];for(const Je in st)F(st[Je].object),delete st[Je];delete Oe[vt]}delete a[be]}}function Me(be){if(a[be.id]===void 0)return;const Oe=a[be.id];for(const vt in Oe){const st=Oe[vt];for(const Je in st)F(st[Je].object),delete st[Je];delete Oe[vt]}delete a[be.id]}function Te(be){for(const Oe in a){const vt=a[Oe];if(vt[be.id]===void 0)continue;const st=vt[be.id];for(const Je in st)F(st[Je].object),delete st[Je];delete vt[be.id]}}function We(){de(),_=!0,g!==d&&(g=d,P(g.object))}function de(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:c,reset:We,resetDefaultState:de,dispose:Le,releaseStatesOfGeometry:Me,releaseStatesOfProgram:Te,initAttributes:re,enableAttribute:$,disableUnusedAttributes:me}}function EF(l,e,t){let a;function d(P){a=P}function g(P,F){l.drawArrays(a,P,F),t.update(F,a,1)}function _(P,F,D){D!==0&&(l.drawArraysInstanced(a,P,F,D),t.update(F,a,D))}function c(P,F,D){if(D===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(a,P,0,F,0,D);let G=0;for(let Z=0;Z<D;Z++)G+=F[Z];t.update(G,a,1)}function I(P,F,D,N){if(D===0)return;const G=e.get("WEBGL_multi_draw");if(G===null)for(let Z=0;Z<P.length;Z++)_(P[Z],F[Z],N[Z]);else{G.multiDrawArraysInstancedWEBGL(a,P,0,F,0,N,0,D);let Z=0;for(let re=0;re<D;re++)Z+=F[re];for(let re=0;re<N.length;re++)t.update(Z,a,N[re])}}this.setMode=d,this.render=g,this.renderInstances=_,this.renderMultiDraw=c,this.renderMultiDrawInstances=I}function TF(l,e,t,a){let d;function g(){if(d!==void 0)return d;if(e.has("EXT_texture_filter_anisotropic")===!0){const Me=e.get("EXT_texture_filter_anisotropic");d=l.getParameter(Me.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else d=0;return d}function _(Me){return!(Me!==Yo&&a.convert(Me)!==l.getParameter(l.IMPLEMENTATION_COLOR_READ_FORMAT))}function c(Me){const Te=Me===Bm&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(Me!==bc&&a.convert(Me)!==l.getParameter(l.IMPLEMENTATION_COLOR_READ_TYPE)&&Me!==Rl&&!Te)}function I(Me){if(Me==="highp"){if(l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.HIGH_FLOAT).precision>0&&l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT).precision>0)return"highp";Me="mediump"}return Me==="mediump"&&l.getShaderPrecisionFormat(l.VERTEX_SHADER,l.MEDIUM_FLOAT).precision>0&&l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let P=t.precision!==void 0?t.precision:"highp";const F=I(P);F!==P&&(console.warn("THREE.WebGLRenderer:",P,"not supported, using",F,"instead."),P=F);const D=t.logarithmicDepthBuffer===!0,N=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS),G=l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Z=l.getParameter(l.MAX_TEXTURE_SIZE),re=l.getParameter(l.MAX_CUBE_MAP_TEXTURE_SIZE),$=l.getParameter(l.MAX_VERTEX_ATTRIBS),X=l.getParameter(l.MAX_VERTEX_UNIFORM_VECTORS),me=l.getParameter(l.MAX_VARYING_VECTORS),le=l.getParameter(l.MAX_FRAGMENT_UNIFORM_VECTORS),ye=G>0,Le=l.getParameter(l.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:g,getMaxPrecision:I,textureFormatReadable:_,textureTypeReadable:c,precision:P,logarithmicDepthBuffer:D,maxTextures:N,maxVertexTextures:G,maxTextureSize:Z,maxCubemapSize:re,maxAttributes:$,maxVertexUniforms:X,maxVaryings:me,maxFragmentUniforms:le,vertexTextures:ye,maxSamples:Le}}function MF(l){const e=this;let t=null,a=0,d=!1,g=!1;const _=new lf,c=new Ei,I={value:null,needsUpdate:!1};this.uniform=I,this.numPlanes=0,this.numIntersection=0,this.init=function(D,N){const G=D.length!==0||N||a!==0||d;return d=N,a=D.length,G},this.beginShadows=function(){g=!0,F(null)},this.endShadows=function(){g=!1},this.setGlobalState=function(D,N){t=F(D,N,0)},this.setState=function(D,N,G){const Z=D.clippingPlanes,re=D.clipIntersection,$=D.clipShadows,X=l.get(D);if(!d||Z===null||Z.length===0||g&&!$)g?F(null):P();else{const me=g?0:a,le=me*4;let ye=X.clippingState||null;I.value=ye,ye=F(Z,N,le,G);for(let Le=0;Le!==le;++Le)ye[Le]=t[Le];X.clippingState=ye,this.numIntersection=re?this.numPlanes:0,this.numPlanes+=me}};function P(){I.value!==t&&(I.value=t,I.needsUpdate=a>0),e.numPlanes=a,e.numIntersection=0}function F(D,N,G,Z){const re=D!==null?D.length:0;let $=null;if(re!==0){if($=I.value,Z!==!0||$===null){const X=G+re*4,me=N.matrixWorldInverse;c.getNormalMatrix(me),($===null||$.length<X)&&($=new Float32Array(X));for(let le=0,ye=G;le!==re;++le,ye+=4)_.copy(D[le]).applyMatrix4(me,c),_.normal.toArray($,ye),$[ye+3]=_.constant}I.value=$,I.needsUpdate=!0}return e.numPlanes=re,e.numIntersection=0,$}}function AF(l){let e=new WeakMap;function t(_,c){return c===Xx?_.mapping=Xd:c===jx&&(_.mapping=jd),_}function a(_){if(_&&_.isTexture){const c=_.mapping;if(c===Xx||c===jx)if(e.has(_)){const I=e.get(_).texture;return t(I,_.mapping)}else{const I=_.image;if(I&&I.height>0){const P=new zD(I.height);return P.fromEquirectangularTexture(l,_),e.set(_,P),_.addEventListener("dispose",d),t(P.texture,_.mapping)}else return null}}return _}function d(_){const c=_.target;c.removeEventListener("dispose",d);const I=e.get(c);I!==void 0&&(e.delete(c),I.dispose())}function g(){e=new WeakMap}return{get:a,dispose:g}}class db extends hb{constructor(e=-1,t=1,a=1,d=-1,g=.1,_=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=a,this.bottom=d,this.near=g,this.far=_,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,a,d,g,_){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=a,this.view.offsetY=d,this.view.width=g,this.view.height=_,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let g=a-e,_=a+e,c=d+t,I=d-t;if(this.view!==null&&this.view.enabled){const P=(this.right-this.left)/this.view.fullWidth/this.zoom,F=(this.top-this.bottom)/this.view.fullHeight/this.zoom;g+=P*this.view.offsetX,_=g+P*this.view.width,c-=F*this.view.offsetY,I=c-F*this.view.height}this.projectionMatrix.makeOrthographic(g,_,c,I,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const kd=4,GS=[.125,.215,.35,.446,.526,.582],hf=20,Q0=new db,HS=new _i;let ex=null,tx=0,nx=0,ix=!1;const uf=(1+Math.sqrt(5))/2,Cd=1/uf,WS=[new lt(-uf,Cd,0),new lt(uf,Cd,0),new lt(-Cd,0,uf),new lt(Cd,0,uf),new lt(0,uf,-Cd),new lt(0,uf,Cd),new lt(-1,1,-1),new lt(1,1,-1),new lt(-1,1,1),new lt(1,1,1)];class qS{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,a=.1,d=100){ex=this._renderer.getRenderTarget(),tx=this._renderer.getActiveCubeFace(),nx=this._renderer.getActiveMipmapLevel(),ix=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const g=this._allocateTargets();return g.depthBuffer=!0,this._sceneToCubeUV(e,a,d,g),t>0&&this._blur(g,0,0,t),this._applyPMREM(g),this._cleanup(g),g}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=jS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=XS(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ex,tx,nx),this._renderer.xr.enabled=ix,e.scissorTest=!1,z_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Xd||e.mapping===jd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ex=this._renderer.getRenderTarget(),tx=this._renderer.getActiveCubeFace(),nx=this._renderer.getActiveMipmapLevel(),ix=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const a=t||this._allocateTargets();return this._textureToCubeUV(e,a),this._applyPMREM(a),this._cleanup(a),a}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,a={magFilter:Io,minFilter:Io,generateMipmaps:!1,type:Bm,format:Yo,colorSpace:ia,depthBuffer:!1},d=$S(e,t,a);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$S(e,t,a);const{_lodMax:g}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=IF(g)),this._blurMaterial=CF(g,e,t)}return d}_compileMaterial(e){const t=new io(this._lodPlanes[0],e);this._renderer.compile(t,Q0)}_sceneToCubeUV(e,t,a,d){const c=new no(90,1,t,a),I=[1,-1,1,1,1,1],P=[1,1,1,-1,-1,-1],F=this._renderer,D=F.autoClear,N=F.toneMapping;F.getClearColor(HS),F.toneMapping=_h,F.autoClear=!1;const G=new ph({name:"PMREM.Background",side:so,depthWrite:!1,depthTest:!1}),Z=new io(new Um,G);let re=!1;const $=e.background;$?$.isColor&&(G.color.copy($),e.background=null,re=!0):(G.color.copy(HS),re=!0);for(let X=0;X<6;X++){const me=X%3;me===0?(c.up.set(0,I[X],0),c.lookAt(P[X],0,0)):me===1?(c.up.set(0,0,I[X]),c.lookAt(0,P[X],0)):(c.up.set(0,I[X],0),c.lookAt(0,0,P[X]));const le=this._cubeSize;z_(d,me*le,X>2?le:0,le,le),F.setRenderTarget(d),re&&F.render(Z,c),F.render(e,c)}Z.geometry.dispose(),Z.material.dispose(),F.toneMapping=N,F.autoClear=D,e.background=$}_textureToCubeUV(e,t){const a=this._renderer,d=e.mapping===Xd||e.mapping===jd;d?(this._cubemapMaterial===null&&(this._cubemapMaterial=jS()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=XS());const g=d?this._cubemapMaterial:this._equirectMaterial,_=new io(this._lodPlanes[0],g),c=g.uniforms;c.envMap.value=e;const I=this._cubeSize;z_(t,0,0,3*I,2*I),a.setRenderTarget(t),a.render(_,Q0)}_applyPMREM(e){const t=this._renderer,a=t.autoClear;t.autoClear=!1;const d=this._lodPlanes.length;for(let g=1;g<d;g++){const _=Math.sqrt(this._sigmas[g]*this._sigmas[g]-this._sigmas[g-1]*this._sigmas[g-1]),c=WS[(d-g-1)%WS.length];this._blur(e,g-1,g,_,c)}t.autoClear=a}_blur(e,t,a,d,g){const _=this._pingPongRenderTarget;this._halfBlur(e,_,t,a,d,"latitudinal",g),this._halfBlur(_,e,a,a,d,"longitudinal",g)}_halfBlur(e,t,a,d,g,_,c){const I=this._renderer,P=this._blurMaterial;_!=="latitudinal"&&_!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const F=3,D=new io(this._lodPlanes[d],P),N=P.uniforms,G=this._sizeLods[a]-1,Z=isFinite(g)?Math.PI/(2*G):2*Math.PI/(2*hf-1),re=g/Z,$=isFinite(g)?1+Math.floor(F*re):hf;$>hf&&console.warn(`sigmaRadians, ${g}, is too large and will clip, as it requested ${$} samples when the maximum is set to ${hf}`);const X=[];let me=0;for(let Te=0;Te<hf;++Te){const We=Te/re,de=Math.exp(-We*We/2);X.push(de),Te===0?me+=de:Te<$&&(me+=2*de)}for(let Te=0;Te<X.length;Te++)X[Te]=X[Te]/me;N.envMap.value=e.texture,N.samples.value=$,N.weights.value=X,N.latitudinal.value=_==="latitudinal",c&&(N.poleAxis.value=c);const{_lodMax:le}=this;N.dTheta.value=Z,N.mipInt.value=le-a;const ye=this._sizeLods[d],Le=3*ye*(d>le-kd?d-le+kd:0),Me=4*(this._cubeSize-ye);z_(t,Le,Me,3*ye,2*ye),I.setRenderTarget(t),I.render(D,Q0)}}function IF(l){const e=[],t=[],a=[];let d=l;const g=l-kd+1+GS.length;for(let _=0;_<g;_++){const c=Math.pow(2,d);t.push(c);let I=1/c;_>l-kd?I=GS[_-l+kd-1]:_===0&&(I=0),a.push(I);const P=1/(c-2),F=-P,D=1+P,N=[F,F,D,F,D,D,F,F,D,D,F,D],G=6,Z=6,re=3,$=2,X=1,me=new Float32Array(re*Z*G),le=new Float32Array($*Z*G),ye=new Float32Array(X*Z*G);for(let Me=0;Me<G;Me++){const Te=Me%3*2/3-1,We=Me>2?0:-1,de=[Te,We,0,Te+2/3,We,0,Te+2/3,We+1,0,Te,We,0,Te+2/3,We+1,0,Te,We+1,0];me.set(de,re*Z*Me),le.set(N,$*Z*Me);const be=[Me,Me,Me,Me,Me,Me];ye.set(be,X*Z*Me)}const Le=new Au;Le.setAttribute("position",new Fa(me,re)),Le.setAttribute("uv",new Fa(le,$)),Le.setAttribute("faceIndex",new Fa(ye,X)),e.push(Le),d>kd&&d--}return{lodPlanes:e,sizeLods:t,sigmas:a}}function $S(l,e,t){const a=new xf(l,e,t);return a.texture.mapping=Yy,a.texture.name="PMREM.cubeUv",a.scissorTest=!0,a}function z_(l,e,t,a,d){l.viewport.set(e,t,a,d),l.scissor.set(e,t,a,d)}function CF(l,e,t){const a=new Float32Array(hf),d=new lt(0,1,0);return new yh({name:"SphericalGaussianBlur",defines:{n:hf,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${l}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:a},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:d}},vertexShader:pb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:gh,depthTest:!1,depthWrite:!1})}function XS(){return new yh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:gh,depthTest:!1,depthWrite:!1})}function jS(){return new yh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:gh,depthTest:!1,depthWrite:!1})}function pb(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function RF(l){let e=new WeakMap,t=null;function a(c){if(c&&c.isTexture){const I=c.mapping,P=I===Xx||I===jx,F=I===Xd||I===jd;if(P||F){let D=e.get(c);const N=D!==void 0?D.texture.pmremVersion:0;if(c.isRenderTargetTexture&&c.pmremVersion!==N)return t===null&&(t=new qS(l)),D=P?t.fromEquirectangular(c,D):t.fromCubemap(c,D),D.texture.pmremVersion=c.pmremVersion,e.set(c,D),D.texture;if(D!==void 0)return D.texture;{const G=c.image;return P&&G&&G.height>0||F&&G&&d(G)?(t===null&&(t=new qS(l)),D=P?t.fromEquirectangular(c):t.fromCubemap(c),D.texture.pmremVersion=c.pmremVersion,e.set(c,D),c.addEventListener("dispose",g),D.texture):null}}}return c}function d(c){let I=0;const P=6;for(let F=0;F<P;F++)c[F]!==void 0&&I++;return I===P}function g(c){const I=c.target;I.removeEventListener("dispose",g);const P=e.get(I);P!==void 0&&(e.delete(I),P.dispose())}function _(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:a,dispose:_}}function PF(l){const e={};function t(a){if(e[a]!==void 0)return e[a];let d;switch(a){case"WEBGL_depth_texture":d=l.getExtension("WEBGL_depth_texture")||l.getExtension("MOZ_WEBGL_depth_texture")||l.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=l.getExtension("WEBGL_compressed_texture_s3tc")||l.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=l.getExtension("WEBGL_compressed_texture_pvrtc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=l.getExtension(a)}return e[a]=d,d}return{has:function(a){return t(a)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(a){const d=t(a);return d===null&&Fd("THREE.WebGLRenderer: "+a+" extension not supported."),d}}}function LF(l,e,t,a){const d={},g=new WeakMap;function _(D){const N=D.target;N.index!==null&&e.remove(N.index);for(const Z in N.attributes)e.remove(N.attributes[Z]);for(const Z in N.morphAttributes){const re=N.morphAttributes[Z];for(let $=0,X=re.length;$<X;$++)e.remove(re[$])}N.removeEventListener("dispose",_),delete d[N.id];const G=g.get(N);G&&(e.remove(G),g.delete(N)),a.releaseStatesOfGeometry(N),N.isInstancedBufferGeometry===!0&&delete N._maxInstanceCount,t.memory.geometries--}function c(D,N){return d[N.id]===!0||(N.addEventListener("dispose",_),d[N.id]=!0,t.memory.geometries++),N}function I(D){const N=D.attributes;for(const Z in N)e.update(N[Z],l.ARRAY_BUFFER);const G=D.morphAttributes;for(const Z in G){const re=G[Z];for(let $=0,X=re.length;$<X;$++)e.update(re[$],l.ARRAY_BUFFER)}}function P(D){const N=[],G=D.index,Z=D.attributes.position;let re=0;if(G!==null){const me=G.array;re=G.version;for(let le=0,ye=me.length;le<ye;le+=3){const Le=me[le+0],Me=me[le+1],Te=me[le+2];N.push(Le,Me,Me,Te,Te,Le)}}else if(Z!==void 0){const me=Z.array;re=Z.version;for(let le=0,ye=me.length/3-1;le<ye;le+=3){const Le=le+0,Me=le+1,Te=le+2;N.push(Le,Me,Me,Te,Te,Le)}}else return;const $=new(LM(N)?zM:FM)(N,1);$.version=re;const X=g.get(D);X&&e.remove(X),g.set(D,$)}function F(D){const N=g.get(D);if(N){const G=D.index;G!==null&&N.version<G.version&&P(D)}else P(D);return g.get(D)}return{get:c,update:I,getWireframeAttribute:F}}function kF(l,e,t){let a;function d(N){a=N}let g,_;function c(N){g=N.type,_=N.bytesPerElement}function I(N,G){l.drawElements(a,G,g,N*_),t.update(G,a,1)}function P(N,G,Z){Z!==0&&(l.drawElementsInstanced(a,G,g,N*_,Z),t.update(G,a,Z))}function F(N,G,Z){if(Z===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(a,G,0,g,N,0,Z);let $=0;for(let X=0;X<Z;X++)$+=G[X];t.update($,a,1)}function D(N,G,Z,re){if(Z===0)return;const $=e.get("WEBGL_multi_draw");if($===null)for(let X=0;X<N.length;X++)P(N[X]/_,G[X],re[X]);else{$.multiDrawElementsInstancedWEBGL(a,G,0,g,N,0,re,0,Z);let X=0;for(let me=0;me<Z;me++)X+=G[me];for(let me=0;me<re.length;me++)t.update(X,a,re[me])}}this.setMode=d,this.setIndex=c,this.render=I,this.renderInstances=P,this.renderMultiDraw=F,this.renderMultiDrawInstances=D}function DF(l){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function a(g,_,c){switch(t.calls++,_){case l.TRIANGLES:t.triangles+=c*(g/3);break;case l.LINES:t.lines+=c*(g/2);break;case l.LINE_STRIP:t.lines+=c*(g-1);break;case l.LINE_LOOP:t.lines+=c*g;break;case l.POINTS:t.points+=c*g;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",_);break}}function d(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:d,update:a}}function NF(l,e,t){const a=new WeakMap,d=new gr;function g(_,c,I){const P=_.morphTargetInfluences,F=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,D=F!==void 0?F.length:0;let N=a.get(c);if(N===void 0||N.count!==D){let be=function(){We.dispose(),a.delete(c),c.removeEventListener("dispose",be)};var G=be;N!==void 0&&N.texture.dispose();const Z=c.morphAttributes.position!==void 0,re=c.morphAttributes.normal!==void 0,$=c.morphAttributes.color!==void 0,X=c.morphAttributes.position||[],me=c.morphAttributes.normal||[],le=c.morphAttributes.color||[];let ye=0;Z===!0&&(ye=1),re===!0&&(ye=2),$===!0&&(ye=3);let Le=c.attributes.position.count*ye,Me=1;Le>e.maxTextureSize&&(Me=Math.ceil(Le/e.maxTextureSize),Le=e.maxTextureSize);const Te=new Float32Array(Le*Me*4*D),We=new DM(Te,Le,Me,D);We.type=Rl,We.needsUpdate=!0;const de=ye*4;for(let Oe=0;Oe<D;Oe++){const vt=X[Oe],st=me[Oe],Je=le[Oe],mt=Le*Me*4*Oe;for(let gt=0;gt<vt.count;gt++){const wt=gt*de;Z===!0&&(d.fromBufferAttribute(vt,gt),Te[mt+wt+0]=d.x,Te[mt+wt+1]=d.y,Te[mt+wt+2]=d.z,Te[mt+wt+3]=0),re===!0&&(d.fromBufferAttribute(st,gt),Te[mt+wt+4]=d.x,Te[mt+wt+5]=d.y,Te[mt+wt+6]=d.z,Te[mt+wt+7]=0),$===!0&&(d.fromBufferAttribute(Je,gt),Te[mt+wt+8]=d.x,Te[mt+wt+9]=d.y,Te[mt+wt+10]=d.z,Te[mt+wt+11]=Je.itemSize===4?d.w:1)}}N={count:D,texture:We,size:new Pi(Le,Me)},a.set(c,N),c.addEventListener("dispose",be)}if(_.isInstancedMesh===!0&&_.morphTexture!==null)I.getUniforms().setValue(l,"morphTexture",_.morphTexture,t);else{let Z=0;for(let $=0;$<P.length;$++)Z+=P[$];const re=c.morphTargetsRelative?1:1-Z;I.getUniforms().setValue(l,"morphTargetBaseInfluence",re),I.getUniforms().setValue(l,"morphTargetInfluences",P)}I.getUniforms().setValue(l,"morphTargetsTexture",N.texture,t),I.getUniforms().setValue(l,"morphTargetsTextureSize",N.size)}return{update:g}}function OF(l,e,t,a){let d=new WeakMap;function g(I){const P=a.render.frame,F=I.geometry,D=e.get(I,F);if(d.get(D)!==P&&(e.update(D),d.set(D,P)),I.isInstancedMesh&&(I.hasEventListener("dispose",c)===!1&&I.addEventListener("dispose",c),d.get(I)!==P&&(t.update(I.instanceMatrix,l.ARRAY_BUFFER),I.instanceColor!==null&&t.update(I.instanceColor,l.ARRAY_BUFFER),d.set(I,P))),I.isSkinnedMesh){const N=I.skeleton;d.get(N)!==P&&(N.update(),d.set(N,P))}return D}function _(){d=new WeakMap}function c(I){const P=I.target;P.removeEventListener("dispose",c),t.remove(P.instanceMatrix),P.instanceColor!==null&&t.remove(P.instanceColor)}return{update:g,dispose:_}}class GM extends Hs{constructor(e,t,a,d,g,_,c,I,P,F=Od){if(F!==Od&&F!==Kd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");a===void 0&&F===Od&&(a=vf),a===void 0&&F===Kd&&(a=Yd),super(null,d,g,_,c,I,F,a,P),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=c!==void 0?c:Oa,this.minFilter=I!==void 0?I:Oa,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const HM=new Hs,ZS=new GM(1,1),WM=new DM,qM=new wD,$M=new UM,YS=[],KS=[],JS=new Float32Array(16),QS=new Float32Array(9),eE=new Float32Array(4);function up(l,e,t){const a=l[0];if(a<=0||a>0)return l;const d=e*t;let g=YS[d];if(g===void 0&&(g=new Float32Array(d),YS[d]=g),e!==0){a.toArray(g,0);for(let _=1,c=0;_!==e;++_)c+=t,l[_].toArray(g,c)}return g}function Rs(l,e){if(l.length!==e.length)return!1;for(let t=0,a=l.length;t<a;t++)if(l[t]!==e[t])return!1;return!0}function Ps(l,e){for(let t=0,a=e.length;t<a;t++)l[t]=e[t]}function Qy(l,e){let t=KS[e];t===void 0&&(t=new Int32Array(e),KS[e]=t);for(let a=0;a!==e;++a)t[a]=l.allocateTextureUnit();return t}function FF(l,e){const t=this.cache;t[0]!==e&&(l.uniform1f(this.addr,e),t[0]=e)}function zF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(l.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;l.uniform2fv(this.addr,e),Ps(t,e)}}function BF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(l.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(l.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Rs(t,e))return;l.uniform3fv(this.addr,e),Ps(t,e)}}function UF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(l.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;l.uniform4fv(this.addr,e),Ps(t,e)}}function VF(l,e){const t=this.cache,a=e.elements;if(a===void 0){if(Rs(t,e))return;l.uniformMatrix2fv(this.addr,!1,e),Ps(t,e)}else{if(Rs(t,a))return;eE.set(a),l.uniformMatrix2fv(this.addr,!1,eE),Ps(t,a)}}function GF(l,e){const t=this.cache,a=e.elements;if(a===void 0){if(Rs(t,e))return;l.uniformMatrix3fv(this.addr,!1,e),Ps(t,e)}else{if(Rs(t,a))return;QS.set(a),l.uniformMatrix3fv(this.addr,!1,QS),Ps(t,a)}}function HF(l,e){const t=this.cache,a=e.elements;if(a===void 0){if(Rs(t,e))return;l.uniformMatrix4fv(this.addr,!1,e),Ps(t,e)}else{if(Rs(t,a))return;JS.set(a),l.uniformMatrix4fv(this.addr,!1,JS),Ps(t,a)}}function WF(l,e){const t=this.cache;t[0]!==e&&(l.uniform1i(this.addr,e),t[0]=e)}function qF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(l.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;l.uniform2iv(this.addr,e),Ps(t,e)}}function $F(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(l.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rs(t,e))return;l.uniform3iv(this.addr,e),Ps(t,e)}}function XF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(l.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;l.uniform4iv(this.addr,e),Ps(t,e)}}function jF(l,e){const t=this.cache;t[0]!==e&&(l.uniform1ui(this.addr,e),t[0]=e)}function ZF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(l.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;l.uniform2uiv(this.addr,e),Ps(t,e)}}function YF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(l.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rs(t,e))return;l.uniform3uiv(this.addr,e),Ps(t,e)}}function KF(l,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(l.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;l.uniform4uiv(this.addr,e),Ps(t,e)}}function JF(l,e,t){const a=this.cache,d=t.allocateTextureUnit();a[0]!==d&&(l.uniform1i(this.addr,d),a[0]=d);let g;this.type===l.SAMPLER_2D_SHADOW?(ZS.compareFunction=PM,g=ZS):g=HM,t.setTexture2D(e||g,d)}function QF(l,e,t){const a=this.cache,d=t.allocateTextureUnit();a[0]!==d&&(l.uniform1i(this.addr,d),a[0]=d),t.setTexture3D(e||qM,d)}function e3(l,e,t){const a=this.cache,d=t.allocateTextureUnit();a[0]!==d&&(l.uniform1i(this.addr,d),a[0]=d),t.setTextureCube(e||$M,d)}function t3(l,e,t){const a=this.cache,d=t.allocateTextureUnit();a[0]!==d&&(l.uniform1i(this.addr,d),a[0]=d),t.setTexture2DArray(e||WM,d)}function n3(l){switch(l){case 5126:return FF;case 35664:return zF;case 35665:return BF;case 35666:return UF;case 35674:return VF;case 35675:return GF;case 35676:return HF;case 5124:case 35670:return WF;case 35667:case 35671:return qF;case 35668:case 35672:return $F;case 35669:case 35673:return XF;case 5125:return jF;case 36294:return ZF;case 36295:return YF;case 36296:return KF;case 35678:case 36198:case 36298:case 36306:case 35682:return JF;case 35679:case 36299:case 36307:return QF;case 35680:case 36300:case 36308:case 36293:return e3;case 36289:case 36303:case 36311:case 36292:return t3}}function i3(l,e){l.uniform1fv(this.addr,e)}function r3(l,e){const t=up(e,this.size,2);l.uniform2fv(this.addr,t)}function s3(l,e){const t=up(e,this.size,3);l.uniform3fv(this.addr,t)}function a3(l,e){const t=up(e,this.size,4);l.uniform4fv(this.addr,t)}function o3(l,e){const t=up(e,this.size,4);l.uniformMatrix2fv(this.addr,!1,t)}function l3(l,e){const t=up(e,this.size,9);l.uniformMatrix3fv(this.addr,!1,t)}function u3(l,e){const t=up(e,this.size,16);l.uniformMatrix4fv(this.addr,!1,t)}function c3(l,e){l.uniform1iv(this.addr,e)}function h3(l,e){l.uniform2iv(this.addr,e)}function f3(l,e){l.uniform3iv(this.addr,e)}function d3(l,e){l.uniform4iv(this.addr,e)}function p3(l,e){l.uniform1uiv(this.addr,e)}function m3(l,e){l.uniform2uiv(this.addr,e)}function g3(l,e){l.uniform3uiv(this.addr,e)}function _3(l,e){l.uniform4uiv(this.addr,e)}function y3(l,e,t){const a=this.cache,d=e.length,g=Qy(t,d);Rs(a,g)||(l.uniform1iv(this.addr,g),Ps(a,g));for(let _=0;_!==d;++_)t.setTexture2D(e[_]||HM,g[_])}function v3(l,e,t){const a=this.cache,d=e.length,g=Qy(t,d);Rs(a,g)||(l.uniform1iv(this.addr,g),Ps(a,g));for(let _=0;_!==d;++_)t.setTexture3D(e[_]||qM,g[_])}function x3(l,e,t){const a=this.cache,d=e.length,g=Qy(t,d);Rs(a,g)||(l.uniform1iv(this.addr,g),Ps(a,g));for(let _=0;_!==d;++_)t.setTextureCube(e[_]||$M,g[_])}function b3(l,e,t){const a=this.cache,d=e.length,g=Qy(t,d);Rs(a,g)||(l.uniform1iv(this.addr,g),Ps(a,g));for(let _=0;_!==d;++_)t.setTexture2DArray(e[_]||WM,g[_])}function w3(l){switch(l){case 5126:return i3;case 35664:return r3;case 35665:return s3;case 35666:return a3;case 35674:return o3;case 35675:return l3;case 35676:return u3;case 5124:case 35670:return c3;case 35667:case 35671:return h3;case 35668:case 35672:return f3;case 35669:case 35673:return d3;case 5125:return p3;case 36294:return m3;case 36295:return g3;case 36296:return _3;case 35678:case 36198:case 36298:case 36306:case 35682:return y3;case 35679:case 36299:case 36307:return v3;case 35680:case 36300:case 36308:case 36293:return x3;case 36289:case 36303:case 36311:case 36292:return b3}}class S3{constructor(e,t,a){this.id=e,this.addr=a,this.cache=[],this.type=t.type,this.setValue=n3(t.type)}}class E3{constructor(e,t,a){this.id=e,this.addr=a,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=w3(t.type)}}class T3{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,a){const d=this.seq;for(let g=0,_=d.length;g!==_;++g){const c=d[g];c.setValue(e,t[c.id],a)}}}const rx=/(\w+)(\])?(\[|\.)?/g;function tE(l,e){l.seq.push(e),l.map[e.id]=e}function M3(l,e,t){const a=l.name,d=a.length;for(rx.lastIndex=0;;){const g=rx.exec(a),_=rx.lastIndex;let c=g[1];const I=g[2]==="]",P=g[3];if(I&&(c=c|0),P===void 0||P==="["&&_+2===d){tE(t,P===void 0?new S3(c,l,e):new E3(c,l,e));break}else{let D=t.map[c];D===void 0&&(D=new T3(c),tE(t,D)),t=D}}}class fy{constructor(e,t){this.seq=[],this.map={};const a=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let d=0;d<a;++d){const g=e.getActiveUniform(t,d),_=e.getUniformLocation(t,g.name);M3(g,_,this)}}setValue(e,t,a,d){const g=this.map[t];g!==void 0&&g.setValue(e,a,d)}setOptional(e,t,a){const d=t[a];d!==void 0&&this.setValue(e,a,d)}static upload(e,t,a,d){for(let g=0,_=t.length;g!==_;++g){const c=t[g],I=a[c.id];I.needsUpdate!==!1&&c.setValue(e,I.value,d)}}static seqWithValue(e,t){const a=[];for(let d=0,g=e.length;d!==g;++d){const _=e[d];_.id in t&&a.push(_)}return a}}function nE(l,e,t){const a=l.createShader(e);return l.shaderSource(a,t),l.compileShader(a),a}const A3=37297;let I3=0;function C3(l,e){const t=l.split(`
`),a=[],d=Math.max(e-6,0),g=Math.min(e+6,t.length);for(let _=d;_<g;_++){const c=_+1;a.push(`${c===e?">":" "} ${c}: ${t[_]}`)}return a.join(`
`)}function R3(l){const e=Ki.getPrimaries(Ki.workingColorSpace),t=Ki.getPrimaries(l);let a;switch(e===t?a="":e===zy&&t===Fy?a="LinearDisplayP3ToLinearSRGB":e===Fy&&t===zy&&(a="LinearSRGBToLinearDisplayP3"),l){case ia:case Ky:return[a,"LinearTransferOETF"];case Na:case ub:return[a,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",l),[a,"LinearTransferOETF"]}}function iE(l,e,t){const a=l.getShaderParameter(e,l.COMPILE_STATUS),d=l.getShaderInfoLog(e).trim();if(a&&d==="")return"";const g=/ERROR: 0:(\d+)/.exec(d);if(g){const _=parseInt(g[1]);return t.toUpperCase()+`

`+d+`

`+C3(l.getShaderSource(e),_)}else return d}function P3(l,e){const t=R3(e);return`vec4 ${l}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function L3(l,e){let t;switch(e){case Lk:t="Linear";break;case kk:t="Reinhard";break;case Dk:t="OptimizedCineon";break;case Nk:t="ACESFilmic";break;case Fk:t="AgX";break;case zk:t="Neutral";break;case Ok:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+l+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const B_=new lt;function k3(){Ki.getLuminanceCoefficients(B_);const l=B_.x.toFixed(4),e=B_.y.toFixed(4),t=B_.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${l}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function D3(l){return[l.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",l.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(vm).join(`
`)}function N3(l){const e=[];for(const t in l){const a=l[t];a!==!1&&e.push("#define "+t+" "+a)}return e.join(`
`)}function O3(l,e){const t={},a=l.getProgramParameter(e,l.ACTIVE_ATTRIBUTES);for(let d=0;d<a;d++){const g=l.getActiveAttrib(e,d),_=g.name;let c=1;g.type===l.FLOAT_MAT2&&(c=2),g.type===l.FLOAT_MAT3&&(c=3),g.type===l.FLOAT_MAT4&&(c=4),t[_]={type:g.type,location:l.getAttribLocation(e,_),locationSize:c}}return t}function vm(l){return l!==""}function rE(l,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return l.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function sE(l,e){return l.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const F3=/^[ \t]*#include +<([\w\d./]+)>/gm;function S1(l){return l.replace(F3,B3)}const z3=new Map;function B3(l,e){let t=Si[e];if(t===void 0){const a=z3.get(e);if(a!==void 0)t=Si[a],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,a);else throw new Error("Can not resolve #include <"+e+">")}return S1(t)}const U3=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function aE(l){return l.replace(U3,V3)}function V3(l,e,t,a){let d="";for(let g=parseInt(e);g<parseInt(t);g++)d+=a.replace(/\[\s*i\s*\]/g,"[ "+g+" ]").replace(/UNROLLED_LOOP_INDEX/g,g);return d}function oE(l){let e=`precision ${l.precision} float;
	precision ${l.precision} int;
	precision ${l.precision} sampler2D;
	precision ${l.precision} samplerCube;
	precision ${l.precision} sampler3D;
	precision ${l.precision} sampler2DArray;
	precision ${l.precision} sampler2DShadow;
	precision ${l.precision} samplerCubeShadow;
	precision ${l.precision} sampler2DArrayShadow;
	precision ${l.precision} isampler2D;
	precision ${l.precision} isampler3D;
	precision ${l.precision} isamplerCube;
	precision ${l.precision} isampler2DArray;
	precision ${l.precision} usampler2D;
	precision ${l.precision} usampler3D;
	precision ${l.precision} usamplerCube;
	precision ${l.precision} usampler2DArray;
	`;return l.precision==="highp"?e+=`
#define HIGH_PRECISION`:l.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:l.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function G3(l){let e="SHADOWMAP_TYPE_BASIC";return l.shadowMapType===gM?e="SHADOWMAP_TYPE_PCF":l.shadowMapType===rk?e="SHADOWMAP_TYPE_PCF_SOFT":l.shadowMapType===mc&&(e="SHADOWMAP_TYPE_VSM"),e}function H3(l){let e="ENVMAP_TYPE_CUBE";if(l.envMap)switch(l.envMapMode){case Xd:case jd:e="ENVMAP_TYPE_CUBE";break;case Yy:e="ENVMAP_TYPE_CUBE_UV";break}return e}function W3(l){let e="ENVMAP_MODE_REFLECTION";if(l.envMap)switch(l.envMapMode){case jd:e="ENVMAP_MODE_REFRACTION";break}return e}function q3(l){let e="ENVMAP_BLENDING_NONE";if(l.envMap)switch(l.combine){case _M:e="ENVMAP_BLENDING_MULTIPLY";break;case Rk:e="ENVMAP_BLENDING_MIX";break;case Pk:e="ENVMAP_BLENDING_ADD";break}return e}function $3(l){const e=l.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,a=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:a,maxMip:t}}function X3(l,e,t,a){const d=l.getContext(),g=t.defines;let _=t.vertexShader,c=t.fragmentShader;const I=G3(t),P=H3(t),F=W3(t),D=q3(t),N=$3(t),G=D3(t),Z=N3(g),re=d.createProgram();let $,X,me=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?($=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z].filter(vm).join(`
`),$.length>0&&($+=`
`),X=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z].filter(vm).join(`
`),X.length>0&&(X+=`
`)):($=[oE(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+F:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+I:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(vm).join(`
`),X=[oE(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,Z,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+P:"",t.envMap?"#define "+F:"",t.envMap?"#define "+D:"",N?"#define CUBEUV_TEXEL_WIDTH "+N.texelWidth:"",N?"#define CUBEUV_TEXEL_HEIGHT "+N.texelHeight:"",N?"#define CUBEUV_MAX_MIP "+N.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+I:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==_h?"#define TONE_MAPPING":"",t.toneMapping!==_h?Si.tonemapping_pars_fragment:"",t.toneMapping!==_h?L3("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Si.colorspace_pars_fragment,P3("linearToOutputTexel",t.outputColorSpace),k3(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(vm).join(`
`)),_=S1(_),_=rE(_,t),_=sE(_,t),c=S1(c),c=rE(c,t),c=sE(c,t),_=aE(_),c=aE(c),t.isRawShaderMaterial!==!0&&(me=`#version 300 es
`,$=[G,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+$,X=["#define varying in",t.glslVersion===bS?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===bS?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+X);const le=me+$+_,ye=me+X+c,Le=nE(d,d.VERTEX_SHADER,le),Me=nE(d,d.FRAGMENT_SHADER,ye);d.attachShader(re,Le),d.attachShader(re,Me),t.index0AttributeName!==void 0?d.bindAttribLocation(re,0,t.index0AttributeName):t.morphTargets===!0&&d.bindAttribLocation(re,0,"position"),d.linkProgram(re);function Te(Oe){if(l.debug.checkShaderErrors){const vt=d.getProgramInfoLog(re).trim(),st=d.getShaderInfoLog(Le).trim(),Je=d.getShaderInfoLog(Me).trim();let mt=!0,gt=!0;if(d.getProgramParameter(re,d.LINK_STATUS)===!1)if(mt=!1,typeof l.debug.onShaderError=="function")l.debug.onShaderError(d,re,Le,Me);else{const wt=iE(d,Le,"vertex"),yt=iE(d,Me,"fragment");console.error("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(re,d.VALIDATE_STATUS)+`

Material Name: `+Oe.name+`
Material Type: `+Oe.type+`

Program Info Log: `+vt+`
`+wt+`
`+yt)}else vt!==""?console.warn("THREE.WebGLProgram: Program Info Log:",vt):(st===""||Je==="")&&(gt=!1);gt&&(Oe.diagnostics={runnable:mt,programLog:vt,vertexShader:{log:st,prefix:$},fragmentShader:{log:Je,prefix:X}})}d.deleteShader(Le),d.deleteShader(Me),We=new fy(d,re),de=O3(d,re)}let We;this.getUniforms=function(){return We===void 0&&Te(this),We};let de;this.getAttributes=function(){return de===void 0&&Te(this),de};let be=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return be===!1&&(be=d.getProgramParameter(re,A3)),be},this.destroy=function(){a.releaseStatesOfProgram(this),d.deleteProgram(re),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=I3++,this.cacheKey=e,this.usedTimes=1,this.program=re,this.vertexShader=Le,this.fragmentShader=Me,this}let j3=0;class Z3{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,a=e.fragmentShader,d=this._getShaderStage(t),g=this._getShaderStage(a),_=this._getShaderCacheForMaterial(e);return _.has(d)===!1&&(_.add(d),d.usedTimes++),_.has(g)===!1&&(_.add(g),g.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const a of t)a.usedTimes--,a.usedTimes===0&&this.shaderCache.delete(a.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let a=t.get(e);return a===void 0&&(a=new Set,t.set(e,a)),a}_getShaderStage(e){const t=this.shaderCache;let a=t.get(e);return a===void 0&&(a=new Y3(e),t.set(e,a)),a}}class Y3{constructor(e){this.id=j3++,this.code=e,this.usedTimes=0}}function K3(l,e,t,a,d,g,_){const c=new NM,I=new Z3,P=new Set,F=[],D=d.logarithmicDepthBuffer,N=d.vertexTextures;let G=d.precision;const Z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function re(de){return P.add(de),de===0?"uv":`uv${de}`}function $(de,be,Oe,vt,st){const Je=vt.fog,mt=st.geometry,gt=de.isMeshStandardMaterial?vt.environment:null,wt=(de.isMeshStandardMaterial?t:e).get(de.envMap||gt),yt=wt&&wt.mapping===Yy?wt.image.height:null,Jt=Z[de.type];de.precision!==null&&(G=d.getMaxPrecision(de.precision),G!==de.precision&&console.warn("THREE.WebGLProgram.getParameters:",de.precision,"not supported, using",G,"instead."));const Tt=mt.morphAttributes.position||mt.morphAttributes.normal||mt.morphAttributes.color,jt=Tt!==void 0?Tt.length:0;let Cn=0;mt.morphAttributes.position!==void 0&&(Cn=1),mt.morphAttributes.normal!==void 0&&(Cn=2),mt.morphAttributes.color!==void 0&&(Cn=3);let jn,ht,Ft,mn;if(Jt){const ce=gu[Jt];jn=ce.vertexShader,ht=ce.fragmentShader}else jn=de.vertexShader,ht=de.fragmentShader,I.update(de),Ft=I.getVertexShaderID(de),mn=I.getFragmentShaderID(de);const cn=l.getRenderTarget(),qe=st.isInstancedMesh===!0,Wn=st.isBatchedMesh===!0,bn=!!de.map,nn=!!de.matcap,ne=!!wt,ui=!!de.aoMap,Gn=!!de.lightMap,Kn=!!de.bumpMap,Ze=!!de.normalMap,hi=!!de.displacementMap,qn=!!de.emissiveMap,ut=!!de.metalnessMap,Pe=!!de.roughnessMap,pe=de.anisotropy>0,dt=de.clearcoat>0,Ut=de.dispersion>0,St=de.iridescence>0,Lt=de.sheen>0,Dn=de.transmission>0,an=pe&&!!de.anisotropyMap,$e=dt&&!!de.clearcoatMap,On=dt&&!!de.clearcoatNormalMap,Mt=dt&&!!de.clearcoatRoughnessMap,Rt=St&&!!de.iridescenceMap,Qn=St&&!!de.iridescenceThicknessMap,bt=Lt&&!!de.sheenColorMap,zt=Lt&&!!de.sheenRoughnessMap,xt=!!de.specularMap,Fn=!!de.specularColorMap,fi=!!de.specularIntensityMap,Be=Dn&&!!de.transmissionMap,Ht=Dn&&!!de.thicknessMap,Ct=!!de.gradientMap,It=!!de.alphaMap,Yt=de.alphaTest>0,Se=!!de.alphaHash,te=!!de.extensions;let ie=_h;de.toneMapped&&(cn===null||cn.isXRRenderTarget===!0)&&(ie=l.toneMapping);const fe={shaderID:Jt,shaderType:de.type,shaderName:de.name,vertexShader:jn,fragmentShader:ht,defines:de.defines,customVertexShaderID:Ft,customFragmentShaderID:mn,isRawShaderMaterial:de.isRawShaderMaterial===!0,glslVersion:de.glslVersion,precision:G,batching:Wn,batchingColor:Wn&&st._colorsTexture!==null,instancing:qe,instancingColor:qe&&st.instanceColor!==null,instancingMorph:qe&&st.morphTexture!==null,supportsVertexTextures:N,outputColorSpace:cn===null?l.outputColorSpace:cn.isXRRenderTarget===!0?cn.texture.colorSpace:ia,alphaToCoverage:!!de.alphaToCoverage,map:bn,matcap:nn,envMap:ne,envMapMode:ne&&wt.mapping,envMapCubeUVHeight:yt,aoMap:ui,lightMap:Gn,bumpMap:Kn,normalMap:Ze,displacementMap:N&&hi,emissiveMap:qn,normalMapObjectSpace:Ze&&de.normalMapType===Wk,normalMapTangentSpace:Ze&&de.normalMapType===RM,metalnessMap:ut,roughnessMap:Pe,anisotropy:pe,anisotropyMap:an,clearcoat:dt,clearcoatMap:$e,clearcoatNormalMap:On,clearcoatRoughnessMap:Mt,dispersion:Ut,iridescence:St,iridescenceMap:Rt,iridescenceThicknessMap:Qn,sheen:Lt,sheenColorMap:bt,sheenRoughnessMap:zt,specularMap:xt,specularColorMap:Fn,specularIntensityMap:fi,transmission:Dn,transmissionMap:Be,thicknessMap:Ht,gradientMap:Ct,opaque:de.transparent===!1&&de.blending===Nd&&de.alphaToCoverage===!1,alphaMap:It,alphaTest:Yt,alphaHash:Se,combine:de.combine,mapUv:bn&&re(de.map.channel),aoMapUv:ui&&re(de.aoMap.channel),lightMapUv:Gn&&re(de.lightMap.channel),bumpMapUv:Kn&&re(de.bumpMap.channel),normalMapUv:Ze&&re(de.normalMap.channel),displacementMapUv:hi&&re(de.displacementMap.channel),emissiveMapUv:qn&&re(de.emissiveMap.channel),metalnessMapUv:ut&&re(de.metalnessMap.channel),roughnessMapUv:Pe&&re(de.roughnessMap.channel),anisotropyMapUv:an&&re(de.anisotropyMap.channel),clearcoatMapUv:$e&&re(de.clearcoatMap.channel),clearcoatNormalMapUv:On&&re(de.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Mt&&re(de.clearcoatRoughnessMap.channel),iridescenceMapUv:Rt&&re(de.iridescenceMap.channel),iridescenceThicknessMapUv:Qn&&re(de.iridescenceThicknessMap.channel),sheenColorMapUv:bt&&re(de.sheenColorMap.channel),sheenRoughnessMapUv:zt&&re(de.sheenRoughnessMap.channel),specularMapUv:xt&&re(de.specularMap.channel),specularColorMapUv:Fn&&re(de.specularColorMap.channel),specularIntensityMapUv:fi&&re(de.specularIntensityMap.channel),transmissionMapUv:Be&&re(de.transmissionMap.channel),thicknessMapUv:Ht&&re(de.thicknessMap.channel),alphaMapUv:It&&re(de.alphaMap.channel),vertexTangents:!!mt.attributes.tangent&&(Ze||pe),vertexColors:de.vertexColors,vertexAlphas:de.vertexColors===!0&&!!mt.attributes.color&&mt.attributes.color.itemSize===4,pointsUvs:st.isPoints===!0&&!!mt.attributes.uv&&(bn||It),fog:!!Je,useFog:de.fog===!0,fogExp2:!!Je&&Je.isFogExp2,flatShading:de.flatShading===!0,sizeAttenuation:de.sizeAttenuation===!0,logarithmicDepthBuffer:D,skinning:st.isSkinnedMesh===!0,morphTargets:mt.morphAttributes.position!==void 0,morphNormals:mt.morphAttributes.normal!==void 0,morphColors:mt.morphAttributes.color!==void 0,morphTargetsCount:jt,morphTextureStride:Cn,numDirLights:be.directional.length,numPointLights:be.point.length,numSpotLights:be.spot.length,numSpotLightMaps:be.spotLightMap.length,numRectAreaLights:be.rectArea.length,numHemiLights:be.hemi.length,numDirLightShadows:be.directionalShadowMap.length,numPointLightShadows:be.pointShadowMap.length,numSpotLightShadows:be.spotShadowMap.length,numSpotLightShadowsWithMaps:be.numSpotLightShadowsWithMaps,numLightProbes:be.numLightProbes,numClippingPlanes:_.numPlanes,numClipIntersection:_.numIntersection,dithering:de.dithering,shadowMapEnabled:l.shadowMap.enabled&&Oe.length>0,shadowMapType:l.shadowMap.type,toneMapping:ie,decodeVideoTexture:bn&&de.map.isVideoTexture===!0&&Ki.getTransfer(de.map.colorSpace)===Dr,premultipliedAlpha:de.premultipliedAlpha,doubleSided:de.side===Al,flipSided:de.side===so,useDepthPacking:de.depthPacking>=0,depthPacking:de.depthPacking||0,index0AttributeName:de.index0AttributeName,extensionClipCullDistance:te&&de.extensions.clipCullDistance===!0&&a.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(te&&de.extensions.multiDraw===!0||Wn)&&a.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:a.has("KHR_parallel_shader_compile"),customProgramCacheKey:de.customProgramCacheKey()};return fe.vertexUv1s=P.has(1),fe.vertexUv2s=P.has(2),fe.vertexUv3s=P.has(3),P.clear(),fe}function X(de){const be=[];if(de.shaderID?be.push(de.shaderID):(be.push(de.customVertexShaderID),be.push(de.customFragmentShaderID)),de.defines!==void 0)for(const Oe in de.defines)be.push(Oe),be.push(de.defines[Oe]);return de.isRawShaderMaterial===!1&&(me(be,de),le(be,de),be.push(l.outputColorSpace)),be.push(de.customProgramCacheKey),be.join()}function me(de,be){de.push(be.precision),de.push(be.outputColorSpace),de.push(be.envMapMode),de.push(be.envMapCubeUVHeight),de.push(be.mapUv),de.push(be.alphaMapUv),de.push(be.lightMapUv),de.push(be.aoMapUv),de.push(be.bumpMapUv),de.push(be.normalMapUv),de.push(be.displacementMapUv),de.push(be.emissiveMapUv),de.push(be.metalnessMapUv),de.push(be.roughnessMapUv),de.push(be.anisotropyMapUv),de.push(be.clearcoatMapUv),de.push(be.clearcoatNormalMapUv),de.push(be.clearcoatRoughnessMapUv),de.push(be.iridescenceMapUv),de.push(be.iridescenceThicknessMapUv),de.push(be.sheenColorMapUv),de.push(be.sheenRoughnessMapUv),de.push(be.specularMapUv),de.push(be.specularColorMapUv),de.push(be.specularIntensityMapUv),de.push(be.transmissionMapUv),de.push(be.thicknessMapUv),de.push(be.combine),de.push(be.fogExp2),de.push(be.sizeAttenuation),de.push(be.morphTargetsCount),de.push(be.morphAttributeCount),de.push(be.numDirLights),de.push(be.numPointLights),de.push(be.numSpotLights),de.push(be.numSpotLightMaps),de.push(be.numHemiLights),de.push(be.numRectAreaLights),de.push(be.numDirLightShadows),de.push(be.numPointLightShadows),de.push(be.numSpotLightShadows),de.push(be.numSpotLightShadowsWithMaps),de.push(be.numLightProbes),de.push(be.shadowMapType),de.push(be.toneMapping),de.push(be.numClippingPlanes),de.push(be.numClipIntersection),de.push(be.depthPacking)}function le(de,be){c.disableAll(),be.supportsVertexTextures&&c.enable(0),be.instancing&&c.enable(1),be.instancingColor&&c.enable(2),be.instancingMorph&&c.enable(3),be.matcap&&c.enable(4),be.envMap&&c.enable(5),be.normalMapObjectSpace&&c.enable(6),be.normalMapTangentSpace&&c.enable(7),be.clearcoat&&c.enable(8),be.iridescence&&c.enable(9),be.alphaTest&&c.enable(10),be.vertexColors&&c.enable(11),be.vertexAlphas&&c.enable(12),be.vertexUv1s&&c.enable(13),be.vertexUv2s&&c.enable(14),be.vertexUv3s&&c.enable(15),be.vertexTangents&&c.enable(16),be.anisotropy&&c.enable(17),be.alphaHash&&c.enable(18),be.batching&&c.enable(19),be.dispersion&&c.enable(20),be.batchingColor&&c.enable(21),de.push(c.mask),c.disableAll(),be.fog&&c.enable(0),be.useFog&&c.enable(1),be.flatShading&&c.enable(2),be.logarithmicDepthBuffer&&c.enable(3),be.skinning&&c.enable(4),be.morphTargets&&c.enable(5),be.morphNormals&&c.enable(6),be.morphColors&&c.enable(7),be.premultipliedAlpha&&c.enable(8),be.shadowMapEnabled&&c.enable(9),be.doubleSided&&c.enable(10),be.flipSided&&c.enable(11),be.useDepthPacking&&c.enable(12),be.dithering&&c.enable(13),be.transmission&&c.enable(14),be.sheen&&c.enable(15),be.opaque&&c.enable(16),be.pointsUvs&&c.enable(17),be.decodeVideoTexture&&c.enable(18),be.alphaToCoverage&&c.enable(19),de.push(c.mask)}function ye(de){const be=Z[de.type];let Oe;if(be){const vt=gu[be];Oe=DD.clone(vt.uniforms)}else Oe=de.uniforms;return Oe}function Le(de,be){let Oe;for(let vt=0,st=F.length;vt<st;vt++){const Je=F[vt];if(Je.cacheKey===be){Oe=Je,++Oe.usedTimes;break}}return Oe===void 0&&(Oe=new X3(l,be,de,g),F.push(Oe)),Oe}function Me(de){if(--de.usedTimes===0){const be=F.indexOf(de);F[be]=F[F.length-1],F.pop(),de.destroy()}}function Te(de){I.remove(de)}function We(){I.dispose()}return{getParameters:$,getProgramCacheKey:X,getUniforms:ye,acquireProgram:Le,releaseProgram:Me,releaseShaderCache:Te,programs:F,dispose:We}}function J3(){let l=new WeakMap;function e(g){let _=l.get(g);return _===void 0&&(_={},l.set(g,_)),_}function t(g){l.delete(g)}function a(g,_,c){l.get(g)[_]=c}function d(){l=new WeakMap}return{get:e,remove:t,update:a,dispose:d}}function Q3(l,e){return l.groupOrder!==e.groupOrder?l.groupOrder-e.groupOrder:l.renderOrder!==e.renderOrder?l.renderOrder-e.renderOrder:l.material.id!==e.material.id?l.material.id-e.material.id:l.z!==e.z?l.z-e.z:l.id-e.id}function lE(l,e){return l.groupOrder!==e.groupOrder?l.groupOrder-e.groupOrder:l.renderOrder!==e.renderOrder?l.renderOrder-e.renderOrder:l.z!==e.z?e.z-l.z:l.id-e.id}function uE(){const l=[];let e=0;const t=[],a=[],d=[];function g(){e=0,t.length=0,a.length=0,d.length=0}function _(D,N,G,Z,re,$){let X=l[e];return X===void 0?(X={id:D.id,object:D,geometry:N,material:G,groupOrder:Z,renderOrder:D.renderOrder,z:re,group:$},l[e]=X):(X.id=D.id,X.object=D,X.geometry=N,X.material=G,X.groupOrder=Z,X.renderOrder=D.renderOrder,X.z=re,X.group=$),e++,X}function c(D,N,G,Z,re,$){const X=_(D,N,G,Z,re,$);G.transmission>0?a.push(X):G.transparent===!0?d.push(X):t.push(X)}function I(D,N,G,Z,re,$){const X=_(D,N,G,Z,re,$);G.transmission>0?a.unshift(X):G.transparent===!0?d.unshift(X):t.unshift(X)}function P(D,N){t.length>1&&t.sort(D||Q3),a.length>1&&a.sort(N||lE),d.length>1&&d.sort(N||lE)}function F(){for(let D=e,N=l.length;D<N;D++){const G=l[D];if(G.id===null)break;G.id=null,G.object=null,G.geometry=null,G.material=null,G.group=null}}return{opaque:t,transmissive:a,transparent:d,init:g,push:c,unshift:I,finish:F,sort:P}}function ez(){let l=new WeakMap;function e(a,d){const g=l.get(a);let _;return g===void 0?(_=new uE,l.set(a,[_])):d>=g.length?(_=new uE,g.push(_)):_=g[d],_}function t(){l=new WeakMap}return{get:e,dispose:t}}function tz(){const l={};return{get:function(e){if(l[e.id]!==void 0)return l[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new lt,color:new _i};break;case"SpotLight":t={position:new lt,direction:new lt,color:new _i,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new lt,color:new _i,distance:0,decay:0};break;case"HemisphereLight":t={direction:new lt,skyColor:new _i,groundColor:new _i};break;case"RectAreaLight":t={color:new _i,position:new lt,halfWidth:new lt,halfHeight:new lt};break}return l[e.id]=t,t}}}function nz(){const l={};return{get:function(e){if(l[e.id]!==void 0)return l[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pi};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pi};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pi,shadowCameraNear:1,shadowCameraFar:1e3};break}return l[e.id]=t,t}}}let iz=0;function rz(l,e){return(e.castShadow?2:0)-(l.castShadow?2:0)+(e.map?1:0)-(l.map?1:0)}function sz(l){const e=new tz,t=nz(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let P=0;P<9;P++)a.probe.push(new lt);const d=new lt,g=new xi,_=new xi;function c(P){let F=0,D=0,N=0;for(let de=0;de<9;de++)a.probe[de].set(0,0,0);let G=0,Z=0,re=0,$=0,X=0,me=0,le=0,ye=0,Le=0,Me=0,Te=0;P.sort(rz);for(let de=0,be=P.length;de<be;de++){const Oe=P[de],vt=Oe.color,st=Oe.intensity,Je=Oe.distance,mt=Oe.shadow&&Oe.shadow.map?Oe.shadow.map.texture:null;if(Oe.isAmbientLight)F+=vt.r*st,D+=vt.g*st,N+=vt.b*st;else if(Oe.isLightProbe){for(let gt=0;gt<9;gt++)a.probe[gt].addScaledVector(Oe.sh.coefficients[gt],st);Te++}else if(Oe.isDirectionalLight){const gt=e.get(Oe);if(gt.color.copy(Oe.color).multiplyScalar(Oe.intensity),Oe.castShadow){const wt=Oe.shadow,yt=t.get(Oe);yt.shadowIntensity=wt.intensity,yt.shadowBias=wt.bias,yt.shadowNormalBias=wt.normalBias,yt.shadowRadius=wt.radius,yt.shadowMapSize=wt.mapSize,a.directionalShadow[G]=yt,a.directionalShadowMap[G]=mt,a.directionalShadowMatrix[G]=Oe.shadow.matrix,me++}a.directional[G]=gt,G++}else if(Oe.isSpotLight){const gt=e.get(Oe);gt.position.setFromMatrixPosition(Oe.matrixWorld),gt.color.copy(vt).multiplyScalar(st),gt.distance=Je,gt.coneCos=Math.cos(Oe.angle),gt.penumbraCos=Math.cos(Oe.angle*(1-Oe.penumbra)),gt.decay=Oe.decay,a.spot[re]=gt;const wt=Oe.shadow;if(Oe.map&&(a.spotLightMap[Le]=Oe.map,Le++,wt.updateMatrices(Oe),Oe.castShadow&&Me++),a.spotLightMatrix[re]=wt.matrix,Oe.castShadow){const yt=t.get(Oe);yt.shadowIntensity=wt.intensity,yt.shadowBias=wt.bias,yt.shadowNormalBias=wt.normalBias,yt.shadowRadius=wt.radius,yt.shadowMapSize=wt.mapSize,a.spotShadow[re]=yt,a.spotShadowMap[re]=mt,ye++}re++}else if(Oe.isRectAreaLight){const gt=e.get(Oe);gt.color.copy(vt).multiplyScalar(st),gt.halfWidth.set(Oe.width*.5,0,0),gt.halfHeight.set(0,Oe.height*.5,0),a.rectArea[$]=gt,$++}else if(Oe.isPointLight){const gt=e.get(Oe);if(gt.color.copy(Oe.color).multiplyScalar(Oe.intensity),gt.distance=Oe.distance,gt.decay=Oe.decay,Oe.castShadow){const wt=Oe.shadow,yt=t.get(Oe);yt.shadowIntensity=wt.intensity,yt.shadowBias=wt.bias,yt.shadowNormalBias=wt.normalBias,yt.shadowRadius=wt.radius,yt.shadowMapSize=wt.mapSize,yt.shadowCameraNear=wt.camera.near,yt.shadowCameraFar=wt.camera.far,a.pointShadow[Z]=yt,a.pointShadowMap[Z]=mt,a.pointShadowMatrix[Z]=Oe.shadow.matrix,le++}a.point[Z]=gt,Z++}else if(Oe.isHemisphereLight){const gt=e.get(Oe);gt.skyColor.copy(Oe.color).multiplyScalar(st),gt.groundColor.copy(Oe.groundColor).multiplyScalar(st),a.hemi[X]=gt,X++}}$>0&&(l.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=xn.LTC_FLOAT_1,a.rectAreaLTC2=xn.LTC_FLOAT_2):(a.rectAreaLTC1=xn.LTC_HALF_1,a.rectAreaLTC2=xn.LTC_HALF_2)),a.ambient[0]=F,a.ambient[1]=D,a.ambient[2]=N;const We=a.hash;(We.directionalLength!==G||We.pointLength!==Z||We.spotLength!==re||We.rectAreaLength!==$||We.hemiLength!==X||We.numDirectionalShadows!==me||We.numPointShadows!==le||We.numSpotShadows!==ye||We.numSpotMaps!==Le||We.numLightProbes!==Te)&&(a.directional.length=G,a.spot.length=re,a.rectArea.length=$,a.point.length=Z,a.hemi.length=X,a.directionalShadow.length=me,a.directionalShadowMap.length=me,a.pointShadow.length=le,a.pointShadowMap.length=le,a.spotShadow.length=ye,a.spotShadowMap.length=ye,a.directionalShadowMatrix.length=me,a.pointShadowMatrix.length=le,a.spotLightMatrix.length=ye+Le-Me,a.spotLightMap.length=Le,a.numSpotLightShadowsWithMaps=Me,a.numLightProbes=Te,We.directionalLength=G,We.pointLength=Z,We.spotLength=re,We.rectAreaLength=$,We.hemiLength=X,We.numDirectionalShadows=me,We.numPointShadows=le,We.numSpotShadows=ye,We.numSpotMaps=Le,We.numLightProbes=Te,a.version=iz++)}function I(P,F){let D=0,N=0,G=0,Z=0,re=0;const $=F.matrixWorldInverse;for(let X=0,me=P.length;X<me;X++){const le=P[X];if(le.isDirectionalLight){const ye=a.directional[D];ye.direction.setFromMatrixPosition(le.matrixWorld),d.setFromMatrixPosition(le.target.matrixWorld),ye.direction.sub(d),ye.direction.transformDirection($),D++}else if(le.isSpotLight){const ye=a.spot[G];ye.position.setFromMatrixPosition(le.matrixWorld),ye.position.applyMatrix4($),ye.direction.setFromMatrixPosition(le.matrixWorld),d.setFromMatrixPosition(le.target.matrixWorld),ye.direction.sub(d),ye.direction.transformDirection($),G++}else if(le.isRectAreaLight){const ye=a.rectArea[Z];ye.position.setFromMatrixPosition(le.matrixWorld),ye.position.applyMatrix4($),_.identity(),g.copy(le.matrixWorld),g.premultiply($),_.extractRotation(g),ye.halfWidth.set(le.width*.5,0,0),ye.halfHeight.set(0,le.height*.5,0),ye.halfWidth.applyMatrix4(_),ye.halfHeight.applyMatrix4(_),Z++}else if(le.isPointLight){const ye=a.point[N];ye.position.setFromMatrixPosition(le.matrixWorld),ye.position.applyMatrix4($),N++}else if(le.isHemisphereLight){const ye=a.hemi[re];ye.direction.setFromMatrixPosition(le.matrixWorld),ye.direction.transformDirection($),re++}}}return{setup:c,setupView:I,state:a}}function cE(l){const e=new sz(l),t=[],a=[];function d(F){P.camera=F,t.length=0,a.length=0}function g(F){t.push(F)}function _(F){a.push(F)}function c(){e.setup(t)}function I(F){e.setupView(t,F)}const P={lightsArray:t,shadowsArray:a,camera:null,lights:e,transmissionRenderTarget:{}};return{init:d,state:P,setupLights:c,setupLightsView:I,pushLight:g,pushShadow:_}}function az(l){let e=new WeakMap;function t(d,g=0){const _=e.get(d);let c;return _===void 0?(c=new cE(l),e.set(d,[c])):g>=_.length?(c=new cE(l),_.push(c)):c=_[g],c}function a(){e=new WeakMap}return{get:t,dispose:a}}class oz extends xu{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Gk,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class lz extends xu{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const uz=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,cz=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function hz(l,e,t){let a=new fb;const d=new Pi,g=new Pi,_=new gr,c=new oz({depthPacking:Hk}),I=new lz,P={},F=t.maxTextureSize,D={[xc]:so,[so]:xc,[Al]:Al},N=new yh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pi},radius:{value:4}},vertexShader:uz,fragmentShader:cz}),G=N.clone();G.defines.HORIZONTAL_PASS=1;const Z=new Au;Z.setAttribute("position",new Fa(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const re=new io(Z,N),$=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gM;let X=this.type;this.render=function(Me,Te,We){if($.enabled===!1||$.autoUpdate===!1&&$.needsUpdate===!1||Me.length===0)return;const de=l.getRenderTarget(),be=l.getActiveCubeFace(),Oe=l.getActiveMipmapLevel(),vt=l.state;vt.setBlending(gh),vt.buffers.color.setClear(1,1,1,1),vt.buffers.depth.setTest(!0),vt.setScissorTest(!1);const st=X!==mc&&this.type===mc,Je=X===mc&&this.type!==mc;for(let mt=0,gt=Me.length;mt<gt;mt++){const wt=Me[mt],yt=wt.shadow;if(yt===void 0){console.warn("THREE.WebGLShadowMap:",wt,"has no shadow.");continue}if(yt.autoUpdate===!1&&yt.needsUpdate===!1)continue;d.copy(yt.mapSize);const Jt=yt.getFrameExtents();if(d.multiply(Jt),g.copy(yt.mapSize),(d.x>F||d.y>F)&&(d.x>F&&(g.x=Math.floor(F/Jt.x),d.x=g.x*Jt.x,yt.mapSize.x=g.x),d.y>F&&(g.y=Math.floor(F/Jt.y),d.y=g.y*Jt.y,yt.mapSize.y=g.y)),yt.map===null||st===!0||Je===!0){const jt=this.type!==mc?{minFilter:Oa,magFilter:Oa}:{};yt.map!==null&&yt.map.dispose(),yt.map=new xf(d.x,d.y,jt),yt.map.texture.name=wt.name+".shadowMap",yt.camera.updateProjectionMatrix()}l.setRenderTarget(yt.map),l.clear();const Tt=yt.getViewportCount();for(let jt=0;jt<Tt;jt++){const Cn=yt.getViewport(jt);_.set(g.x*Cn.x,g.y*Cn.y,g.x*Cn.z,g.y*Cn.w),vt.viewport(_),yt.updateMatrices(wt,jt),a=yt.getFrustum(),ye(Te,We,yt.camera,wt,this.type)}yt.isPointLightShadow!==!0&&this.type===mc&&me(yt,We),yt.needsUpdate=!1}X=this.type,$.needsUpdate=!1,l.setRenderTarget(de,be,Oe)};function me(Me,Te){const We=e.update(re);N.defines.VSM_SAMPLES!==Me.blurSamples&&(N.defines.VSM_SAMPLES=Me.blurSamples,G.defines.VSM_SAMPLES=Me.blurSamples,N.needsUpdate=!0,G.needsUpdate=!0),Me.mapPass===null&&(Me.mapPass=new xf(d.x,d.y)),N.uniforms.shadow_pass.value=Me.map.texture,N.uniforms.resolution.value=Me.mapSize,N.uniforms.radius.value=Me.radius,l.setRenderTarget(Me.mapPass),l.clear(),l.renderBufferDirect(Te,null,We,N,re,null),G.uniforms.shadow_pass.value=Me.mapPass.texture,G.uniforms.resolution.value=Me.mapSize,G.uniforms.radius.value=Me.radius,l.setRenderTarget(Me.map),l.clear(),l.renderBufferDirect(Te,null,We,G,re,null)}function le(Me,Te,We,de){let be=null;const Oe=We.isPointLight===!0?Me.customDistanceMaterial:Me.customDepthMaterial;if(Oe!==void 0)be=Oe;else if(be=We.isPointLight===!0?I:c,l.localClippingEnabled&&Te.clipShadows===!0&&Array.isArray(Te.clippingPlanes)&&Te.clippingPlanes.length!==0||Te.displacementMap&&Te.displacementScale!==0||Te.alphaMap&&Te.alphaTest>0||Te.map&&Te.alphaTest>0){const vt=be.uuid,st=Te.uuid;let Je=P[vt];Je===void 0&&(Je={},P[vt]=Je);let mt=Je[st];mt===void 0&&(mt=be.clone(),Je[st]=mt,Te.addEventListener("dispose",Le)),be=mt}if(be.visible=Te.visible,be.wireframe=Te.wireframe,de===mc?be.side=Te.shadowSide!==null?Te.shadowSide:Te.side:be.side=Te.shadowSide!==null?Te.shadowSide:D[Te.side],be.alphaMap=Te.alphaMap,be.alphaTest=Te.alphaTest,be.map=Te.map,be.clipShadows=Te.clipShadows,be.clippingPlanes=Te.clippingPlanes,be.clipIntersection=Te.clipIntersection,be.displacementMap=Te.displacementMap,be.displacementScale=Te.displacementScale,be.displacementBias=Te.displacementBias,be.wireframeLinewidth=Te.wireframeLinewidth,be.linewidth=Te.linewidth,We.isPointLight===!0&&be.isMeshDistanceMaterial===!0){const vt=l.properties.get(be);vt.light=We}return be}function ye(Me,Te,We,de,be){if(Me.visible===!1)return;if(Me.layers.test(Te.layers)&&(Me.isMesh||Me.isLine||Me.isPoints)&&(Me.castShadow||Me.receiveShadow&&be===mc)&&(!Me.frustumCulled||a.intersectsObject(Me))){Me.modelViewMatrix.multiplyMatrices(We.matrixWorldInverse,Me.matrixWorld);const st=e.update(Me),Je=Me.material;if(Array.isArray(Je)){const mt=st.groups;for(let gt=0,wt=mt.length;gt<wt;gt++){const yt=mt[gt],Jt=Je[yt.materialIndex];if(Jt&&Jt.visible){const Tt=le(Me,Jt,de,be);Me.onBeforeShadow(l,Me,Te,We,st,Tt,yt),l.renderBufferDirect(We,null,st,Tt,Me,yt),Me.onAfterShadow(l,Me,Te,We,st,Tt,yt)}}}else if(Je.visible){const mt=le(Me,Je,de,be);Me.onBeforeShadow(l,Me,Te,We,st,mt,null),l.renderBufferDirect(We,null,st,mt,Me,null),Me.onAfterShadow(l,Me,Te,We,st,mt,null)}}const vt=Me.children;for(let st=0,Je=vt.length;st<Je;st++)ye(vt[st],Te,We,de,be)}function Le(Me){Me.target.removeEventListener("dispose",Le);for(const We in P){const de=P[We],be=Me.target.uuid;be in de&&(de[be].dispose(),delete de[be])}}}function fz(l){function e(){let Be=!1;const Ht=new gr;let Ct=null;const It=new gr(0,0,0,0);return{setMask:function(Yt){Ct!==Yt&&!Be&&(l.colorMask(Yt,Yt,Yt,Yt),Ct=Yt)},setLocked:function(Yt){Be=Yt},setClear:function(Yt,Se,te,ie,fe){fe===!0&&(Yt*=ie,Se*=ie,te*=ie),Ht.set(Yt,Se,te,ie),It.equals(Ht)===!1&&(l.clearColor(Yt,Se,te,ie),It.copy(Ht))},reset:function(){Be=!1,Ct=null,It.set(-1,0,0,0)}}}function t(){let Be=!1,Ht=null,Ct=null,It=null;return{setTest:function(Yt){Yt?mn(l.DEPTH_TEST):cn(l.DEPTH_TEST)},setMask:function(Yt){Ht!==Yt&&!Be&&(l.depthMask(Yt),Ht=Yt)},setFunc:function(Yt){if(Ct!==Yt){switch(Yt){case Sk:l.depthFunc(l.NEVER);break;case Ek:l.depthFunc(l.ALWAYS);break;case Tk:l.depthFunc(l.LESS);break;case Dy:l.depthFunc(l.LEQUAL);break;case Mk:l.depthFunc(l.EQUAL);break;case Ak:l.depthFunc(l.GEQUAL);break;case Ik:l.depthFunc(l.GREATER);break;case Ck:l.depthFunc(l.NOTEQUAL);break;default:l.depthFunc(l.LEQUAL)}Ct=Yt}},setLocked:function(Yt){Be=Yt},setClear:function(Yt){It!==Yt&&(l.clearDepth(Yt),It=Yt)},reset:function(){Be=!1,Ht=null,Ct=null,It=null}}}function a(){let Be=!1,Ht=null,Ct=null,It=null,Yt=null,Se=null,te=null,ie=null,fe=null;return{setTest:function(ce){Be||(ce?mn(l.STENCIL_TEST):cn(l.STENCIL_TEST))},setMask:function(ce){Ht!==ce&&!Be&&(l.stencilMask(ce),Ht=ce)},setFunc:function(ce,Ve,Xe){(Ct!==ce||It!==Ve||Yt!==Xe)&&(l.stencilFunc(ce,Ve,Xe),Ct=ce,It=Ve,Yt=Xe)},setOp:function(ce,Ve,Xe){(Se!==ce||te!==Ve||ie!==Xe)&&(l.stencilOp(ce,Ve,Xe),Se=ce,te=Ve,ie=Xe)},setLocked:function(ce){Be=ce},setClear:function(ce){fe!==ce&&(l.clearStencil(ce),fe=ce)},reset:function(){Be=!1,Ht=null,Ct=null,It=null,Yt=null,Se=null,te=null,ie=null,fe=null}}}const d=new e,g=new t,_=new a,c=new WeakMap,I=new WeakMap;let P={},F={},D=new WeakMap,N=[],G=null,Z=!1,re=null,$=null,X=null,me=null,le=null,ye=null,Le=null,Me=new _i(0,0,0),Te=0,We=!1,de=null,be=null,Oe=null,vt=null,st=null;const Je=l.getParameter(l.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let mt=!1,gt=0;const wt=l.getParameter(l.VERSION);wt.indexOf("WebGL")!==-1?(gt=parseFloat(/^WebGL (\d)/.exec(wt)[1]),mt=gt>=1):wt.indexOf("OpenGL ES")!==-1&&(gt=parseFloat(/^OpenGL ES (\d)/.exec(wt)[1]),mt=gt>=2);let yt=null,Jt={};const Tt=l.getParameter(l.SCISSOR_BOX),jt=l.getParameter(l.VIEWPORT),Cn=new gr().fromArray(Tt),jn=new gr().fromArray(jt);function ht(Be,Ht,Ct,It){const Yt=new Uint8Array(4),Se=l.createTexture();l.bindTexture(Be,Se),l.texParameteri(Be,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(Be,l.TEXTURE_MAG_FILTER,l.NEAREST);for(let te=0;te<Ct;te++)Be===l.TEXTURE_3D||Be===l.TEXTURE_2D_ARRAY?l.texImage3D(Ht,0,l.RGBA,1,1,It,0,l.RGBA,l.UNSIGNED_BYTE,Yt):l.texImage2D(Ht+te,0,l.RGBA,1,1,0,l.RGBA,l.UNSIGNED_BYTE,Yt);return Se}const Ft={};Ft[l.TEXTURE_2D]=ht(l.TEXTURE_2D,l.TEXTURE_2D,1),Ft[l.TEXTURE_CUBE_MAP]=ht(l.TEXTURE_CUBE_MAP,l.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ft[l.TEXTURE_2D_ARRAY]=ht(l.TEXTURE_2D_ARRAY,l.TEXTURE_2D_ARRAY,1,1),Ft[l.TEXTURE_3D]=ht(l.TEXTURE_3D,l.TEXTURE_3D,1,1),d.setClear(0,0,0,1),g.setClear(1),_.setClear(0),mn(l.DEPTH_TEST),g.setFunc(Dy),Kn(!1),Ze(fS),mn(l.CULL_FACE),ui(gh);function mn(Be){P[Be]!==!0&&(l.enable(Be),P[Be]=!0)}function cn(Be){P[Be]!==!1&&(l.disable(Be),P[Be]=!1)}function qe(Be,Ht){return F[Be]!==Ht?(l.bindFramebuffer(Be,Ht),F[Be]=Ht,Be===l.DRAW_FRAMEBUFFER&&(F[l.FRAMEBUFFER]=Ht),Be===l.FRAMEBUFFER&&(F[l.DRAW_FRAMEBUFFER]=Ht),!0):!1}function Wn(Be,Ht){let Ct=N,It=!1;if(Be){Ct=D.get(Ht),Ct===void 0&&(Ct=[],D.set(Ht,Ct));const Yt=Be.textures;if(Ct.length!==Yt.length||Ct[0]!==l.COLOR_ATTACHMENT0){for(let Se=0,te=Yt.length;Se<te;Se++)Ct[Se]=l.COLOR_ATTACHMENT0+Se;Ct.length=Yt.length,It=!0}}else Ct[0]!==l.BACK&&(Ct[0]=l.BACK,It=!0);It&&l.drawBuffers(Ct)}function bn(Be){return G!==Be?(l.useProgram(Be),G=Be,!0):!1}const nn={[cf]:l.FUNC_ADD,[ak]:l.FUNC_SUBTRACT,[ok]:l.FUNC_REVERSE_SUBTRACT};nn[lk]=l.MIN,nn[uk]=l.MAX;const ne={[ck]:l.ZERO,[hk]:l.ONE,[fk]:l.SRC_COLOR,[qx]:l.SRC_ALPHA,[yk]:l.SRC_ALPHA_SATURATE,[gk]:l.DST_COLOR,[pk]:l.DST_ALPHA,[dk]:l.ONE_MINUS_SRC_COLOR,[$x]:l.ONE_MINUS_SRC_ALPHA,[_k]:l.ONE_MINUS_DST_COLOR,[mk]:l.ONE_MINUS_DST_ALPHA,[vk]:l.CONSTANT_COLOR,[xk]:l.ONE_MINUS_CONSTANT_COLOR,[bk]:l.CONSTANT_ALPHA,[wk]:l.ONE_MINUS_CONSTANT_ALPHA};function ui(Be,Ht,Ct,It,Yt,Se,te,ie,fe,ce){if(Be===gh){Z===!0&&(cn(l.BLEND),Z=!1);return}if(Z===!1&&(mn(l.BLEND),Z=!0),Be!==sk){if(Be!==re||ce!==We){if(($!==cf||le!==cf)&&(l.blendEquation(l.FUNC_ADD),$=cf,le=cf),ce)switch(Be){case Nd:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case dS:l.blendFunc(l.ONE,l.ONE);break;case pS:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case mS:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Be);break}else switch(Be){case Nd:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case dS:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case pS:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case mS:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Be);break}X=null,me=null,ye=null,Le=null,Me.set(0,0,0),Te=0,re=Be,We=ce}return}Yt=Yt||Ht,Se=Se||Ct,te=te||It,(Ht!==$||Yt!==le)&&(l.blendEquationSeparate(nn[Ht],nn[Yt]),$=Ht,le=Yt),(Ct!==X||It!==me||Se!==ye||te!==Le)&&(l.blendFuncSeparate(ne[Ct],ne[It],ne[Se],ne[te]),X=Ct,me=It,ye=Se,Le=te),(ie.equals(Me)===!1||fe!==Te)&&(l.blendColor(ie.r,ie.g,ie.b,fe),Me.copy(ie),Te=fe),re=Be,We=!1}function Gn(Be,Ht){Be.side===Al?cn(l.CULL_FACE):mn(l.CULL_FACE);let Ct=Be.side===so;Ht&&(Ct=!Ct),Kn(Ct),Be.blending===Nd&&Be.transparent===!1?ui(gh):ui(Be.blending,Be.blendEquation,Be.blendSrc,Be.blendDst,Be.blendEquationAlpha,Be.blendSrcAlpha,Be.blendDstAlpha,Be.blendColor,Be.blendAlpha,Be.premultipliedAlpha),g.setFunc(Be.depthFunc),g.setTest(Be.depthTest),g.setMask(Be.depthWrite),d.setMask(Be.colorWrite);const It=Be.stencilWrite;_.setTest(It),It&&(_.setMask(Be.stencilWriteMask),_.setFunc(Be.stencilFunc,Be.stencilRef,Be.stencilFuncMask),_.setOp(Be.stencilFail,Be.stencilZFail,Be.stencilZPass)),qn(Be.polygonOffset,Be.polygonOffsetFactor,Be.polygonOffsetUnits),Be.alphaToCoverage===!0?mn(l.SAMPLE_ALPHA_TO_COVERAGE):cn(l.SAMPLE_ALPHA_TO_COVERAGE)}function Kn(Be){de!==Be&&(Be?l.frontFace(l.CW):l.frontFace(l.CCW),de=Be)}function Ze(Be){Be!==nk?(mn(l.CULL_FACE),Be!==be&&(Be===fS?l.cullFace(l.BACK):Be===ik?l.cullFace(l.FRONT):l.cullFace(l.FRONT_AND_BACK))):cn(l.CULL_FACE),be=Be}function hi(Be){Be!==Oe&&(mt&&l.lineWidth(Be),Oe=Be)}function qn(Be,Ht,Ct){Be?(mn(l.POLYGON_OFFSET_FILL),(vt!==Ht||st!==Ct)&&(l.polygonOffset(Ht,Ct),vt=Ht,st=Ct)):cn(l.POLYGON_OFFSET_FILL)}function ut(Be){Be?mn(l.SCISSOR_TEST):cn(l.SCISSOR_TEST)}function Pe(Be){Be===void 0&&(Be=l.TEXTURE0+Je-1),yt!==Be&&(l.activeTexture(Be),yt=Be)}function pe(Be,Ht,Ct){Ct===void 0&&(yt===null?Ct=l.TEXTURE0+Je-1:Ct=yt);let It=Jt[Ct];It===void 0&&(It={type:void 0,texture:void 0},Jt[Ct]=It),(It.type!==Be||It.texture!==Ht)&&(yt!==Ct&&(l.activeTexture(Ct),yt=Ct),l.bindTexture(Be,Ht||Ft[Be]),It.type=Be,It.texture=Ht)}function dt(){const Be=Jt[yt];Be!==void 0&&Be.type!==void 0&&(l.bindTexture(Be.type,null),Be.type=void 0,Be.texture=void 0)}function Ut(){try{l.compressedTexImage2D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function St(){try{l.compressedTexImage3D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function Lt(){try{l.texSubImage2D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function Dn(){try{l.texSubImage3D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function an(){try{l.compressedTexSubImage2D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function $e(){try{l.compressedTexSubImage3D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function On(){try{l.texStorage2D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function Mt(){try{l.texStorage3D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function Rt(){try{l.texImage2D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function Qn(){try{l.texImage3D.apply(l,arguments)}catch(Be){console.error("THREE.WebGLState:",Be)}}function bt(Be){Cn.equals(Be)===!1&&(l.scissor(Be.x,Be.y,Be.z,Be.w),Cn.copy(Be))}function zt(Be){jn.equals(Be)===!1&&(l.viewport(Be.x,Be.y,Be.z,Be.w),jn.copy(Be))}function xt(Be,Ht){let Ct=I.get(Ht);Ct===void 0&&(Ct=new WeakMap,I.set(Ht,Ct));let It=Ct.get(Be);It===void 0&&(It=l.getUniformBlockIndex(Ht,Be.name),Ct.set(Be,It))}function Fn(Be,Ht){const It=I.get(Ht).get(Be);c.get(Ht)!==It&&(l.uniformBlockBinding(Ht,It,Be.__bindingPointIndex),c.set(Ht,It))}function fi(){l.disable(l.BLEND),l.disable(l.CULL_FACE),l.disable(l.DEPTH_TEST),l.disable(l.POLYGON_OFFSET_FILL),l.disable(l.SCISSOR_TEST),l.disable(l.STENCIL_TEST),l.disable(l.SAMPLE_ALPHA_TO_COVERAGE),l.blendEquation(l.FUNC_ADD),l.blendFunc(l.ONE,l.ZERO),l.blendFuncSeparate(l.ONE,l.ZERO,l.ONE,l.ZERO),l.blendColor(0,0,0,0),l.colorMask(!0,!0,!0,!0),l.clearColor(0,0,0,0),l.depthMask(!0),l.depthFunc(l.LESS),l.clearDepth(1),l.stencilMask(4294967295),l.stencilFunc(l.ALWAYS,0,4294967295),l.stencilOp(l.KEEP,l.KEEP,l.KEEP),l.clearStencil(0),l.cullFace(l.BACK),l.frontFace(l.CCW),l.polygonOffset(0,0),l.activeTexture(l.TEXTURE0),l.bindFramebuffer(l.FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.useProgram(null),l.lineWidth(1),l.scissor(0,0,l.canvas.width,l.canvas.height),l.viewport(0,0,l.canvas.width,l.canvas.height),P={},yt=null,Jt={},F={},D=new WeakMap,N=[],G=null,Z=!1,re=null,$=null,X=null,me=null,le=null,ye=null,Le=null,Me=new _i(0,0,0),Te=0,We=!1,de=null,be=null,Oe=null,vt=null,st=null,Cn.set(0,0,l.canvas.width,l.canvas.height),jn.set(0,0,l.canvas.width,l.canvas.height),d.reset(),g.reset(),_.reset()}return{buffers:{color:d,depth:g,stencil:_},enable:mn,disable:cn,bindFramebuffer:qe,drawBuffers:Wn,useProgram:bn,setBlending:ui,setMaterial:Gn,setFlipSided:Kn,setCullFace:Ze,setLineWidth:hi,setPolygonOffset:qn,setScissorTest:ut,activeTexture:Pe,bindTexture:pe,unbindTexture:dt,compressedTexImage2D:Ut,compressedTexImage3D:St,texImage2D:Rt,texImage3D:Qn,updateUBOMapping:xt,uniformBlockBinding:Fn,texStorage2D:On,texStorage3D:Mt,texSubImage2D:Lt,texSubImage3D:Dn,compressedTexSubImage2D:an,compressedTexSubImage3D:$e,scissor:bt,viewport:zt,reset:fi}}function hE(l,e,t,a){const d=dz(a);switch(t){case SM:return l*e;case TM:return l*e;case MM:return l*e*2;case sb:return l*e/d.components*d.byteLength;case ab:return l*e/d.components*d.byteLength;case AM:return l*e*2/d.components*d.byteLength;case ob:return l*e*2/d.components*d.byteLength;case EM:return l*e*3/d.components*d.byteLength;case Yo:return l*e*4/d.components*d.byteLength;case lb:return l*e*4/d.components*d.byteLength;case oy:case ly:return Math.floor((l+3)/4)*Math.floor((e+3)/4)*8;case uy:case cy:return Math.floor((l+3)/4)*Math.floor((e+3)/4)*16;case Yx:case Jx:return Math.max(l,16)*Math.max(e,8)/4;case Zx:case Kx:return Math.max(l,8)*Math.max(e,8)/2;case Qx:case e1:return Math.floor((l+3)/4)*Math.floor((e+3)/4)*8;case t1:return Math.floor((l+3)/4)*Math.floor((e+3)/4)*16;case n1:return Math.floor((l+3)/4)*Math.floor((e+3)/4)*16;case i1:return Math.floor((l+4)/5)*Math.floor((e+3)/4)*16;case r1:return Math.floor((l+4)/5)*Math.floor((e+4)/5)*16;case s1:return Math.floor((l+5)/6)*Math.floor((e+4)/5)*16;case a1:return Math.floor((l+5)/6)*Math.floor((e+5)/6)*16;case o1:return Math.floor((l+7)/8)*Math.floor((e+4)/5)*16;case l1:return Math.floor((l+7)/8)*Math.floor((e+5)/6)*16;case u1:return Math.floor((l+7)/8)*Math.floor((e+7)/8)*16;case c1:return Math.floor((l+9)/10)*Math.floor((e+4)/5)*16;case h1:return Math.floor((l+9)/10)*Math.floor((e+5)/6)*16;case f1:return Math.floor((l+9)/10)*Math.floor((e+7)/8)*16;case d1:return Math.floor((l+9)/10)*Math.floor((e+9)/10)*16;case p1:return Math.floor((l+11)/12)*Math.floor((e+9)/10)*16;case m1:return Math.floor((l+11)/12)*Math.floor((e+11)/12)*16;case hy:case g1:case _1:return Math.ceil(l/4)*Math.ceil(e/4)*16;case IM:case y1:return Math.ceil(l/4)*Math.ceil(e/4)*8;case v1:case x1:return Math.ceil(l/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function dz(l){switch(l){case bc:case xM:return{byteLength:1,components:1};case Rm:case bM:case Bm:return{byteLength:2,components:1};case ib:case rb:return{byteLength:2,components:4};case vf:case nb:case Rl:return{byteLength:4,components:1};case wM:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${l}.`)}function pz(l,e,t,a,d,g,_){const c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,I=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),P=new Pi,F=new WeakMap;let D;const N=new WeakMap;let G=!1;try{G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Z(Pe,pe){return G?new OffscreenCanvas(Pe,pe):km("canvas")}function re(Pe,pe,dt){let Ut=1;const St=ut(Pe);if((St.width>dt||St.height>dt)&&(Ut=dt/Math.max(St.width,St.height)),Ut<1)if(typeof HTMLImageElement<"u"&&Pe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Pe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Pe instanceof ImageBitmap||typeof VideoFrame<"u"&&Pe instanceof VideoFrame){const Lt=Math.floor(Ut*St.width),Dn=Math.floor(Ut*St.height);D===void 0&&(D=Z(Lt,Dn));const an=pe?Z(Lt,Dn):D;return an.width=Lt,an.height=Dn,an.getContext("2d").drawImage(Pe,0,0,Lt,Dn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+St.width+"x"+St.height+") to ("+Lt+"x"+Dn+")."),an}else return"data"in Pe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+St.width+"x"+St.height+")."),Pe;return Pe}function $(Pe){return Pe.generateMipmaps&&Pe.minFilter!==Oa&&Pe.minFilter!==Io}function X(Pe){l.generateMipmap(Pe)}function me(Pe,pe,dt,Ut,St=!1){if(Pe!==null){if(l[Pe]!==void 0)return l[Pe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Pe+"'")}let Lt=pe;if(pe===l.RED&&(dt===l.FLOAT&&(Lt=l.R32F),dt===l.HALF_FLOAT&&(Lt=l.R16F),dt===l.UNSIGNED_BYTE&&(Lt=l.R8)),pe===l.RED_INTEGER&&(dt===l.UNSIGNED_BYTE&&(Lt=l.R8UI),dt===l.UNSIGNED_SHORT&&(Lt=l.R16UI),dt===l.UNSIGNED_INT&&(Lt=l.R32UI),dt===l.BYTE&&(Lt=l.R8I),dt===l.SHORT&&(Lt=l.R16I),dt===l.INT&&(Lt=l.R32I)),pe===l.RG&&(dt===l.FLOAT&&(Lt=l.RG32F),dt===l.HALF_FLOAT&&(Lt=l.RG16F),dt===l.UNSIGNED_BYTE&&(Lt=l.RG8)),pe===l.RG_INTEGER&&(dt===l.UNSIGNED_BYTE&&(Lt=l.RG8UI),dt===l.UNSIGNED_SHORT&&(Lt=l.RG16UI),dt===l.UNSIGNED_INT&&(Lt=l.RG32UI),dt===l.BYTE&&(Lt=l.RG8I),dt===l.SHORT&&(Lt=l.RG16I),dt===l.INT&&(Lt=l.RG32I)),pe===l.RGB&&dt===l.UNSIGNED_INT_5_9_9_9_REV&&(Lt=l.RGB9_E5),pe===l.RGBA){const Dn=St?Oy:Ki.getTransfer(Ut);dt===l.FLOAT&&(Lt=l.RGBA32F),dt===l.HALF_FLOAT&&(Lt=l.RGBA16F),dt===l.UNSIGNED_BYTE&&(Lt=Dn===Dr?l.SRGB8_ALPHA8:l.RGBA8),dt===l.UNSIGNED_SHORT_4_4_4_4&&(Lt=l.RGBA4),dt===l.UNSIGNED_SHORT_5_5_5_1&&(Lt=l.RGB5_A1)}return(Lt===l.R16F||Lt===l.R32F||Lt===l.RG16F||Lt===l.RG32F||Lt===l.RGBA16F||Lt===l.RGBA32F)&&e.get("EXT_color_buffer_float"),Lt}function le(Pe,pe){let dt;return Pe?pe===null||pe===vf||pe===Yd?dt=l.DEPTH24_STENCIL8:pe===Rl?dt=l.DEPTH32F_STENCIL8:pe===Rm&&(dt=l.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):pe===null||pe===vf||pe===Yd?dt=l.DEPTH_COMPONENT24:pe===Rl?dt=l.DEPTH_COMPONENT32F:pe===Rm&&(dt=l.DEPTH_COMPONENT16),dt}function ye(Pe,pe){return $(Pe)===!0||Pe.isFramebufferTexture&&Pe.minFilter!==Oa&&Pe.minFilter!==Io?Math.log2(Math.max(pe.width,pe.height))+1:Pe.mipmaps!==void 0&&Pe.mipmaps.length>0?Pe.mipmaps.length:Pe.isCompressedTexture&&Array.isArray(Pe.image)?pe.mipmaps.length:1}function Le(Pe){const pe=Pe.target;pe.removeEventListener("dispose",Le),Te(pe),pe.isVideoTexture&&F.delete(pe)}function Me(Pe){const pe=Pe.target;pe.removeEventListener("dispose",Me),de(pe)}function Te(Pe){const pe=a.get(Pe);if(pe.__webglInit===void 0)return;const dt=Pe.source,Ut=N.get(dt);if(Ut){const St=Ut[pe.__cacheKey];St.usedTimes--,St.usedTimes===0&&We(Pe),Object.keys(Ut).length===0&&N.delete(dt)}a.remove(Pe)}function We(Pe){const pe=a.get(Pe);l.deleteTexture(pe.__webglTexture);const dt=Pe.source,Ut=N.get(dt);delete Ut[pe.__cacheKey],_.memory.textures--}function de(Pe){const pe=a.get(Pe);if(Pe.depthTexture&&Pe.depthTexture.dispose(),Pe.isWebGLCubeRenderTarget)for(let Ut=0;Ut<6;Ut++){if(Array.isArray(pe.__webglFramebuffer[Ut]))for(let St=0;St<pe.__webglFramebuffer[Ut].length;St++)l.deleteFramebuffer(pe.__webglFramebuffer[Ut][St]);else l.deleteFramebuffer(pe.__webglFramebuffer[Ut]);pe.__webglDepthbuffer&&l.deleteRenderbuffer(pe.__webglDepthbuffer[Ut])}else{if(Array.isArray(pe.__webglFramebuffer))for(let Ut=0;Ut<pe.__webglFramebuffer.length;Ut++)l.deleteFramebuffer(pe.__webglFramebuffer[Ut]);else l.deleteFramebuffer(pe.__webglFramebuffer);if(pe.__webglDepthbuffer&&l.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&l.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let Ut=0;Ut<pe.__webglColorRenderbuffer.length;Ut++)pe.__webglColorRenderbuffer[Ut]&&l.deleteRenderbuffer(pe.__webglColorRenderbuffer[Ut]);pe.__webglDepthRenderbuffer&&l.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}const dt=Pe.textures;for(let Ut=0,St=dt.length;Ut<St;Ut++){const Lt=a.get(dt[Ut]);Lt.__webglTexture&&(l.deleteTexture(Lt.__webglTexture),_.memory.textures--),a.remove(dt[Ut])}a.remove(Pe)}let be=0;function Oe(){be=0}function vt(){const Pe=be;return Pe>=d.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Pe+" texture units while this GPU supports only "+d.maxTextures),be+=1,Pe}function st(Pe){const pe=[];return pe.push(Pe.wrapS),pe.push(Pe.wrapT),pe.push(Pe.wrapR||0),pe.push(Pe.magFilter),pe.push(Pe.minFilter),pe.push(Pe.anisotropy),pe.push(Pe.internalFormat),pe.push(Pe.format),pe.push(Pe.type),pe.push(Pe.generateMipmaps),pe.push(Pe.premultiplyAlpha),pe.push(Pe.flipY),pe.push(Pe.unpackAlignment),pe.push(Pe.colorSpace),pe.join()}function Je(Pe,pe){const dt=a.get(Pe);if(Pe.isVideoTexture&&hi(Pe),Pe.isRenderTargetTexture===!1&&Pe.version>0&&dt.__version!==Pe.version){const Ut=Pe.image;if(Ut===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ut.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{jn(dt,Pe,pe);return}}t.bindTexture(l.TEXTURE_2D,dt.__webglTexture,l.TEXTURE0+pe)}function mt(Pe,pe){const dt=a.get(Pe);if(Pe.version>0&&dt.__version!==Pe.version){jn(dt,Pe,pe);return}t.bindTexture(l.TEXTURE_2D_ARRAY,dt.__webglTexture,l.TEXTURE0+pe)}function gt(Pe,pe){const dt=a.get(Pe);if(Pe.version>0&&dt.__version!==Pe.version){jn(dt,Pe,pe);return}t.bindTexture(l.TEXTURE_3D,dt.__webglTexture,l.TEXTURE0+pe)}function wt(Pe,pe){const dt=a.get(Pe);if(Pe.version>0&&dt.__version!==Pe.version){ht(dt,Pe,pe);return}t.bindTexture(l.TEXTURE_CUBE_MAP,dt.__webglTexture,l.TEXTURE0+pe)}const yt={[Zd]:l.REPEAT,[dh]:l.CLAMP_TO_EDGE,[Ny]:l.MIRRORED_REPEAT},Jt={[Oa]:l.NEAREST,[vM]:l.NEAREST_MIPMAP_NEAREST,[ym]:l.NEAREST_MIPMAP_LINEAR,[Io]:l.LINEAR,[ay]:l.LINEAR_MIPMAP_NEAREST,[_c]:l.LINEAR_MIPMAP_LINEAR},Tt={[qk]:l.NEVER,[Kk]:l.ALWAYS,[$k]:l.LESS,[PM]:l.LEQUAL,[Xk]:l.EQUAL,[Yk]:l.GEQUAL,[jk]:l.GREATER,[Zk]:l.NOTEQUAL};function jt(Pe,pe){if(pe.type===Rl&&e.has("OES_texture_float_linear")===!1&&(pe.magFilter===Io||pe.magFilter===ay||pe.magFilter===ym||pe.magFilter===_c||pe.minFilter===Io||pe.minFilter===ay||pe.minFilter===ym||pe.minFilter===_c)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),l.texParameteri(Pe,l.TEXTURE_WRAP_S,yt[pe.wrapS]),l.texParameteri(Pe,l.TEXTURE_WRAP_T,yt[pe.wrapT]),(Pe===l.TEXTURE_3D||Pe===l.TEXTURE_2D_ARRAY)&&l.texParameteri(Pe,l.TEXTURE_WRAP_R,yt[pe.wrapR]),l.texParameteri(Pe,l.TEXTURE_MAG_FILTER,Jt[pe.magFilter]),l.texParameteri(Pe,l.TEXTURE_MIN_FILTER,Jt[pe.minFilter]),pe.compareFunction&&(l.texParameteri(Pe,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.texParameteri(Pe,l.TEXTURE_COMPARE_FUNC,Tt[pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(pe.magFilter===Oa||pe.minFilter!==ym&&pe.minFilter!==_c||pe.type===Rl&&e.has("OES_texture_float_linear")===!1)return;if(pe.anisotropy>1||a.get(pe).__currentAnisotropy){const dt=e.get("EXT_texture_filter_anisotropic");l.texParameterf(Pe,dt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,d.getMaxAnisotropy())),a.get(pe).__currentAnisotropy=pe.anisotropy}}}function Cn(Pe,pe){let dt=!1;Pe.__webglInit===void 0&&(Pe.__webglInit=!0,pe.addEventListener("dispose",Le));const Ut=pe.source;let St=N.get(Ut);St===void 0&&(St={},N.set(Ut,St));const Lt=st(pe);if(Lt!==Pe.__cacheKey){St[Lt]===void 0&&(St[Lt]={texture:l.createTexture(),usedTimes:0},_.memory.textures++,dt=!0),St[Lt].usedTimes++;const Dn=St[Pe.__cacheKey];Dn!==void 0&&(St[Pe.__cacheKey].usedTimes--,Dn.usedTimes===0&&We(pe)),Pe.__cacheKey=Lt,Pe.__webglTexture=St[Lt].texture}return dt}function jn(Pe,pe,dt){let Ut=l.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(Ut=l.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(Ut=l.TEXTURE_3D);const St=Cn(Pe,pe),Lt=pe.source;t.bindTexture(Ut,Pe.__webglTexture,l.TEXTURE0+dt);const Dn=a.get(Lt);if(Lt.version!==Dn.__version||St===!0){t.activeTexture(l.TEXTURE0+dt);const an=Ki.getPrimaries(Ki.workingColorSpace),$e=pe.colorSpace===hh?null:Ki.getPrimaries(pe.colorSpace),On=pe.colorSpace===hh||an===$e?l.NONE:l.BROWSER_DEFAULT_WEBGL;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,pe.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,pe.unpackAlignment),l.pixelStorei(l.UNPACK_COLORSPACE_CONVERSION_WEBGL,On);let Mt=re(pe.image,!1,d.maxTextureSize);Mt=qn(pe,Mt);const Rt=g.convert(pe.format,pe.colorSpace),Qn=g.convert(pe.type);let bt=me(pe.internalFormat,Rt,Qn,pe.colorSpace,pe.isVideoTexture);jt(Ut,pe);let zt;const xt=pe.mipmaps,Fn=pe.isVideoTexture!==!0,fi=Dn.__version===void 0||St===!0,Be=Lt.dataReady,Ht=ye(pe,Mt);if(pe.isDepthTexture)bt=le(pe.format===Kd,pe.type),fi&&(Fn?t.texStorage2D(l.TEXTURE_2D,1,bt,Mt.width,Mt.height):t.texImage2D(l.TEXTURE_2D,0,bt,Mt.width,Mt.height,0,Rt,Qn,null));else if(pe.isDataTexture)if(xt.length>0){Fn&&fi&&t.texStorage2D(l.TEXTURE_2D,Ht,bt,xt[0].width,xt[0].height);for(let Ct=0,It=xt.length;Ct<It;Ct++)zt=xt[Ct],Fn?Be&&t.texSubImage2D(l.TEXTURE_2D,Ct,0,0,zt.width,zt.height,Rt,Qn,zt.data):t.texImage2D(l.TEXTURE_2D,Ct,bt,zt.width,zt.height,0,Rt,Qn,zt.data);pe.generateMipmaps=!1}else Fn?(fi&&t.texStorage2D(l.TEXTURE_2D,Ht,bt,Mt.width,Mt.height),Be&&t.texSubImage2D(l.TEXTURE_2D,0,0,0,Mt.width,Mt.height,Rt,Qn,Mt.data)):t.texImage2D(l.TEXTURE_2D,0,bt,Mt.width,Mt.height,0,Rt,Qn,Mt.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){Fn&&fi&&t.texStorage3D(l.TEXTURE_2D_ARRAY,Ht,bt,xt[0].width,xt[0].height,Mt.depth);for(let Ct=0,It=xt.length;Ct<It;Ct++)if(zt=xt[Ct],pe.format!==Yo)if(Rt!==null)if(Fn){if(Be)if(pe.layerUpdates.size>0){const Yt=hE(zt.width,zt.height,pe.format,pe.type);for(const Se of pe.layerUpdates){const te=zt.data.subarray(Se*Yt/zt.data.BYTES_PER_ELEMENT,(Se+1)*Yt/zt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(l.TEXTURE_2D_ARRAY,Ct,0,0,Se,zt.width,zt.height,1,Rt,te,0,0)}pe.clearLayerUpdates()}else t.compressedTexSubImage3D(l.TEXTURE_2D_ARRAY,Ct,0,0,0,zt.width,zt.height,Mt.depth,Rt,zt.data,0,0)}else t.compressedTexImage3D(l.TEXTURE_2D_ARRAY,Ct,bt,zt.width,zt.height,Mt.depth,0,zt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Fn?Be&&t.texSubImage3D(l.TEXTURE_2D_ARRAY,Ct,0,0,0,zt.width,zt.height,Mt.depth,Rt,Qn,zt.data):t.texImage3D(l.TEXTURE_2D_ARRAY,Ct,bt,zt.width,zt.height,Mt.depth,0,Rt,Qn,zt.data)}else{Fn&&fi&&t.texStorage2D(l.TEXTURE_2D,Ht,bt,xt[0].width,xt[0].height);for(let Ct=0,It=xt.length;Ct<It;Ct++)zt=xt[Ct],pe.format!==Yo?Rt!==null?Fn?Be&&t.compressedTexSubImage2D(l.TEXTURE_2D,Ct,0,0,zt.width,zt.height,Rt,zt.data):t.compressedTexImage2D(l.TEXTURE_2D,Ct,bt,zt.width,zt.height,0,zt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Fn?Be&&t.texSubImage2D(l.TEXTURE_2D,Ct,0,0,zt.width,zt.height,Rt,Qn,zt.data):t.texImage2D(l.TEXTURE_2D,Ct,bt,zt.width,zt.height,0,Rt,Qn,zt.data)}else if(pe.isDataArrayTexture)if(Fn){if(fi&&t.texStorage3D(l.TEXTURE_2D_ARRAY,Ht,bt,Mt.width,Mt.height,Mt.depth),Be)if(pe.layerUpdates.size>0){const Ct=hE(Mt.width,Mt.height,pe.format,pe.type);for(const It of pe.layerUpdates){const Yt=Mt.data.subarray(It*Ct/Mt.data.BYTES_PER_ELEMENT,(It+1)*Ct/Mt.data.BYTES_PER_ELEMENT);t.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,It,Mt.width,Mt.height,1,Rt,Qn,Yt)}pe.clearLayerUpdates()}else t.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,0,Mt.width,Mt.height,Mt.depth,Rt,Qn,Mt.data)}else t.texImage3D(l.TEXTURE_2D_ARRAY,0,bt,Mt.width,Mt.height,Mt.depth,0,Rt,Qn,Mt.data);else if(pe.isData3DTexture)Fn?(fi&&t.texStorage3D(l.TEXTURE_3D,Ht,bt,Mt.width,Mt.height,Mt.depth),Be&&t.texSubImage3D(l.TEXTURE_3D,0,0,0,0,Mt.width,Mt.height,Mt.depth,Rt,Qn,Mt.data)):t.texImage3D(l.TEXTURE_3D,0,bt,Mt.width,Mt.height,Mt.depth,0,Rt,Qn,Mt.data);else if(pe.isFramebufferTexture){if(fi)if(Fn)t.texStorage2D(l.TEXTURE_2D,Ht,bt,Mt.width,Mt.height);else{let Ct=Mt.width,It=Mt.height;for(let Yt=0;Yt<Ht;Yt++)t.texImage2D(l.TEXTURE_2D,Yt,bt,Ct,It,0,Rt,Qn,null),Ct>>=1,It>>=1}}else if(xt.length>0){if(Fn&&fi){const Ct=ut(xt[0]);t.texStorage2D(l.TEXTURE_2D,Ht,bt,Ct.width,Ct.height)}for(let Ct=0,It=xt.length;Ct<It;Ct++)zt=xt[Ct],Fn?Be&&t.texSubImage2D(l.TEXTURE_2D,Ct,0,0,Rt,Qn,zt):t.texImage2D(l.TEXTURE_2D,Ct,bt,Rt,Qn,zt);pe.generateMipmaps=!1}else if(Fn){if(fi){const Ct=ut(Mt);t.texStorage2D(l.TEXTURE_2D,Ht,bt,Ct.width,Ct.height)}Be&&t.texSubImage2D(l.TEXTURE_2D,0,0,0,Rt,Qn,Mt)}else t.texImage2D(l.TEXTURE_2D,0,bt,Rt,Qn,Mt);$(pe)&&X(Ut),Dn.__version=Lt.version,pe.onUpdate&&pe.onUpdate(pe)}Pe.__version=pe.version}function ht(Pe,pe,dt){if(pe.image.length!==6)return;const Ut=Cn(Pe,pe),St=pe.source;t.bindTexture(l.TEXTURE_CUBE_MAP,Pe.__webglTexture,l.TEXTURE0+dt);const Lt=a.get(St);if(St.version!==Lt.__version||Ut===!0){t.activeTexture(l.TEXTURE0+dt);const Dn=Ki.getPrimaries(Ki.workingColorSpace),an=pe.colorSpace===hh?null:Ki.getPrimaries(pe.colorSpace),$e=pe.colorSpace===hh||Dn===an?l.NONE:l.BROWSER_DEFAULT_WEBGL;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,pe.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,pe.unpackAlignment),l.pixelStorei(l.UNPACK_COLORSPACE_CONVERSION_WEBGL,$e);const On=pe.isCompressedTexture||pe.image[0].isCompressedTexture,Mt=pe.image[0]&&pe.image[0].isDataTexture,Rt=[];for(let It=0;It<6;It++)!On&&!Mt?Rt[It]=re(pe.image[It],!0,d.maxCubemapSize):Rt[It]=Mt?pe.image[It].image:pe.image[It],Rt[It]=qn(pe,Rt[It]);const Qn=Rt[0],bt=g.convert(pe.format,pe.colorSpace),zt=g.convert(pe.type),xt=me(pe.internalFormat,bt,zt,pe.colorSpace),Fn=pe.isVideoTexture!==!0,fi=Lt.__version===void 0||Ut===!0,Be=St.dataReady;let Ht=ye(pe,Qn);jt(l.TEXTURE_CUBE_MAP,pe);let Ct;if(On){Fn&&fi&&t.texStorage2D(l.TEXTURE_CUBE_MAP,Ht,xt,Qn.width,Qn.height);for(let It=0;It<6;It++){Ct=Rt[It].mipmaps;for(let Yt=0;Yt<Ct.length;Yt++){const Se=Ct[Yt];pe.format!==Yo?bt!==null?Fn?Be&&t.compressedTexSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt,0,0,Se.width,Se.height,bt,Se.data):t.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt,xt,Se.width,Se.height,0,Se.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Fn?Be&&t.texSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt,0,0,Se.width,Se.height,bt,zt,Se.data):t.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt,xt,Se.width,Se.height,0,bt,zt,Se.data)}}}else{if(Ct=pe.mipmaps,Fn&&fi){Ct.length>0&&Ht++;const It=ut(Rt[0]);t.texStorage2D(l.TEXTURE_CUBE_MAP,Ht,xt,It.width,It.height)}for(let It=0;It<6;It++)if(Mt){Fn?Be&&t.texSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,0,0,0,Rt[It].width,Rt[It].height,bt,zt,Rt[It].data):t.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,0,xt,Rt[It].width,Rt[It].height,0,bt,zt,Rt[It].data);for(let Yt=0;Yt<Ct.length;Yt++){const te=Ct[Yt].image[It].image;Fn?Be&&t.texSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt+1,0,0,te.width,te.height,bt,zt,te.data):t.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt+1,xt,te.width,te.height,0,bt,zt,te.data)}}else{Fn?Be&&t.texSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,0,0,0,bt,zt,Rt[It]):t.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,0,xt,bt,zt,Rt[It]);for(let Yt=0;Yt<Ct.length;Yt++){const Se=Ct[Yt];Fn?Be&&t.texSubImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt+1,0,0,bt,zt,Se.image[It]):t.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+It,Yt+1,xt,bt,zt,Se.image[It])}}}$(pe)&&X(l.TEXTURE_CUBE_MAP),Lt.__version=St.version,pe.onUpdate&&pe.onUpdate(pe)}Pe.__version=pe.version}function Ft(Pe,pe,dt,Ut,St,Lt){const Dn=g.convert(dt.format,dt.colorSpace),an=g.convert(dt.type),$e=me(dt.internalFormat,Dn,an,dt.colorSpace);if(!a.get(pe).__hasExternalTextures){const Mt=Math.max(1,pe.width>>Lt),Rt=Math.max(1,pe.height>>Lt);St===l.TEXTURE_3D||St===l.TEXTURE_2D_ARRAY?t.texImage3D(St,Lt,$e,Mt,Rt,pe.depth,0,Dn,an,null):t.texImage2D(St,Lt,$e,Mt,Rt,0,Dn,an,null)}t.bindFramebuffer(l.FRAMEBUFFER,Pe),Ze(pe)?c.framebufferTexture2DMultisampleEXT(l.FRAMEBUFFER,Ut,St,a.get(dt).__webglTexture,0,Kn(pe)):(St===l.TEXTURE_2D||St>=l.TEXTURE_CUBE_MAP_POSITIVE_X&&St<=l.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&l.framebufferTexture2D(l.FRAMEBUFFER,Ut,St,a.get(dt).__webglTexture,Lt),t.bindFramebuffer(l.FRAMEBUFFER,null)}function mn(Pe,pe,dt){if(l.bindRenderbuffer(l.RENDERBUFFER,Pe),pe.depthBuffer){const Ut=pe.depthTexture,St=Ut&&Ut.isDepthTexture?Ut.type:null,Lt=le(pe.stencilBuffer,St),Dn=pe.stencilBuffer?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT,an=Kn(pe);Ze(pe)?c.renderbufferStorageMultisampleEXT(l.RENDERBUFFER,an,Lt,pe.width,pe.height):dt?l.renderbufferStorageMultisample(l.RENDERBUFFER,an,Lt,pe.width,pe.height):l.renderbufferStorage(l.RENDERBUFFER,Lt,pe.width,pe.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,Dn,l.RENDERBUFFER,Pe)}else{const Ut=pe.textures;for(let St=0;St<Ut.length;St++){const Lt=Ut[St],Dn=g.convert(Lt.format,Lt.colorSpace),an=g.convert(Lt.type),$e=me(Lt.internalFormat,Dn,an,Lt.colorSpace),On=Kn(pe);dt&&Ze(pe)===!1?l.renderbufferStorageMultisample(l.RENDERBUFFER,On,$e,pe.width,pe.height):Ze(pe)?c.renderbufferStorageMultisampleEXT(l.RENDERBUFFER,On,$e,pe.width,pe.height):l.renderbufferStorage(l.RENDERBUFFER,$e,pe.width,pe.height)}}l.bindRenderbuffer(l.RENDERBUFFER,null)}function cn(Pe,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(l.FRAMEBUFFER,Pe),!(pe.depthTexture&&pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!a.get(pe.depthTexture).__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),Je(pe.depthTexture,0);const Ut=a.get(pe.depthTexture).__webglTexture,St=Kn(pe);if(pe.depthTexture.format===Od)Ze(pe)?c.framebufferTexture2DMultisampleEXT(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.TEXTURE_2D,Ut,0,St):l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.TEXTURE_2D,Ut,0);else if(pe.depthTexture.format===Kd)Ze(pe)?c.framebufferTexture2DMultisampleEXT(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.TEXTURE_2D,Ut,0,St):l.framebufferTexture2D(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.TEXTURE_2D,Ut,0);else throw new Error("Unknown depthTexture format")}function qe(Pe){const pe=a.get(Pe),dt=Pe.isWebGLCubeRenderTarget===!0;if(Pe.depthTexture&&!pe.__autoAllocateDepthBuffer){if(dt)throw new Error("target.depthTexture not supported in Cube render targets");cn(pe.__webglFramebuffer,Pe)}else if(dt){pe.__webglDepthbuffer=[];for(let Ut=0;Ut<6;Ut++)t.bindFramebuffer(l.FRAMEBUFFER,pe.__webglFramebuffer[Ut]),pe.__webglDepthbuffer[Ut]=l.createRenderbuffer(),mn(pe.__webglDepthbuffer[Ut],Pe,!1)}else t.bindFramebuffer(l.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer=l.createRenderbuffer(),mn(pe.__webglDepthbuffer,Pe,!1);t.bindFramebuffer(l.FRAMEBUFFER,null)}function Wn(Pe,pe,dt){const Ut=a.get(Pe);pe!==void 0&&Ft(Ut.__webglFramebuffer,Pe,Pe.texture,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,0),dt!==void 0&&qe(Pe)}function bn(Pe){const pe=Pe.texture,dt=a.get(Pe),Ut=a.get(pe);Pe.addEventListener("dispose",Me);const St=Pe.textures,Lt=Pe.isWebGLCubeRenderTarget===!0,Dn=St.length>1;if(Dn||(Ut.__webglTexture===void 0&&(Ut.__webglTexture=l.createTexture()),Ut.__version=pe.version,_.memory.textures++),Lt){dt.__webglFramebuffer=[];for(let an=0;an<6;an++)if(pe.mipmaps&&pe.mipmaps.length>0){dt.__webglFramebuffer[an]=[];for(let $e=0;$e<pe.mipmaps.length;$e++)dt.__webglFramebuffer[an][$e]=l.createFramebuffer()}else dt.__webglFramebuffer[an]=l.createFramebuffer()}else{if(pe.mipmaps&&pe.mipmaps.length>0){dt.__webglFramebuffer=[];for(let an=0;an<pe.mipmaps.length;an++)dt.__webglFramebuffer[an]=l.createFramebuffer()}else dt.__webglFramebuffer=l.createFramebuffer();if(Dn)for(let an=0,$e=St.length;an<$e;an++){const On=a.get(St[an]);On.__webglTexture===void 0&&(On.__webglTexture=l.createTexture(),_.memory.textures++)}if(Pe.samples>0&&Ze(Pe)===!1){dt.__webglMultisampledFramebuffer=l.createFramebuffer(),dt.__webglColorRenderbuffer=[],t.bindFramebuffer(l.FRAMEBUFFER,dt.__webglMultisampledFramebuffer);for(let an=0;an<St.length;an++){const $e=St[an];dt.__webglColorRenderbuffer[an]=l.createRenderbuffer(),l.bindRenderbuffer(l.RENDERBUFFER,dt.__webglColorRenderbuffer[an]);const On=g.convert($e.format,$e.colorSpace),Mt=g.convert($e.type),Rt=me($e.internalFormat,On,Mt,$e.colorSpace,Pe.isXRRenderTarget===!0),Qn=Kn(Pe);l.renderbufferStorageMultisample(l.RENDERBUFFER,Qn,Rt,Pe.width,Pe.height),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0+an,l.RENDERBUFFER,dt.__webglColorRenderbuffer[an])}l.bindRenderbuffer(l.RENDERBUFFER,null),Pe.depthBuffer&&(dt.__webglDepthRenderbuffer=l.createRenderbuffer(),mn(dt.__webglDepthRenderbuffer,Pe,!0)),t.bindFramebuffer(l.FRAMEBUFFER,null)}}if(Lt){t.bindTexture(l.TEXTURE_CUBE_MAP,Ut.__webglTexture),jt(l.TEXTURE_CUBE_MAP,pe);for(let an=0;an<6;an++)if(pe.mipmaps&&pe.mipmaps.length>0)for(let $e=0;$e<pe.mipmaps.length;$e++)Ft(dt.__webglFramebuffer[an][$e],Pe,pe,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+an,$e);else Ft(dt.__webglFramebuffer[an],Pe,pe,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+an,0);$(pe)&&X(l.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Dn){for(let an=0,$e=St.length;an<$e;an++){const On=St[an],Mt=a.get(On);t.bindTexture(l.TEXTURE_2D,Mt.__webglTexture),jt(l.TEXTURE_2D,On),Ft(dt.__webglFramebuffer,Pe,On,l.COLOR_ATTACHMENT0+an,l.TEXTURE_2D,0),$(On)&&X(l.TEXTURE_2D)}t.unbindTexture()}else{let an=l.TEXTURE_2D;if((Pe.isWebGL3DRenderTarget||Pe.isWebGLArrayRenderTarget)&&(an=Pe.isWebGL3DRenderTarget?l.TEXTURE_3D:l.TEXTURE_2D_ARRAY),t.bindTexture(an,Ut.__webglTexture),jt(an,pe),pe.mipmaps&&pe.mipmaps.length>0)for(let $e=0;$e<pe.mipmaps.length;$e++)Ft(dt.__webglFramebuffer[$e],Pe,pe,l.COLOR_ATTACHMENT0,an,$e);else Ft(dt.__webglFramebuffer,Pe,pe,l.COLOR_ATTACHMENT0,an,0);$(pe)&&X(an),t.unbindTexture()}Pe.depthBuffer&&qe(Pe)}function nn(Pe){const pe=Pe.textures;for(let dt=0,Ut=pe.length;dt<Ut;dt++){const St=pe[dt];if($(St)){const Lt=Pe.isWebGLCubeRenderTarget?l.TEXTURE_CUBE_MAP:l.TEXTURE_2D,Dn=a.get(St).__webglTexture;t.bindTexture(Lt,Dn),X(Lt),t.unbindTexture()}}}const ne=[],ui=[];function Gn(Pe){if(Pe.samples>0){if(Ze(Pe)===!1){const pe=Pe.textures,dt=Pe.width,Ut=Pe.height;let St=l.COLOR_BUFFER_BIT;const Lt=Pe.stencilBuffer?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT,Dn=a.get(Pe),an=pe.length>1;if(an)for(let $e=0;$e<pe.length;$e++)t.bindFramebuffer(l.FRAMEBUFFER,Dn.__webglMultisampledFramebuffer),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0+$e,l.RENDERBUFFER,null),t.bindFramebuffer(l.FRAMEBUFFER,Dn.__webglFramebuffer),l.framebufferTexture2D(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0+$e,l.TEXTURE_2D,null,0);t.bindFramebuffer(l.READ_FRAMEBUFFER,Dn.__webglMultisampledFramebuffer),t.bindFramebuffer(l.DRAW_FRAMEBUFFER,Dn.__webglFramebuffer);for(let $e=0;$e<pe.length;$e++){if(Pe.resolveDepthBuffer&&(Pe.depthBuffer&&(St|=l.DEPTH_BUFFER_BIT),Pe.stencilBuffer&&Pe.resolveStencilBuffer&&(St|=l.STENCIL_BUFFER_BIT)),an){l.framebufferRenderbuffer(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.RENDERBUFFER,Dn.__webglColorRenderbuffer[$e]);const On=a.get(pe[$e]).__webglTexture;l.framebufferTexture2D(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,On,0)}l.blitFramebuffer(0,0,dt,Ut,0,0,dt,Ut,St,l.NEAREST),I===!0&&(ne.length=0,ui.length=0,ne.push(l.COLOR_ATTACHMENT0+$e),Pe.depthBuffer&&Pe.resolveDepthBuffer===!1&&(ne.push(Lt),ui.push(Lt),l.invalidateFramebuffer(l.DRAW_FRAMEBUFFER,ui)),l.invalidateFramebuffer(l.READ_FRAMEBUFFER,ne))}if(t.bindFramebuffer(l.READ_FRAMEBUFFER,null),t.bindFramebuffer(l.DRAW_FRAMEBUFFER,null),an)for(let $e=0;$e<pe.length;$e++){t.bindFramebuffer(l.FRAMEBUFFER,Dn.__webglMultisampledFramebuffer),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0+$e,l.RENDERBUFFER,Dn.__webglColorRenderbuffer[$e]);const On=a.get(pe[$e]).__webglTexture;t.bindFramebuffer(l.FRAMEBUFFER,Dn.__webglFramebuffer),l.framebufferTexture2D(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0+$e,l.TEXTURE_2D,On,0)}t.bindFramebuffer(l.DRAW_FRAMEBUFFER,Dn.__webglMultisampledFramebuffer)}else if(Pe.depthBuffer&&Pe.resolveDepthBuffer===!1&&I){const pe=Pe.stencilBuffer?l.DEPTH_STENCIL_ATTACHMENT:l.DEPTH_ATTACHMENT;l.invalidateFramebuffer(l.DRAW_FRAMEBUFFER,[pe])}}}function Kn(Pe){return Math.min(d.maxSamples,Pe.samples)}function Ze(Pe){const pe=a.get(Pe);return Pe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&pe.__useRenderToTexture!==!1}function hi(Pe){const pe=_.render.frame;F.get(Pe)!==pe&&(F.set(Pe,pe),Pe.update())}function qn(Pe,pe){const dt=Pe.colorSpace,Ut=Pe.format,St=Pe.type;return Pe.isCompressedTexture===!0||Pe.isVideoTexture===!0||dt!==ia&&dt!==hh&&(Ki.getTransfer(dt)===Dr?(Ut!==Yo||St!==bc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",dt)),pe}function ut(Pe){return typeof HTMLImageElement<"u"&&Pe instanceof HTMLImageElement?(P.width=Pe.naturalWidth||Pe.width,P.height=Pe.naturalHeight||Pe.height):typeof VideoFrame<"u"&&Pe instanceof VideoFrame?(P.width=Pe.displayWidth,P.height=Pe.displayHeight):(P.width=Pe.width,P.height=Pe.height),P}this.allocateTextureUnit=vt,this.resetTextureUnits=Oe,this.setTexture2D=Je,this.setTexture2DArray=mt,this.setTexture3D=gt,this.setTextureCube=wt,this.rebindTextures=Wn,this.setupRenderTarget=bn,this.updateRenderTargetMipmap=nn,this.updateMultisampleRenderTarget=Gn,this.setupDepthRenderbuffer=qe,this.setupFrameBufferTexture=Ft,this.useMultisampledRTT=Ze}function mz(l,e){function t(a,d=hh){let g;const _=Ki.getTransfer(d);if(a===bc)return l.UNSIGNED_BYTE;if(a===ib)return l.UNSIGNED_SHORT_4_4_4_4;if(a===rb)return l.UNSIGNED_SHORT_5_5_5_1;if(a===wM)return l.UNSIGNED_INT_5_9_9_9_REV;if(a===xM)return l.BYTE;if(a===bM)return l.SHORT;if(a===Rm)return l.UNSIGNED_SHORT;if(a===nb)return l.INT;if(a===vf)return l.UNSIGNED_INT;if(a===Rl)return l.FLOAT;if(a===Bm)return l.HALF_FLOAT;if(a===SM)return l.ALPHA;if(a===EM)return l.RGB;if(a===Yo)return l.RGBA;if(a===TM)return l.LUMINANCE;if(a===MM)return l.LUMINANCE_ALPHA;if(a===Od)return l.DEPTH_COMPONENT;if(a===Kd)return l.DEPTH_STENCIL;if(a===sb)return l.RED;if(a===ab)return l.RED_INTEGER;if(a===AM)return l.RG;if(a===ob)return l.RG_INTEGER;if(a===lb)return l.RGBA_INTEGER;if(a===oy||a===ly||a===uy||a===cy)if(_===Dr)if(g=e.get("WEBGL_compressed_texture_s3tc_srgb"),g!==null){if(a===oy)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===ly)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===uy)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===cy)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=e.get("WEBGL_compressed_texture_s3tc"),g!==null){if(a===oy)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===ly)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===uy)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===cy)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===Zx||a===Yx||a===Kx||a===Jx)if(g=e.get("WEBGL_compressed_texture_pvrtc"),g!==null){if(a===Zx)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===Yx)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===Kx)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===Jx)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===Qx||a===e1||a===t1)if(g=e.get("WEBGL_compressed_texture_etc"),g!==null){if(a===Qx||a===e1)return _===Dr?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(a===t1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===n1||a===i1||a===r1||a===s1||a===a1||a===o1||a===l1||a===u1||a===c1||a===h1||a===f1||a===d1||a===p1||a===m1)if(g=e.get("WEBGL_compressed_texture_astc"),g!==null){if(a===n1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===i1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===r1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===s1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===a1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===o1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===l1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===u1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===c1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===h1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===f1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===d1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===p1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===m1)return _===Dr?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===hy||a===g1||a===_1)if(g=e.get("EXT_texture_compression_bptc"),g!==null){if(a===hy)return _===Dr?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(a===g1)return g.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(a===_1)return g.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(a===IM||a===y1||a===v1||a===x1)if(g=e.get("EXT_texture_compression_rgtc"),g!==null){if(a===hy)return g.COMPRESSED_RED_RGTC1_EXT;if(a===y1)return g.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===v1)return g.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===x1)return g.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===Yd?l.UNSIGNED_INT_24_8:l[a]!==void 0?l[a]:null}return{convert:t}}class gz extends no{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ff extends Jr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _z={type:"move"};class sx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ff,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ff,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new lt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new lt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ff,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new lt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new lt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const a of e.hand.values())this._getHandJoint(t,a)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,a){let d=null,g=null,_=null;const c=this._targetRay,I=this._grip,P=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(P&&e.hand){_=!0;for(const re of e.hand.values()){const $=t.getJointPose(re,a),X=this._getHandJoint(P,re);$!==null&&(X.matrix.fromArray($.transform.matrix),X.matrix.decompose(X.position,X.rotation,X.scale),X.matrixWorldNeedsUpdate=!0,X.jointRadius=$.radius),X.visible=$!==null}const F=P.joints["index-finger-tip"],D=P.joints["thumb-tip"],N=F.position.distanceTo(D.position),G=.02,Z=.005;P.inputState.pinching&&N>G+Z?(P.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!P.inputState.pinching&&N<=G-Z&&(P.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else I!==null&&e.gripSpace&&(g=t.getPose(e.gripSpace,a),g!==null&&(I.matrix.fromArray(g.transform.matrix),I.matrix.decompose(I.position,I.rotation,I.scale),I.matrixWorldNeedsUpdate=!0,g.linearVelocity?(I.hasLinearVelocity=!0,I.linearVelocity.copy(g.linearVelocity)):I.hasLinearVelocity=!1,g.angularVelocity?(I.hasAngularVelocity=!0,I.angularVelocity.copy(g.angularVelocity)):I.hasAngularVelocity=!1));c!==null&&(d=t.getPose(e.targetRaySpace,a),d===null&&g!==null&&(d=g),d!==null&&(c.matrix.fromArray(d.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,d.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(d.linearVelocity)):c.hasLinearVelocity=!1,d.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(d.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(_z)))}return c!==null&&(c.visible=d!==null),I!==null&&(I.visible=g!==null),P!==null&&(P.visible=_!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const a=new ff;a.matrixAutoUpdate=!1,a.visible=!1,e.joints[t.jointName]=a,e.add(a)}return e.joints[t.jointName]}}const yz=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,vz=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class xz{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,a){if(this.texture===null){const d=new Hs,g=e.properties.get(d);g.__webglTexture=t.texture,(t.depthNear!=a.depthNear||t.depthFar!=a.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=d}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,a=new yh({vertexShader:yz,fragmentShader:vz,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new io(new Vm(20,20),a)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class bz extends lp{constructor(e,t){super();const a=this;let d=null,g=1,_=null,c="local-floor",I=1,P=null,F=null,D=null,N=null,G=null,Z=null;const re=new xz,$=t.getContextAttributes();let X=null,me=null;const le=[],ye=[],Le=new Pi;let Me=null;const Te=new no;Te.layers.enable(1),Te.viewport=new gr;const We=new no;We.layers.enable(2),We.viewport=new gr;const de=[Te,We],be=new gz;be.layers.enable(1),be.layers.enable(2);let Oe=null,vt=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ht){let Ft=le[ht];return Ft===void 0&&(Ft=new sx,le[ht]=Ft),Ft.getTargetRaySpace()},this.getControllerGrip=function(ht){let Ft=le[ht];return Ft===void 0&&(Ft=new sx,le[ht]=Ft),Ft.getGripSpace()},this.getHand=function(ht){let Ft=le[ht];return Ft===void 0&&(Ft=new sx,le[ht]=Ft),Ft.getHandSpace()};function st(ht){const Ft=ye.indexOf(ht.inputSource);if(Ft===-1)return;const mn=le[Ft];mn!==void 0&&(mn.update(ht.inputSource,ht.frame,P||_),mn.dispatchEvent({type:ht.type,data:ht.inputSource}))}function Je(){d.removeEventListener("select",st),d.removeEventListener("selectstart",st),d.removeEventListener("selectend",st),d.removeEventListener("squeeze",st),d.removeEventListener("squeezestart",st),d.removeEventListener("squeezeend",st),d.removeEventListener("end",Je),d.removeEventListener("inputsourceschange",mt);for(let ht=0;ht<le.length;ht++){const Ft=ye[ht];Ft!==null&&(ye[ht]=null,le[ht].disconnect(Ft))}Oe=null,vt=null,re.reset(),e.setRenderTarget(X),G=null,N=null,D=null,d=null,me=null,jn.stop(),a.isPresenting=!1,e.setPixelRatio(Me),e.setSize(Le.width,Le.height,!1),a.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ht){g=ht,a.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ht){c=ht,a.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return P||_},this.setReferenceSpace=function(ht){P=ht},this.getBaseLayer=function(){return N!==null?N:G},this.getBinding=function(){return D},this.getFrame=function(){return Z},this.getSession=function(){return d},this.setSession=async function(ht){if(d=ht,d!==null){if(X=e.getRenderTarget(),d.addEventListener("select",st),d.addEventListener("selectstart",st),d.addEventListener("selectend",st),d.addEventListener("squeeze",st),d.addEventListener("squeezestart",st),d.addEventListener("squeezeend",st),d.addEventListener("end",Je),d.addEventListener("inputsourceschange",mt),$.xrCompatible!==!0&&await t.makeXRCompatible(),Me=e.getPixelRatio(),e.getSize(Le),d.renderState.layers===void 0){const Ft={antialias:$.antialias,alpha:!0,depth:$.depth,stencil:$.stencil,framebufferScaleFactor:g};G=new XRWebGLLayer(d,t,Ft),d.updateRenderState({baseLayer:G}),e.setPixelRatio(1),e.setSize(G.framebufferWidth,G.framebufferHeight,!1),me=new xf(G.framebufferWidth,G.framebufferHeight,{format:Yo,type:bc,colorSpace:e.outputColorSpace,stencilBuffer:$.stencil})}else{let Ft=null,mn=null,cn=null;$.depth&&(cn=$.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ft=$.stencil?Kd:Od,mn=$.stencil?Yd:vf);const qe={colorFormat:t.RGBA8,depthFormat:cn,scaleFactor:g};D=new XRWebGLBinding(d,t),N=D.createProjectionLayer(qe),d.updateRenderState({layers:[N]}),e.setPixelRatio(1),e.setSize(N.textureWidth,N.textureHeight,!1),me=new xf(N.textureWidth,N.textureHeight,{format:Yo,type:bc,depthTexture:new GM(N.textureWidth,N.textureHeight,mn,void 0,void 0,void 0,void 0,void 0,void 0,Ft),stencilBuffer:$.stencil,colorSpace:e.outputColorSpace,samples:$.antialias?4:0,resolveDepthBuffer:N.ignoreDepthValues===!1})}me.isXRRenderTarget=!0,this.setFoveation(I),P=null,_=await d.requestReferenceSpace(c),jn.setContext(d),jn.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(d!==null)return d.environmentBlendMode},this.getDepthTexture=function(){return re.getDepthTexture()};function mt(ht){for(let Ft=0;Ft<ht.removed.length;Ft++){const mn=ht.removed[Ft],cn=ye.indexOf(mn);cn>=0&&(ye[cn]=null,le[cn].disconnect(mn))}for(let Ft=0;Ft<ht.added.length;Ft++){const mn=ht.added[Ft];let cn=ye.indexOf(mn);if(cn===-1){for(let Wn=0;Wn<le.length;Wn++)if(Wn>=ye.length){ye.push(mn),cn=Wn;break}else if(ye[Wn]===null){ye[Wn]=mn,cn=Wn;break}if(cn===-1)break}const qe=le[cn];qe&&qe.connect(mn)}}const gt=new lt,wt=new lt;function yt(ht,Ft,mn){gt.setFromMatrixPosition(Ft.matrixWorld),wt.setFromMatrixPosition(mn.matrixWorld);const cn=gt.distanceTo(wt),qe=Ft.projectionMatrix.elements,Wn=mn.projectionMatrix.elements,bn=qe[14]/(qe[10]-1),nn=qe[14]/(qe[10]+1),ne=(qe[9]+1)/qe[5],ui=(qe[9]-1)/qe[5],Gn=(qe[8]-1)/qe[0],Kn=(Wn[8]+1)/Wn[0],Ze=bn*Gn,hi=bn*Kn,qn=cn/(-Gn+Kn),ut=qn*-Gn;Ft.matrixWorld.decompose(ht.position,ht.quaternion,ht.scale),ht.translateX(ut),ht.translateZ(qn),ht.matrixWorld.compose(ht.position,ht.quaternion,ht.scale),ht.matrixWorldInverse.copy(ht.matrixWorld).invert();const Pe=bn+qn,pe=nn+qn,dt=Ze-ut,Ut=hi+(cn-ut),St=ne*nn/pe*Pe,Lt=ui*nn/pe*Pe;ht.projectionMatrix.makePerspective(dt,Ut,St,Lt,Pe,pe),ht.projectionMatrixInverse.copy(ht.projectionMatrix).invert()}function Jt(ht,Ft){Ft===null?ht.matrixWorld.copy(ht.matrix):ht.matrixWorld.multiplyMatrices(Ft.matrixWorld,ht.matrix),ht.matrixWorldInverse.copy(ht.matrixWorld).invert()}this.updateCamera=function(ht){if(d===null)return;re.texture!==null&&(ht.near=re.depthNear,ht.far=re.depthFar),be.near=We.near=Te.near=ht.near,be.far=We.far=Te.far=ht.far,(Oe!==be.near||vt!==be.far)&&(d.updateRenderState({depthNear:be.near,depthFar:be.far}),Oe=be.near,vt=be.far,Te.near=Oe,Te.far=vt,We.near=Oe,We.far=vt,Te.updateProjectionMatrix(),We.updateProjectionMatrix(),ht.updateProjectionMatrix());const Ft=ht.parent,mn=be.cameras;Jt(be,Ft);for(let cn=0;cn<mn.length;cn++)Jt(mn[cn],Ft);mn.length===2?yt(be,Te,We):be.projectionMatrix.copy(Te.projectionMatrix),Tt(ht,be,Ft)};function Tt(ht,Ft,mn){mn===null?ht.matrix.copy(Ft.matrixWorld):(ht.matrix.copy(mn.matrixWorld),ht.matrix.invert(),ht.matrix.multiply(Ft.matrixWorld)),ht.matrix.decompose(ht.position,ht.quaternion,ht.scale),ht.updateMatrixWorld(!0),ht.projectionMatrix.copy(Ft.projectionMatrix),ht.projectionMatrixInverse.copy(Ft.projectionMatrixInverse),ht.isPerspectiveCamera&&(ht.fov=Jd*2*Math.atan(1/ht.projectionMatrix.elements[5]),ht.zoom=1)}this.getCamera=function(){return be},this.getFoveation=function(){if(!(N===null&&G===null))return I},this.setFoveation=function(ht){I=ht,N!==null&&(N.fixedFoveation=ht),G!==null&&G.fixedFoveation!==void 0&&(G.fixedFoveation=ht)},this.hasDepthSensing=function(){return re.texture!==null},this.getDepthSensingMesh=function(){return re.getMesh(be)};let jt=null;function Cn(ht,Ft){if(F=Ft.getViewerPose(P||_),Z=Ft,F!==null){const mn=F.views;G!==null&&(e.setRenderTargetFramebuffer(me,G.framebuffer),e.setRenderTarget(me));let cn=!1;mn.length!==be.cameras.length&&(be.cameras.length=0,cn=!0);for(let Wn=0;Wn<mn.length;Wn++){const bn=mn[Wn];let nn=null;if(G!==null)nn=G.getViewport(bn);else{const ui=D.getViewSubImage(N,bn);nn=ui.viewport,Wn===0&&(e.setRenderTargetTextures(me,ui.colorTexture,N.ignoreDepthValues?void 0:ui.depthStencilTexture),e.setRenderTarget(me))}let ne=de[Wn];ne===void 0&&(ne=new no,ne.layers.enable(Wn),ne.viewport=new gr,de[Wn]=ne),ne.matrix.fromArray(bn.transform.matrix),ne.matrix.decompose(ne.position,ne.quaternion,ne.scale),ne.projectionMatrix.fromArray(bn.projectionMatrix),ne.projectionMatrixInverse.copy(ne.projectionMatrix).invert(),ne.viewport.set(nn.x,nn.y,nn.width,nn.height),Wn===0&&(be.matrix.copy(ne.matrix),be.matrix.decompose(be.position,be.quaternion,be.scale)),cn===!0&&be.cameras.push(ne)}const qe=d.enabledFeatures;if(qe&&qe.includes("depth-sensing")){const Wn=D.getDepthInformation(mn[0]);Wn&&Wn.isValid&&Wn.texture&&re.init(e,Wn,d.renderState)}}for(let mn=0;mn<le.length;mn++){const cn=ye[mn],qe=le[mn];cn!==null&&qe!==void 0&&qe.update(cn,Ft,P||_)}jt&&jt(ht,Ft),Ft.detectedPlanes&&a.dispatchEvent({type:"planesdetected",data:Ft}),Z=null}const jn=new VM;jn.setAnimationLoop(Cn),this.setAnimationLoop=function(ht){jt=ht},this.dispose=function(){}}}const af=new Su,wz=new xi;function Sz(l,e){function t($,X){$.matrixAutoUpdate===!0&&$.updateMatrix(),X.value.copy($.matrix)}function a($,X){X.color.getRGB($.fogColor.value,BM(l)),X.isFog?($.fogNear.value=X.near,$.fogFar.value=X.far):X.isFogExp2&&($.fogDensity.value=X.density)}function d($,X,me,le,ye){X.isMeshBasicMaterial||X.isMeshLambertMaterial?g($,X):X.isMeshToonMaterial?(g($,X),D($,X)):X.isMeshPhongMaterial?(g($,X),F($,X)):X.isMeshStandardMaterial?(g($,X),N($,X),X.isMeshPhysicalMaterial&&G($,X,ye)):X.isMeshMatcapMaterial?(g($,X),Z($,X)):X.isMeshDepthMaterial?g($,X):X.isMeshDistanceMaterial?(g($,X),re($,X)):X.isMeshNormalMaterial?g($,X):X.isLineBasicMaterial?(_($,X),X.isLineDashedMaterial&&c($,X)):X.isPointsMaterial?I($,X,me,le):X.isSpriteMaterial?P($,X):X.isShadowMaterial?($.color.value.copy(X.color),$.opacity.value=X.opacity):X.isShaderMaterial&&(X.uniformsNeedUpdate=!1)}function g($,X){$.opacity.value=X.opacity,X.color&&$.diffuse.value.copy(X.color),X.emissive&&$.emissive.value.copy(X.emissive).multiplyScalar(X.emissiveIntensity),X.map&&($.map.value=X.map,t(X.map,$.mapTransform)),X.alphaMap&&($.alphaMap.value=X.alphaMap,t(X.alphaMap,$.alphaMapTransform)),X.bumpMap&&($.bumpMap.value=X.bumpMap,t(X.bumpMap,$.bumpMapTransform),$.bumpScale.value=X.bumpScale,X.side===so&&($.bumpScale.value*=-1)),X.normalMap&&($.normalMap.value=X.normalMap,t(X.normalMap,$.normalMapTransform),$.normalScale.value.copy(X.normalScale),X.side===so&&$.normalScale.value.negate()),X.displacementMap&&($.displacementMap.value=X.displacementMap,t(X.displacementMap,$.displacementMapTransform),$.displacementScale.value=X.displacementScale,$.displacementBias.value=X.displacementBias),X.emissiveMap&&($.emissiveMap.value=X.emissiveMap,t(X.emissiveMap,$.emissiveMapTransform)),X.specularMap&&($.specularMap.value=X.specularMap,t(X.specularMap,$.specularMapTransform)),X.alphaTest>0&&($.alphaTest.value=X.alphaTest);const me=e.get(X),le=me.envMap,ye=me.envMapRotation;le&&($.envMap.value=le,af.copy(ye),af.x*=-1,af.y*=-1,af.z*=-1,le.isCubeTexture&&le.isRenderTargetTexture===!1&&(af.y*=-1,af.z*=-1),$.envMapRotation.value.setFromMatrix4(wz.makeRotationFromEuler(af)),$.flipEnvMap.value=le.isCubeTexture&&le.isRenderTargetTexture===!1?-1:1,$.reflectivity.value=X.reflectivity,$.ior.value=X.ior,$.refractionRatio.value=X.refractionRatio),X.lightMap&&($.lightMap.value=X.lightMap,$.lightMapIntensity.value=X.lightMapIntensity,t(X.lightMap,$.lightMapTransform)),X.aoMap&&($.aoMap.value=X.aoMap,$.aoMapIntensity.value=X.aoMapIntensity,t(X.aoMap,$.aoMapTransform))}function _($,X){$.diffuse.value.copy(X.color),$.opacity.value=X.opacity,X.map&&($.map.value=X.map,t(X.map,$.mapTransform))}function c($,X){$.dashSize.value=X.dashSize,$.totalSize.value=X.dashSize+X.gapSize,$.scale.value=X.scale}function I($,X,me,le){$.diffuse.value.copy(X.color),$.opacity.value=X.opacity,$.size.value=X.size*me,$.scale.value=le*.5,X.map&&($.map.value=X.map,t(X.map,$.uvTransform)),X.alphaMap&&($.alphaMap.value=X.alphaMap,t(X.alphaMap,$.alphaMapTransform)),X.alphaTest>0&&($.alphaTest.value=X.alphaTest)}function P($,X){$.diffuse.value.copy(X.color),$.opacity.value=X.opacity,$.rotation.value=X.rotation,X.map&&($.map.value=X.map,t(X.map,$.mapTransform)),X.alphaMap&&($.alphaMap.value=X.alphaMap,t(X.alphaMap,$.alphaMapTransform)),X.alphaTest>0&&($.alphaTest.value=X.alphaTest)}function F($,X){$.specular.value.copy(X.specular),$.shininess.value=Math.max(X.shininess,1e-4)}function D($,X){X.gradientMap&&($.gradientMap.value=X.gradientMap)}function N($,X){$.metalness.value=X.metalness,X.metalnessMap&&($.metalnessMap.value=X.metalnessMap,t(X.metalnessMap,$.metalnessMapTransform)),$.roughness.value=X.roughness,X.roughnessMap&&($.roughnessMap.value=X.roughnessMap,t(X.roughnessMap,$.roughnessMapTransform)),X.envMap&&($.envMapIntensity.value=X.envMapIntensity)}function G($,X,me){$.ior.value=X.ior,X.sheen>0&&($.sheenColor.value.copy(X.sheenColor).multiplyScalar(X.sheen),$.sheenRoughness.value=X.sheenRoughness,X.sheenColorMap&&($.sheenColorMap.value=X.sheenColorMap,t(X.sheenColorMap,$.sheenColorMapTransform)),X.sheenRoughnessMap&&($.sheenRoughnessMap.value=X.sheenRoughnessMap,t(X.sheenRoughnessMap,$.sheenRoughnessMapTransform))),X.clearcoat>0&&($.clearcoat.value=X.clearcoat,$.clearcoatRoughness.value=X.clearcoatRoughness,X.clearcoatMap&&($.clearcoatMap.value=X.clearcoatMap,t(X.clearcoatMap,$.clearcoatMapTransform)),X.clearcoatRoughnessMap&&($.clearcoatRoughnessMap.value=X.clearcoatRoughnessMap,t(X.clearcoatRoughnessMap,$.clearcoatRoughnessMapTransform)),X.clearcoatNormalMap&&($.clearcoatNormalMap.value=X.clearcoatNormalMap,t(X.clearcoatNormalMap,$.clearcoatNormalMapTransform),$.clearcoatNormalScale.value.copy(X.clearcoatNormalScale),X.side===so&&$.clearcoatNormalScale.value.negate())),X.dispersion>0&&($.dispersion.value=X.dispersion),X.iridescence>0&&($.iridescence.value=X.iridescence,$.iridescenceIOR.value=X.iridescenceIOR,$.iridescenceThicknessMinimum.value=X.iridescenceThicknessRange[0],$.iridescenceThicknessMaximum.value=X.iridescenceThicknessRange[1],X.iridescenceMap&&($.iridescenceMap.value=X.iridescenceMap,t(X.iridescenceMap,$.iridescenceMapTransform)),X.iridescenceThicknessMap&&($.iridescenceThicknessMap.value=X.iridescenceThicknessMap,t(X.iridescenceThicknessMap,$.iridescenceThicknessMapTransform))),X.transmission>0&&($.transmission.value=X.transmission,$.transmissionSamplerMap.value=me.texture,$.transmissionSamplerSize.value.set(me.width,me.height),X.transmissionMap&&($.transmissionMap.value=X.transmissionMap,t(X.transmissionMap,$.transmissionMapTransform)),$.thickness.value=X.thickness,X.thicknessMap&&($.thicknessMap.value=X.thicknessMap,t(X.thicknessMap,$.thicknessMapTransform)),$.attenuationDistance.value=X.attenuationDistance,$.attenuationColor.value.copy(X.attenuationColor)),X.anisotropy>0&&($.anisotropyVector.value.set(X.anisotropy*Math.cos(X.anisotropyRotation),X.anisotropy*Math.sin(X.anisotropyRotation)),X.anisotropyMap&&($.anisotropyMap.value=X.anisotropyMap,t(X.anisotropyMap,$.anisotropyMapTransform))),$.specularIntensity.value=X.specularIntensity,$.specularColor.value.copy(X.specularColor),X.specularColorMap&&($.specularColorMap.value=X.specularColorMap,t(X.specularColorMap,$.specularColorMapTransform)),X.specularIntensityMap&&($.specularIntensityMap.value=X.specularIntensityMap,t(X.specularIntensityMap,$.specularIntensityMapTransform))}function Z($,X){X.matcap&&($.matcap.value=X.matcap)}function re($,X){const me=e.get(X).light;$.referencePosition.value.setFromMatrixPosition(me.matrixWorld),$.nearDistance.value=me.shadow.camera.near,$.farDistance.value=me.shadow.camera.far}return{refreshFogUniforms:a,refreshMaterialUniforms:d}}function Ez(l,e,t,a){let d={},g={},_=[];const c=l.getParameter(l.MAX_UNIFORM_BUFFER_BINDINGS);function I(me,le){const ye=le.program;a.uniformBlockBinding(me,ye)}function P(me,le){let ye=d[me.id];ye===void 0&&(Z(me),ye=F(me),d[me.id]=ye,me.addEventListener("dispose",$));const Le=le.program;a.updateUBOMapping(me,Le);const Me=e.render.frame;g[me.id]!==Me&&(N(me),g[me.id]=Me)}function F(me){const le=D();me.__bindingPointIndex=le;const ye=l.createBuffer(),Le=me.__size,Me=me.usage;return l.bindBuffer(l.UNIFORM_BUFFER,ye),l.bufferData(l.UNIFORM_BUFFER,Le,Me),l.bindBuffer(l.UNIFORM_BUFFER,null),l.bindBufferBase(l.UNIFORM_BUFFER,le,ye),ye}function D(){for(let me=0;me<c;me++)if(_.indexOf(me)===-1)return _.push(me),me;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function N(me){const le=d[me.id],ye=me.uniforms,Le=me.__cache;l.bindBuffer(l.UNIFORM_BUFFER,le);for(let Me=0,Te=ye.length;Me<Te;Me++){const We=Array.isArray(ye[Me])?ye[Me]:[ye[Me]];for(let de=0,be=We.length;de<be;de++){const Oe=We[de];if(G(Oe,Me,de,Le)===!0){const vt=Oe.__offset,st=Array.isArray(Oe.value)?Oe.value:[Oe.value];let Je=0;for(let mt=0;mt<st.length;mt++){const gt=st[mt],wt=re(gt);typeof gt=="number"||typeof gt=="boolean"?(Oe.__data[0]=gt,l.bufferSubData(l.UNIFORM_BUFFER,vt+Je,Oe.__data)):gt.isMatrix3?(Oe.__data[0]=gt.elements[0],Oe.__data[1]=gt.elements[1],Oe.__data[2]=gt.elements[2],Oe.__data[3]=0,Oe.__data[4]=gt.elements[3],Oe.__data[5]=gt.elements[4],Oe.__data[6]=gt.elements[5],Oe.__data[7]=0,Oe.__data[8]=gt.elements[6],Oe.__data[9]=gt.elements[7],Oe.__data[10]=gt.elements[8],Oe.__data[11]=0):(gt.toArray(Oe.__data,Je),Je+=wt.storage/Float32Array.BYTES_PER_ELEMENT)}l.bufferSubData(l.UNIFORM_BUFFER,vt,Oe.__data)}}}l.bindBuffer(l.UNIFORM_BUFFER,null)}function G(me,le,ye,Le){const Me=me.value,Te=le+"_"+ye;if(Le[Te]===void 0)return typeof Me=="number"||typeof Me=="boolean"?Le[Te]=Me:Le[Te]=Me.clone(),!0;{const We=Le[Te];if(typeof Me=="number"||typeof Me=="boolean"){if(We!==Me)return Le[Te]=Me,!0}else if(We.equals(Me)===!1)return We.copy(Me),!0}return!1}function Z(me){const le=me.uniforms;let ye=0;const Le=16;for(let Te=0,We=le.length;Te<We;Te++){const de=Array.isArray(le[Te])?le[Te]:[le[Te]];for(let be=0,Oe=de.length;be<Oe;be++){const vt=de[be],st=Array.isArray(vt.value)?vt.value:[vt.value];for(let Je=0,mt=st.length;Je<mt;Je++){const gt=st[Je],wt=re(gt),yt=ye%Le,Jt=yt%wt.boundary,Tt=yt+Jt;ye+=Jt,Tt!==0&&Le-Tt<wt.storage&&(ye+=Le-Tt),vt.__data=new Float32Array(wt.storage/Float32Array.BYTES_PER_ELEMENT),vt.__offset=ye,ye+=wt.storage}}}const Me=ye%Le;return Me>0&&(ye+=Le-Me),me.__size=ye,me.__cache={},this}function re(me){const le={boundary:0,storage:0};return typeof me=="number"||typeof me=="boolean"?(le.boundary=4,le.storage=4):me.isVector2?(le.boundary=8,le.storage=8):me.isVector3||me.isColor?(le.boundary=16,le.storage=12):me.isVector4?(le.boundary=16,le.storage=16):me.isMatrix3?(le.boundary=48,le.storage=48):me.isMatrix4?(le.boundary=64,le.storage=64):me.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",me),le}function $(me){const le=me.target;le.removeEventListener("dispose",$);const ye=_.indexOf(le.__bindingPointIndex);_.splice(ye,1),l.deleteBuffer(d[le.id]),delete d[le.id],delete g[le.id]}function X(){for(const me in d)l.deleteBuffer(d[me]);_=[],d={},g={}}return{bind:I,update:P,dispose:X}}class Tz{constructor(e={}){const{canvas:t=mD(),context:a=null,depth:d=!0,stencil:g=!1,alpha:_=!1,antialias:c=!1,premultipliedAlpha:I=!0,preserveDrawingBuffer:P=!1,powerPreference:F="default",failIfMajorPerformanceCaveat:D=!1}=e;this.isWebGLRenderer=!0;let N;if(a!==null){if(typeof WebGLRenderingContext<"u"&&a instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");N=a.getContextAttributes().alpha}else N=_;const G=new Uint32Array(4),Z=new Int32Array(4);let re=null,$=null;const X=[],me=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Na,this.toneMapping=_h,this.toneMappingExposure=1;const le=this;let ye=!1,Le=0,Me=0,Te=null,We=-1,de=null;const be=new gr,Oe=new gr;let vt=null;const st=new _i(0);let Je=0,mt=t.width,gt=t.height,wt=1,yt=null,Jt=null;const Tt=new gr(0,0,mt,gt),jt=new gr(0,0,mt,gt);let Cn=!1;const jn=new fb;let ht=!1,Ft=!1;const mn=new xi,cn=new lt,qe=new gr,Wn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let bn=!1;function nn(){return Te===null?wt:1}let ne=a;function ui(ve,Ge){return t.getContext(ve,Ge)}try{const ve={alpha:!0,depth:d,stencil:g,antialias:c,premultipliedAlpha:I,preserveDrawingBuffer:P,powerPreference:F,failIfMajorPerformanceCaveat:D};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${tb}`),t.addEventListener("webglcontextlost",Ct,!1),t.addEventListener("webglcontextrestored",It,!1),t.addEventListener("webglcontextcreationerror",Yt,!1),ne===null){const Ge="webgl2";if(ne=ui(Ge,ve),ne===null)throw ui(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ve){throw console.error("THREE.WebGLRenderer: "+ve.message),ve}let Gn,Kn,Ze,hi,qn,ut,Pe,pe,dt,Ut,St,Lt,Dn,an,$e,On,Mt,Rt,Qn,bt,zt,xt,Fn,fi;function Be(){Gn=new PF(ne),Gn.init(),xt=new mz(ne,Gn),Kn=new TF(ne,Gn,e,xt),Ze=new fz(ne),hi=new DF(ne),qn=new J3,ut=new pz(ne,Gn,Ze,qn,Kn,xt,hi),Pe=new AF(le),pe=new RF(le),dt=new VD(ne),Fn=new SF(ne,dt),Ut=new LF(ne,dt,hi,Fn),St=new OF(ne,Ut,dt,hi),Qn=new NF(ne,Kn,ut),On=new MF(qn),Lt=new K3(le,Pe,pe,Gn,Kn,Fn,On),Dn=new Sz(le,qn),an=new ez,$e=new az(Gn),Rt=new wF(le,Pe,pe,Ze,St,N,I),Mt=new hz(le,St,Kn),fi=new Ez(ne,hi,Kn,Ze),bt=new EF(ne,Gn,hi),zt=new kF(ne,Gn,hi),hi.programs=Lt.programs,le.capabilities=Kn,le.extensions=Gn,le.properties=qn,le.renderLists=an,le.shadowMap=Mt,le.state=Ze,le.info=hi}Be();const Ht=new bz(le,ne);this.xr=Ht,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){const ve=Gn.get("WEBGL_lose_context");ve&&ve.loseContext()},this.forceContextRestore=function(){const ve=Gn.get("WEBGL_lose_context");ve&&ve.restoreContext()},this.getPixelRatio=function(){return wt},this.setPixelRatio=function(ve){ve!==void 0&&(wt=ve,this.setSize(mt,gt,!1))},this.getSize=function(ve){return ve.set(mt,gt)},this.setSize=function(ve,Ge,it=!0){if(Ht.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}mt=ve,gt=Ge,t.width=Math.floor(ve*wt),t.height=Math.floor(Ge*wt),it===!0&&(t.style.width=ve+"px",t.style.height=Ge+"px"),this.setViewport(0,0,ve,Ge)},this.getDrawingBufferSize=function(ve){return ve.set(mt*wt,gt*wt).floor()},this.setDrawingBufferSize=function(ve,Ge,it){mt=ve,gt=Ge,wt=it,t.width=Math.floor(ve*it),t.height=Math.floor(Ge*it),this.setViewport(0,0,ve,Ge)},this.getCurrentViewport=function(ve){return ve.copy(be)},this.getViewport=function(ve){return ve.copy(Tt)},this.setViewport=function(ve,Ge,it,at){ve.isVector4?Tt.set(ve.x,ve.y,ve.z,ve.w):Tt.set(ve,Ge,it,at),Ze.viewport(be.copy(Tt).multiplyScalar(wt).round())},this.getScissor=function(ve){return ve.copy(jt)},this.setScissor=function(ve,Ge,it,at){ve.isVector4?jt.set(ve.x,ve.y,ve.z,ve.w):jt.set(ve,Ge,it,at),Ze.scissor(Oe.copy(jt).multiplyScalar(wt).round())},this.getScissorTest=function(){return Cn},this.setScissorTest=function(ve){Ze.setScissorTest(Cn=ve)},this.setOpaqueSort=function(ve){yt=ve},this.setTransparentSort=function(ve){Jt=ve},this.getClearColor=function(ve){return ve.copy(Rt.getClearColor())},this.setClearColor=function(){Rt.setClearColor.apply(Rt,arguments)},this.getClearAlpha=function(){return Rt.getClearAlpha()},this.setClearAlpha=function(){Rt.setClearAlpha.apply(Rt,arguments)},this.clear=function(ve=!0,Ge=!0,it=!0){let at=0;if(ve){let Qe=!1;if(Te!==null){const Dt=Te.texture.format;Qe=Dt===lb||Dt===ob||Dt===ab}if(Qe){const Dt=Te.texture.type,en=Dt===bc||Dt===vf||Dt===Rm||Dt===Yd||Dt===ib||Dt===rb,Sn=Rt.getClearColor(),qt=Rt.getClearAlpha(),zn=Sn.r,Un=Sn.g,En=Sn.b;en?(G[0]=zn,G[1]=Un,G[2]=En,G[3]=qt,ne.clearBufferuiv(ne.COLOR,0,G)):(Z[0]=zn,Z[1]=Un,Z[2]=En,Z[3]=qt,ne.clearBufferiv(ne.COLOR,0,Z))}else at|=ne.COLOR_BUFFER_BIT}Ge&&(at|=ne.DEPTH_BUFFER_BIT),it&&(at|=ne.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ne.clear(at)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ct,!1),t.removeEventListener("webglcontextrestored",It,!1),t.removeEventListener("webglcontextcreationerror",Yt,!1),an.dispose(),$e.dispose(),qn.dispose(),Pe.dispose(),pe.dispose(),St.dispose(),Fn.dispose(),fi.dispose(),Lt.dispose(),Ht.dispose(),Ht.removeEventListener("sessionstart",Xe),Ht.removeEventListener("sessionend",et),Fe.stop()};function Ct(ve){ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ye=!0}function It(){console.log("THREE.WebGLRenderer: Context Restored."),ye=!1;const ve=hi.autoReset,Ge=Mt.enabled,it=Mt.autoUpdate,at=Mt.needsUpdate,Qe=Mt.type;Be(),hi.autoReset=ve,Mt.enabled=Ge,Mt.autoUpdate=it,Mt.needsUpdate=at,Mt.type=Qe}function Yt(ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ve.statusMessage)}function Se(ve){const Ge=ve.target;Ge.removeEventListener("dispose",Se),te(Ge)}function te(ve){ie(ve),qn.remove(ve)}function ie(ve){const Ge=qn.get(ve).programs;Ge!==void 0&&(Ge.forEach(function(it){Lt.releaseProgram(it)}),ve.isShaderMaterial&&Lt.releaseShaderCache(ve))}this.renderBufferDirect=function(ve,Ge,it,at,Qe,Dt){Ge===null&&(Ge=Wn);const en=Qe.isMesh&&Qe.matrixWorld.determinant()<0,Sn=kn(ve,Ge,it,at,Qe);Ze.setMaterial(at,en);let qt=it.index,zn=1;if(at.wireframe===!0){if(qt=Ut.getWireframeAttribute(it),qt===void 0)return;zn=2}const Un=it.drawRange,En=it.attributes.position;let Jn=Un.start*zn,Qi=(Un.start+Un.count)*zn;Dt!==null&&(Jn=Math.max(Jn,Dt.start*zn),Qi=Math.min(Qi,(Dt.start+Dt.count)*zn)),qt!==null?(Jn=Math.max(Jn,0),Qi=Math.min(Qi,qt.count)):En!=null&&(Jn=Math.max(Jn,0),Qi=Math.min(Qi,En.count));const Yn=Qi-Jn;if(Yn<0||Yn===1/0)return;Fn.setup(Qe,at,Sn,it,qt);let bi,pi=bt;if(qt!==null&&(bi=dt.get(qt),pi=zt,pi.setIndex(bi)),Qe.isMesh)at.wireframe===!0?(Ze.setLineWidth(at.wireframeLinewidth*nn()),pi.setMode(ne.LINES)):pi.setMode(ne.TRIANGLES);else if(Qe.isLine){let Tn=at.linewidth;Tn===void 0&&(Tn=1),Ze.setLineWidth(Tn*nn()),Qe.isLineSegments?pi.setMode(ne.LINES):Qe.isLineLoop?pi.setMode(ne.LINE_LOOP):pi.setMode(ne.LINE_STRIP)}else Qe.isPoints?pi.setMode(ne.POINTS):Qe.isSprite&&pi.setMode(ne.TRIANGLES);if(Qe.isBatchedMesh)if(Qe._multiDrawInstances!==null)pi.renderMultiDrawInstances(Qe._multiDrawStarts,Qe._multiDrawCounts,Qe._multiDrawCount,Qe._multiDrawInstances);else if(Gn.get("WEBGL_multi_draw"))pi.renderMultiDraw(Qe._multiDrawStarts,Qe._multiDrawCounts,Qe._multiDrawCount);else{const Tn=Qe._multiDrawStarts,oi=Qe._multiDrawCounts,si=Qe._multiDrawCount,wr=qt?dt.get(qt).bytesPerElement:1,Fi=qn.get(at).currentProgram.getUniforms();for(let _r=0;_r<si;_r++)Fi.setValue(ne,"_gl_DrawID",_r),pi.render(Tn[_r]/wr,oi[_r])}else if(Qe.isInstancedMesh)pi.renderInstances(Jn,Yn,Qe.count);else if(it.isInstancedBufferGeometry){const Tn=it._maxInstanceCount!==void 0?it._maxInstanceCount:1/0,oi=Math.min(it.instanceCount,Tn);pi.renderInstances(Jn,Yn,oi)}else pi.render(Jn,Yn)};function fe(ve,Ge,it){ve.transparent===!0&&ve.side===Al&&ve.forceSinglePass===!1?(ve.side=so,ve.needsUpdate=!0,An(ve,Ge,it),ve.side=xc,ve.needsUpdate=!0,An(ve,Ge,it),ve.side=Al):An(ve,Ge,it)}this.compile=function(ve,Ge,it=null){it===null&&(it=ve),$=$e.get(it),$.init(Ge),me.push($),it.traverseVisible(function(Qe){Qe.isLight&&Qe.layers.test(Ge.layers)&&($.pushLight(Qe),Qe.castShadow&&$.pushShadow(Qe))}),ve!==it&&ve.traverseVisible(function(Qe){Qe.isLight&&Qe.layers.test(Ge.layers)&&($.pushLight(Qe),Qe.castShadow&&$.pushShadow(Qe))}),$.setupLights();const at=new Set;return ve.traverse(function(Qe){const Dt=Qe.material;if(Dt)if(Array.isArray(Dt))for(let en=0;en<Dt.length;en++){const Sn=Dt[en];fe(Sn,it,Qe),at.add(Sn)}else fe(Dt,it,Qe),at.add(Dt)}),me.pop(),$=null,at},this.compileAsync=function(ve,Ge,it=null){const at=this.compile(ve,Ge,it);return new Promise(Qe=>{function Dt(){if(at.forEach(function(en){qn.get(en).currentProgram.isReady()&&at.delete(en)}),at.size===0){Qe(ve);return}setTimeout(Dt,10)}Gn.get("KHR_parallel_shader_compile")!==null?Dt():setTimeout(Dt,10)})};let ce=null;function Ve(ve){ce&&ce(ve)}function Xe(){Fe.stop()}function et(){Fe.start()}const Fe=new VM;Fe.setAnimationLoop(Ve),typeof self<"u"&&Fe.setContext(self),this.setAnimationLoop=function(ve){ce=ve,Ht.setAnimationLoop(ve),ve===null?Fe.stop():Fe.start()},Ht.addEventListener("sessionstart",Xe),Ht.addEventListener("sessionend",et),this.render=function(ve,Ge){if(Ge!==void 0&&Ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ye===!0)return;if(ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),Ht.enabled===!0&&Ht.isPresenting===!0&&(Ht.cameraAutoUpdate===!0&&Ht.updateCamera(Ge),Ge=Ht.getCamera()),ve.isScene===!0&&ve.onBeforeRender(le,ve,Ge,Te),$=$e.get(ve,me.length),$.init(Ge),me.push($),mn.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),jn.setFromProjectionMatrix(mn),Ft=this.localClippingEnabled,ht=On.init(this.clippingPlanes,Ft),re=an.get(ve,X.length),re.init(),X.push(re),Ht.enabled===!0&&Ht.isPresenting===!0){const Dt=le.xr.getDepthSensingMesh();Dt!==null&&_t(Dt,Ge,-1/0,le.sortObjects)}_t(ve,Ge,0,le.sortObjects),re.finish(),le.sortObjects===!0&&re.sort(yt,Jt),bn=Ht.enabled===!1||Ht.isPresenting===!1||Ht.hasDepthSensing()===!1,bn&&Rt.addToRenderList(re,ve),this.info.render.frame++,ht===!0&&On.beginShadows();const it=$.state.shadowsArray;Mt.render(it,ve,Ge),ht===!0&&On.endShadows(),this.info.autoReset===!0&&this.info.reset();const at=re.opaque,Qe=re.transmissive;if($.setupLights(),Ge.isArrayCamera){const Dt=Ge.cameras;if(Qe.length>0)for(let en=0,Sn=Dt.length;en<Sn;en++){const qt=Dt[en];ct(at,Qe,ve,qt)}bn&&Rt.render(ve);for(let en=0,Sn=Dt.length;en<Sn;en++){const qt=Dt[en];Pt(re,ve,qt,qt.viewport)}}else Qe.length>0&&ct(at,Qe,ve,Ge),bn&&Rt.render(ve),Pt(re,ve,Ge);Te!==null&&(ut.updateMultisampleRenderTarget(Te),ut.updateRenderTargetMipmap(Te)),ve.isScene===!0&&ve.onAfterRender(le,ve,Ge),Fn.resetDefaultState(),We=-1,de=null,me.pop(),me.length>0?($=me[me.length-1],ht===!0&&On.setGlobalState(le.clippingPlanes,$.state.camera)):$=null,X.pop(),X.length>0?re=X[X.length-1]:re=null};function _t(ve,Ge,it,at){if(ve.visible===!1)return;if(ve.layers.test(Ge.layers)){if(ve.isGroup)it=ve.renderOrder;else if(ve.isLOD)ve.autoUpdate===!0&&ve.update(Ge);else if(ve.isLight)$.pushLight(ve),ve.castShadow&&$.pushShadow(ve);else if(ve.isSprite){if(!ve.frustumCulled||jn.intersectsSprite(ve)){at&&qe.setFromMatrixPosition(ve.matrixWorld).applyMatrix4(mn);const en=St.update(ve),Sn=ve.material;Sn.visible&&re.push(ve,en,Sn,it,qe.z,null)}}else if((ve.isMesh||ve.isLine||ve.isPoints)&&(!ve.frustumCulled||jn.intersectsObject(ve))){const en=St.update(ve),Sn=ve.material;if(at&&(ve.boundingSphere!==void 0?(ve.boundingSphere===null&&ve.computeBoundingSphere(),qe.copy(ve.boundingSphere.center)):(en.boundingSphere===null&&en.computeBoundingSphere(),qe.copy(en.boundingSphere.center)),qe.applyMatrix4(ve.matrixWorld).applyMatrix4(mn)),Array.isArray(Sn)){const qt=en.groups;for(let zn=0,Un=qt.length;zn<Un;zn++){const En=qt[zn],Jn=Sn[En.materialIndex];Jn&&Jn.visible&&re.push(ve,en,Jn,it,qe.z,En)}}else Sn.visible&&re.push(ve,en,Sn,it,qe.z,null)}}const Dt=ve.children;for(let en=0,Sn=Dt.length;en<Sn;en++)_t(Dt[en],Ge,it,at)}function Pt(ve,Ge,it,at){const Qe=ve.opaque,Dt=ve.transmissive,en=ve.transparent;$.setupLightsView(it),ht===!0&&On.setGlobalState(le.clippingPlanes,it),at&&Ze.viewport(be.copy(at)),Qe.length>0&&Xt(Qe,Ge,it),Dt.length>0&&Xt(Dt,Ge,it),en.length>0&&Xt(en,Ge,it),Ze.buffers.depth.setTest(!0),Ze.buffers.depth.setMask(!0),Ze.buffers.color.setMask(!0),Ze.setPolygonOffset(!1)}function ct(ve,Ge,it,at){if((it.isScene===!0?it.overrideMaterial:null)!==null)return;$.state.transmissionRenderTarget[at.id]===void 0&&($.state.transmissionRenderTarget[at.id]=new xf(1,1,{generateMipmaps:!0,type:Gn.has("EXT_color_buffer_half_float")||Gn.has("EXT_color_buffer_float")?Bm:bc,minFilter:_c,samples:4,stencilBuffer:g,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Ki.workingColorSpace}));const Dt=$.state.transmissionRenderTarget[at.id],en=at.viewport||be;Dt.setSize(en.z,en.w);const Sn=le.getRenderTarget();le.setRenderTarget(Dt),le.getClearColor(st),Je=le.getClearAlpha(),Je<1&&le.setClearColor(16777215,.5),le.clear(),bn&&Rt.render(it);const qt=le.toneMapping;le.toneMapping=_h;const zn=at.viewport;if(at.viewport!==void 0&&(at.viewport=void 0),$.setupLightsView(at),ht===!0&&On.setGlobalState(le.clippingPlanes,at),Xt(ve,it,at),ut.updateMultisampleRenderTarget(Dt),ut.updateRenderTargetMipmap(Dt),Gn.has("WEBGL_multisampled_render_to_texture")===!1){let Un=!1;for(let En=0,Jn=Ge.length;En<Jn;En++){const Qi=Ge[En],Yn=Qi.object,bi=Qi.geometry,pi=Qi.material,Tn=Qi.group;if(pi.side===Al&&Yn.layers.test(at.layers)){const oi=pi.side;pi.side=so,pi.needsUpdate=!0,yn(Yn,it,at,bi,pi,Tn),pi.side=oi,pi.needsUpdate=!0,Un=!0}}Un===!0&&(ut.updateMultisampleRenderTarget(Dt),ut.updateRenderTargetMipmap(Dt))}le.setRenderTarget(Sn),le.setClearColor(st,Je),zn!==void 0&&(at.viewport=zn),le.toneMapping=qt}function Xt(ve,Ge,it){const at=Ge.isScene===!0?Ge.overrideMaterial:null;for(let Qe=0,Dt=ve.length;Qe<Dt;Qe++){const en=ve[Qe],Sn=en.object,qt=en.geometry,zn=at===null?en.material:at,Un=en.group;Sn.layers.test(it.layers)&&yn(Sn,Ge,it,qt,zn,Un)}}function yn(ve,Ge,it,at,Qe,Dt){ve.onBeforeRender(le,Ge,it,at,Qe,Dt),ve.modelViewMatrix.multiplyMatrices(it.matrixWorldInverse,ve.matrixWorld),ve.normalMatrix.getNormalMatrix(ve.modelViewMatrix),Qe.transparent===!0&&Qe.side===Al&&Qe.forceSinglePass===!1?(Qe.side=so,Qe.needsUpdate=!0,le.renderBufferDirect(it,Ge,at,Qe,ve,Dt),Qe.side=xc,Qe.needsUpdate=!0,le.renderBufferDirect(it,Ge,at,Qe,ve,Dt),Qe.side=Al):le.renderBufferDirect(it,Ge,at,Qe,ve,Dt),ve.onAfterRender(le,Ge,it,at,Qe,Dt)}function An(ve,Ge,it){Ge.isScene!==!0&&(Ge=Wn);const at=qn.get(ve),Qe=$.state.lights,Dt=$.state.shadowsArray,en=Qe.state.version,Sn=Lt.getParameters(ve,Qe.state,Dt,Ge,it),qt=Lt.getProgramCacheKey(Sn);let zn=at.programs;at.environment=ve.isMeshStandardMaterial?Ge.environment:null,at.fog=Ge.fog,at.envMap=(ve.isMeshStandardMaterial?pe:Pe).get(ve.envMap||at.environment),at.envMapRotation=at.environment!==null&&ve.envMap===null?Ge.environmentRotation:ve.envMapRotation,zn===void 0&&(ve.addEventListener("dispose",Se),zn=new Map,at.programs=zn);let Un=zn.get(qt);if(Un!==void 0){if(at.currentProgram===Un&&at.lightsStateVersion===en)return di(ve,Sn),Un}else Sn.uniforms=Lt.getUniforms(ve),ve.onBeforeCompile(Sn,le),Un=Lt.acquireProgram(Sn,qt),zn.set(qt,Un),at.uniforms=Sn.uniforms;const En=at.uniforms;return(!ve.isShaderMaterial&&!ve.isRawShaderMaterial||ve.clipping===!0)&&(En.clippingPlanes=On.uniform),di(ve,Sn),at.needsLights=Li(ve),at.lightsStateVersion=en,at.needsLights&&(En.ambientLightColor.value=Qe.state.ambient,En.lightProbe.value=Qe.state.probe,En.directionalLights.value=Qe.state.directional,En.directionalLightShadows.value=Qe.state.directionalShadow,En.spotLights.value=Qe.state.spot,En.spotLightShadows.value=Qe.state.spotShadow,En.rectAreaLights.value=Qe.state.rectArea,En.ltc_1.value=Qe.state.rectAreaLTC1,En.ltc_2.value=Qe.state.rectAreaLTC2,En.pointLights.value=Qe.state.point,En.pointLightShadows.value=Qe.state.pointShadow,En.hemisphereLights.value=Qe.state.hemi,En.directionalShadowMap.value=Qe.state.directionalShadowMap,En.directionalShadowMatrix.value=Qe.state.directionalShadowMatrix,En.spotShadowMap.value=Qe.state.spotShadowMap,En.spotLightMatrix.value=Qe.state.spotLightMatrix,En.spotLightMap.value=Qe.state.spotLightMap,En.pointShadowMap.value=Qe.state.pointShadowMap,En.pointShadowMatrix.value=Qe.state.pointShadowMatrix),at.currentProgram=Un,at.uniformsList=null,Un}function Hn(ve){if(ve.uniformsList===null){const Ge=ve.currentProgram.getUniforms();ve.uniformsList=fy.seqWithValue(Ge.seq,ve.uniforms)}return ve.uniformsList}function di(ve,Ge){const it=qn.get(ve);it.outputColorSpace=Ge.outputColorSpace,it.batching=Ge.batching,it.batchingColor=Ge.batchingColor,it.instancing=Ge.instancing,it.instancingColor=Ge.instancingColor,it.instancingMorph=Ge.instancingMorph,it.skinning=Ge.skinning,it.morphTargets=Ge.morphTargets,it.morphNormals=Ge.morphNormals,it.morphColors=Ge.morphColors,it.morphTargetsCount=Ge.morphTargetsCount,it.numClippingPlanes=Ge.numClippingPlanes,it.numIntersection=Ge.numClipIntersection,it.vertexAlphas=Ge.vertexAlphas,it.vertexTangents=Ge.vertexTangents,it.toneMapping=Ge.toneMapping}function kn(ve,Ge,it,at,Qe){Ge.isScene!==!0&&(Ge=Wn),ut.resetTextureUnits();const Dt=Ge.fog,en=at.isMeshStandardMaterial?Ge.environment:null,Sn=Te===null?le.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:ia,qt=(at.isMeshStandardMaterial?pe:Pe).get(at.envMap||en),zn=at.vertexColors===!0&&!!it.attributes.color&&it.attributes.color.itemSize===4,Un=!!it.attributes.tangent&&(!!at.normalMap||at.anisotropy>0),En=!!it.morphAttributes.position,Jn=!!it.morphAttributes.normal,Qi=!!it.morphAttributes.color;let Yn=_h;at.toneMapped&&(Te===null||Te.isXRRenderTarget===!0)&&(Yn=le.toneMapping);const bi=it.morphAttributes.position||it.morphAttributes.normal||it.morphAttributes.color,pi=bi!==void 0?bi.length:0,Tn=qn.get(at),oi=$.state.lights;if(ht===!0&&(Ft===!0||ve!==de)){const Ir=ve===de&&at.id===We;On.setState(at,ve,Ir)}let si=!1;at.version===Tn.__version?(Tn.needsLights&&Tn.lightsStateVersion!==oi.state.version||Tn.outputColorSpace!==Sn||Qe.isBatchedMesh&&Tn.batching===!1||!Qe.isBatchedMesh&&Tn.batching===!0||Qe.isBatchedMesh&&Tn.batchingColor===!0&&Qe.colorTexture===null||Qe.isBatchedMesh&&Tn.batchingColor===!1&&Qe.colorTexture!==null||Qe.isInstancedMesh&&Tn.instancing===!1||!Qe.isInstancedMesh&&Tn.instancing===!0||Qe.isSkinnedMesh&&Tn.skinning===!1||!Qe.isSkinnedMesh&&Tn.skinning===!0||Qe.isInstancedMesh&&Tn.instancingColor===!0&&Qe.instanceColor===null||Qe.isInstancedMesh&&Tn.instancingColor===!1&&Qe.instanceColor!==null||Qe.isInstancedMesh&&Tn.instancingMorph===!0&&Qe.morphTexture===null||Qe.isInstancedMesh&&Tn.instancingMorph===!1&&Qe.morphTexture!==null||Tn.envMap!==qt||at.fog===!0&&Tn.fog!==Dt||Tn.numClippingPlanes!==void 0&&(Tn.numClippingPlanes!==On.numPlanes||Tn.numIntersection!==On.numIntersection)||Tn.vertexAlphas!==zn||Tn.vertexTangents!==Un||Tn.morphTargets!==En||Tn.morphNormals!==Jn||Tn.morphColors!==Qi||Tn.toneMapping!==Yn||Tn.morphTargetsCount!==pi)&&(si=!0):(si=!0,Tn.__version=at.version);let wr=Tn.currentProgram;si===!0&&(wr=An(at,Ge,Qe));let Fi=!1,_r=!1,Gr=!1;const ki=wr.getUniforms(),Hi=Tn.uniforms;if(Ze.useProgram(wr.program)&&(Fi=!0,_r=!0,Gr=!0),at.id!==We&&(We=at.id,_r=!0),Fi||de!==ve){ki.setValue(ne,"projectionMatrix",ve.projectionMatrix),ki.setValue(ne,"viewMatrix",ve.matrixWorldInverse);const Ir=ki.map.cameraPosition;Ir!==void 0&&Ir.setValue(ne,cn.setFromMatrixPosition(ve.matrixWorld)),Kn.logarithmicDepthBuffer&&ki.setValue(ne,"logDepthBufFC",2/(Math.log(ve.far+1)/Math.LN2)),(at.isMeshPhongMaterial||at.isMeshToonMaterial||at.isMeshLambertMaterial||at.isMeshBasicMaterial||at.isMeshStandardMaterial||at.isShaderMaterial)&&ki.setValue(ne,"isOrthographic",ve.isOrthographicCamera===!0),de!==ve&&(de=ve,_r=!0,Gr=!0)}if(Qe.isSkinnedMesh){ki.setOptional(ne,Qe,"bindMatrix"),ki.setOptional(ne,Qe,"bindMatrixInverse");const Ir=Qe.skeleton;Ir&&(Ir.boneTexture===null&&Ir.computeBoneTexture(),ki.setValue(ne,"boneTexture",Ir.boneTexture,ut))}Qe.isBatchedMesh&&(ki.setOptional(ne,Qe,"batchingTexture"),ki.setValue(ne,"batchingTexture",Qe._matricesTexture,ut),ki.setOptional(ne,Qe,"batchingIdTexture"),ki.setValue(ne,"batchingIdTexture",Qe._indirectTexture,ut),ki.setOptional(ne,Qe,"batchingColorTexture"),Qe._colorsTexture!==null&&ki.setValue(ne,"batchingColorTexture",Qe._colorsTexture,ut));const ss=it.morphAttributes;if((ss.position!==void 0||ss.normal!==void 0||ss.color!==void 0)&&Qn.update(Qe,it,wr),(_r||Tn.receiveShadow!==Qe.receiveShadow)&&(Tn.receiveShadow=Qe.receiveShadow,ki.setValue(ne,"receiveShadow",Qe.receiveShadow)),at.isMeshGouraudMaterial&&at.envMap!==null&&(Hi.envMap.value=qt,Hi.flipEnvMap.value=qt.isCubeTexture&&qt.isRenderTargetTexture===!1?-1:1),at.isMeshStandardMaterial&&at.envMap===null&&Ge.environment!==null&&(Hi.envMapIntensity.value=Ge.environmentIntensity),_r&&(ki.setValue(ne,"toneMappingExposure",le.toneMappingExposure),Tn.needsLights&&Mi(Hi,Gr),Dt&&at.fog===!0&&Dn.refreshFogUniforms(Hi,Dt),Dn.refreshMaterialUniforms(Hi,at,wt,gt,$.state.transmissionRenderTarget[ve.id]),fy.upload(ne,Hn(Tn),Hi,ut)),at.isShaderMaterial&&at.uniformsNeedUpdate===!0&&(fy.upload(ne,Hn(Tn),Hi,ut),at.uniformsNeedUpdate=!1),at.isSpriteMaterial&&ki.setValue(ne,"center",Qe.center),ki.setValue(ne,"modelViewMatrix",Qe.modelViewMatrix),ki.setValue(ne,"normalMatrix",Qe.normalMatrix),ki.setValue(ne,"modelMatrix",Qe.matrixWorld),at.isShaderMaterial||at.isRawShaderMaterial){const Ir=at.uniformsGroups;for(let Nr=0,yi=Ir.length;Nr<yi;Nr++){const wa=Ir[Nr];fi.update(wa,wr),fi.bind(wa,wr)}}return wr}function Mi(ve,Ge){ve.ambientLightColor.needsUpdate=Ge,ve.lightProbe.needsUpdate=Ge,ve.directionalLights.needsUpdate=Ge,ve.directionalLightShadows.needsUpdate=Ge,ve.pointLights.needsUpdate=Ge,ve.pointLightShadows.needsUpdate=Ge,ve.spotLights.needsUpdate=Ge,ve.spotLightShadows.needsUpdate=Ge,ve.rectAreaLights.needsUpdate=Ge,ve.hemisphereLights.needsUpdate=Ge}function Li(ve){return ve.isMeshLambertMaterial||ve.isMeshToonMaterial||ve.isMeshPhongMaterial||ve.isMeshStandardMaterial||ve.isShadowMaterial||ve.isShaderMaterial&&ve.lights===!0}this.getActiveCubeFace=function(){return Le},this.getActiveMipmapLevel=function(){return Me},this.getRenderTarget=function(){return Te},this.setRenderTargetTextures=function(ve,Ge,it){qn.get(ve.texture).__webglTexture=Ge,qn.get(ve.depthTexture).__webglTexture=it;const at=qn.get(ve);at.__hasExternalTextures=!0,at.__autoAllocateDepthBuffer=it===void 0,at.__autoAllocateDepthBuffer||Gn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),at.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ve,Ge){const it=qn.get(ve);it.__webglFramebuffer=Ge,it.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(ve,Ge=0,it=0){Te=ve,Le=Ge,Me=it;let at=!0,Qe=null,Dt=!1,en=!1;if(ve){const qt=qn.get(ve);qt.__useDefaultFramebuffer!==void 0?(Ze.bindFramebuffer(ne.FRAMEBUFFER,null),at=!1):qt.__webglFramebuffer===void 0?ut.setupRenderTarget(ve):qt.__hasExternalTextures&&ut.rebindTextures(ve,qn.get(ve.texture).__webglTexture,qn.get(ve.depthTexture).__webglTexture);const zn=ve.texture;(zn.isData3DTexture||zn.isDataArrayTexture||zn.isCompressedArrayTexture)&&(en=!0);const Un=qn.get(ve).__webglFramebuffer;ve.isWebGLCubeRenderTarget?(Array.isArray(Un[Ge])?Qe=Un[Ge][it]:Qe=Un[Ge],Dt=!0):ve.samples>0&&ut.useMultisampledRTT(ve)===!1?Qe=qn.get(ve).__webglMultisampledFramebuffer:Array.isArray(Un)?Qe=Un[it]:Qe=Un,be.copy(ve.viewport),Oe.copy(ve.scissor),vt=ve.scissorTest}else be.copy(Tt).multiplyScalar(wt).floor(),Oe.copy(jt).multiplyScalar(wt).floor(),vt=Cn;if(Ze.bindFramebuffer(ne.FRAMEBUFFER,Qe)&&at&&Ze.drawBuffers(ve,Qe),Ze.viewport(be),Ze.scissor(Oe),Ze.setScissorTest(vt),Dt){const qt=qn.get(ve.texture);ne.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,qt.__webglTexture,it)}else if(en){const qt=qn.get(ve.texture),zn=Ge||0;ne.framebufferTextureLayer(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,qt.__webglTexture,it||0,zn)}We=-1},this.readRenderTargetPixels=function(ve,Ge,it,at,Qe,Dt,en){if(!(ve&&ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Sn=qn.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&en!==void 0&&(Sn=Sn[en]),Sn){Ze.bindFramebuffer(ne.FRAMEBUFFER,Sn);try{const qt=ve.texture,zn=qt.format,Un=qt.type;if(!Kn.textureFormatReadable(zn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Kn.textureTypeReadable(Un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ge>=0&&Ge<=ve.width-at&&it>=0&&it<=ve.height-Qe&&ne.readPixels(Ge,it,at,Qe,xt.convert(zn),xt.convert(Un),Dt)}finally{const qt=Te!==null?qn.get(Te).__webglFramebuffer:null;Ze.bindFramebuffer(ne.FRAMEBUFFER,qt)}}},this.readRenderTargetPixelsAsync=async function(ve,Ge,it,at,Qe,Dt,en){if(!(ve&&ve.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Sn=qn.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&en!==void 0&&(Sn=Sn[en]),Sn){Ze.bindFramebuffer(ne.FRAMEBUFFER,Sn);try{const qt=ve.texture,zn=qt.format,Un=qt.type;if(!Kn.textureFormatReadable(zn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Kn.textureTypeReadable(Un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ge>=0&&Ge<=ve.width-at&&it>=0&&it<=ve.height-Qe){const En=ne.createBuffer();ne.bindBuffer(ne.PIXEL_PACK_BUFFER,En),ne.bufferData(ne.PIXEL_PACK_BUFFER,Dt.byteLength,ne.STREAM_READ),ne.readPixels(Ge,it,at,Qe,xt.convert(zn),xt.convert(Un),0),ne.flush();const Jn=ne.fenceSync(ne.SYNC_GPU_COMMANDS_COMPLETE,0);await gD(ne,Jn,4);try{ne.bindBuffer(ne.PIXEL_PACK_BUFFER,En),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,Dt)}finally{ne.deleteBuffer(En),ne.deleteSync(Jn)}return Dt}}finally{const qt=Te!==null?qn.get(Te).__webglFramebuffer:null;Ze.bindFramebuffer(ne.FRAMEBUFFER,qt)}}},this.copyFramebufferToTexture=function(ve,Ge=null,it=0){ve.isTexture!==!0&&(Fd("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ge=arguments[0]||null,ve=arguments[1]);const at=Math.pow(2,-it),Qe=Math.floor(ve.image.width*at),Dt=Math.floor(ve.image.height*at),en=Ge!==null?Ge.x:0,Sn=Ge!==null?Ge.y:0;ut.setTexture2D(ve,0),ne.copyTexSubImage2D(ne.TEXTURE_2D,it,0,0,en,Sn,Qe,Dt),Ze.unbindTexture()},this.copyTextureToTexture=function(ve,Ge,it=null,at=null,Qe=0){ve.isTexture!==!0&&(Fd("WebGLRenderer: copyTextureToTexture function signature has changed."),at=arguments[0]||null,ve=arguments[1],Ge=arguments[2],Qe=arguments[3]||0,it=null);let Dt,en,Sn,qt,zn,Un;it!==null?(Dt=it.max.x-it.min.x,en=it.max.y-it.min.y,Sn=it.min.x,qt=it.min.y):(Dt=ve.image.width,en=ve.image.height,Sn=0,qt=0),at!==null?(zn=at.x,Un=at.y):(zn=0,Un=0);const En=xt.convert(Ge.format),Jn=xt.convert(Ge.type);ut.setTexture2D(Ge,0),ne.pixelStorei(ne.UNPACK_FLIP_Y_WEBGL,Ge.flipY),ne.pixelStorei(ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),ne.pixelStorei(ne.UNPACK_ALIGNMENT,Ge.unpackAlignment);const Qi=ne.getParameter(ne.UNPACK_ROW_LENGTH),Yn=ne.getParameter(ne.UNPACK_IMAGE_HEIGHT),bi=ne.getParameter(ne.UNPACK_SKIP_PIXELS),pi=ne.getParameter(ne.UNPACK_SKIP_ROWS),Tn=ne.getParameter(ne.UNPACK_SKIP_IMAGES),oi=ve.isCompressedTexture?ve.mipmaps[Qe]:ve.image;ne.pixelStorei(ne.UNPACK_ROW_LENGTH,oi.width),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,oi.height),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,Sn),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,qt),ve.isDataTexture?ne.texSubImage2D(ne.TEXTURE_2D,Qe,zn,Un,Dt,en,En,Jn,oi.data):ve.isCompressedTexture?ne.compressedTexSubImage2D(ne.TEXTURE_2D,Qe,zn,Un,oi.width,oi.height,En,oi.data):ne.texSubImage2D(ne.TEXTURE_2D,Qe,zn,Un,Dt,en,En,Jn,oi),ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Qi),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,Yn),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,bi),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,pi),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,Tn),Qe===0&&Ge.generateMipmaps&&ne.generateMipmap(ne.TEXTURE_2D),Ze.unbindTexture()},this.copyTextureToTexture3D=function(ve,Ge,it=null,at=null,Qe=0){ve.isTexture!==!0&&(Fd("WebGLRenderer: copyTextureToTexture3D function signature has changed."),it=arguments[0]||null,at=arguments[1]||null,ve=arguments[2],Ge=arguments[3],Qe=arguments[4]||0);let Dt,en,Sn,qt,zn,Un,En,Jn,Qi;const Yn=ve.isCompressedTexture?ve.mipmaps[Qe]:ve.image;it!==null?(Dt=it.max.x-it.min.x,en=it.max.y-it.min.y,Sn=it.max.z-it.min.z,qt=it.min.x,zn=it.min.y,Un=it.min.z):(Dt=Yn.width,en=Yn.height,Sn=Yn.depth,qt=0,zn=0,Un=0),at!==null?(En=at.x,Jn=at.y,Qi=at.z):(En=0,Jn=0,Qi=0);const bi=xt.convert(Ge.format),pi=xt.convert(Ge.type);let Tn;if(Ge.isData3DTexture)ut.setTexture3D(Ge,0),Tn=ne.TEXTURE_3D;else if(Ge.isDataArrayTexture||Ge.isCompressedArrayTexture)ut.setTexture2DArray(Ge,0),Tn=ne.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ne.pixelStorei(ne.UNPACK_FLIP_Y_WEBGL,Ge.flipY),ne.pixelStorei(ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),ne.pixelStorei(ne.UNPACK_ALIGNMENT,Ge.unpackAlignment);const oi=ne.getParameter(ne.UNPACK_ROW_LENGTH),si=ne.getParameter(ne.UNPACK_IMAGE_HEIGHT),wr=ne.getParameter(ne.UNPACK_SKIP_PIXELS),Fi=ne.getParameter(ne.UNPACK_SKIP_ROWS),_r=ne.getParameter(ne.UNPACK_SKIP_IMAGES);ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Yn.width),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,Yn.height),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,qt),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,zn),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,Un),ve.isDataTexture||ve.isData3DTexture?ne.texSubImage3D(Tn,Qe,En,Jn,Qi,Dt,en,Sn,bi,pi,Yn.data):Ge.isCompressedArrayTexture?ne.compressedTexSubImage3D(Tn,Qe,En,Jn,Qi,Dt,en,Sn,bi,Yn.data):ne.texSubImage3D(Tn,Qe,En,Jn,Qi,Dt,en,Sn,bi,pi,Yn),ne.pixelStorei(ne.UNPACK_ROW_LENGTH,oi),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,si),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,wr),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,Fi),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,_r),Qe===0&&Ge.generateMipmaps&&ne.generateMipmap(Tn),Ze.unbindTexture()},this.initRenderTarget=function(ve){qn.get(ve).__webglFramebuffer===void 0&&ut.setupRenderTarget(ve)},this.initTexture=function(ve){ve.isCubeTexture?ut.setTextureCube(ve,0):ve.isData3DTexture?ut.setTexture3D(ve,0):ve.isDataArrayTexture||ve.isCompressedArrayTexture?ut.setTexture2DArray(ve,0):ut.setTexture2D(ve,0),Ze.unbindTexture()},this.resetState=function(){Le=0,Me=0,Te=null,Ze.reset(),Fn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return yc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===ub?"display-p3":"srgb",t.unpackColorSpace=Ki.workingColorSpace===Ky?"display-p3":"srgb"}}class Mz extends Jr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Su,this.environmentIntensity=1,this.environmentRotation=new Su,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Az{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=w1,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Ll()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Fd("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,a){e*=this.stride,a*=t.stride;for(let d=0,g=this.stride;d<g;d++)this.array[e+d]=t.array[a+d];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ll()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),a=new this.constructor(t,this.stride);return a.setUsage(this.usage),a}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ll()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ka=new lt;class mb{constructor(e,t,a,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=a,this.normalized=d}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,a=this.data.count;t<a;t++)ka.fromBufferAttribute(this,t),ka.applyMatrix4(e),this.setXYZ(t,ka.x,ka.y,ka.z);return this}applyNormalMatrix(e){for(let t=0,a=this.count;t<a;t++)ka.fromBufferAttribute(this,t),ka.applyNormalMatrix(e),this.setXYZ(t,ka.x,ka.y,ka.z);return this}transformDirection(e){for(let t=0,a=this.count;t<a;t++)ka.fromBufferAttribute(this,t),ka.transformDirection(e),this.setXYZ(t,ka.x,ka.y,ka.z);return this}getComponent(e,t){let a=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(a=Il(a,this.array)),a}setComponent(e,t,a){return this.normalized&&(a=hr(a,this.array)),this.data.array[e*this.data.stride+this.offset+t]=a,this}setX(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=hr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Il(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Il(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Il(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Il(t,this.array)),t}setXY(e,t,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=a,this}setXYZ(e,t,a,d){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array),d=hr(d,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=a,this.data.array[e+2]=d,this}setXYZW(e,t,a,d,g){return e=e*this.data.stride+this.offset,this.normalized&&(t=hr(t,this.array),a=hr(a,this.array),d=hr(d,this.array),g=hr(g,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=a,this.data.array[e+2]=d,this.data.array[e+3]=g,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let a=0;a<this.count;a++){const d=a*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)t.push(this.data.array[d+g])}return new Fa(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new mb(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let a=0;a<this.count;a++){const d=a*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)t.push(this.data.array[d+g])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const fE=new lt,dE=new gr,pE=new gr,Iz=new lt,mE=new xi,U_=new lt,ax=new Mu,gE=new xi,ox=new Jy;class Cz extends io{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=gS,this.bindMatrix=new xi,this.bindMatrixInverse=new xi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new wc),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let a=0;a<t.count;a++)this.getVertexPosition(a,U_),this.boundingBox.expandByPoint(U_)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Mu),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let a=0;a<t.count;a++)this.getVertexPosition(a,U_),this.boundingSphere.expandByPoint(U_)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const a=this.material,d=this.matrixWorld;a!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ax.copy(this.boundingSphere),ax.applyMatrix4(d),e.ray.intersectsSphere(ax)!==!1&&(gE.copy(d).invert(),ox.copy(e.ray).applyMatrix4(gE),!(this.boundingBox!==null&&ox.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,ox)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new gr,t=this.geometry.attributes.skinWeight;for(let a=0,d=t.count;a<d;a++){e.fromBufferAttribute(t,a);const g=1/e.manhattanLength();g!==1/0?e.multiplyScalar(g):e.set(1,0,0,0),t.setXYZW(a,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===gS?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Bk?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const a=this.skeleton,d=this.geometry;dE.fromBufferAttribute(d.attributes.skinIndex,e),pE.fromBufferAttribute(d.attributes.skinWeight,e),fE.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let g=0;g<4;g++){const _=pE.getComponent(g);if(_!==0){const c=dE.getComponent(g);mE.multiplyMatrices(a.bones[c].matrixWorld,a.boneInverses[c]),t.addScaledVector(Iz.copy(fE).applyMatrix4(mE),_)}}return t.applyMatrix4(this.bindMatrixInverse)}}class XM extends Jr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class jM extends Hs{constructor(e=null,t=1,a=1,d,g,_,c,I,P=Oa,F=Oa,D,N){super(null,_,c,I,P,F,d,g,D,N),this.isDataTexture=!0,this.image={data:e,width:t,height:a},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _E=new xi,Rz=new xi;class gb{constructor(e=[],t=[]){this.uuid=Ll(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let a=0,d=this.bones.length;a<d;a++)this.boneInverses.push(new xi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const a=new xi;this.bones[e]&&a.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(a)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const a=this.bones[e];a&&a.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const a=this.bones[e];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}update(){const e=this.bones,t=this.boneInverses,a=this.boneMatrices,d=this.boneTexture;for(let g=0,_=e.length;g<_;g++){const c=e[g]?e[g].matrixWorld:Rz;_E.multiplyMatrices(c,t[g]),_E.toArray(a,g*16)}d!==null&&(d.needsUpdate=!0)}clone(){return new gb(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const a=new jM(t,e,e,Yo,Rl);return a.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=a,this}getBoneByName(e){for(let t=0,a=this.bones.length;t<a;t++){const d=this.bones[t];if(d.name===e)return d}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let a=0,d=e.bones.length;a<d;a++){const g=e.bones[a];let _=t[g];_===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",g),_=new XM),this.bones.push(_),this.boneInverses.push(new xi().fromArray(e.boneInverses[a]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,a=this.boneInverses;for(let d=0,g=t.length;d<g;d++){const _=t[d];e.bones.push(_.uuid);const c=a[d];e.boneInverses.push(c.toArray())}return e}}class E1 extends Fa{constructor(e,t,a,d=1){super(e,t,a),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Rd=new xi,yE=new xi,V_=[],vE=new wc,Pz=new xi,cm=new io,hm=new Mu;class Lz extends io{constructor(e,t,a){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new E1(new Float32Array(a*16),16),this.instanceColor=null,this.morphTexture=null,this.count=a,this.boundingBox=null,this.boundingSphere=null;for(let d=0;d<a;d++)this.setMatrixAt(d,Pz)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new wc),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let a=0;a<t;a++)this.getMatrixAt(a,Rd),vE.copy(e.boundingBox).applyMatrix4(Rd),this.boundingBox.union(vE)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Mu),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let a=0;a<t;a++)this.getMatrixAt(a,Rd),hm.copy(e.boundingSphere).applyMatrix4(Rd),this.boundingSphere.union(hm)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const a=t.morphTargetInfluences,d=this.morphTexture.source.data.data,g=a.length+1,_=e*g+1;for(let c=0;c<a.length;c++)a[c]=d[_+c]}raycast(e,t){const a=this.matrixWorld,d=this.count;if(cm.geometry=this.geometry,cm.material=this.material,cm.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),hm.copy(this.boundingSphere),hm.applyMatrix4(a),e.ray.intersectsSphere(hm)!==!1))for(let g=0;g<d;g++){this.getMatrixAt(g,Rd),yE.multiplyMatrices(a,Rd),cm.matrixWorld=yE,cm.raycast(e,V_);for(let _=0,c=V_.length;_<c;_++){const I=V_[_];I.instanceId=g,I.object=this,t.push(I)}V_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new E1(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const a=t.morphTargetInfluences,d=a.length+1;this.morphTexture===null&&(this.morphTexture=new jM(new Float32Array(d*this.count),d,this.count,sb,Rl));const g=this.morphTexture.source.data.data;let _=0;for(let P=0;P<a.length;P++)_+=a[P];const c=this.geometry.morphTargetsRelative?1:1-_,I=d*e;g[I]=c,g.set(a,I+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class ZM extends xu{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new _i(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Uy=new lt,Vy=new lt,xE=new xi,fm=new Jy,G_=new Mu,lx=new lt,bE=new lt;class _b extends Jr{constructor(e=new Au,t=new ZM){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,a=[0];for(let d=1,g=t.count;d<g;d++)Uy.fromBufferAttribute(t,d-1),Vy.fromBufferAttribute(t,d),a[d]=a[d-1],a[d]+=Uy.distanceTo(Vy);e.setAttribute("lineDistance",new vc(a,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const a=this.geometry,d=this.matrixWorld,g=e.params.Line.threshold,_=a.drawRange;if(a.boundingSphere===null&&a.computeBoundingSphere(),G_.copy(a.boundingSphere),G_.applyMatrix4(d),G_.radius+=g,e.ray.intersectsSphere(G_)===!1)return;xE.copy(d).invert(),fm.copy(e.ray).applyMatrix4(xE);const c=g/((this.scale.x+this.scale.y+this.scale.z)/3),I=c*c,P=this.isLineSegments?2:1,F=a.index,N=a.attributes.position;if(F!==null){const G=Math.max(0,_.start),Z=Math.min(F.count,_.start+_.count);for(let re=G,$=Z-1;re<$;re+=P){const X=F.getX(re),me=F.getX(re+1),le=H_(this,e,fm,I,X,me);le&&t.push(le)}if(this.isLineLoop){const re=F.getX(Z-1),$=F.getX(G),X=H_(this,e,fm,I,re,$);X&&t.push(X)}}else{const G=Math.max(0,_.start),Z=Math.min(N.count,_.start+_.count);for(let re=G,$=Z-1;re<$;re+=P){const X=H_(this,e,fm,I,re,re+1);X&&t.push(X)}if(this.isLineLoop){const re=H_(this,e,fm,I,Z-1,G);re&&t.push(re)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,a=Object.keys(t);if(a.length>0){const d=t[a[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,_=d.length;g<_;g++){const c=d[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=g}}}}}function H_(l,e,t,a,d,g){const _=l.geometry.attributes.position;if(Uy.fromBufferAttribute(_,d),Vy.fromBufferAttribute(_,g),t.distanceSqToSegment(Uy,Vy,lx,bE)>a)return;lx.applyMatrix4(l.matrixWorld);const I=e.ray.origin.distanceTo(lx);if(!(I<e.near||I>e.far))return{distance:I,point:bE.clone().applyMatrix4(l.matrixWorld),index:d,face:null,faceIndex:null,object:l}}const wE=new lt,SE=new lt;class kz extends _b{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,a=[];for(let d=0,g=t.count;d<g;d+=2)wE.fromBufferAttribute(t,d),SE.fromBufferAttribute(t,d+1),a[d]=d===0?0:a[d-1],a[d+1]=a[d]+wE.distanceTo(SE);e.setAttribute("lineDistance",new vc(a,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Dz extends _b{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class YM extends xu{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new _i(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const EE=new xi,T1=new Jy,W_=new Mu,q_=new lt;class Nz extends Jr{constructor(e=new Au,t=new YM){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const a=this.geometry,d=this.matrixWorld,g=e.params.Points.threshold,_=a.drawRange;if(a.boundingSphere===null&&a.computeBoundingSphere(),W_.copy(a.boundingSphere),W_.applyMatrix4(d),W_.radius+=g,e.ray.intersectsSphere(W_)===!1)return;EE.copy(d).invert(),T1.copy(e.ray).applyMatrix4(EE);const c=g/((this.scale.x+this.scale.y+this.scale.z)/3),I=c*c,P=a.index,D=a.attributes.position;if(P!==null){const N=Math.max(0,_.start),G=Math.min(P.count,_.start+_.count);for(let Z=N,re=G;Z<re;Z++){const $=P.getX(Z);q_.fromBufferAttribute(D,$),TE(q_,$,I,d,e,t,this)}}else{const N=Math.max(0,_.start),G=Math.min(D.count,_.start+_.count);for(let Z=N,re=G;Z<re;Z++)q_.fromBufferAttribute(D,Z),TE(q_,Z,I,d,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,a=Object.keys(t);if(a.length>0){const d=t[a[0]];if(d!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let g=0,_=d.length;g<_;g++){const c=d[g].name||String(g);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=g}}}}}function TE(l,e,t,a,d,g,_){const c=T1.distanceSqToPoint(l);if(c<t){const I=new lt;T1.closestPointToPoint(l,I),I.applyMatrix4(a);const P=d.ray.origin.distanceTo(I);if(P<d.near||P>d.far)return;g.push({distance:P,distanceToRay:Math.sqrt(c),point:I,index:e,face:null,object:_})}}class yb extends xu{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new _i(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new _i(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=RM,this.normalScale=new Pi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Su,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Iu extends yb{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Pi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return xa(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new _i(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new _i(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new _i(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function $_(l,e,t){return!l||!t&&l.constructor===e?l:typeof e.BYTES_PER_ELEMENT=="number"?new e(l):Array.prototype.slice.call(l)}function Oz(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}function Fz(l){function e(d,g){return l[d]-l[g]}const t=l.length,a=new Array(t);for(let d=0;d!==t;++d)a[d]=d;return a.sort(e),a}function ME(l,e,t){const a=l.length,d=new l.constructor(a);for(let g=0,_=0;_!==a;++g){const c=t[g]*e;for(let I=0;I!==e;++I)d[_++]=l[c+I]}return d}function KM(l,e,t,a){let d=1,g=l[0];for(;g!==void 0&&g[a]===void 0;)g=l[d++];if(g===void 0)return;let _=g[a];if(_!==void 0)if(Array.isArray(_))do _=g[a],_!==void 0&&(e.push(g.time),t.push.apply(t,_)),g=l[d++];while(g!==void 0);else if(_.toArray!==void 0)do _=g[a],_!==void 0&&(e.push(g.time),_.toArray(t,t.length)),g=l[d++];while(g!==void 0);else do _=g[a],_!==void 0&&(e.push(g.time),t.push(_)),g=l[d++];while(g!==void 0)}class Gm{constructor(e,t,a,d){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=d!==void 0?d:new t.constructor(a),this.sampleValues=t,this.valueSize=a,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let a=this._cachedIndex,d=t[a],g=t[a-1];e:{t:{let _;n:{i:if(!(e<d)){for(let c=a+2;;){if(d===void 0){if(e<g)break i;return a=t.length,this._cachedIndex=a,this.copySampleValue_(a-1)}if(a===c)break;if(g=d,d=t[++a],e<d)break t}_=t.length;break n}if(!(e>=g)){const c=t[1];e<c&&(a=2,g=c);for(let I=a-2;;){if(g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===I)break;if(d=g,g=t[--a-1],e>=g)break t}_=a,a=0;break n}break e}for(;a<_;){const c=a+_>>>1;e<t[c]?_=c:a=c+1}if(d=t[a],g=t[a-1],g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===void 0)return a=t.length,this._cachedIndex=a,this.copySampleValue_(a-1)}this._cachedIndex=a,this.intervalChanged_(a,g,d)}return this.interpolate_(a,g,e,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,a=this.sampleValues,d=this.valueSize,g=e*d;for(let _=0;_!==d;++_)t[_]=a[g+_];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class zz extends Gm{constructor(e,t,a,d){super(e,t,a,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:_S,endingEnd:_S}}intervalChanged_(e,t,a){const d=this.parameterPositions;let g=e-2,_=e+1,c=d[g],I=d[_];if(c===void 0)switch(this.getSettings_().endingStart){case yS:g=e,c=2*t-a;break;case vS:g=d.length-2,c=t+d[g]-d[g+1];break;default:g=e,c=a}if(I===void 0)switch(this.getSettings_().endingEnd){case yS:_=e,I=2*a-t;break;case vS:_=1,I=a+d[1]-d[0];break;default:_=e-1,I=t}const P=(a-t)*.5,F=this.valueSize;this._weightPrev=P/(t-c),this._weightNext=P/(I-a),this._offsetPrev=g*F,this._offsetNext=_*F}interpolate_(e,t,a,d){const g=this.resultBuffer,_=this.sampleValues,c=this.valueSize,I=e*c,P=I-c,F=this._offsetPrev,D=this._offsetNext,N=this._weightPrev,G=this._weightNext,Z=(a-t)/(d-t),re=Z*Z,$=re*Z,X=-N*$+2*N*re-N*Z,me=(1+N)*$+(-1.5-2*N)*re+(-.5+N)*Z+1,le=(-1-G)*$+(1.5+G)*re+.5*Z,ye=G*$-G*re;for(let Le=0;Le!==c;++Le)g[Le]=X*_[F+Le]+me*_[P+Le]+le*_[I+Le]+ye*_[D+Le];return g}}class Bz extends Gm{constructor(e,t,a,d){super(e,t,a,d)}interpolate_(e,t,a,d){const g=this.resultBuffer,_=this.sampleValues,c=this.valueSize,I=e*c,P=I-c,F=(a-t)/(d-t),D=1-F;for(let N=0;N!==c;++N)g[N]=_[P+N]*D+_[I+N]*F;return g}}class Uz extends Gm{constructor(e,t,a,d){super(e,t,a,d)}interpolate_(e){return this.copySampleValue_(e-1)}}class Cu{constructor(e,t,a,d){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=$_(t,this.TimeBufferType),this.values=$_(a,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let a;if(t.toJSON!==this.toJSON)a=t.toJSON(e);else{a={name:e.name,times:$_(e.times,Array),values:$_(e.values,Array)};const d=e.getInterpolation();d!==e.DefaultInterpolation&&(a.interpolation=d)}return a.type=e.ValueTypeName,a}InterpolantFactoryMethodDiscrete(e){return new Uz(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Bz(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new zz(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Pm:t=this.InterpolantFactoryMethodDiscrete;break;case Lm:t=this.InterpolantFactoryMethodLinear;break;case D0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(a);return console.warn("THREE.KeyframeTrack:",a),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pm;case this.InterpolantFactoryMethodLinear:return Lm;case this.InterpolantFactoryMethodSmooth:return D0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let a=0,d=t.length;a!==d;++a)t[a]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let a=0,d=t.length;a!==d;++a)t[a]*=e}return this}trim(e,t){const a=this.times,d=a.length;let g=0,_=d-1;for(;g!==d&&a[g]<e;)++g;for(;_!==-1&&a[_]>t;)--_;if(++_,g!==0||_!==d){g>=_&&(_=Math.max(_,1),g=_-1);const c=this.getValueSize();this.times=a.slice(g,_),this.values=this.values.slice(g*c,_*c)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const a=this.times,d=this.values,g=a.length;g===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let _=null;for(let c=0;c!==g;c++){const I=a[c];if(typeof I=="number"&&isNaN(I)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,I),e=!1;break}if(_!==null&&_>I){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,I,_),e=!1;break}_=I}if(d!==void 0&&Oz(d))for(let c=0,I=d.length;c!==I;++c){const P=d[c];if(isNaN(P)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,P),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),a=this.getValueSize(),d=this.getInterpolation()===D0,g=e.length-1;let _=1;for(let c=1;c<g;++c){let I=!1;const P=e[c],F=e[c+1];if(P!==F&&(c!==1||P!==e[0]))if(d)I=!0;else{const D=c*a,N=D-a,G=D+a;for(let Z=0;Z!==a;++Z){const re=t[D+Z];if(re!==t[N+Z]||re!==t[G+Z]){I=!0;break}}}if(I){if(c!==_){e[_]=e[c];const D=c*a,N=_*a;for(let G=0;G!==a;++G)t[N+G]=t[D+G]}++_}}if(g>0){e[_]=e[g];for(let c=g*a,I=_*a,P=0;P!==a;++P)t[I+P]=t[c+P];++_}return _!==e.length?(this.times=e.slice(0,_),this.values=t.slice(0,_*a)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),a=this.constructor,d=new a(this.name,e,t);return d.createInterpolant=this.createInterpolant,d}}Cu.prototype.TimeBufferType=Float32Array;Cu.prototype.ValueBufferType=Float32Array;Cu.prototype.DefaultInterpolation=Lm;class cp extends Cu{constructor(e,t,a){super(e,t,a)}}cp.prototype.ValueTypeName="bool";cp.prototype.ValueBufferType=Array;cp.prototype.DefaultInterpolation=Pm;cp.prototype.InterpolantFactoryMethodLinear=void 0;cp.prototype.InterpolantFactoryMethodSmooth=void 0;class JM extends Cu{}JM.prototype.ValueTypeName="color";class ep extends Cu{}ep.prototype.ValueTypeName="number";class Vz extends Gm{constructor(e,t,a,d){super(e,t,a,d)}interpolate_(e,t,a,d){const g=this.resultBuffer,_=this.sampleValues,c=this.valueSize,I=(a-t)/(d-t);let P=e*c;for(let F=P+c;P!==F;P+=4)wh.slerpFlat(g,0,_,P-c,_,P,I);return g}}class tp extends Cu{InterpolantFactoryMethodLinear(e){return new Vz(this.times,this.values,this.getValueSize(),e)}}tp.prototype.ValueTypeName="quaternion";tp.prototype.InterpolantFactoryMethodSmooth=void 0;class hp extends Cu{constructor(e,t,a){super(e,t,a)}}hp.prototype.ValueTypeName="string";hp.prototype.ValueBufferType=Array;hp.prototype.DefaultInterpolation=Pm;hp.prototype.InterpolantFactoryMethodLinear=void 0;hp.prototype.InterpolantFactoryMethodSmooth=void 0;class np extends Cu{}np.prototype.ValueTypeName="vector";class Gz{constructor(e="",t=-1,a=[],d=Uk){this.name=e,this.tracks=a,this.duration=t,this.blendMode=d,this.uuid=Ll(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],a=e.tracks,d=1/(e.fps||1);for(let _=0,c=a.length;_!==c;++_)t.push(Wz(a[_]).scale(d));const g=new this(e.name,e.duration,t,e.blendMode);return g.uuid=e.uuid,g}static toJSON(e){const t=[],a=e.tracks,d={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let g=0,_=a.length;g!==_;++g)t.push(Cu.toJSON(a[g]));return d}static CreateFromMorphTargetSequence(e,t,a,d){const g=t.length,_=[];for(let c=0;c<g;c++){let I=[],P=[];I.push((c+g-1)%g,c,(c+1)%g),P.push(0,1,0);const F=Fz(I);I=ME(I,1,F),P=ME(P,1,F),!d&&I[0]===0&&(I.push(g),P.push(P[0])),_.push(new ep(".morphTargetInfluences["+t[c].name+"]",I,P).scale(1/a))}return new this(e,-1,_)}static findByName(e,t){let a=e;if(!Array.isArray(e)){const d=e;a=d.geometry&&d.geometry.animations||d.animations}for(let d=0;d<a.length;d++)if(a[d].name===t)return a[d];return null}static CreateClipsFromMorphTargetSequences(e,t,a){const d={},g=/^([\w-]*?)([\d]+)$/;for(let c=0,I=e.length;c<I;c++){const P=e[c],F=P.name.match(g);if(F&&F.length>1){const D=F[1];let N=d[D];N||(d[D]=N=[]),N.push(P)}}const _=[];for(const c in d)_.push(this.CreateFromMorphTargetSequence(c,d[c],t,a));return _}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const a=function(D,N,G,Z,re){if(G.length!==0){const $=[],X=[];KM(G,$,X,Z),$.length!==0&&re.push(new D(N,$,X))}},d=[],g=e.name||"default",_=e.fps||30,c=e.blendMode;let I=e.length||-1;const P=e.hierarchy||[];for(let D=0;D<P.length;D++){const N=P[D].keys;if(!(!N||N.length===0))if(N[0].morphTargets){const G={};let Z;for(Z=0;Z<N.length;Z++)if(N[Z].morphTargets)for(let re=0;re<N[Z].morphTargets.length;re++)G[N[Z].morphTargets[re]]=-1;for(const re in G){const $=[],X=[];for(let me=0;me!==N[Z].morphTargets.length;++me){const le=N[Z];$.push(le.time),X.push(le.morphTarget===re?1:0)}d.push(new ep(".morphTargetInfluence["+re+"]",$,X))}I=G.length*_}else{const G=".bones["+t[D].name+"]";a(np,G+".position",N,"pos",d),a(tp,G+".quaternion",N,"rot",d),a(np,G+".scale",N,"scl",d)}}return d.length===0?null:new this(g,I,d,c)}resetDuration(){const e=this.tracks;let t=0;for(let a=0,d=e.length;a!==d;++a){const g=this.tracks[a];t=Math.max(t,g.times[g.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Hz(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ep;case"vector":case"vector2":case"vector3":case"vector4":return np;case"color":return JM;case"quaternion":return tp;case"bool":case"boolean":return cp;case"string":return hp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}function Wz(l){if(l.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Hz(l.type);if(l.times===void 0){const t=[],a=[];KM(l.keys,t,a,"value"),l.times=t,l.values=a}return e.parse!==void 0?e.parse(l):new e(l.name,l.times,l.values,l.interpolation)}const mh={enabled:!1,files:{},add:function(l,e){this.enabled!==!1&&(this.files[l]=e)},get:function(l){if(this.enabled!==!1)return this.files[l]},remove:function(l){delete this.files[l]},clear:function(){this.files={}}};class qz{constructor(e,t,a){const d=this;let g=!1,_=0,c=0,I;const P=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=a,this.itemStart=function(F){c++,g===!1&&d.onStart!==void 0&&d.onStart(F,_,c),g=!0},this.itemEnd=function(F){_++,d.onProgress!==void 0&&d.onProgress(F,_,c),_===c&&(g=!1,d.onLoad!==void 0&&d.onLoad())},this.itemError=function(F){d.onError!==void 0&&d.onError(F)},this.resolveURL=function(F){return I?I(F):F},this.setURLModifier=function(F){return I=F,this},this.addHandler=function(F,D){return P.push(F,D),this},this.removeHandler=function(F){const D=P.indexOf(F);return D!==-1&&P.splice(D,2),this},this.getHandler=function(F){for(let D=0,N=P.length;D<N;D+=2){const G=P[D],Z=P[D+1];if(G.global&&(G.lastIndex=0),G.test(F))return Z}return null}}}const $z=new qz;class fp{constructor(e){this.manager=e!==void 0?e:$z,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const a=this;return new Promise(function(d,g){a.load(e,d,t,g)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}fp.DEFAULT_MATERIAL_NAME="__DEFAULT";const pc={};class Xz extends Error{constructor(e,t){super(e),this.response=t}}class QM extends fp{constructor(e){super(e)}load(e,t,a,d){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=mh.get(e);if(g!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(g),this.manager.itemEnd(e)},0),g;if(pc[e]!==void 0){pc[e].push({onLoad:t,onProgress:a,onError:d});return}pc[e]=[],pc[e].push({onLoad:t,onProgress:a,onError:d});const _=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),c=this.mimeType,I=this.responseType;fetch(_).then(P=>{if(P.status===200||P.status===0){if(P.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||P.body===void 0||P.body.getReader===void 0)return P;const F=pc[e],D=P.body.getReader(),N=P.headers.get("X-File-Size")||P.headers.get("Content-Length"),G=N?parseInt(N):0,Z=G!==0;let re=0;const $=new ReadableStream({start(X){me();function me(){D.read().then(({done:le,value:ye})=>{if(le)X.close();else{re+=ye.byteLength;const Le=new ProgressEvent("progress",{lengthComputable:Z,loaded:re,total:G});for(let Me=0,Te=F.length;Me<Te;Me++){const We=F[Me];We.onProgress&&We.onProgress(Le)}X.enqueue(ye),me()}},le=>{X.error(le)})}}});return new Response($)}else throw new Xz(`fetch for "${P.url}" responded with ${P.status}: ${P.statusText}`,P)}).then(P=>{switch(I){case"arraybuffer":return P.arrayBuffer();case"blob":return P.blob();case"document":return P.text().then(F=>new DOMParser().parseFromString(F,c));case"json":return P.json();default:if(c===void 0)return P.text();{const D=/charset="?([^;"\s]*)"?/i.exec(c),N=D&&D[1]?D[1].toLowerCase():void 0,G=new TextDecoder(N);return P.arrayBuffer().then(Z=>G.decode(Z))}}}).then(P=>{mh.add(e,P);const F=pc[e];delete pc[e];for(let D=0,N=F.length;D<N;D++){const G=F[D];G.onLoad&&G.onLoad(P)}}).catch(P=>{const F=pc[e];if(F===void 0)throw this.manager.itemError(e),P;delete pc[e];for(let D=0,N=F.length;D<N;D++){const G=F[D];G.onError&&G.onError(P)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class jz extends fp{constructor(e){super(e)}load(e,t,a,d){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=this,_=mh.get(e);if(_!==void 0)return g.manager.itemStart(e),setTimeout(function(){t&&t(_),g.manager.itemEnd(e)},0),_;const c=km("img");function I(){F(),mh.add(e,this),t&&t(this),g.manager.itemEnd(e)}function P(D){F(),d&&d(D),g.manager.itemError(e),g.manager.itemEnd(e)}function F(){c.removeEventListener("load",I,!1),c.removeEventListener("error",P,!1)}return c.addEventListener("load",I,!1),c.addEventListener("error",P,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),g.manager.itemStart(e),c.src=e,c}}class eA extends fp{constructor(e){super(e)}load(e,t,a,d){const g=new Hs,_=new jz(this.manager);return _.setCrossOrigin(this.crossOrigin),_.setPath(this.path),_.load(e,function(c){g.image=c,g.needsUpdate=!0,t!==void 0&&t(g)},a,d),g}}class ev extends Jr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new _i(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const ux=new xi,AE=new lt,IE=new lt;class vb{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pi(512,512),this.map=null,this.mapPass=null,this.matrix=new xi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new fb,this._frameExtents=new Pi(1,1),this._viewportCount=1,this._viewports=[new gr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,a=this.matrix;AE.setFromMatrixPosition(e.matrixWorld),t.position.copy(AE),IE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(IE),t.updateMatrixWorld(),ux.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ux),a.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),a.multiply(ux)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Zz extends vb{constructor(){super(new no(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,a=Jd*2*e.angle*this.focus,d=this.mapSize.width/this.mapSize.height,g=e.distance||t.far;(a!==t.fov||d!==t.aspect||g!==t.far)&&(t.fov=a,t.aspect=d,t.far=g,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Yz extends ev{constructor(e,t,a=0,d=Math.PI/3,g=0,_=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Jr.DEFAULT_UP),this.updateMatrix(),this.target=new Jr,this.distance=a,this.angle=d,this.penumbra=g,this.decay=_,this.map=null,this.shadow=new Zz}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const CE=new xi,dm=new lt,cx=new lt;class Kz extends vb{constructor(){super(new no(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Pi(4,2),this._viewportCount=6,this._viewports=[new gr(2,1,1,1),new gr(0,1,1,1),new gr(3,1,1,1),new gr(1,1,1,1),new gr(3,0,1,1),new gr(1,0,1,1)],this._cubeDirections=[new lt(1,0,0),new lt(-1,0,0),new lt(0,0,1),new lt(0,0,-1),new lt(0,1,0),new lt(0,-1,0)],this._cubeUps=[new lt(0,1,0),new lt(0,1,0),new lt(0,1,0),new lt(0,1,0),new lt(0,0,1),new lt(0,0,-1)]}updateMatrices(e,t=0){const a=this.camera,d=this.matrix,g=e.distance||a.far;g!==a.far&&(a.far=g,a.updateProjectionMatrix()),dm.setFromMatrixPosition(e.matrixWorld),a.position.copy(dm),cx.copy(a.position),cx.add(this._cubeDirections[t]),a.up.copy(this._cubeUps[t]),a.lookAt(cx),a.updateMatrixWorld(),d.makeTranslation(-dm.x,-dm.y,-dm.z),CE.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this._frustum.setFromProjectionMatrix(CE)}}class Jz extends ev{constructor(e,t,a=0,d=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=a,this.decay=d,this.shadow=new Kz}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Qz extends vb{constructor(){super(new db(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class eB extends ev{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Jr.DEFAULT_UP),this.updateMatrix(),this.target=new Jr,this.shadow=new Qz}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class tB extends ev{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Am{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let a=0,d=e.length;a<d;a++)t+=String.fromCharCode(e[a]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class nB extends fp{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,a,d){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const g=this,_=mh.get(e);if(_!==void 0){if(g.manager.itemStart(e),_.then){_.then(P=>{t&&t(P),g.manager.itemEnd(e)}).catch(P=>{d&&d(P)});return}return setTimeout(function(){t&&t(_),g.manager.itemEnd(e)},0),_}const c={};c.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",c.headers=this.requestHeader;const I=fetch(e,c).then(function(P){return P.blob()}).then(function(P){return createImageBitmap(P,Object.assign(g.options,{colorSpaceConversion:"none"}))}).then(function(P){return mh.add(e,P),t&&t(P),g.manager.itemEnd(e),P}).catch(function(P){d&&d(P),mh.remove(e),g.manager.itemError(e),g.manager.itemEnd(e)});mh.add(e,I),g.manager.itemStart(e)}}const xb="\\[\\]\\.:\\/",iB=new RegExp("["+xb+"]","g"),bb="[^"+xb+"]",rB="[^"+xb.replace("\\.","")+"]",sB=/((?:WC+[\/:])*)/.source.replace("WC",bb),aB=/(WCOD+)?/.source.replace("WCOD",rB),oB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",bb),lB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",bb),uB=new RegExp("^"+sB+aB+oB+lB+"$"),cB=["material","materials","bones","map"];class hB{constructor(e,t,a){const d=a||fr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,d)}getValue(e,t){this.bind();const a=this._targetGroup.nCachedObjects_,d=this._bindings[a];d!==void 0&&d.getValue(e,t)}setValue(e,t){const a=this._bindings;for(let d=this._targetGroup.nCachedObjects_,g=a.length;d!==g;++d)a[d].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t)e[t].unbind()}}class fr{constructor(e,t,a){this.path=t,this.parsedPath=a||fr.parseTrackName(t),this.node=fr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,a){return e&&e.isAnimationObjectGroup?new fr.Composite(e,t,a):new fr(e,t,a)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(iB,"")}static parseTrackName(e){const t=uB.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},d=a.nodeName&&a.nodeName.lastIndexOf(".");if(d!==void 0&&d!==-1){const g=a.nodeName.substring(d+1);cB.indexOf(g)!==-1&&(a.nodeName=a.nodeName.substring(0,d),a.objectName=g)}if(a.propertyName===null||a.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return a}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const a=e.skeleton.getBoneByName(t);if(a!==void 0)return a}if(e.children){const a=function(g){for(let _=0;_<g.length;_++){const c=g[_];if(c.name===t||c.uuid===t)return c;const I=a(c.children);if(I)return I}return null},d=a(e.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const a=this.resolvedProperty;for(let d=0,g=a.length;d!==g;++d)e[t++]=a[d]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const a=this.resolvedProperty;for(let d=0,g=a.length;d!==g;++d)a[d]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const a=this.resolvedProperty;for(let d=0,g=a.length;d!==g;++d)a[d]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const a=this.resolvedProperty;for(let d=0,g=a.length;d!==g;++d)a[d]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,a=t.objectName,d=t.propertyName;let g=t.propertyIndex;if(e||(e=fr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(a){let P=t.objectIndex;switch(a){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let F=0;F<e.length;F++)if(e[F].name===P){P=F;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[a]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[a]}if(P!==void 0){if(e[P]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[P]}}const _=e[d];if(_===void 0){const P=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+P+"."+d+" but it wasn't found.",e);return}let c=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?c=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(c=this.Versioning.MatrixWorldNeedsUpdate);let I=this.BindingType.Direct;if(g!==void 0){if(d==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[g]!==void 0&&(g=e.morphTargetDictionary[g])}I=this.BindingType.ArrayElement,this.resolvedProperty=_,this.propertyIndex=g}else _.fromArray!==void 0&&_.toArray!==void 0?(I=this.BindingType.HasFromToArray,this.resolvedProperty=_):Array.isArray(_)?(I=this.BindingType.EntireArray,this.resolvedProperty=_):this.propertyName=d;this.getValue=this.GetterByBindingType[I],this.setValue=this.SetterByBindingTypeAndVersioning[I][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}fr.Composite=hB;fr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};fr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};fr.prototype.GetterByBindingType=[fr.prototype._getValue_direct,fr.prototype._getValue_array,fr.prototype._getValue_arrayElement,fr.prototype._getValue_toArray];fr.prototype.SetterByBindingTypeAndVersioning=[[fr.prototype._setValue_direct,fr.prototype._setValue_direct_setNeedsUpdate,fr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[fr.prototype._setValue_array,fr.prototype._setValue_array_setNeedsUpdate,fr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[fr.prototype._setValue_arrayElement,fr.prototype._setValue_arrayElement_setNeedsUpdate,fr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[fr.prototype._setValue_fromArray,fr.prototype._setValue_fromArray_setNeedsUpdate,fr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:tb}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=tb);var Gy={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Gy.exports;(function(l,e){(function(){var t,a="4.17.21",d=200,g="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",_="Expected a function",c="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",P=500,F="__lodash_placeholder__",D=1,N=2,G=4,Z=1,re=2,$=1,X=2,me=4,le=8,ye=16,Le=32,Me=64,Te=128,We=256,de=512,be=30,Oe="...",vt=800,st=16,Je=1,mt=2,gt=3,wt=1/0,yt=9007199254740991,Jt=17976931348623157e292,Tt=NaN,jt=4294967295,Cn=jt-1,jn=jt>>>1,ht=[["ary",Te],["bind",$],["bindKey",X],["curry",le],["curryRight",ye],["flip",de],["partial",Le],["partialRight",Me],["rearg",We]],Ft="[object Arguments]",mn="[object Array]",cn="[object AsyncFunction]",qe="[object Boolean]",Wn="[object Date]",bn="[object DOMException]",nn="[object Error]",ne="[object Function]",ui="[object GeneratorFunction]",Gn="[object Map]",Kn="[object Number]",Ze="[object Null]",hi="[object Object]",qn="[object Promise]",ut="[object Proxy]",Pe="[object RegExp]",pe="[object Set]",dt="[object String]",Ut="[object Symbol]",St="[object Undefined]",Lt="[object WeakMap]",Dn="[object WeakSet]",an="[object ArrayBuffer]",$e="[object DataView]",On="[object Float32Array]",Mt="[object Float64Array]",Rt="[object Int8Array]",Qn="[object Int16Array]",bt="[object Int32Array]",zt="[object Uint8Array]",xt="[object Uint8ClampedArray]",Fn="[object Uint16Array]",fi="[object Uint32Array]",Be=/\b__p \+= '';/g,Ht=/\b(__p \+=) '' \+/g,Ct=/(__e\(.*?\)|\b__t\)) \+\n'';/g,It=/&(?:amp|lt|gt|quot|#39);/g,Yt=/[&<>"']/g,Se=RegExp(It.source),te=RegExp(Yt.source),ie=/<%-([\s\S]+?)%>/g,fe=/<%([\s\S]+?)%>/g,ce=/<%=([\s\S]+?)%>/g,Ve=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xe=/^\w*$/,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fe=/[\\^$.*+?()[\]{}|]/g,_t=RegExp(Fe.source),Pt=/^\s+/,ct=/\s/,Xt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,yn=/\{\n\/\* \[wrapped with (.+)\] \*/,An=/,? & /,Hn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,di=/[()=,{}\[\]\/\s]/,kn=/\\(\\)?/g,Mi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Li=/\w*$/,ve=/^[-+]0x[0-9a-f]+$/i,Ge=/^0b[01]+$/i,it=/^\[object .+?Constructor\]$/,at=/^0o[0-7]+$/i,Qe=/^(?:0|[1-9]\d*)$/,Dt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,en=/($^)/,Sn=/['\n\r\u2028\u2029\\]/g,qt="\\ud800-\\udfff",zn="\\u0300-\\u036f",Un="\\ufe20-\\ufe2f",En="\\u20d0-\\u20ff",Jn=zn+Un+En,Qi="\\u2700-\\u27bf",Yn="a-z\\xdf-\\xf6\\xf8-\\xff",bi="\\xac\\xb1\\xd7\\xf7",pi="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Tn="\\u2000-\\u206f",oi=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",si="A-Z\\xc0-\\xd6\\xd8-\\xde",wr="\\ufe0e\\ufe0f",Fi=bi+pi+Tn+oi,_r="['’]",Gr="["+qt+"]",ki="["+Fi+"]",Hi="["+Jn+"]",ss="\\d+",Ir="["+Qi+"]",Nr="["+Yn+"]",yi="[^"+qt+Fi+ss+Qi+Yn+si+"]",wa="\\ud83c[\\udffb-\\udfff]",Ru="(?:"+Hi+"|"+wa+")",Co="[^"+qt+"]",ao="(?:\\ud83c[\\udde6-\\uddff]){2}",sa="[\\ud800-\\udbff][\\udc00-\\udfff]",aa="["+si+"]",Jo="\\u200d",oo="(?:"+Nr+"|"+yi+")",Ro="(?:"+aa+"|"+yi+")",Dl="(?:"+_r+"(?:d|ll|m|re|s|t|ve))?",er="(?:"+_r+"(?:D|LL|M|RE|S|T|VE))?",Sa=Ru+"?",Sc="["+wr+"]?",oa="(?:"+Jo+"(?:"+[Co,ao,sa].join("|")+")"+Sc+Sa+")*",Qr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sr="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Hr=Sc+Sa+oa,Qo="(?:"+[Ir,ao,sa].join("|")+")"+Hr,Nl="(?:"+[Co+Hi+"?",Hi,ao,sa,Gr].join("|")+")",Pu=RegExp(_r,"g"),el=RegExp(Hi,"g"),Ea=RegExp(wa+"(?="+wa+")|"+Nl+Hr,"g"),Lu=RegExp([aa+"?"+Nr+"+"+Dl+"(?="+[ki,aa,"$"].join("|")+")",Ro+"+"+er+"(?="+[ki,aa+oo,"$"].join("|")+")",aa+"?"+oo+"+"+Dl,aa+"+"+er,sr,Qr,ss,Qo].join("|"),"g"),Ai=RegExp("["+Jo+qt+Jn+wr+"]"),la=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ol=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ku=-1,zi={};zi[On]=zi[Mt]=zi[Rt]=zi[Qn]=zi[bt]=zi[zt]=zi[xt]=zi[Fn]=zi[fi]=!0,zi[Ft]=zi[mn]=zi[an]=zi[qe]=zi[$e]=zi[Wn]=zi[nn]=zi[ne]=zi[Gn]=zi[Kn]=zi[hi]=zi[Pe]=zi[pe]=zi[dt]=zi[Lt]=!1;var Di={};Di[Ft]=Di[mn]=Di[an]=Di[$e]=Di[qe]=Di[Wn]=Di[On]=Di[Mt]=Di[Rt]=Di[Qn]=Di[bt]=Di[Gn]=Di[Kn]=Di[hi]=Di[Pe]=Di[pe]=Di[dt]=Di[Ut]=Di[zt]=Di[xt]=Di[Fn]=Di[fi]=!0,Di[nn]=Di[ne]=Di[Lt]=!1;var Wr={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},tl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},nl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Fl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ws=parseFloat,Du=parseInt,za=typeof Ml=="object"&&Ml&&Ml.Object===Object&&Ml,ti=typeof self=="object"&&self&&self.Object===Object&&self,ar=za||ti||Function("return this")(),Nu=e&&!e.nodeType&&e,yr=Nu&&!0&&l&&!l.nodeType&&l,lo=yr&&yr.exports===Nu,Ba=lo&&za.process,qr=function(){try{var s=yr&&yr.require&&yr.require("util").types;return s||Ba&&Ba.binding&&Ba.binding("util")}catch{}}(),zl=qr&&qr.isArrayBuffer,uo=qr&&qr.isDate,Ou=qr&&qr.isMap,ys=qr&&qr.isRegExp,Bl=qr&&qr.isSet,Fu=qr&&qr.isTypedArray;function us(s,u,f){switch(f.length){case 0:return s.call(u);case 1:return s.call(u,f[0]);case 2:return s.call(u,f[0],f[1]);case 3:return s.call(u,f[0],f[1],f[2])}return s.apply(u,f)}function Ec(s,u,f,v){for(var C=-1,B=s==null?0:s.length;++C<B;){var j=s[C];u(v,j,f(j),s)}return v}function Or(s,u){for(var f=-1,v=s==null?0:s.length;++f<v&&u(s[f],f,s)!==!1;);return s}function Tc(s,u){for(var f=s==null?0:s.length;f--&&u(s[f],f,s)!==!1;);return s}function Mc(s,u){for(var f=-1,v=s==null?0:s.length;++f<v;)if(!u(s[f],f,s))return!1;return!0}function Ua(s,u){for(var f=-1,v=s==null?0:s.length,C=0,B=[];++f<v;){var j=s[f];u(j,f,s)&&(B[C++]=j)}return B}function qs(s,u){var f=s==null?0:s.length;return!!f&&Fr(s,u,0)>-1}function Cr(s,u,f){for(var v=-1,C=s==null?0:s.length;++v<C;)if(f(u,s[v]))return!0;return!1}function or(s,u){for(var f=-1,v=s==null?0:s.length,C=Array(v);++f<v;)C[f]=u(s[f],f,s);return C}function Ls(s,u){for(var f=-1,v=u.length,C=s.length;++f<v;)s[C+f]=u[f];return s}function zu(s,u,f,v){var C=-1,B=s==null?0:s.length;for(v&&B&&(f=s[++C]);++C<B;)f=u(f,s[C],C,s);return f}function Bu(s,u,f,v){var C=s==null?0:s.length;for(v&&C&&(f=s[--C]);C--;)f=u(f,s[C],C,s);return f}function il(s,u){for(var f=-1,v=s==null?0:s.length;++f<v;)if(u(s[f],f,s))return!0;return!1}var Ul=ol("length");function Uu(s){return s.split("")}function vs(s){return s.match(Hn)||[]}function Vl(s,u,f){var v;return f(s,function(C,B,j){if(u(C,B,j))return v=B,!1}),v}function Rr(s,u,f,v){for(var C=s.length,B=f+(v?1:-1);v?B--:++B<C;)if(u(s[B],B,s))return B;return-1}function Fr(s,u,f){return u===u?Ac(s,u,f):Rr(s,sl,f)}function rl(s,u,f,v){for(var C=f-1,B=s.length;++C<B;)if(v(s[C],u))return C;return-1}function sl(s){return s!==s}function al(s,u){var f=s==null?0:s.length;return f?ai(s,u)/f:Tt}function ol(s){return function(u){return u==null?t:u[s]}}function co(s){return function(u){return s==null?t:s[u]}}function Wi(s,u,f,v,C){return C(s,function(B,j,Q){f=v?(v=!1,B):u(f,B,j,Q)}),f}function Vu(s,u){var f=s.length;for(s.sort(u);f--;)s[f]=s[f].value;return s}function ai(s,u){for(var f,v=-1,C=s.length;++v<C;){var B=u(s[v]);B!==t&&(f=f===t?B:f+B)}return f}function ll(s,u){for(var f=-1,v=Array(s);++f<s;)v[f]=u(f);return v}function tr(s,u){return or(u,function(f){return[f,s[f]]})}function $i(s){return s&&s.slice(0,po(s)+1).replace(Pt,"")}function $r(s){return function(u){return s(u)}}function Gl(s,u){return or(u,function(f){return s[f]})}function Va(s,u){return s.has(u)}function ul(s,u){for(var f=-1,v=s.length;++f<v&&Fr(u,s[f],0)>-1;);return f}function Po(s,u){for(var f=s.length;f--&&Fr(u,s[f],0)>-1;);return f}function Hl(s,u){for(var f=s.length,v=0;f--;)s[f]===u&&++v;return v}var Gu=co(Wr),Ga=co(tl);function ho(s){return"\\"+Fl[s]}function xs(s,u){return s==null?t:s[u]}function Ha(s){return Ai.test(s)}function Wl(s){return la.test(s)}function ql(s){for(var u,f=[];!(u=s.next()).done;)f.push(u.value);return f}function ua(s){var u=-1,f=Array(s.size);return s.forEach(function(v,C){f[++u]=[C,v]}),f}function Lo(s,u){return function(f){return s(u(f))}}function $s(s,u){for(var f=-1,v=s.length,C=0,B=[];++f<v;){var j=s[f];(j===u||j===F)&&(s[f]=F,B[C++]=f)}return B}function Ta(s){var u=-1,f=Array(s.size);return s.forEach(function(v){f[++u]=v}),f}function ko(s){var u=-1,f=Array(s.size);return s.forEach(function(v){f[++u]=[v,v]}),f}function Ac(s,u,f){for(var v=f-1,C=s.length;++v<C;)if(s[v]===u)return v;return-1}function fo(s,u,f){for(var v=f+1;v--;)if(s[v]===u)return v;return v}function bs(s){return Ha(s)?cl(s):Ul(s)}function ws(s){return Ha(s)?Hu(s):Uu(s)}function po(s){for(var u=s.length;u--&&ct.test(s.charAt(u)););return u}var ci=co(nl);function cl(s){for(var u=Ea.lastIndex=0;Ea.test(s);)++u;return u}function Hu(s){return s.match(Ea)||[]}function Ss(s){return s.match(Lu)||[]}var es=function s(u){u=u==null?ar:S.defaults(ar.Object(),u,S.pick(ar,Ol));var f=u.Array,v=u.Date,C=u.Error,B=u.Function,j=u.Math,Q=u.Object,xe=u.RegExp,Ue=u.String,je=u.TypeError,Et=f.prototype,Zt=B.prototype,Nt=Q.prototype,Rn=u["__core-js_shared__"],Nn=Zt.toString,fn=Nt.hasOwnProperty,Ii=0,Bi=function(){var m=/[^.]+$/.exec(Rn&&Rn.keys&&Rn.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),vr=Nt.toString,zr=Nn.call(Q),Es=ar._,Xs=xe("^"+Nn.call(fn).replace(Fe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),js=lo?u.Buffer:t,mi=u.Symbol,cs=u.Uint8Array,Sr=js?js.allocUnsafe:t,Wa=Lo(Q.getPrototypeOf,Q),mo=Q.create,Do=Nt.propertyIsEnumerable,ks=Et.splice,$l=mi?mi.isConcatSpreadable:t,go=mi?mi.iterator:t,Ma=mi?mi.toStringTag:t,Xl=function(){try{var m=ml(Q,"defineProperty");return m({},"",{}),m}catch{}}(),Sh=u.clearTimeout!==ar.clearTimeout&&u.clearTimeout,Eh=v&&v.now!==ar.Date.now&&v.now,Th=u.setTimeout!==ar.setTimeout&&u.setTimeout,ca=j.ceil,jl=j.floor,Ic=Q.getOwnPropertySymbols,Mh=js?js.isBuffer:t,Ah=u.isFinite,Ih=Et.join,Ch=Lo(Q.keys,Q),Pr=j.max,Br=j.min,Sf=v.now,ha=u.parseInt,fa=j.random,Rh=Et.reverse,Zs=ml(u,"DataView"),Ys=ml(u,"Map"),Ph=ml(u,"Promise"),No=ml(u,"Set"),Wu=ml(u,"WeakMap"),qu=ml(Q,"create"),Zl=Wu&&new Wu,Aa={},qa=lu(Zs),pn=lu(Ys),Ef=lu(Ph),Lh=lu(No),Tf=lu(Wu),Oo=mi?mi.prototype:t,Ds=Oo?Oo.valueOf:t,kh=Oo?Oo.toString:t;function se(m){if(Tr(m)&&!li(m)&&!(m instanceof vi)){if(m instanceof Ks)return m;if(fn.call(m,"__wrapped__"))return Rp(m)}return new Ks(m)}var Fo=function(){function m(){}return function(w){if(!cr(w))return{};if(mo)return mo(w);m.prototype=w;var L=new m;return m.prototype=t,L}}();function Cc(){}function Ks(m,w){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!w,this.__index__=0,this.__values__=t}se.templateSettings={escape:ie,evaluate:fe,interpolate:ce,variable:"",imports:{_:se}},se.prototype=Cc.prototype,se.prototype.constructor=se,Ks.prototype=Fo(Cc.prototype),Ks.prototype.constructor=Ks;function vi(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=jt,this.__views__=[]}function Mf(){var m=new vi(this.__wrapped__);return m.__actions__=Ms(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=Ms(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=Ms(this.__views__),m}function zo(){if(this.__filtered__){var m=new vi(this);m.__dir__=-1,m.__filtered__=!0}else m=this.clone(),m.__dir__*=-1;return m}function Af(){var m=this.__wrapped__.value(),w=this.__dir__,L=li(m),q=w<0,oe=L?m.length:0,we=lv(0,oe,this.__views__),ze=we.start,Ye=we.end,ot=Ye-ze,Bt=q?Ye:ze-1,Vt=this.__iteratees__,$t=Vt.length,vn=0,Bn=Br(ot,this.__takeCount__);if(!L||!q&&oe==ot&&Bn==ot)return kf(m,this.__actions__);var ni=[];e:for(;ot--&&vn<Bn;){Bt+=w;for(var wi=-1,ii=m[Bt];++wi<$t;){var Ci=Vt[wi],Gi=Ci.iteratee,Eo=Ci.type,La=Gi(ii);if(Eo==mt)ii=La;else if(!La){if(Eo==Je)continue e;break e}}ni[vn++]=ii}return ni}vi.prototype=Fo(Cc.prototype),vi.prototype.constructor=vi;function _o(m){var w=-1,L=m==null?0:m.length;for(this.clear();++w<L;){var q=m[w];this.set(q[0],q[1])}}function Bo(){this.__data__=qu?qu(null):{},this.size=0}function nr(m){var w=this.has(m)&&delete this.__data__[m];return this.size-=w?1:0,w}function Rc(m){var w=this.__data__;if(qu){var L=w[m];return L===I?t:L}return fn.call(w,m)?w[m]:t}function Yl(m){var w=this.__data__;return qu?w[m]!==t:fn.call(w,m)}function Kl(m,w){var L=this.__data__;return this.size+=this.has(m)?0:1,L[m]=qu&&w===t?I:w,this}_o.prototype.clear=Bo,_o.prototype.delete=nr,_o.prototype.get=Rc,_o.prototype.has=Yl,_o.prototype.set=Kl;function $a(m){var w=-1,L=m==null?0:m.length;for(this.clear();++w<L;){var q=m[w];this.set(q[0],q[1])}}function Dh(){this.__data__=[],this.size=0}function $u(m){var w=this.__data__,L=Ke(w,m);if(L<0)return!1;var q=w.length-1;return L==q?w.pop():ks.call(w,L,1),--this.size,!0}function Xa(m){var w=this.__data__,L=Ke(w,m);return L<0?t:w[L][1]}function Pc(m){return Ke(this.__data__,m)>-1}function In(m,w){var L=this.__data__,q=Ke(L,m);return q<0?(++this.size,L.push([m,w])):L[q][1]=w,this}$a.prototype.clear=Dh,$a.prototype.delete=$u,$a.prototype.get=Xa,$a.prototype.has=Pc,$a.prototype.set=In;function Pn(m){var w=-1,L=m==null?0:m.length;for(this.clear();++w<L;){var q=m[w];this.set(q[0],q[1])}}function T(){this.size=0,this.__data__={hash:new _o,map:new(Ys||$a),string:new _o}}function i(m){var w=au(this,m).delete(m);return this.size-=w?1:0,w}function h(m){return au(this,m).get(m)}function y(m){return au(this,m).has(m)}function x(m,w){var L=au(this,m),q=L.size;return L.set(m,w),this.size+=L.size==q?0:1,this}Pn.prototype.clear=T,Pn.prototype.delete=i,Pn.prototype.get=h,Pn.prototype.has=y,Pn.prototype.set=x;function E(m){var w=-1,L=m==null?0:m.length;for(this.__data__=new Pn;++w<L;)this.add(m[w])}function k(m){return this.__data__.set(m,I),this}function z(m){return this.__data__.has(m)}E.prototype.add=E.prototype.push=k,E.prototype.has=z;function V(m){var w=this.__data__=new $a(m);this.size=w.size}function H(){this.__data__=new $a,this.size=0}function J(m){var w=this.__data__,L=w.delete(m);return this.size=w.size,L}function K(m){return this.__data__.get(m)}function ue(m){return this.__data__.has(m)}function ge(m,w){var L=this.__data__;if(L instanceof $a){var q=L.__data__;if(!Ys||q.length<d-1)return q.push([m,w]),this.size=++L.size,this;L=this.__data__=new Pn(q)}return L.set(m,w),this.size=L.size,this}V.prototype.clear=H,V.prototype.delete=J,V.prototype.get=K,V.prototype.has=ue,V.prototype.set=ge;function Ee(m,w){var L=li(m),q=!L&&_l(m),oe=!L&&!q&&yl(m),we=!L&&!q&&!oe&&Y(m),ze=L||q||oe||we,Ye=ze?ll(m.length,Ue):[],ot=Ye.length;for(var Bt in m)(w||fn.call(m,Bt))&&!(ze&&(Bt=="length"||oe&&(Bt=="offset"||Bt=="parent")||we&&(Bt=="buffer"||Bt=="byteLength"||Bt=="byteOffset")||pa(Bt,ot)))&&Ye.push(Bt);return Ye}function Re(m){var w=m.length;return w?m[Fh(0,w-1)]:t}function Ie(m,w){return Xf(Ms(m),on(w,0,m.length))}function De(m){return Xf(Ms(m))}function He(m,w,L){(L!==t&&!Os(m[w],L)||L===t&&!(w in m))&&Gt(m,w,L)}function Ae(m,w,L){var q=m[w];(!(fn.call(m,w)&&Os(q,L))||L===t&&!(w in m))&&Gt(m,w,L)}function Ke(m,w){for(var L=m.length;L--;)if(Os(m[L][0],w))return L;return-1}function rt(m,w,L,q){return tn(m,function(oe,we,ze){w(q,oe,L(oe),ze)}),q}function ft(m,w){return m&&Vo(w,Vi(w),m)}function kt(m,w){return m&&Vo(w,ji(w),m)}function Gt(m,w,L){w=="__proto__"&&Xl?Xl(m,w,{configurable:!0,enumerable:!0,value:L,writable:!0}):m[w]=L}function ln(m,w){for(var L=-1,q=w.length,oe=f(q),we=m==null;++L<q;)oe[L]=we?t:ms(m,w[L]);return oe}function on(m,w,L){return m===m&&(L!==t&&(m=m<=L?m:L),w!==t&&(m=m>=w?m:w)),m}function Ot(m,w,L,q,oe,we){var ze,Ye=w&D,ot=w&N,Bt=w&G;if(L&&(ze=oe?L(m,q,oe,we):L(m)),ze!==t)return ze;if(!cr(m))return m;var Vt=li(m);if(Vt){if(ze=cv(m),!Ye)return Ms(m,ze)}else{var $t=As(m),vn=$t==ne||$t==ui;if(yl(m))return Gh(m,Ye);if($t==hi||$t==Ft||vn&&!oe){if(ze=ot||vn?{}:sg(m),!Ye)return ot?Jm(m,kt(ze,m)):Km(m,ft(ze,m))}else{if(!Di[$t])return oe?m:{};ze=ou(m,$t,Ye)}}we||(we=new V);var Bn=we.get(m);if(Bn)return Bn;we.set(m,ze),O(m)?m.forEach(function(ii){ze.add(Ot(ii,w,L,ii,m,we))}):ud(m)&&m.forEach(function(ii,Ci){ze.set(Ci,Ot(ii,w,L,Ci,m,we))});var ni=Bt?ot?Hc:qf:ot?ji:Vi,wi=Vt?t:ni(m);return Or(wi||m,function(ii,Ci){wi&&(Ci=ii,ii=m[Ci]),Ae(ze,Ci,Ot(ii,w,L,Ci,m,we))}),ze}function Kt(m){var w=Vi(m);return function(L){return gn(L,m,w)}}function gn(m,w,L){var q=L.length;if(m==null)return!q;for(m=Q(m);q--;){var oe=L[q],we=w[oe],ze=m[oe];if(ze===t&&!(oe in m)||!we(ze))return!1}return!0}function $n(m,w,L){if(typeof m!="function")throw new je(_);return $c(function(){m.apply(t,L)},w)}function Qt(m,w,L,q){var oe=-1,we=qs,ze=!0,Ye=m.length,ot=[],Bt=w.length;if(!Ye)return ot;L&&(w=or(w,$r(L))),q?(we=Cr,ze=!1):w.length>=d&&(we=Va,ze=!1,w=new E(w));e:for(;++oe<Ye;){var Vt=m[oe],$t=L==null?Vt:L(Vt);if(Vt=q||Vt!==0?Vt:0,ze&&$t===$t){for(var vn=Bt;vn--;)if(w[vn]===$t)continue e;ot.push(Vt)}else we(w,$t,q)||ot.push(Vt)}return ot}var tn=Bf(xr),Vn=Bf(as,!0);function lr(m,w){var L=!0;return tn(m,function(q,oe,we){return L=!!w(q,oe,we),L}),L}function ei(m,w,L){for(var q=-1,oe=m.length;++q<oe;){var we=m[q],ze=w(we);if(ze!=null&&(Ye===t?ze===ze&&!W(ze):L(ze,Ye)))var Ye=ze,ot=we}return ot}function gi(m,w,L,q){var oe=m.length;for(L=ke(L),L<0&&(L=-L>oe?0:oe+L),q=q===t||q>oe?oe:ke(q),q<0&&(q+=oe),q=L>q?0:tt(q);L<q;)m[L++]=w;return m}function ir(m,w){var L=[];return tn(m,function(q,oe,we){w(q,oe,we)&&L.push(q)}),L}function Ni(m,w,L,q,oe){var we=-1,ze=m.length;for(L||(L=ag),oe||(oe=[]);++we<ze;){var Ye=m[we];w>0&&L(Ye)?w>1?Ni(Ye,w-1,L,q,oe):Ls(oe,Ye):q||(oe[oe.length]=Ye)}return oe}var Js=_p(),rr=_p(!0);function xr(m,w){return m&&Js(m,w,Vi)}function as(m,w){return m&&rr(m,w,Vi)}function Xr(m,w){return Ua(w,function(L){return Ho(m[L])})}function Er(m,w){w=Ia(w,m);for(var L=0,q=w.length;m!=null&&L<q;)m=m[Go(w[L++])];return L&&L==q?m:t}function da(m,w,L){var q=w(m);return li(m)?q:Ls(q,L(m))}function Lr(m){return m==null?m===t?St:Ze:Ma&&Ma in Q(m)?bp(m):pv(m)}function Jl(m,w){return m>w}function Ql(m,w){return m!=null&&fn.call(m,w)}function hl(m,w){return m!=null&&w in Q(m)}function Lc(m,w,L){return m>=Br(w,L)&&m<Pr(w,L)}function Xu(m,w,L){for(var q=L?Cr:qs,oe=m[0].length,we=m.length,ze=we,Ye=f(we),ot=1/0,Bt=[];ze--;){var Vt=m[ze];ze&&w&&(Vt=or(Vt,$r(w))),ot=Br(Vt.length,ot),Ye[ze]=!L&&(w||oe>=120&&Vt.length>=120)?new E(ze&&Vt):t}Vt=m[0];var $t=-1,vn=Ye[0];e:for(;++$t<oe&&Bt.length<ot;){var Bn=Vt[$t],ni=w?w(Bn):Bn;if(Bn=L||Bn!==0?Bn:0,!(vn?Va(vn,ni):q(Bt,ni,L))){for(ze=we;--ze;){var wi=Ye[ze];if(!(wi?Va(wi,ni):q(m[ze],ni,L)))continue e}vn&&vn.push(ni),Bt.push(Bn)}}return Bt}function os(m,w,L,q){return xr(m,function(oe,we,ze){w(q,L(oe),we,ze)}),q}function Ts(m,w,L){w=Ia(w,m),m=Mp(m,w);var q=m==null?m:m[Go(Ka(w))];return q==null?t:us(q,m,L)}function yo(m){return Tr(m)&&Lr(m)==Ft}function eu(m){return Tr(m)&&Lr(m)==an}function hs(m){return Tr(m)&&Lr(m)==Wn}function Ur(m,w,L,q,oe){return m===w?!0:m==null||w==null||!Tr(m)&&!Tr(w)?m!==m&&w!==w:ts(m,w,L,q,Ur,oe)}function ts(m,w,L,q,oe,we){var ze=li(m),Ye=li(w),ot=ze?mn:As(m),Bt=Ye?mn:As(w);ot=ot==Ft?hi:ot,Bt=Bt==Ft?hi:Bt;var Vt=ot==hi,$t=Bt==hi,vn=ot==Bt;if(vn&&yl(m)){if(!yl(w))return!1;ze=!0,Vt=!1}if(vn&&!Vt)return we||(we=new V),ze||Y(m)?ec(m,w,L,q,oe,we):ov(m,w,ot,L,q,oe,we);if(!(L&Z)){var Bn=Vt&&fn.call(m,"__wrapped__"),ni=$t&&fn.call(w,"__wrapped__");if(Bn||ni){var wi=Bn?m.value():m,ii=ni?w.value():w;return we||(we=new V),oe(wi,ii,L,q,we)}}return vn?(we||(we=new V),kr(m,w,L,q,oe,we)):!1}function pr(m){return Tr(m)&&As(m)==Gn}function Uo(m,w,L,q){var oe=L.length,we=oe,ze=!q;if(m==null)return!we;for(m=Q(m);oe--;){var Ye=L[oe];if(ze&&Ye[2]?Ye[1]!==m[Ye[0]]:!(Ye[0]in m))return!1}for(;++oe<we;){Ye=L[oe];var ot=Ye[0],Bt=m[ot],Vt=Ye[1];if(ze&&Ye[2]){if(Bt===t&&!(ot in m))return!1}else{var $t=new V;if(q)var vn=q(Bt,Vt,ot,m,w,$t);if(!(vn===t?Ur(Vt,Bt,Z|re,q,$t):vn))return!1}}return!0}function kc(m){if(!cr(m)||og(m))return!1;var w=Ho(m)?Xs:it;return w.test(lu(m))}function jr(m){return Tr(m)&&Lr(m)==Pe}function If(m){return Tr(m)&&As(m)==pe}function Dc(m){return Tr(m)&&ic(m.length)&&!!zi[Lr(m)]}function ju(m){return typeof m=="function"?m:m==null?eo:typeof m=="object"?li(m)?Yu(m[0],m[1]):Oc(m):Ab(m)}function ja(m){if(!Xh(m))return Ch(m);var w=[];for(var L in Q(m))fn.call(m,L)&&L!="constructor"&&w.push(L);return w}function Cf(m){if(!cr(m))return Tp(m);var w=Xh(m),L=[];for(var q in m)q=="constructor"&&(w||!fn.call(m,q))||L.push(q);return L}function Zu(m,w){return m<w}function Nc(m,w){var L=-1,q=Fs(m)?f(m.length):[];return tn(m,function(oe,we,ze){q[++L]=w(oe,we,ze)}),q}function Oc(m){var w=qh(m);return w.length==1&&w[0][2]?ug(w[0][0],w[0][1]):function(L){return L===m||Uo(L,m,w)}}function Yu(m,w){return Sp(m)&&lg(w)?ug(Go(m),w):function(L){var q=ms(L,m);return q===t&&q===w?mr(L,m):Ur(w,q,Z|re)}}function vo(m,w,L,q,oe){m!==w&&Js(w,function(we,ze){if(oe||(oe=new V),cr(we))Wm(m,w,ze,L,vo,q,oe);else{var Ye=q?q(Ap(m,ze),we,ze+"",m,w,oe):t;Ye===t&&(Ye=we),He(m,ze,Ye)}},ji)}function Wm(m,w,L,q,oe,we,ze){var Ye=Ap(m,L),ot=Ap(w,L),Bt=ze.get(ot);if(Bt){He(m,L,Bt);return}var Vt=we?we(Ye,ot,L+"",m,w,ze):t,$t=Vt===t;if($t){var vn=li(ot),Bn=!vn&&yl(ot),ni=!vn&&!Bn&&Y(ot);Vt=ot,vn||Bn||ni?li(Ye)?Vt=Ye:Zr(Ye)?Vt=Ms(Ye):Bn?($t=!1,Vt=Gh(ot,!0)):ni?($t=!1,Vt=Ju(ot,!0)):Vt=[]:M(ot)||_l(ot)?(Vt=Ye,_l(Ye)?Vt=Wt(Ye):(!cr(Ye)||Ho(Ye))&&(Vt=sg(ot))):$t=!1}$t&&(ze.set(ot,Vt),oe(Vt,ot,q,we,ze),ze.delete(ot)),He(m,L,Vt)}function Rf(m,w){var L=m.length;if(L)return w+=w<0?L:0,pa(w,L)?m[w]:t}function Nh(m,w,L){w.length?w=or(w,function(we){return li(we)?function(ze){return Er(ze,we.length===1?we[0]:we)}:we}):w=[eo];var q=-1;w=or(w,$r(Zn()));var oe=Nc(m,function(we,ze,Ye){var ot=or(w,function(Bt){return Bt(we)});return{criteria:ot,index:++q,value:we}});return Vu(oe,function(we,ze){return Zm(we,ze,L)})}function Ku(m,w){return Oh(m,w,function(L,q){return mr(m,q)})}function Oh(m,w,L){for(var q=-1,oe=w.length,we={};++q<oe;){var ze=w[q],Ye=Er(m,ze);L(Ye,ze)&&Fc(we,Ia(ze,m),Ye)}return we}function qm(m){return function(w){return Er(w,m)}}function Pf(m,w,L,q){var oe=q?rl:Fr,we=-1,ze=w.length,Ye=m;for(m===w&&(w=Ms(w)),L&&(Ye=or(m,$r(L)));++we<ze;)for(var ot=0,Bt=w[we],Vt=L?L(Bt):Bt;(ot=oe(Ye,Vt,ot,q))>-1;)Ye!==m&&ks.call(Ye,ot,1),ks.call(m,ot,1);return m}function $m(m,w){for(var L=m?w.length:0,q=L-1;L--;){var oe=w[L];if(L==q||oe!==we){var we=oe;pa(oe)?ks.call(m,oe,1):pp(m,oe)}}return m}function Fh(m,w){return m+jl(fa()*(w-m+1))}function zh(m,w,L,q){for(var oe=-1,we=Pr(ca((w-m)/(L||1)),0),ze=f(we);we--;)ze[q?we:++oe]=m,m+=L;return ze}function tu(m,w){var L="";if(!m||w<1||w>yt)return L;do w%2&&(L+=m),w=jl(w/2),w&&(m+=m);while(w);return L}function ri(m,w){return Ip(cg(m,w,eo),m+"")}function xo(m){return Re(du(m))}function nu(m,w){var L=du(m);return Xf(L,on(w,0,L.length))}function Fc(m,w,L,q){if(!cr(m))return m;w=Ia(w,m);for(var oe=-1,we=w.length,ze=we-1,Ye=m;Ye!=null&&++oe<we;){var ot=Go(w[oe]),Bt=L;if(ot==="__proto__"||ot==="constructor"||ot==="prototype")return m;if(oe!=ze){var Vt=Ye[ot];Bt=q?q(Vt,ot,Ye):t,Bt===t&&(Bt=cr(Vt)?Vt:pa(w[oe+1])?[]:{})}Ae(Ye,ot,Bt),Ye=Ye[ot]}return m}var iu=Zl?function(m,w){return Zl.set(m,w),m}:eo,tv=Xl?function(m,w){return Xl(m,"toString",{configurable:!0,enumerable:!1,value:o0(w),writable:!0})}:eo;function Xm(m){return Xf(du(m))}function Ui(m,w,L){var q=-1,oe=m.length;w<0&&(w=-w>oe?0:oe+w),L=L>oe?oe:L,L<0&&(L+=oe),oe=w>L?0:L-w>>>0,w>>>=0;for(var we=f(oe);++q<oe;)we[q]=m[q+w];return we}function dp(m,w){var L;return tn(m,function(q,oe,we){return L=w(q,oe,we),!L}),!!L}function Bh(m,w,L){var q=0,oe=m==null?q:m.length;if(typeof w=="number"&&w===w&&oe<=jn){for(;q<oe;){var we=q+oe>>>1,ze=m[we];ze!==null&&!W(ze)&&(L?ze<=w:ze<w)?q=we+1:oe=we}return oe}return fl(m,w,eo,L)}function fl(m,w,L,q){var oe=0,we=m==null?0:m.length;if(we===0)return 0;w=L(w);for(var ze=w!==w,Ye=w===null,ot=W(w),Bt=w===t;oe<we;){var Vt=jl((oe+we)/2),$t=L(m[Vt]),vn=$t!==t,Bn=$t===null,ni=$t===$t,wi=W($t);if(ze)var ii=q||ni;else Bt?ii=ni&&(q||vn):Ye?ii=ni&&vn&&(q||!Bn):ot?ii=ni&&vn&&!Bn&&(q||!wi):Bn||wi?ii=!1:ii=q?$t<=w:$t<w;ii?oe=Vt+1:we=Vt}return Br(we,Cn)}function ru(m,w){for(var L=-1,q=m.length,oe=0,we=[];++L<q;){var ze=m[L],Ye=w?w(ze):ze;if(!L||!Os(Ye,ot)){var ot=Ye;we[oe++]=ze===0?0:ze}}return we}function Uh(m){return typeof m=="number"?m:W(m)?Tt:+m}function Qs(m){if(typeof m=="string")return m;if(li(m))return or(m,Qs)+"";if(W(m))return kh?kh.call(m):"";var w=m+"";return w=="0"&&1/m==-wt?"-0":w}function dl(m,w,L){var q=-1,oe=qs,we=m.length,ze=!0,Ye=[],ot=Ye;if(L)ze=!1,oe=Cr;else if(we>=d){var Bt=w?null:sv(m);if(Bt)return Ta(Bt);ze=!1,oe=Va,ot=new E}else ot=w?[]:Ye;e:for(;++q<we;){var Vt=m[q],$t=w?w(Vt):Vt;if(Vt=L||Vt!==0?Vt:0,ze&&$t===$t){for(var vn=ot.length;vn--;)if(ot[vn]===$t)continue e;w&&ot.push($t),Ye.push(Vt)}else oe(ot,$t,L)||(ot!==Ye&&ot.push($t),Ye.push(Vt))}return Ye}function pp(m,w){return w=Ia(w,m),m=Mp(m,w),m==null||delete m[Go(Ka(w))]}function mp(m,w,L,q){return Fc(m,w,L(Er(m,w)),q)}function Lf(m,w,L,q){for(var oe=m.length,we=q?oe:-1;(q?we--:++we<oe)&&w(m[we],we,m););return L?Ui(m,q?0:we,q?we+1:oe):Ui(m,q?we+1:0,q?oe:we)}function kf(m,w){var L=m;return L instanceof vi&&(L=L.value()),zu(w,function(q,oe){return oe.func.apply(oe.thisArg,Ls([q],oe.args))},L)}function gp(m,w,L){var q=m.length;if(q<2)return q?dl(m[0]):[];for(var oe=-1,we=f(q);++oe<q;)for(var ze=m[oe],Ye=-1;++Ye<q;)Ye!=oe&&(we[oe]=Qt(we[oe]||ze,m[Ye],w,L));return dl(Ni(we,1),w,L)}function Df(m,w,L){for(var q=-1,oe=m.length,we=w.length,ze={};++q<oe;){var Ye=q<we?w[q]:t;L(ze,m[q],Ye)}return ze}function Nf(m){return Zr(m)?m:[]}function Of(m){return typeof m=="function"?m:eo}function Ia(m,w){return li(m)?m:Sp(m,w)?[m]:dg(rn(m))}var nv=ri;function Za(m,w,L){var q=m.length;return L=L===t?q:L,!w&&L>=q?m:Ui(m,w,L)}var Vh=Sh||function(m){return ar.clearTimeout(m)};function Gh(m,w){if(w)return m.slice();var L=m.length,q=Sr?Sr(L):new m.constructor(L);return m.copy(q),q}function Ff(m){var w=new m.constructor(m.byteLength);return new cs(w).set(new cs(m)),w}function jm(m,w){var L=w?Ff(m.buffer):m.buffer;return new m.constructor(L,m.byteOffset,m.byteLength)}function iv(m){var w=new m.constructor(m.source,Li.exec(m));return w.lastIndex=m.lastIndex,w}function Ns(m){return Ds?Q(Ds.call(m)):{}}function Ju(m,w){var L=w?Ff(m.buffer):m.buffer;return new m.constructor(L,m.byteOffset,m.length)}function zf(m,w){if(m!==w){var L=m!==t,q=m===null,oe=m===m,we=W(m),ze=w!==t,Ye=w===null,ot=w===w,Bt=W(w);if(!Ye&&!Bt&&!we&&m>w||we&&ze&&ot&&!Ye&&!Bt||q&&ze&&ot||!L&&ot||!oe)return 1;if(!q&&!we&&!Bt&&m<w||Bt&&L&&oe&&!q&&!we||Ye&&L&&oe||!ze&&oe||!ot)return-1}return 0}function Zm(m,w,L){for(var q=-1,oe=m.criteria,we=w.criteria,ze=oe.length,Ye=L.length;++q<ze;){var ot=zf(oe[q],we[q]);if(ot){if(q>=Ye)return ot;var Bt=L[q];return ot*(Bt=="desc"?-1:1)}}return m.index-w.index}function zc(m,w,L,q){for(var oe=-1,we=m.length,ze=L.length,Ye=-1,ot=w.length,Bt=Pr(we-ze,0),Vt=f(ot+Bt),$t=!q;++Ye<ot;)Vt[Ye]=w[Ye];for(;++oe<ze;)($t||oe<we)&&(Vt[L[oe]]=m[oe]);for(;Bt--;)Vt[Ye++]=m[oe++];return Vt}function Ym(m,w,L,q){for(var oe=-1,we=m.length,ze=-1,Ye=L.length,ot=-1,Bt=w.length,Vt=Pr(we-Ye,0),$t=f(Vt+Bt),vn=!q;++oe<Vt;)$t[oe]=m[oe];for(var Bn=oe;++ot<Bt;)$t[Bn+ot]=w[ot];for(;++ze<Ye;)(vn||oe<we)&&($t[Bn+L[ze]]=m[oe++]);return $t}function Ms(m,w){var L=-1,q=m.length;for(w||(w=f(q));++L<q;)w[L]=m[L];return w}function Vo(m,w,L,q){var oe=!L;L||(L={});for(var we=-1,ze=w.length;++we<ze;){var Ye=w[we],ot=q?q(L[Ye],m[Ye],Ye,L,m):t;ot===t&&(ot=m[Ye]),oe?Gt(L,Ye,ot):Ae(L,Ye,ot)}return L}function Km(m,w){return Vo(m,$h(m),w)}function Jm(m,w){return Vo(m,wp(m),w)}function Hh(m,w){return function(L,q){var oe=li(L)?Ec:rt,we=w?w():{};return oe(L,m,Zn(q,2),we)}}function Bc(m){return ri(function(w,L){var q=-1,oe=L.length,we=oe>1?L[oe-1]:t,ze=oe>2?L[2]:t;for(we=m.length>3&&typeof we=="function"?(oe--,we):t,ze&&ea(L[0],L[1],ze)&&(we=oe<3?t:we,oe=1),w=Q(w);++q<oe;){var Ye=L[q];Ye&&m(w,Ye,q,we)}return w})}function Bf(m,w){return function(L,q){if(L==null)return L;if(!Fs(L))return m(L,q);for(var oe=L.length,we=w?oe:-1,ze=Q(L);(w?we--:++we<oe)&&q(ze[we],we,ze)!==!1;);return L}}function _p(m){return function(w,L,q){for(var oe=-1,we=Q(w),ze=q(w),Ye=ze.length;Ye--;){var ot=ze[m?Ye:++oe];if(L(we[ot],ot,we)===!1)break}return w}}function yp(m,w,L){var q=w&$,oe=Vc(m);function we(){var ze=this&&this!==ar&&this instanceof we?oe:m;return ze.apply(q?L:this,arguments)}return we}function Uc(m){return function(w){w=rn(w);var L=Ha(w)?ws(w):t,q=L?L[0]:w.charAt(0),oe=L?Za(L,1).join(""):w.slice(1);return q[m]()+oe}}function fs(m){return function(w){return zu(Tb(u_(w).replace(Pu,"")),m,"")}}function Vc(m){return function(){var w=arguments;switch(w.length){case 0:return new m;case 1:return new m(w[0]);case 2:return new m(w[0],w[1]);case 3:return new m(w[0],w[1],w[2]);case 4:return new m(w[0],w[1],w[2],w[3]);case 5:return new m(w[0],w[1],w[2],w[3],w[4]);case 6:return new m(w[0],w[1],w[2],w[3],w[4],w[5]);case 7:return new m(w[0],w[1],w[2],w[3],w[4],w[5],w[6])}var L=Fo(m.prototype),q=m.apply(L,w);return cr(q)?q:L}}function rv(m,w,L){var q=Vc(m);function oe(){for(var we=arguments.length,ze=f(we),Ye=we,ot=tc(oe);Ye--;)ze[Ye]=arguments[Ye];var Bt=we<3&&ze[0]!==ot&&ze[we-1]!==ot?[]:$s(ze,ot);if(we-=Bt.length,we<L)return tg(m,w,Uf,oe.placeholder,t,ze,Bt,t,t,L-we);var Vt=this&&this!==ar&&this instanceof oe?q:m;return us(Vt,this,ze)}return oe}function vp(m){return function(w,L,q){var oe=Q(w);if(!Fs(w)){var we=Zn(L,3);w=Vi(w),L=function(Ye){return we(oe[Ye],Ye,oe)}}var ze=m(w,L,q);return ze>-1?oe[we?w[ze]:ze]:t}}function Qm(m){return Ya(function(w){var L=w.length,q=L,oe=Ks.prototype.thru;for(m&&w.reverse();q--;){var we=w[q];if(typeof we!="function")throw new je(_);if(oe&&!ze&&su(we)=="wrapper")var ze=new Ks([],!0)}for(q=ze?q:L;++q<L;){we=w[q];var Ye=su(we),ot=Ye=="wrapper"?Wc(we):t;ot&&$f(ot[0])&&ot[1]==(Te|le|Le|We)&&!ot[4].length&&ot[9]==1?ze=ze[su(ot[0])].apply(ze,ot[3]):ze=we.length==1&&$f(we)?ze[Ye]():ze.thru(we)}return function(){var Bt=arguments,Vt=Bt[0];if(ze&&Bt.length==1&&li(Vt))return ze.plant(Vt).value();for(var $t=0,vn=L?w[$t].apply(this,Bt):Vt;++$t<L;)vn=w[$t].call(this,vn);return vn}})}function Uf(m,w,L,q,oe,we,ze,Ye,ot,Bt){var Vt=w&Te,$t=w&$,vn=w&X,Bn=w&(le|ye),ni=w&de,wi=vn?t:Vc(m);function ii(){for(var Ci=arguments.length,Gi=f(Ci),Eo=Ci;Eo--;)Gi[Eo]=arguments[Eo];if(Bn)var La=tc(ii),To=Hl(Gi,La);if(q&&(Gi=zc(Gi,q,oe,Bn)),we&&(Gi=Ym(Gi,we,ze,Bn)),Ci-=To,Bn&&Ci<Bt){var ls=$s(Gi,La);return tg(m,w,Uf,ii.placeholder,L,Gi,ls,Ye,ot,Bt-Ci)}var bl=$t?L:this,oc=vn?bl[m]:m;return Ci=Gi.length,Ye?Gi=mv(Gi,Ye):ni&&Ci>1&&Gi.reverse(),Vt&&ot<Ci&&(Gi.length=ot),this&&this!==ar&&this instanceof ii&&(oc=wi||Vc(oc)),oc.apply(bl,Gi)}return ii}function eg(m,w){return function(L,q){return os(L,m,w(q),{})}}function Vf(m,w){return function(L,q){var oe;if(L===t&&q===t)return w;if(L!==t&&(oe=L),q!==t){if(oe===t)return q;typeof L=="string"||typeof q=="string"?(L=Qs(L),q=Qs(q)):(L=Uh(L),q=Uh(q)),oe=m(L,q)}return oe}}function Gf(m){return Ya(function(w){return w=or(w,$r(Zn())),ri(function(L){var q=this;return m(w,function(oe){return us(oe,q,L)})})})}function Wh(m,w){w=w===t?" ":Qs(w);var L=w.length;if(L<2)return L?tu(w,m):w;var q=tu(w,ca(m/bs(w)));return Ha(w)?Za(ws(q),0,m).join(""):q.slice(0,m)}function Qu(m,w,L,q){var oe=w&$,we=Vc(m);function ze(){for(var Ye=-1,ot=arguments.length,Bt=-1,Vt=q.length,$t=f(Vt+ot),vn=this&&this!==ar&&this instanceof ze?we:m;++Bt<Vt;)$t[Bt]=q[Bt];for(;ot--;)$t[Bt++]=arguments[++Ye];return us(vn,oe?L:this,$t)}return ze}function Gc(m){return function(w,L,q){return q&&typeof q!="number"&&ea(w,L,q)&&(L=q=t),w=nt(w),L===t?(L=w,w=0):L=nt(L),q=q===t?w<L?1:-1:nt(q),zh(w,L,q,m)}}function Hf(m){return function(w,L){return typeof w=="string"&&typeof L=="string"||(w=pt(w),L=pt(L)),m(w,L)}}function tg(m,w,L,q,oe,we,ze,Ye,ot,Bt){var Vt=w&le,$t=Vt?ze:t,vn=Vt?t:ze,Bn=Vt?we:t,ni=Vt?t:we;w|=Vt?Le:Me,w&=~(Vt?Me:Le),w&me||(w&=~($|X));var wi=[m,w,oe,Bn,$t,ni,vn,Ye,ot,Bt],ii=L.apply(t,wi);return $f(m)&&qc(ii,wi),ii.placeholder=q,hg(ii,m,w)}function xp(m){var w=j[m];return function(L,q){if(L=pt(L),q=q==null?0:Br(ke(q),292),q&&Ah(L)){var oe=(rn(L)+"e").split("e"),we=w(oe[0]+"e"+(+oe[1]+q));return oe=(rn(we)+"e").split("e"),+(oe[0]+"e"+(+oe[1]-q))}return w(L)}}var sv=No&&1/Ta(new No([,-0]))[1]==wt?function(m){return new No(m)}:c0;function ng(m){return function(w){var L=As(w);return L==Gn?ua(w):L==pe?ko(w):tr(w,m(w))}}function pl(m,w,L,q,oe,we,ze,Ye){var ot=w&X;if(!ot&&typeof m!="function")throw new je(_);var Bt=q?q.length:0;if(Bt||(w&=~(Le|Me),q=oe=t),ze=ze===t?ze:Pr(ke(ze),0),Ye=Ye===t?Ye:ke(Ye),Bt-=oe?oe.length:0,w&Me){var Vt=q,$t=oe;q=oe=t}var vn=ot?t:Wc(m),Bn=[m,w,L,q,oe,Vt,$t,we,ze,Ye];if(vn&&jh(Bn,vn),m=Bn[0],w=Bn[1],L=Bn[2],q=Bn[3],oe=Bn[4],Ye=Bn[9]=Bn[9]===t?ot?0:m.length:Pr(Bn[9]-Bt,0),!Ye&&w&(le|ye)&&(w&=~(le|ye)),!w||w==$)var ni=yp(m,w,L);else w==le||w==ye?ni=rv(m,w,Ye):(w==Le||w==($|Le))&&!oe.length?ni=Qu(m,w,L,q):ni=Uf.apply(t,Bn);var wi=vn?iu:qc;return hg(wi(ni,Bn),m,w)}function ig(m,w,L,q){return m===t||Os(m,Nt[L])&&!fn.call(q,L)?w:m}function Wf(m,w,L,q,oe,we){return cr(m)&&cr(w)&&(we.set(w,m),vo(m,w,t,Wf,we),we.delete(w)),m}function av(m){return M(m)?t:m}function ec(m,w,L,q,oe,we){var ze=L&Z,Ye=m.length,ot=w.length;if(Ye!=ot&&!(ze&&ot>Ye))return!1;var Bt=we.get(m),Vt=we.get(w);if(Bt&&Vt)return Bt==w&&Vt==m;var $t=-1,vn=!0,Bn=L&re?new E:t;for(we.set(m,w),we.set(w,m);++$t<Ye;){var ni=m[$t],wi=w[$t];if(q)var ii=ze?q(wi,ni,$t,w,m,we):q(ni,wi,$t,m,w,we);if(ii!==t){if(ii)continue;vn=!1;break}if(Bn){if(!il(w,function(Ci,Gi){if(!Va(Bn,Gi)&&(ni===Ci||oe(ni,Ci,L,q,we)))return Bn.push(Gi)})){vn=!1;break}}else if(!(ni===wi||oe(ni,wi,L,q,we))){vn=!1;break}}return we.delete(m),we.delete(w),vn}function ov(m,w,L,q,oe,we,ze){switch(L){case $e:if(m.byteLength!=w.byteLength||m.byteOffset!=w.byteOffset)return!1;m=m.buffer,w=w.buffer;case an:return!(m.byteLength!=w.byteLength||!we(new cs(m),new cs(w)));case qe:case Wn:case Kn:return Os(+m,+w);case nn:return m.name==w.name&&m.message==w.message;case Pe:case dt:return m==w+"";case Gn:var Ye=ua;case pe:var ot=q&Z;if(Ye||(Ye=Ta),m.size!=w.size&&!ot)return!1;var Bt=ze.get(m);if(Bt)return Bt==w;q|=re,ze.set(m,w);var Vt=ec(Ye(m),Ye(w),q,oe,we,ze);return ze.delete(m),Vt;case Ut:if(Ds)return Ds.call(m)==Ds.call(w)}return!1}function kr(m,w,L,q,oe,we){var ze=L&Z,Ye=qf(m),ot=Ye.length,Bt=qf(w),Vt=Bt.length;if(ot!=Vt&&!ze)return!1;for(var $t=ot;$t--;){var vn=Ye[$t];if(!(ze?vn in w:fn.call(w,vn)))return!1}var Bn=we.get(m),ni=we.get(w);if(Bn&&ni)return Bn==w&&ni==m;var wi=!0;we.set(m,w),we.set(w,m);for(var ii=ze;++$t<ot;){vn=Ye[$t];var Ci=m[vn],Gi=w[vn];if(q)var Eo=ze?q(Gi,Ci,vn,w,m,we):q(Ci,Gi,vn,m,w,we);if(!(Eo===t?Ci===Gi||oe(Ci,Gi,L,q,we):Eo)){wi=!1;break}ii||(ii=vn=="constructor")}if(wi&&!ii){var La=m.constructor,To=w.constructor;La!=To&&"constructor"in m&&"constructor"in w&&!(typeof La=="function"&&La instanceof La&&typeof To=="function"&&To instanceof To)&&(wi=!1)}return we.delete(m),we.delete(w),wi}function Ya(m){return Ip(cg(m,t,Vr),m+"")}function qf(m){return da(m,Vi,$h)}function Hc(m){return da(m,ji,wp)}var Wc=Zl?function(m){return Zl.get(m)}:c0;function su(m){for(var w=m.name+"",L=Aa[w],q=fn.call(Aa,w)?L.length:0;q--;){var oe=L[q],we=oe.func;if(we==null||we==m)return oe.name}return w}function tc(m){var w=fn.call(se,"placeholder")?se:m;return w.placeholder}function Zn(){var m=se.iteratee||l0;return m=m===l0?ju:m,arguments.length?m(arguments[0],arguments[1]):m}function au(m,w){var L=m.__data__;return fv(w)?L[typeof w=="string"?"string":"hash"]:L.map}function qh(m){for(var w=Vi(m),L=w.length;L--;){var q=w[L],oe=m[q];w[L]=[q,oe,lg(oe)]}return w}function ml(m,w){var L=xs(m,w);return kc(L)?L:t}function bp(m){var w=fn.call(m,Ma),L=m[Ma];try{m[Ma]=t;var q=!0}catch{}var oe=vr.call(m);return q&&(w?m[Ma]=L:delete m[Ma]),oe}var $h=Ic?function(m){return m==null?[]:(m=Q(m),Ua(Ic(m),function(w){return Do.call(m,w)}))}:h0,wp=Ic?function(m){for(var w=[];m;)Ls(w,$h(m)),m=Wa(m);return w}:h0,As=Lr;(Zs&&As(new Zs(new ArrayBuffer(1)))!=$e||Ys&&As(new Ys)!=Gn||Ph&&As(Ph.resolve())!=qn||No&&As(new No)!=pe||Wu&&As(new Wu)!=Lt)&&(As=function(m){var w=Lr(m),L=w==hi?m.constructor:t,q=L?lu(L):"";if(q)switch(q){case qa:return $e;case pn:return Gn;case Ef:return qn;case Lh:return pe;case Tf:return Lt}return w});function lv(m,w,L){for(var q=-1,oe=L.length;++q<oe;){var we=L[q],ze=we.size;switch(we.type){case"drop":m+=ze;break;case"dropRight":w-=ze;break;case"take":w=Br(w,m+ze);break;case"takeRight":m=Pr(m,w-ze);break}}return{start:m,end:w}}function uv(m){var w=m.match(yn);return w?w[1].split(An):[]}function rg(m,w,L){w=Ia(w,m);for(var q=-1,oe=w.length,we=!1;++q<oe;){var ze=Go(w[q]);if(!(we=m!=null&&L(m,ze)))break;m=m[ze]}return we||++q!=oe?we:(oe=m==null?0:m.length,!!oe&&ic(oe)&&pa(ze,oe)&&(li(m)||_l(m)))}function cv(m){var w=m.length,L=new m.constructor(w);return w&&typeof m[0]=="string"&&fn.call(m,"index")&&(L.index=m.index,L.input=m.input),L}function sg(m){return typeof m.constructor=="function"&&!Xh(m)?Fo(Wa(m)):{}}function ou(m,w,L){var q=m.constructor;switch(w){case an:return Ff(m);case qe:case Wn:return new q(+m);case $e:return jm(m,L);case On:case Mt:case Rt:case Qn:case bt:case zt:case xt:case Fn:case fi:return Ju(m,L);case Gn:return new q;case Kn:case dt:return new q(m);case Pe:return iv(m);case pe:return new q;case Ut:return Ns(m)}}function hv(m,w){var L=w.length;if(!L)return m;var q=L-1;return w[q]=(L>1?"& ":"")+w[q],w=w.join(L>2?", ":" "),m.replace(Xt,`{
/* [wrapped with `+w+`] */
`)}function ag(m){return li(m)||_l(m)||!!($l&&m&&m[$l])}function pa(m,w){var L=typeof m;return w=w??yt,!!w&&(L=="number"||L!="symbol"&&Qe.test(m))&&m>-1&&m%1==0&&m<w}function ea(m,w,L){if(!cr(L))return!1;var q=typeof w;return(q=="number"?Fs(L)&&pa(w,L.length):q=="string"&&w in L)?Os(L[w],m):!1}function Sp(m,w){if(li(m))return!1;var L=typeof m;return L=="number"||L=="symbol"||L=="boolean"||m==null||W(m)?!0:Xe.test(m)||!Ve.test(m)||w!=null&&m in Q(w)}function fv(m){var w=typeof m;return w=="string"||w=="number"||w=="symbol"||w=="boolean"?m!=="__proto__":m===null}function $f(m){var w=su(m),L=se[w];if(typeof L!="function"||!(w in vi.prototype))return!1;if(m===L)return!0;var q=Wc(L);return!!q&&m===q[0]}function og(m){return!!Bi&&Bi in m}var dv=Rn?Ho:f0;function Xh(m){var w=m&&m.constructor,L=typeof w=="function"&&w.prototype||Nt;return m===L}function lg(m){return m===m&&!cr(m)}function ug(m,w){return function(L){return L==null?!1:L[m]===w&&(w!==t||m in Q(L))}}function Ep(m){var w=bo(m,function(q){return L.size===P&&L.clear(),q}),L=w.cache;return w}function jh(m,w){var L=m[1],q=w[1],oe=L|q,we=oe<($|X|Te),ze=q==Te&&L==le||q==Te&&L==We&&m[7].length<=w[8]||q==(Te|We)&&w[7].length<=w[8]&&L==le;if(!(we||ze))return m;q&$&&(m[2]=w[2],oe|=L&$?0:me);var Ye=w[3];if(Ye){var ot=m[3];m[3]=ot?zc(ot,Ye,w[4]):Ye,m[4]=ot?$s(m[3],F):w[4]}return Ye=w[5],Ye&&(ot=m[5],m[5]=ot?Ym(ot,Ye,w[6]):Ye,m[6]=ot?$s(m[5],F):w[6]),Ye=w[7],Ye&&(m[7]=Ye),q&Te&&(m[8]=m[8]==null?w[8]:Br(m[8],w[8])),m[9]==null&&(m[9]=w[9]),m[0]=w[0],m[1]=oe,m}function Tp(m){var w=[];if(m!=null)for(var L in Q(m))w.push(L);return w}function pv(m){return vr.call(m)}function cg(m,w,L){return w=Pr(w===t?m.length-1:w,0),function(){for(var q=arguments,oe=-1,we=Pr(q.length-w,0),ze=f(we);++oe<we;)ze[oe]=q[w+oe];oe=-1;for(var Ye=f(w+1);++oe<w;)Ye[oe]=q[oe];return Ye[w]=L(ze),us(m,this,Ye)}}function Mp(m,w){return w.length<2?m:Er(m,Ui(w,0,-1))}function mv(m,w){for(var L=m.length,q=Br(w.length,L),oe=Ms(m);q--;){var we=w[q];m[q]=pa(we,L)?oe[we]:t}return m}function Ap(m,w){if(!(w==="constructor"&&typeof m[w]=="function")&&w!="__proto__")return m[w]}var qc=fg(iu),$c=Th||function(m,w){return ar.setTimeout(m,w)},Ip=fg(tv);function hg(m,w,L){var q=w+"";return Ip(m,hv(q,Cp(uv(q),L)))}function fg(m){var w=0,L=0;return function(){var q=Sf(),oe=st-(q-L);if(L=q,oe>0){if(++w>=vt)return arguments[0]}else w=0;return m.apply(t,arguments)}}function Xf(m,w){var L=-1,q=m.length,oe=q-1;for(w=w===t?q:w;++L<w;){var we=Fh(L,oe),ze=m[we];m[we]=m[L],m[L]=ze}return m.length=w,m}var dg=Ep(function(m){var w=[];return m.charCodeAt(0)===46&&w.push(""),m.replace(et,function(L,q,oe,we){w.push(oe?we.replace(kn,"$1"):q||L)}),w});function Go(m){if(typeof m=="string"||W(m))return m;var w=m+"";return w=="0"&&1/m==-wt?"-0":w}function lu(m){if(m!=null){try{return Nn.call(m)}catch{}try{return m+""}catch{}}return""}function Cp(m,w){return Or(ht,function(L){var q="_."+L[0];w&L[1]&&!qs(m,q)&&m.push(q)}),m.sort()}function Rp(m){if(m instanceof vi)return m.clone();var w=new Ks(m.__wrapped__,m.__chain__);return w.__actions__=Ms(m.__actions__),w.__index__=m.__index__,w.__values__=m.__values__,w}function pg(m,w,L){(L?ea(m,w,L):w===t)?w=1:w=Pr(ke(w),0);var q=m==null?0:m.length;if(!q||w<1)return[];for(var oe=0,we=0,ze=f(ca(q/w));oe<q;)ze[we++]=Ui(m,oe,oe+=w);return ze}function mg(m){for(var w=-1,L=m==null?0:m.length,q=0,oe=[];++w<L;){var we=m[w];we&&(oe[q++]=we)}return oe}function gv(){var m=arguments.length;if(!m)return[];for(var w=f(m-1),L=arguments[0],q=m;q--;)w[q-1]=arguments[q];return Ls(li(L)?Ms(L):[L],Ni(w,1))}var jf=ri(function(m,w){return Zr(m)?Qt(m,Ni(w,1,Zr,!0)):[]}),_v=ri(function(m,w){var L=Ka(w);return Zr(L)&&(L=t),Zr(m)?Qt(m,Ni(w,1,Zr,!0),Zn(L,2)):[]}),gg=ri(function(m,w){var L=Ka(w);return Zr(L)&&(L=t),Zr(m)?Qt(m,Ni(w,1,Zr,!0),t,L):[]});function yv(m,w,L){var q=m==null?0:m.length;return q?(w=L||w===t?1:ke(w),Ui(m,w<0?0:w,q)):[]}function vv(m,w,L){var q=m==null?0:m.length;return q?(w=L||w===t?1:ke(w),w=q-w,Ui(m,0,w<0?0:w)):[]}function xv(m,w){return m&&m.length?Lf(m,Zn(w,3),!0,!0):[]}function _g(m,w){return m&&m.length?Lf(m,Zn(w,3),!0):[]}function bv(m,w,L,q){var oe=m==null?0:m.length;return oe?(L&&typeof L!="number"&&ea(m,w,L)&&(L=0,q=oe),gi(m,w,L,q)):[]}function yg(m,w,L){var q=m==null?0:m.length;if(!q)return-1;var oe=L==null?0:ke(L);return oe<0&&(oe=Pr(q+oe,0)),Rr(m,Zn(w,3),oe)}function Xc(m,w,L){var q=m==null?0:m.length;if(!q)return-1;var oe=q-1;return L!==t&&(oe=ke(L),oe=L<0?Pr(q+oe,0):Br(oe,q-1)),Rr(m,Zn(w,3),oe,!0)}function Vr(m){var w=m==null?0:m.length;return w?Ni(m,1):[]}function vg(m){var w=m==null?0:m.length;return w?Ni(m,wt):[]}function xg(m,w){var L=m==null?0:m.length;return L?(w=w===t?1:ke(w),Ni(m,w)):[]}function bg(m){for(var w=-1,L=m==null?0:m.length,q={};++w<L;){var oe=m[w];q[oe[0]]=oe[1]}return q}function qi(m){return m&&m.length?m[0]:t}function Pp(m,w,L){var q=m==null?0:m.length;if(!q)return-1;var oe=L==null?0:ke(L);return oe<0&&(oe=Pr(q+oe,0)),Fr(m,w,oe)}function wg(m){var w=m==null?0:m.length;return w?Ui(m,0,-1):[]}var Sg=ri(function(m){var w=or(m,Nf);return w.length&&w[0]===m[0]?Xu(w):[]}),gl=ri(function(m){var w=Ka(m),L=or(m,Nf);return w===Ka(L)?w=t:L.pop(),L.length&&L[0]===m[0]?Xu(L,Zn(w,2)):[]}),jc=ri(function(m){var w=Ka(m),L=or(m,Nf);return w=typeof w=="function"?w:t,w&&L.pop(),L.length&&L[0]===m[0]?Xu(L,t,w):[]});function Eg(m,w){return m==null?"":Ih.call(m,w)}function Ka(m){var w=m==null?0:m.length;return w?m[w-1]:t}function wv(m,w,L){var q=m==null?0:m.length;if(!q)return-1;var oe=q;return L!==t&&(oe=ke(L),oe=oe<0?Pr(q+oe,0):Br(oe,q-1)),w===w?fo(m,w,oe):Rr(m,sl,oe,!0)}function Sv(m,w){return m&&m.length?Rf(m,ke(w)):t}var Ev=ri(Tg);function Tg(m,w){return m&&m.length&&w&&w.length?Pf(m,w):m}function Tv(m,w,L){return m&&m.length&&w&&w.length?Pf(m,w,Zn(L,2)):m}function Mv(m,w,L){return m&&m.length&&w&&w.length?Pf(m,w,t,L):m}var Av=Ya(function(m,w){var L=m==null?0:m.length,q=ln(m,w);return $m(m,or(w,function(oe){return pa(oe,L)?+oe:oe}).sort(zf)),q});function Iv(m,w){var L=[];if(!(m&&m.length))return L;var q=-1,oe=[],we=m.length;for(w=Zn(w,3);++q<we;){var ze=m[q];w(ze,q,m)&&(L.push(ze),oe.push(q))}return $m(m,oe),L}function Zc(m){return m==null?m:Rh.call(m)}function Yc(m,w,L){var q=m==null?0:m.length;return q?(L&&typeof L!="number"&&ea(m,w,L)?(w=0,L=q):(w=w==null?0:ke(w),L=L===t?q:ke(L)),Ui(m,w,L)):[]}function Mg(m,w){return Bh(m,w)}function Lp(m,w,L){return fl(m,w,Zn(L,2))}function kp(m,w){var L=m==null?0:m.length;if(L){var q=Bh(m,w);if(q<L&&Os(m[q],w))return q}return-1}function Cv(m,w){return Bh(m,w,!0)}function Rv(m,w,L){return fl(m,w,Zn(L,2),!0)}function Pv(m,w){var L=m==null?0:m.length;if(L){var q=Bh(m,w,!0)-1;if(Os(m[q],w))return q}return-1}function Ag(m){return m&&m.length?ru(m):[]}function Ig(m,w){return m&&m.length?ru(m,Zn(w,2)):[]}function ta(m){var w=m==null?0:m.length;return w?Ui(m,1,w):[]}function Dp(m,w,L){return m&&m.length?(w=L||w===t?1:ke(w),Ui(m,0,w<0?0:w)):[]}function Cg(m,w,L){var q=m==null?0:m.length;return q?(w=L||w===t?1:ke(w),w=q-w,Ui(m,w<0?0:w,q)):[]}function uu(m,w){return m&&m.length?Lf(m,Zn(w,3),!1,!0):[]}function Zh(m,w){return m&&m.length?Lf(m,Zn(w,3)):[]}var Yh=ri(function(m){return dl(Ni(m,1,Zr,!0))}),Kc=ri(function(m){var w=Ka(m);return Zr(w)&&(w=t),dl(Ni(m,1,Zr,!0),Zn(w,2))}),Zf=ri(function(m){var w=Ka(m);return w=typeof w=="function"?w:t,dl(Ni(m,1,Zr,!0),t,w)});function Yf(m){return m&&m.length?dl(m):[]}function Lv(m,w){return m&&m.length?dl(m,Zn(w,2)):[]}function kv(m,w){return w=typeof w=="function"?w:t,m&&m.length?dl(m,t,w):[]}function Kf(m){if(!(m&&m.length))return[];var w=0;return m=Ua(m,function(L){if(Zr(L))return w=Pr(L.length,w),!0}),ll(w,function(L){return or(m,ol(L))})}function Np(m,w){if(!(m&&m.length))return[];var L=Kf(m);return w==null?L:or(L,function(q){return us(w,t,q)})}var Dv=ri(function(m,w){return Zr(m)?Qt(m,w):[]}),Rg=ri(function(m){return gp(Ua(m,Zr))}),Pg=ri(function(m){var w=Ka(m);return Zr(w)&&(w=t),gp(Ua(m,Zr),Zn(w,2))}),Op=ri(function(m){var w=Ka(m);return w=typeof w=="function"?w:t,gp(Ua(m,Zr),t,w)}),Fp=ri(Kf);function Nv(m,w){return Df(m||[],w||[],Ae)}function Ov(m,w){return Df(m||[],w||[],Fc)}var Lg=ri(function(m){var w=m.length,L=w>1?m[w-1]:t;return L=typeof L=="function"?(m.pop(),L):t,Np(m,L)});function zp(m){var w=se(m);return w.__chain__=!0,w}function Kh(m,w){return w(m),m}function Ca(m,w){return w(m)}var cu=Ya(function(m){var w=m.length,L=w?m[0]:0,q=this.__wrapped__,oe=function(we){return ln(we,m)};return w>1||this.__actions__.length||!(q instanceof vi)||!pa(L)?this.thru(oe):(q=q.slice(L,+L+(w?1:0)),q.__actions__.push({func:Ca,args:[oe],thisArg:t}),new Ks(q,this.__chain__).thru(function(we){return w&&!we.length&&we.push(t),we}))});function kg(){return zp(this)}function Bp(){return new Ks(this.value(),this.__chain__)}function Fv(){this.__values__===t&&(this.__values__=Ne(this.value()));var m=this.__index__>=this.__values__.length,w=m?t:this.__values__[this.__index__++];return{done:m,value:w}}function zv(){return this}function Jf(m){for(var w,L=this;L instanceof Cc;){var q=Rp(L);q.__index__=0,q.__values__=t,w?oe.__wrapped__=q:w=q;var oe=q;L=L.__wrapped__}return oe.__wrapped__=m,w}function Up(){var m=this.__wrapped__;if(m instanceof vi){var w=m;return this.__actions__.length&&(w=new vi(this)),w=w.reverse(),w.__actions__.push({func:Ca,args:[Zc],thisArg:t}),new Ks(w,this.__chain__)}return this.thru(Zc)}function Bv(){return kf(this.__wrapped__,this.__actions__)}var Vp=Hh(function(m,w,L){fn.call(m,L)?++m[L]:Gt(m,L,1)});function Gp(m,w,L){var q=li(m)?Mc:lr;return L&&ea(m,w,L)&&(w=t),q(m,Zn(w,3))}function Jc(m,w){var L=li(m)?Ua:ir;return L(m,Zn(w,3))}var Dg=vp(yg),Ng=vp(Xc);function Hp(m,w){return Ni(ed(m,w),1)}function Og(m,w){return Ni(ed(m,w),wt)}function Qf(m,w,L){return L=L===t?1:ke(L),Ni(ed(m,w),L)}function Wp(m,w){var L=li(m)?Or:tn;return L(m,Zn(w,3))}function Fg(m,w){var L=li(m)?Tc:Vn;return L(m,Zn(w,3))}var Uv=Hh(function(m,w,L){fn.call(m,L)?m[L].push(w):Gt(m,L,[w])});function zg(m,w,L,q){m=Fs(m)?m:du(m),L=L&&!q?ke(L):0;var oe=m.length;return L<0&&(L=Pr(oe+L,0)),U(m)?L<=oe&&m.indexOf(w,L)>-1:!!oe&&Fr(m,w,L)>-1}var Vv=ri(function(m,w,L){var q=-1,oe=typeof w=="function",we=Fs(m)?f(m.length):[];return tn(m,function(ze){we[++q]=oe?us(w,ze,L):Ts(ze,w,L)}),we}),Gv=Hh(function(m,w,L){Gt(m,L,w)});function ed(m,w){var L=li(m)?or:Nc;return L(m,Zn(w,3))}function Hv(m,w,L,q){return m==null?[]:(li(w)||(w=w==null?[]:[w]),L=q?t:L,li(L)||(L=L==null?[]:[L]),Nh(m,w,L))}var qp=Hh(function(m,w,L){m[L?0:1].push(w)},function(){return[[],[]]});function hu(m,w,L){var q=li(m)?zu:Wi,oe=arguments.length<3;return q(m,Zn(w,4),L,oe,tn)}function Bg(m,w,L){var q=li(m)?Bu:Wi,oe=arguments.length<3;return q(m,Zn(w,4),L,oe,Vn)}function Ug(m,w){var L=li(m)?Ua:ir;return L(m,Jh(Zn(w,3)))}function Vg(m){var w=li(m)?Re:xo;return w(m)}function Gg(m,w,L){(L?ea(m,w,L):w===t)?w=1:w=ke(w);var q=li(m)?Ie:nu;return q(m,w)}function Hg(m){var w=li(m)?De:Xm;return w(m)}function $p(m){if(m==null)return 0;if(Fs(m))return U(m)?bs(m):m.length;var w=As(m);return w==Gn||w==pe?m.size:ja(m).length}function td(m,w,L){var q=li(m)?il:dp;return L&&ea(m,w,L)&&(w=t),q(m,Zn(w,3))}var Wg=ri(function(m,w){if(m==null)return[];var L=w.length;return L>1&&ea(m,w[0],w[1])?w=[]:L>2&&ea(w[0],w[1],w[2])&&(w=[w[0]]),Nh(m,Ni(w,1),[])}),Qc=Eh||function(){return ar.Date.now()};function qg(m,w){if(typeof w!="function")throw new je(_);return m=ke(m),function(){if(--m<1)return w.apply(this,arguments)}}function ma(m,w,L){return w=L?t:w,w=m&&w==null?m.length:w,pl(m,Te,t,t,t,t,w)}function eh(m,w){var L;if(typeof w!="function")throw new je(_);return m=ke(m),function(){return--m>0&&(L=w.apply(this,arguments)),m<=1&&(w=t),L}}var nd=ri(function(m,w,L){var q=$;if(L.length){var oe=$s(L,tc(nd));q|=Le}return pl(m,q,w,L,oe)}),Xp=ri(function(m,w,L){var q=$|X;if(L.length){var oe=$s(L,tc(Xp));q|=Le}return pl(w,q,m,L,oe)});function jp(m,w,L){w=L?t:w;var q=pl(m,le,t,t,t,t,t,w);return q.placeholder=jp.placeholder,q}function Zp(m,w,L){w=L?t:w;var q=pl(m,ye,t,t,t,t,t,w);return q.placeholder=Zp.placeholder,q}function Yp(m,w,L){var q,oe,we,ze,Ye,ot,Bt=0,Vt=!1,$t=!1,vn=!0;if(typeof m!="function")throw new je(_);w=pt(w)||0,cr(L)&&(Vt=!!L.leading,$t="maxWait"in L,we=$t?Pr(pt(L.maxWait)||0,w):we,vn="trailing"in L?!!L.trailing:vn);function Bn(ls){var bl=q,oc=oe;return q=oe=t,Bt=ls,ze=m.apply(oc,bl),ze}function ni(ls){return Bt=ls,Ye=$c(Ci,w),Vt?Bn(ls):ze}function wi(ls){var bl=ls-ot,oc=ls-Bt,Ib=w-bl;return $t?Br(Ib,we-oc):Ib}function ii(ls){var bl=ls-ot,oc=ls-Bt;return ot===t||bl>=w||bl<0||$t&&oc>=we}function Ci(){var ls=Qc();if(ii(ls))return Gi(ls);Ye=$c(Ci,wi(ls))}function Gi(ls){return Ye=t,vn&&q?Bn(ls):(q=oe=t,ze)}function Eo(){Ye!==t&&Vh(Ye),Bt=0,q=ot=oe=Ye=t}function La(){return Ye===t?ze:Gi(Qc())}function To(){var ls=Qc(),bl=ii(ls);if(q=arguments,oe=this,ot=ls,bl){if(Ye===t)return ni(ot);if($t)return Vh(Ye),Ye=$c(Ci,w),Bn(ot)}return Ye===t&&(Ye=$c(Ci,w)),ze}return To.cancel=Eo,To.flush=La,To}var $g=ri(function(m,w){return $n(m,1,w)}),Wv=ri(function(m,w,L){return $n(m,pt(w)||0,L)});function Xg(m){return pl(m,de)}function bo(m,w){if(typeof m!="function"||w!=null&&typeof w!="function")throw new je(_);var L=function(){var q=arguments,oe=w?w.apply(this,q):q[0],we=L.cache;if(we.has(oe))return we.get(oe);var ze=m.apply(this,q);return L.cache=we.set(oe,ze)||we,ze};return L.cache=new(bo.Cache||Pn),L}bo.Cache=Pn;function Jh(m){if(typeof m!="function")throw new je(_);return function(){var w=arguments;switch(w.length){case 0:return!m.call(this);case 1:return!m.call(this,w[0]);case 2:return!m.call(this,w[0],w[1]);case 3:return!m.call(this,w[0],w[1],w[2])}return!m.apply(this,w)}}function jg(m){return eh(2,m)}var Zg=nv(function(m,w){w=w.length==1&&li(w[0])?or(w[0],$r(Zn())):or(Ni(w,1),$r(Zn()));var L=w.length;return ri(function(q){for(var oe=-1,we=Br(q.length,L);++oe<we;)q[oe]=w[oe].call(this,q[oe]);return us(m,this,q)})}),id=ri(function(m,w){var L=$s(w,tc(id));return pl(m,Le,t,w,L)}),Yg=ri(function(m,w){var L=$s(w,tc(Yg));return pl(m,Me,t,w,L)}),qv=Ya(function(m,w){return pl(m,We,t,t,t,w)});function Kg(m,w){if(typeof m!="function")throw new je(_);return w=w===t?w:ke(w),ri(m,w)}function th(m,w){if(typeof m!="function")throw new je(_);return w=w==null?0:Pr(ke(w),0),ri(function(L){var q=L[w],oe=Za(L,0,w);return q&&Ls(oe,q),us(m,this,oe)})}function Jg(m,w,L){var q=!0,oe=!0;if(typeof m!="function")throw new je(_);return cr(L)&&(q="leading"in L?!!L.leading:q,oe="trailing"in L?!!L.trailing:oe),Yp(m,w,{leading:q,maxWait:w,trailing:oe})}function rd(m){return ma(m,1)}function Qg(m,w){return id(Of(w),m)}function sd(){if(!arguments.length)return[];var m=arguments[0];return li(m)?m:[m]}function ad(m){return Ot(m,G)}function od(m,w){return w=typeof w=="function"?w:t,Ot(m,G,w)}function $v(m){return Ot(m,D|G)}function Xv(m,w){return w=typeof w=="function"?w:t,Ot(m,D|G,w)}function jv(m,w){return w==null||gn(m,w,Vi(w))}function Os(m,w){return m===w||m!==m&&w!==w}var ds=Hf(Jl),fu=Hf(function(m,w){return m>=w}),_l=yo(function(){return arguments}())?yo:function(m){return Tr(m)&&fn.call(m,"callee")&&!Do.call(m,"callee")},li=f.isArray,e_=zl?$r(zl):eu;function Fs(m){return m!=null&&ic(m.length)&&!Ho(m)}function Zr(m){return Tr(m)&&Fs(m)}function t_(m){return m===!0||m===!1||Tr(m)&&Lr(m)==qe}var yl=Mh||f0,Zv=uo?$r(uo):hs;function n_(m){return Tr(m)&&m.nodeType===1&&!M(m)}function Kp(m){if(m==null)return!0;if(Fs(m)&&(li(m)||typeof m=="string"||typeof m.splice=="function"||yl(m)||Y(m)||_l(m)))return!m.length;var w=As(m);if(w==Gn||w==pe)return!m.size;if(Xh(m))return!ja(m).length;for(var L in m)if(fn.call(m,L))return!1;return!0}function Jp(m,w){return Ur(m,w)}function i_(m,w,L){L=typeof L=="function"?L:t;var q=L?L(m,w):t;return q===t?Ur(m,w,t,L):!!q}function nc(m){if(!Tr(m))return!1;var w=Lr(m);return w==nn||w==bn||typeof m.message=="string"&&typeof m.name=="string"&&!M(m)}function Qp(m){return typeof m=="number"&&Ah(m)}function Ho(m){if(!cr(m))return!1;var w=Lr(m);return w==ne||w==ui||w==cn||w==ut}function ld(m){return typeof m=="number"&&m==ke(m)}function ic(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=yt}function cr(m){var w=typeof m;return m!=null&&(w=="object"||w=="function")}function Tr(m){return m!=null&&typeof m=="object"}var ud=Ou?$r(Ou):pr;function em(m,w){return m===w||Uo(m,w,qh(w))}function Yv(m,w,L){return L=typeof L=="function"?L:t,Uo(m,w,qh(w),L)}function r(m){return b(m)&&m!=+m}function n(m){if(dv(m))throw new C(g);return kc(m)}function o(m){return m===null}function p(m){return m==null}function b(m){return typeof m=="number"||Tr(m)&&Lr(m)==Kn}function M(m){if(!Tr(m)||Lr(m)!=hi)return!1;var w=Wa(m);if(w===null)return!0;var L=fn.call(w,"constructor")&&w.constructor;return typeof L=="function"&&L instanceof L&&Nn.call(L)==zr}var A=ys?$r(ys):jr;function R(m){return ld(m)&&m>=-yt&&m<=yt}var O=Bl?$r(Bl):If;function U(m){return typeof m=="string"||!li(m)&&Tr(m)&&Lr(m)==dt}function W(m){return typeof m=="symbol"||Tr(m)&&Lr(m)==Ut}var Y=Fu?$r(Fu):Dc;function ee(m){return m===t}function ae(m){return Tr(m)&&As(m)==Lt}function he(m){return Tr(m)&&Lr(m)==Dn}var _e=Hf(Zu),Ce=Hf(function(m,w){return m<=w});function Ne(m){if(!m)return[];if(Fs(m))return U(m)?ws(m):Ms(m);if(go&&m[go])return ql(m[go]());var w=As(m),L=w==Gn?ua:w==pe?Ta:du;return L(m)}function nt(m){if(!m)return m===0?m:0;if(m=pt(m),m===wt||m===-wt){var w=m<0?-1:1;return w*Jt}return m===m?m:0}function ke(m){var w=nt(m),L=w%1;return w===w?L?w-L:w:0}function tt(m){return m?on(ke(m),0,jt):0}function pt(m){if(typeof m=="number")return m;if(W(m))return Tt;if(cr(m)){var w=typeof m.valueOf=="function"?m.valueOf():m;m=cr(w)?w+"":w}if(typeof m!="string")return m===0?m:+m;m=$i(m);var L=Ge.test(m);return L||at.test(m)?Du(m.slice(2),L?2:8):ve.test(m)?Tt:+m}function Wt(m){return Vo(m,ji(m))}function hn(m){return m?on(ke(m),-yt,yt):m===0?m:0}function rn(m){return m==null?"":Qs(m)}var un=Bc(function(m,w){if(Xh(w)||Fs(w)){Vo(w,Vi(w),m);return}for(var L in w)fn.call(w,L)&&Ae(m,L,w[L])}),sn=Bc(function(m,w){Vo(w,ji(w),m)}),wn=Bc(function(m,w,L,q){Vo(w,ji(w),m,q)}),_n=Bc(function(m,w,L,q){Vo(w,Vi(w),m,q)}),dn=Ya(ln);function At(m,w){var L=Fo(m);return w==null?L:ft(L,w)}var Ln=ri(function(m,w){m=Q(m);var L=-1,q=w.length,oe=q>2?w[2]:t;for(oe&&ea(w[0],w[1],oe)&&(q=1);++L<q;)for(var we=w[L],ze=ji(we),Ye=-1,ot=ze.length;++Ye<ot;){var Bt=ze[Ye],Vt=m[Bt];(Vt===t||Os(Vt,Nt[Bt])&&!fn.call(m,Bt))&&(m[Bt]=we[Bt])}return m}),Mn=ri(function(m){return m.push(t,Wf),us(Yi,t,m)});function Xn(m,w){return Vl(m,Zn(w,3),xr)}function Zi(m,w){return Vl(m,Zn(w,3),as)}function Xi(m,w){return m==null?m:Js(m,Zn(w,3),ji)}function ns(m,w){return m==null?m:rr(m,Zn(w,3),ji)}function Ja(m,w){return m&&xr(m,Zn(w,3))}function ps(m,w){return m&&as(m,Zn(w,3))}function Mr(m){return m==null?[]:Xr(m,Vi(m))}function zs(m){return m==null?[]:Xr(m,ji(m))}function ms(m,w,L){var q=m==null?t:Er(m,w);return q===t?L:q}function Bs(m,w){return m!=null&&rg(m,w,Ql)}function mr(m,w){return m!=null&&rg(m,w,hl)}var is=eg(function(m,w,L){w!=null&&typeof w.toString!="function"&&(w=vr.call(w)),m[w]=L},o0(eo)),Is=eg(function(m,w,L){w!=null&&typeof w.toString!="function"&&(w=vr.call(w)),fn.call(m,w)?m[w].push(L):m[w]=[L]},Zn),gs=ri(Ts);function Vi(m){return Fs(m)?Ee(m):ja(m)}function ji(m){return Fs(m)?Ee(m,!0):Cf(m)}function Ra(m,w){var L={};return w=Zn(w,3),xr(m,function(q,oe,we){Gt(L,w(q,oe,we),q)}),L}function na(m,w){var L={};return w=Zn(w,3),xr(m,function(q,oe,we){Gt(L,oe,w(q,oe,we))}),L}var Ti=Bc(function(m,w,L){vo(m,w,L)}),Yi=Bc(function(m,w,L,q){vo(m,w,L,q)}),ur=Ya(function(m,w){var L={};if(m==null)return L;var q=!1;w=or(w,function(we){return we=Ia(we,m),q||(q=we.length>1),we}),Vo(m,Hc(m),L),q&&(L=Ot(L,D|N|G,av));for(var oe=w.length;oe--;)pp(L,w[oe]);return L});function ga(m,w){return rc(m,Jh(Zn(w)))}var br=Ya(function(m,w){return m==null?{}:Ku(m,w)});function rc(m,w){if(m==null)return{};var L=or(Hc(m),function(q){return[q]});return w=Zn(w),Oh(m,L,function(q,oe){return w(q,oe[0])})}function Wo(m,w,L){w=Ia(w,m);var q=-1,oe=w.length;for(oe||(oe=1,m=t);++q<oe;){var we=m==null?t:m[Go(w[q])];we===t&&(q=oe,we=L),m=Ho(we)?we.call(m):we}return m}function qo(m,w,L){return m==null?m:Fc(m,w,L)}function Qa(m,w,L,q){return q=typeof q=="function"?q:t,m==null?m:Fc(m,w,L,q)}var _a=ng(Vi),rs=ng(ji);function vl(m,w,L){var q=li(m),oe=q||yl(m)||Y(m);if(w=Zn(w,4),L==null){var we=m&&m.constructor;oe?L=q?new we:[]:cr(m)?L=Ho(we)?Fo(Wa(m)):{}:L={}}return(oe?Or:xr)(m,function(ze,Ye,ot){return w(L,ze,Ye,ot)}),L}function Qh(m,w){return m==null?!0:pp(m,w)}function r_(m,w,L){return m==null?m:mp(m,w,Of(L))}function s_(m,w,L,q){return q=typeof q=="function"?q:t,m==null?m:mp(m,w,Of(L),q)}function du(m){return m==null?[]:Gl(m,Vi(m))}function tm(m){return m==null?[]:Gl(m,ji(m))}function xl(m,w,L){return L===t&&(L=w,w=t),L!==t&&(L=pt(L),L=L===L?L:0),w!==t&&(w=pt(w),w=w===w?w:0),on(pt(m),w,L)}function a_(m,w,L){return w=nt(w),L===t?(L=w,w=0):L=nt(L),m=pt(m),Lc(m,w,L)}function o_(m,w,L){if(L&&typeof L!="boolean"&&ea(m,w,L)&&(w=L=t),L===t&&(typeof w=="boolean"?(L=w,w=t):typeof m=="boolean"&&(L=m,m=t)),m===t&&w===t?(m=0,w=1):(m=nt(m),w===t?(w=m,m=0):w=nt(w)),m>w){var q=m;m=w,w=q}if(L||m%1||w%1){var oe=fa();return Br(m+oe*(w-m+Ws("1e-"+((oe+"").length-1))),w)}return Fh(m,w)}var Kv=fs(function(m,w,L){return w=w.toLowerCase(),m+(L?l_(w):w)});function l_(m){return a0(rn(m).toLowerCase())}function u_(m){return m=rn(m),m&&m.replace(Dt,Gu).replace(el,"")}function Jv(m,w,L){m=rn(m),w=Qs(w);var q=m.length;L=L===t?q:on(ke(L),0,q);var oe=L;return L-=w.length,L>=0&&m.slice(L,oe)==w}function Qv(m){return m=rn(m),m&&te.test(m)?m.replace(Yt,Ga):m}function e0(m){return m=rn(m),m&&_t.test(m)?m.replace(Fe,"\\$&"):m}var t0=fs(function(m,w,L){return m+(L?"-":"")+w.toLowerCase()}),n0=fs(function(m,w,L){return m+(L?" ":"")+w.toLowerCase()}),wo=Uc("toLowerCase");function cd(m,w,L){m=rn(m),w=ke(w);var q=w?bs(m):0;if(!w||q>=w)return m;var oe=(w-q)/2;return Wh(jl(oe),L)+m+Wh(ca(oe),L)}function c_(m,w,L){m=rn(m),w=ke(w);var q=w?bs(m):0;return w&&q<w?m+Wh(w-q,L):m}function i0(m,w,L){m=rn(m),w=ke(w);var q=w?bs(m):0;return w&&q<w?Wh(w-q,L)+m:m}function r0(m,w,L){return L||w==null?w=0:w&&(w=+w),ha(rn(m).replace(Pt,""),w||0)}function s0(m,w,L){return(L?ea(m,w,L):w===t)?w=1:w=ke(w),tu(rn(m),w)}function Cs(){var m=arguments,w=rn(m[0]);return m.length<3?w:w.replace(m[1],m[2])}var Pa=fs(function(m,w,L){return m+(L?"_":"")+w.toLowerCase()});function sc(m,w,L){return L&&typeof L!="number"&&ea(m,w,L)&&(w=L=t),L=L===t?jt:L>>>0,L?(m=rn(m),m&&(typeof w=="string"||w!=null&&!A(w))&&(w=Qs(w),!w&&Ha(m))?Za(ws(m),0,L):m.split(w,L)):[]}var So=fs(function(m,w,L){return m+(L?" ":"")+a0(w)});function ac(m,w,L){return m=rn(m),L=L==null?0:on(ke(L),0,m.length),w=Qs(w),m.slice(L,L+w.length)==w}function $o(m,w,L){var q=se.templateSettings;L&&ea(m,w,L)&&(w=t),m=rn(m),w=wn({},w,q,ig);var oe=wn({},w.imports,q.imports,ig),we=Vi(oe),ze=Gl(oe,we),Ye,ot,Bt=0,Vt=w.interpolate||en,$t="__p += '",vn=xe((w.escape||en).source+"|"+Vt.source+"|"+(Vt===ce?Mi:en).source+"|"+(w.evaluate||en).source+"|$","g"),Bn="//# sourceURL="+(fn.call(w,"sourceURL")?(w.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ku+"]")+`
`;m.replace(vn,function(ii,Ci,Gi,Eo,La,To){return Gi||(Gi=Eo),$t+=m.slice(Bt,To).replace(Sn,ho),Ci&&(Ye=!0,$t+=`' +
__e(`+Ci+`) +
'`),La&&(ot=!0,$t+=`';
`+La+`;
__p += '`),Gi&&($t+=`' +
((__t = (`+Gi+`)) == null ? '' : __t) +
'`),Bt=To+ii.length,ii}),$t+=`';
`;var ni=fn.call(w,"variable")&&w.variable;if(!ni)$t=`with (obj) {
`+$t+`
}
`;else if(di.test(ni))throw new C(c);$t=(ot?$t.replace(Be,""):$t).replace(Ht,"$1").replace(Ct,"$1;"),$t="function("+(ni||"obj")+`) {
`+(ni?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ye?", __e = _.escape":"")+(ot?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$t+`return __p
}`;var wi=Mb(function(){return B(we,Bn+"return "+$t).apply(t,ze)});if(wi.source=$t,nc(wi))throw wi;return wi}function hA(m){return rn(m).toLowerCase()}function fA(m){return rn(m).toUpperCase()}function dA(m,w,L){if(m=rn(m),m&&(L||w===t))return $i(m);if(!m||!(w=Qs(w)))return m;var q=ws(m),oe=ws(w),we=ul(q,oe),ze=Po(q,oe)+1;return Za(q,we,ze).join("")}function pA(m,w,L){if(m=rn(m),m&&(L||w===t))return m.slice(0,po(m)+1);if(!m||!(w=Qs(w)))return m;var q=ws(m),oe=Po(q,ws(w))+1;return Za(q,0,oe).join("")}function mA(m,w,L){if(m=rn(m),m&&(L||w===t))return m.replace(Pt,"");if(!m||!(w=Qs(w)))return m;var q=ws(m),oe=ul(q,ws(w));return Za(q,oe).join("")}function gA(m,w){var L=be,q=Oe;if(cr(w)){var oe="separator"in w?w.separator:oe;L="length"in w?ke(w.length):L,q="omission"in w?Qs(w.omission):q}m=rn(m);var we=m.length;if(Ha(m)){var ze=ws(m);we=ze.length}if(L>=we)return m;var Ye=L-bs(q);if(Ye<1)return q;var ot=ze?Za(ze,0,Ye).join(""):m.slice(0,Ye);if(oe===t)return ot+q;if(ze&&(Ye+=ot.length-Ye),A(oe)){if(m.slice(Ye).search(oe)){var Bt,Vt=ot;for(oe.global||(oe=xe(oe.source,rn(Li.exec(oe))+"g")),oe.lastIndex=0;Bt=oe.exec(Vt);)var $t=Bt.index;ot=ot.slice(0,$t===t?Ye:$t)}}else if(m.indexOf(Qs(oe),Ye)!=Ye){var vn=ot.lastIndexOf(oe);vn>-1&&(ot=ot.slice(0,vn))}return ot+q}function _A(m){return m=rn(m),m&&Se.test(m)?m.replace(It,ci):m}var yA=fs(function(m,w,L){return m+(L?" ":"")+w.toUpperCase()}),a0=Uc("toUpperCase");function Tb(m,w,L){return m=rn(m),w=L?t:w,w===t?Wl(m)?Ss(m):vs(m):m.match(w)||[]}var Mb=ri(function(m,w){try{return us(m,t,w)}catch(L){return nc(L)?L:new C(L)}}),vA=Ya(function(m,w){return Or(w,function(L){L=Go(L),Gt(m,L,nd(m[L],m))}),m});function xA(m){var w=m==null?0:m.length,L=Zn();return m=w?or(m,function(q){if(typeof q[1]!="function")throw new je(_);return[L(q[0]),q[1]]}):[],ri(function(q){for(var oe=-1;++oe<w;){var we=m[oe];if(us(we[0],this,q))return us(we[1],this,q)}})}function bA(m){return Kt(Ot(m,D))}function o0(m){return function(){return m}}function wA(m,w){return m==null||m!==m?w:m}var SA=Qm(),EA=Qm(!0);function eo(m){return m}function l0(m){return ju(typeof m=="function"?m:Ot(m,D))}function TA(m){return Oc(Ot(m,D))}function MA(m,w){return Yu(m,Ot(w,D))}var AA=ri(function(m,w){return function(L){return Ts(L,m,w)}}),IA=ri(function(m,w){return function(L){return Ts(m,L,w)}});function u0(m,w,L){var q=Vi(w),oe=Xr(w,q);L==null&&!(cr(w)&&(oe.length||!q.length))&&(L=w,w=m,m=this,oe=Xr(w,Vi(w)));var we=!(cr(L)&&"chain"in L)||!!L.chain,ze=Ho(m);return Or(oe,function(Ye){var ot=w[Ye];m[Ye]=ot,ze&&(m.prototype[Ye]=function(){var Bt=this.__chain__;if(we||Bt){var Vt=m(this.__wrapped__),$t=Vt.__actions__=Ms(this.__actions__);return $t.push({func:ot,args:arguments,thisArg:m}),Vt.__chain__=Bt,Vt}return ot.apply(m,Ls([this.value()],arguments))})}),m}function CA(){return ar._===this&&(ar._=Es),this}function c0(){}function RA(m){return m=ke(m),ri(function(w){return Rf(w,m)})}var PA=Gf(or),LA=Gf(Mc),kA=Gf(il);function Ab(m){return Sp(m)?ol(Go(m)):qm(m)}function DA(m){return function(w){return m==null?t:Er(m,w)}}var NA=Gc(),OA=Gc(!0);function h0(){return[]}function f0(){return!1}function FA(){return{}}function zA(){return""}function BA(){return!0}function UA(m,w){if(m=ke(m),m<1||m>yt)return[];var L=jt,q=Br(m,jt);w=Zn(w),m-=jt;for(var oe=ll(q,w);++L<m;)w(L);return oe}function VA(m){return li(m)?or(m,Go):W(m)?[m]:Ms(dg(rn(m)))}function GA(m){var w=++Ii;return rn(m)+w}var HA=Vf(function(m,w){return m+w},0),WA=xp("ceil"),qA=Vf(function(m,w){return m/w},1),$A=xp("floor");function XA(m){return m&&m.length?ei(m,eo,Jl):t}function jA(m,w){return m&&m.length?ei(m,Zn(w,2),Jl):t}function ZA(m){return al(m,eo)}function YA(m,w){return al(m,Zn(w,2))}function KA(m){return m&&m.length?ei(m,eo,Zu):t}function JA(m,w){return m&&m.length?ei(m,Zn(w,2),Zu):t}var QA=Vf(function(m,w){return m*w},1),eI=xp("round"),tI=Vf(function(m,w){return m-w},0);function nI(m){return m&&m.length?ai(m,eo):0}function iI(m,w){return m&&m.length?ai(m,Zn(w,2)):0}return se.after=qg,se.ary=ma,se.assign=un,se.assignIn=sn,se.assignInWith=wn,se.assignWith=_n,se.at=dn,se.before=eh,se.bind=nd,se.bindAll=vA,se.bindKey=Xp,se.castArray=sd,se.chain=zp,se.chunk=pg,se.compact=mg,se.concat=gv,se.cond=xA,se.conforms=bA,se.constant=o0,se.countBy=Vp,se.create=At,se.curry=jp,se.curryRight=Zp,se.debounce=Yp,se.defaults=Ln,se.defaultsDeep=Mn,se.defer=$g,se.delay=Wv,se.difference=jf,se.differenceBy=_v,se.differenceWith=gg,se.drop=yv,se.dropRight=vv,se.dropRightWhile=xv,se.dropWhile=_g,se.fill=bv,se.filter=Jc,se.flatMap=Hp,se.flatMapDeep=Og,se.flatMapDepth=Qf,se.flatten=Vr,se.flattenDeep=vg,se.flattenDepth=xg,se.flip=Xg,se.flow=SA,se.flowRight=EA,se.fromPairs=bg,se.functions=Mr,se.functionsIn=zs,se.groupBy=Uv,se.initial=wg,se.intersection=Sg,se.intersectionBy=gl,se.intersectionWith=jc,se.invert=is,se.invertBy=Is,se.invokeMap=Vv,se.iteratee=l0,se.keyBy=Gv,se.keys=Vi,se.keysIn=ji,se.map=ed,se.mapKeys=Ra,se.mapValues=na,se.matches=TA,se.matchesProperty=MA,se.memoize=bo,se.merge=Ti,se.mergeWith=Yi,se.method=AA,se.methodOf=IA,se.mixin=u0,se.negate=Jh,se.nthArg=RA,se.omit=ur,se.omitBy=ga,se.once=jg,se.orderBy=Hv,se.over=PA,se.overArgs=Zg,se.overEvery=LA,se.overSome=kA,se.partial=id,se.partialRight=Yg,se.partition=qp,se.pick=br,se.pickBy=rc,se.property=Ab,se.propertyOf=DA,se.pull=Ev,se.pullAll=Tg,se.pullAllBy=Tv,se.pullAllWith=Mv,se.pullAt=Av,se.range=NA,se.rangeRight=OA,se.rearg=qv,se.reject=Ug,se.remove=Iv,se.rest=Kg,se.reverse=Zc,se.sampleSize=Gg,se.set=qo,se.setWith=Qa,se.shuffle=Hg,se.slice=Yc,se.sortBy=Wg,se.sortedUniq=Ag,se.sortedUniqBy=Ig,se.split=sc,se.spread=th,se.tail=ta,se.take=Dp,se.takeRight=Cg,se.takeRightWhile=uu,se.takeWhile=Zh,se.tap=Kh,se.throttle=Jg,se.thru=Ca,se.toArray=Ne,se.toPairs=_a,se.toPairsIn=rs,se.toPath=VA,se.toPlainObject=Wt,se.transform=vl,se.unary=rd,se.union=Yh,se.unionBy=Kc,se.unionWith=Zf,se.uniq=Yf,se.uniqBy=Lv,se.uniqWith=kv,se.unset=Qh,se.unzip=Kf,se.unzipWith=Np,se.update=r_,se.updateWith=s_,se.values=du,se.valuesIn=tm,se.without=Dv,se.words=Tb,se.wrap=Qg,se.xor=Rg,se.xorBy=Pg,se.xorWith=Op,se.zip=Fp,se.zipObject=Nv,se.zipObjectDeep=Ov,se.zipWith=Lg,se.entries=_a,se.entriesIn=rs,se.extend=sn,se.extendWith=wn,u0(se,se),se.add=HA,se.attempt=Mb,se.camelCase=Kv,se.capitalize=l_,se.ceil=WA,se.clamp=xl,se.clone=ad,se.cloneDeep=$v,se.cloneDeepWith=Xv,se.cloneWith=od,se.conformsTo=jv,se.deburr=u_,se.defaultTo=wA,se.divide=qA,se.endsWith=Jv,se.eq=Os,se.escape=Qv,se.escapeRegExp=e0,se.every=Gp,se.find=Dg,se.findIndex=yg,se.findKey=Xn,se.findLast=Ng,se.findLastIndex=Xc,se.findLastKey=Zi,se.floor=$A,se.forEach=Wp,se.forEachRight=Fg,se.forIn=Xi,se.forInRight=ns,se.forOwn=Ja,se.forOwnRight=ps,se.get=ms,se.gt=ds,se.gte=fu,se.has=Bs,se.hasIn=mr,se.head=qi,se.identity=eo,se.includes=zg,se.indexOf=Pp,se.inRange=a_,se.invoke=gs,se.isArguments=_l,se.isArray=li,se.isArrayBuffer=e_,se.isArrayLike=Fs,se.isArrayLikeObject=Zr,se.isBoolean=t_,se.isBuffer=yl,se.isDate=Zv,se.isElement=n_,se.isEmpty=Kp,se.isEqual=Jp,se.isEqualWith=i_,se.isError=nc,se.isFinite=Qp,se.isFunction=Ho,se.isInteger=ld,se.isLength=ic,se.isMap=ud,se.isMatch=em,se.isMatchWith=Yv,se.isNaN=r,se.isNative=n,se.isNil=p,se.isNull=o,se.isNumber=b,se.isObject=cr,se.isObjectLike=Tr,se.isPlainObject=M,se.isRegExp=A,se.isSafeInteger=R,se.isSet=O,se.isString=U,se.isSymbol=W,se.isTypedArray=Y,se.isUndefined=ee,se.isWeakMap=ae,se.isWeakSet=he,se.join=Eg,se.kebabCase=t0,se.last=Ka,se.lastIndexOf=wv,se.lowerCase=n0,se.lowerFirst=wo,se.lt=_e,se.lte=Ce,se.max=XA,se.maxBy=jA,se.mean=ZA,se.meanBy=YA,se.min=KA,se.minBy=JA,se.stubArray=h0,se.stubFalse=f0,se.stubObject=FA,se.stubString=zA,se.stubTrue=BA,se.multiply=QA,se.nth=Sv,se.noConflict=CA,se.noop=c0,se.now=Qc,se.pad=cd,se.padEnd=c_,se.padStart=i0,se.parseInt=r0,se.random=o_,se.reduce=hu,se.reduceRight=Bg,se.repeat=s0,se.replace=Cs,se.result=Wo,se.round=eI,se.runInContext=s,se.sample=Vg,se.size=$p,se.snakeCase=Pa,se.some=td,se.sortedIndex=Mg,se.sortedIndexBy=Lp,se.sortedIndexOf=kp,se.sortedLastIndex=Cv,se.sortedLastIndexBy=Rv,se.sortedLastIndexOf=Pv,se.startCase=So,se.startsWith=ac,se.subtract=tI,se.sum=nI,se.sumBy=iI,se.template=$o,se.times=UA,se.toFinite=nt,se.toInteger=ke,se.toLength=tt,se.toLower=hA,se.toNumber=pt,se.toSafeInteger=hn,se.toString=rn,se.toUpper=fA,se.trim=dA,se.trimEnd=pA,se.trimStart=mA,se.truncate=gA,se.unescape=_A,se.uniqueId=GA,se.upperCase=yA,se.upperFirst=a0,se.each=Wp,se.eachRight=Fg,se.first=qi,u0(se,function(){var m={};return xr(se,function(w,L){fn.call(se.prototype,L)||(m[L]=w)}),m}(),{chain:!1}),se.VERSION=a,Or(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){se[m].placeholder=se}),Or(["drop","take"],function(m,w){vi.prototype[m]=function(L){L=L===t?1:Pr(ke(L),0);var q=this.__filtered__&&!w?new vi(this):this.clone();return q.__filtered__?q.__takeCount__=Br(L,q.__takeCount__):q.__views__.push({size:Br(L,jt),type:m+(q.__dir__<0?"Right":"")}),q},vi.prototype[m+"Right"]=function(L){return this.reverse()[m](L).reverse()}}),Or(["filter","map","takeWhile"],function(m,w){var L=w+1,q=L==Je||L==gt;vi.prototype[m]=function(oe){var we=this.clone();return we.__iteratees__.push({iteratee:Zn(oe,3),type:L}),we.__filtered__=we.__filtered__||q,we}}),Or(["head","last"],function(m,w){var L="take"+(w?"Right":"");vi.prototype[m]=function(){return this[L](1).value()[0]}}),Or(["initial","tail"],function(m,w){var L="drop"+(w?"":"Right");vi.prototype[m]=function(){return this.__filtered__?new vi(this):this[L](1)}}),vi.prototype.compact=function(){return this.filter(eo)},vi.prototype.find=function(m){return this.filter(m).head()},vi.prototype.findLast=function(m){return this.reverse().find(m)},vi.prototype.invokeMap=ri(function(m,w){return typeof m=="function"?new vi(this):this.map(function(L){return Ts(L,m,w)})}),vi.prototype.reject=function(m){return this.filter(Jh(Zn(m)))},vi.prototype.slice=function(m,w){m=ke(m);var L=this;return L.__filtered__&&(m>0||w<0)?new vi(L):(m<0?L=L.takeRight(-m):m&&(L=L.drop(m)),w!==t&&(w=ke(w),L=w<0?L.dropRight(-w):L.take(w-m)),L)},vi.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},vi.prototype.toArray=function(){return this.take(jt)},xr(vi.prototype,function(m,w){var L=/^(?:filter|find|map|reject)|While$/.test(w),q=/^(?:head|last)$/.test(w),oe=se[q?"take"+(w=="last"?"Right":""):w],we=q||/^find/.test(w);oe&&(se.prototype[w]=function(){var ze=this.__wrapped__,Ye=q?[1]:arguments,ot=ze instanceof vi,Bt=Ye[0],Vt=ot||li(ze),$t=function(Ci){var Gi=oe.apply(se,Ls([Ci],Ye));return q&&vn?Gi[0]:Gi};Vt&&L&&typeof Bt=="function"&&Bt.length!=1&&(ot=Vt=!1);var vn=this.__chain__,Bn=!!this.__actions__.length,ni=we&&!vn,wi=ot&&!Bn;if(!we&&Vt){ze=wi?ze:new vi(this);var ii=m.apply(ze,Ye);return ii.__actions__.push({func:Ca,args:[$t],thisArg:t}),new Ks(ii,vn)}return ni&&wi?m.apply(this,Ye):(ii=this.thru($t),ni?q?ii.value()[0]:ii.value():ii)})}),Or(["pop","push","shift","sort","splice","unshift"],function(m){var w=Et[m],L=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",q=/^(?:pop|shift)$/.test(m);se.prototype[m]=function(){var oe=arguments;if(q&&!this.__chain__){var we=this.value();return w.apply(li(we)?we:[],oe)}return this[L](function(ze){return w.apply(li(ze)?ze:[],oe)})}}),xr(vi.prototype,function(m,w){var L=se[w];if(L){var q=L.name+"";fn.call(Aa,q)||(Aa[q]=[]),Aa[q].push({name:w,func:L})}}),Aa[Uf(t,X).name]=[{name:"wrapper",func:t}],vi.prototype.clone=Mf,vi.prototype.reverse=zo,vi.prototype.value=Af,se.prototype.at=cu,se.prototype.chain=kg,se.prototype.commit=Bp,se.prototype.next=Fv,se.prototype.plant=Jf,se.prototype.reverse=Up,se.prototype.toJSON=se.prototype.valueOf=se.prototype.value=Bv,se.prototype.first=se.prototype.head,go&&(se.prototype[go]=zv),se},S=es();yr?((yr.exports=S)._=S,Nu._=S):ar._=S}).call(Ml)})(Gy,Gy.exports);var fB=Gy.exports;const hx=qy(fB);function RE(l,e){if(e===Vk)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===b1||e===CM){let t=l.getIndex();if(t===null){const _=[],c=l.getAttribute("position");if(c!==void 0){for(let I=0;I<c.count;I++)_.push(I);l.setIndex(_),t=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const a=t.count-2,d=[];if(e===b1)for(let _=1;_<=a;_++)d.push(t.getX(0)),d.push(t.getX(_)),d.push(t.getX(_+1));else for(let _=0;_<a;_++)_%2===0?(d.push(t.getX(_)),d.push(t.getX(_+1)),d.push(t.getX(_+2))):(d.push(t.getX(_+2)),d.push(t.getX(_+1)),d.push(t.getX(_)));d.length/3!==a&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const g=l.clone();return g.setIndex(d),g.clearGroups(),g}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}class dB extends fp{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new yB(t)}),this.register(function(t){return new vB(t)}),this.register(function(t){return new IB(t)}),this.register(function(t){return new CB(t)}),this.register(function(t){return new RB(t)}),this.register(function(t){return new bB(t)}),this.register(function(t){return new wB(t)}),this.register(function(t){return new SB(t)}),this.register(function(t){return new EB(t)}),this.register(function(t){return new _B(t)}),this.register(function(t){return new TB(t)}),this.register(function(t){return new xB(t)}),this.register(function(t){return new AB(t)}),this.register(function(t){return new MB(t)}),this.register(function(t){return new mB(t)}),this.register(function(t){return new PB(t)}),this.register(function(t){return new LB(t)})}load(e,t,a,d){const g=this;let _;if(this.resourcePath!=="")_=this.resourcePath;else if(this.path!==""){const P=Am.extractUrlBase(e);_=Am.resolveURL(P,this.path)}else _=Am.extractUrlBase(e);this.manager.itemStart(e);const c=function(P){d?d(P):console.error(P),g.manager.itemError(e),g.manager.itemEnd(e)},I=new QM(this.manager);I.setPath(this.path),I.setResponseType("arraybuffer"),I.setRequestHeader(this.requestHeader),I.setWithCredentials(this.withCredentials),I.load(e,function(P){try{g.parse(P,_,function(F){t(F),g.manager.itemEnd(e)},c)}catch(F){c(F)}},a,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,a,d){let g;const _={},c={},I=new TextDecoder;if(typeof e=="string")g=JSON.parse(e);else if(e instanceof ArrayBuffer)if(I.decode(new Uint8Array(e,0,4))===tA){try{_[Ri.KHR_BINARY_GLTF]=new kB(e)}catch(D){d&&d(D);return}g=JSON.parse(_[Ri.KHR_BINARY_GLTF].content)}else g=JSON.parse(I.decode(e));else g=e;if(g.asset===void 0||g.asset.version[0]<2){d&&d(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const P=new $B(g,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});P.fileLoader.setRequestHeader(this.requestHeader);for(let F=0;F<this.pluginCallbacks.length;F++){const D=this.pluginCallbacks[F](P);D.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[D.name]=D,_[D.name]=!0}if(g.extensionsUsed)for(let F=0;F<g.extensionsUsed.length;++F){const D=g.extensionsUsed[F],N=g.extensionsRequired||[];switch(D){case Ri.KHR_MATERIALS_UNLIT:_[D]=new gB;break;case Ri.KHR_DRACO_MESH_COMPRESSION:_[D]=new DB(g,this.dracoLoader);break;case Ri.KHR_TEXTURE_TRANSFORM:_[D]=new NB;break;case Ri.KHR_MESH_QUANTIZATION:_[D]=new OB;break;default:N.indexOf(D)>=0&&c[D]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+D+'".')}}P.setExtensions(_),P.setPlugins(c),P.parse(a,d)}parseAsync(e,t){const a=this;return new Promise(function(d,g){a.parse(e,t,d,g)})}}function pB(){let l={};return{get:function(e){return l[e]},add:function(e,t){l[e]=t},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const Ri={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mB{constructor(e){this.parser=e,this.name=Ri.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let a=0,d=t.length;a<d;a++){const g=t[a];g.extensions&&g.extensions[this.name]&&g.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,g.extensions[this.name].light)}}_loadLight(e){const t=this.parser,a="light:"+e;let d=t.cache.get(a);if(d)return d;const g=t.json,I=((g.extensions&&g.extensions[this.name]||{}).lights||[])[e];let P;const F=new _i(16777215);I.color!==void 0&&F.setRGB(I.color[0],I.color[1],I.color[2],ia);const D=I.range!==void 0?I.range:0;switch(I.type){case"directional":P=new eB(F),P.target.position.set(0,0,-1),P.add(P.target);break;case"point":P=new Jz(F),P.distance=D;break;case"spot":P=new Yz(F),P.distance=D,I.spot=I.spot||{},I.spot.innerConeAngle=I.spot.innerConeAngle!==void 0?I.spot.innerConeAngle:0,I.spot.outerConeAngle=I.spot.outerConeAngle!==void 0?I.spot.outerConeAngle:Math.PI/4,P.angle=I.spot.outerConeAngle,P.penumbra=1-I.spot.innerConeAngle/I.spot.outerConeAngle,P.target.position.set(0,0,-1),P.add(P.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+I.type)}return P.position.set(0,0,0),P.decay=2,gc(P,I),I.intensity!==void 0&&(P.intensity=I.intensity),P.name=t.createUniqueName(I.name||"light_"+e),d=Promise.resolve(P),t.cache.add(a,d),d}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,a=this.parser,g=a.json.nodes[e],c=(g.extensions&&g.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(I){return a._getNodeRef(t.cache,c,I)})}}class gB{constructor(){this.name=Ri.KHR_MATERIALS_UNLIT}getMaterialType(){return ph}extendParams(e,t,a){const d=[];e.color=new _i(1,1,1),e.opacity=1;const g=t.pbrMetallicRoughness;if(g){if(Array.isArray(g.baseColorFactor)){const _=g.baseColorFactor;e.color.setRGB(_[0],_[1],_[2],ia),e.opacity=_[3]}g.baseColorTexture!==void 0&&d.push(a.assignTexture(e,"map",g.baseColorTexture,Na))}return Promise.all(d)}}class _B{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const d=this.parser.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=d.extensions[this.name].emissiveStrength;return g!==void 0&&(t.emissiveIntensity=g),Promise.resolve()}}class yB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];if(_.clearcoatFactor!==void 0&&(t.clearcoat=_.clearcoatFactor),_.clearcoatTexture!==void 0&&g.push(a.assignTexture(t,"clearcoatMap",_.clearcoatTexture)),_.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=_.clearcoatRoughnessFactor),_.clearcoatRoughnessTexture!==void 0&&g.push(a.assignTexture(t,"clearcoatRoughnessMap",_.clearcoatRoughnessTexture)),_.clearcoatNormalTexture!==void 0&&(g.push(a.assignTexture(t,"clearcoatNormalMap",_.clearcoatNormalTexture)),_.clearcoatNormalTexture.scale!==void 0)){const c=_.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Pi(c,c)}return Promise.all(g)}}class vB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_DISPERSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const d=this.parser.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=d.extensions[this.name];return t.dispersion=g.dispersion!==void 0?g.dispersion:0,Promise.resolve()}}class xB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];return _.iridescenceFactor!==void 0&&(t.iridescence=_.iridescenceFactor),_.iridescenceTexture!==void 0&&g.push(a.assignTexture(t,"iridescenceMap",_.iridescenceTexture)),_.iridescenceIor!==void 0&&(t.iridescenceIOR=_.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),_.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=_.iridescenceThicknessMinimum),_.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=_.iridescenceThicknessMaximum),_.iridescenceThicknessTexture!==void 0&&g.push(a.assignTexture(t,"iridescenceThicknessMap",_.iridescenceThicknessTexture)),Promise.all(g)}}class bB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_SHEEN}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[];t.sheenColor=new _i(0,0,0),t.sheenRoughness=0,t.sheen=1;const _=d.extensions[this.name];if(_.sheenColorFactor!==void 0){const c=_.sheenColorFactor;t.sheenColor.setRGB(c[0],c[1],c[2],ia)}return _.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=_.sheenRoughnessFactor),_.sheenColorTexture!==void 0&&g.push(a.assignTexture(t,"sheenColorMap",_.sheenColorTexture,Na)),_.sheenRoughnessTexture!==void 0&&g.push(a.assignTexture(t,"sheenRoughnessMap",_.sheenRoughnessTexture)),Promise.all(g)}}class wB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];return _.transmissionFactor!==void 0&&(t.transmission=_.transmissionFactor),_.transmissionTexture!==void 0&&g.push(a.assignTexture(t,"transmissionMap",_.transmissionTexture)),Promise.all(g)}}class SB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_VOLUME}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];t.thickness=_.thicknessFactor!==void 0?_.thicknessFactor:0,_.thicknessTexture!==void 0&&g.push(a.assignTexture(t,"thicknessMap",_.thicknessTexture)),t.attenuationDistance=_.attenuationDistance||1/0;const c=_.attenuationColor||[1,1,1];return t.attenuationColor=new _i().setRGB(c[0],c[1],c[2],ia),Promise.all(g)}}class EB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_IOR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const d=this.parser.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=d.extensions[this.name];return t.ior=g.ior!==void 0?g.ior:1.5,Promise.resolve()}}class TB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_SPECULAR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];t.specularIntensity=_.specularFactor!==void 0?_.specularFactor:1,_.specularTexture!==void 0&&g.push(a.assignTexture(t,"specularIntensityMap",_.specularTexture));const c=_.specularColorFactor||[1,1,1];return t.specularColor=new _i().setRGB(c[0],c[1],c[2],ia),_.specularColorTexture!==void 0&&g.push(a.assignTexture(t,"specularColorMap",_.specularColorTexture,Na)),Promise.all(g)}}class MB{constructor(e){this.parser=e,this.name=Ri.EXT_MATERIALS_BUMP}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];return t.bumpScale=_.bumpFactor!==void 0?_.bumpFactor:1,_.bumpTexture!==void 0&&g.push(a.assignTexture(t,"bumpMap",_.bumpTexture)),Promise.all(g)}}class AB{constructor(e){this.parser=e,this.name=Ri.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Iu}extendMaterialParams(e,t){const a=this.parser,d=a.json.materials[e];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const g=[],_=d.extensions[this.name];return _.anisotropyStrength!==void 0&&(t.anisotropy=_.anisotropyStrength),_.anisotropyRotation!==void 0&&(t.anisotropyRotation=_.anisotropyRotation),_.anisotropyTexture!==void 0&&g.push(a.assignTexture(t,"anisotropyMap",_.anisotropyTexture)),Promise.all(g)}}class IB{constructor(e){this.parser=e,this.name=Ri.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,a=t.json,d=a.textures[e];if(!d.extensions||!d.extensions[this.name])return null;const g=d.extensions[this.name],_=t.options.ktx2Loader;if(!_){if(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,g.source,_)}}class CB{constructor(e){this.parser=e,this.name=Ri.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,a=this.parser,d=a.json,g=d.textures[e];if(!g.extensions||!g.extensions[t])return null;const _=g.extensions[t],c=d.images[_.source];let I=a.textureLoader;if(c.uri){const P=a.options.manager.getHandler(c.uri);P!==null&&(I=P)}return this.detectSupport().then(function(P){if(P)return a.loadTextureImage(e,_.source,I);if(d.extensionsRequired&&d.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class RB{constructor(e){this.parser=e,this.name=Ri.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,a=this.parser,d=a.json,g=d.textures[e];if(!g.extensions||!g.extensions[t])return null;const _=g.extensions[t],c=d.images[_.source];let I=a.textureLoader;if(c.uri){const P=a.options.manager.getHandler(c.uri);P!==null&&(I=P)}return this.detectSupport().then(function(P){if(P)return a.loadTextureImage(e,_.source,I);if(d.extensionsRequired&&d.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return a.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class PB{constructor(e){this.name=Ri.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,a=t.bufferViews[e];if(a.extensions&&a.extensions[this.name]){const d=a.extensions[this.name],g=this.parser.getDependency("buffer",d.buffer),_=this.parser.options.meshoptDecoder;if(!_||!_.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return g.then(function(c){const I=d.byteOffset||0,P=d.byteLength||0,F=d.count,D=d.byteStride,N=new Uint8Array(c,I,P);return _.decodeGltfBufferAsync?_.decodeGltfBufferAsync(F,D,N,d.mode,d.filter).then(function(G){return G.buffer}):_.ready.then(function(){const G=new ArrayBuffer(F*D);return _.decodeGltfBuffer(new Uint8Array(G),F,D,N,d.mode,d.filter),G})})}else return null}}class LB{constructor(e){this.name=Ri.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,a=t.nodes[e];if(!a.extensions||!a.extensions[this.name]||a.mesh===void 0)return null;const d=t.meshes[a.mesh];for(const P of d.primitives)if(P.mode!==Zo.TRIANGLES&&P.mode!==Zo.TRIANGLE_STRIP&&P.mode!==Zo.TRIANGLE_FAN&&P.mode!==void 0)return null;const _=a.extensions[this.name].attributes,c=[],I={};for(const P in _)c.push(this.parser.getDependency("accessor",_[P]).then(F=>(I[P]=F,I[P])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(P=>{const F=P.pop(),D=F.isGroup?F.children:[F],N=P[0].count,G=[];for(const Z of D){const re=new xi,$=new lt,X=new wh,me=new lt(1,1,1),le=new Lz(Z.geometry,Z.material,N);for(let ye=0;ye<N;ye++)I.TRANSLATION&&$.fromBufferAttribute(I.TRANSLATION,ye),I.ROTATION&&X.fromBufferAttribute(I.ROTATION,ye),I.SCALE&&me.fromBufferAttribute(I.SCALE,ye),le.setMatrixAt(ye,re.compose($,X,me));for(const ye in I)if(ye==="_COLOR_0"){const Le=I[ye];le.instanceColor=new E1(Le.array,Le.itemSize,Le.normalized)}else ye!=="TRANSLATION"&&ye!=="ROTATION"&&ye!=="SCALE"&&Z.geometry.setAttribute(ye,I[ye]);Jr.prototype.copy.call(le,Z),this.parser.assignFinalMaterial(le),G.push(le)}return F.isGroup?(F.clear(),F.add(...G),F):G[0]}))}}const tA="glTF",pm=12,PE={JSON:1313821514,BIN:5130562};class kB{constructor(e){this.name=Ri.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,pm),a=new TextDecoder;if(this.header={magic:a.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==tA)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const d=this.header.length-pm,g=new DataView(e,pm);let _=0;for(;_<d;){const c=g.getUint32(_,!0);_+=4;const I=g.getUint32(_,!0);if(_+=4,I===PE.JSON){const P=new Uint8Array(e,pm+_,c);this.content=a.decode(P)}else if(I===PE.BIN){const P=pm+_;this.body=e.slice(P,P+c)}_+=c}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class DB{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ri.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const a=this.json,d=this.dracoLoader,g=e.extensions[this.name].bufferView,_=e.extensions[this.name].attributes,c={},I={},P={};for(const F in _){const D=M1[F]||F.toLowerCase();c[D]=_[F]}for(const F in e.attributes){const D=M1[F]||F.toLowerCase();if(_[F]!==void 0){const N=a.accessors[e.attributes[F]],G=Bd[N.componentType];P[D]=G.name,I[D]=N.normalized===!0}}return t.getDependency("bufferView",g).then(function(F){return new Promise(function(D,N){d.decodeDracoFile(F,function(G){for(const Z in G.attributes){const re=G.attributes[Z],$=I[Z];$!==void 0&&(re.normalized=$)}D(G)},c,P,ia,N)})})}}class NB{constructor(){this.name=Ri.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class OB{constructor(){this.name=Ri.KHR_MESH_QUANTIZATION}}class nA extends Gm{constructor(e,t,a,d){super(e,t,a,d)}copySampleValue_(e){const t=this.resultBuffer,a=this.sampleValues,d=this.valueSize,g=e*d*3+d;for(let _=0;_!==d;_++)t[_]=a[g+_];return t}interpolate_(e,t,a,d){const g=this.resultBuffer,_=this.sampleValues,c=this.valueSize,I=c*2,P=c*3,F=d-t,D=(a-t)/F,N=D*D,G=N*D,Z=e*P,re=Z-P,$=-2*G+3*N,X=G-N,me=1-$,le=X-N+D;for(let ye=0;ye!==c;ye++){const Le=_[re+ye+c],Me=_[re+ye+I]*F,Te=_[Z+ye+c],We=_[Z+ye]*F;g[ye]=me*Le+le*Me+$*Te+X*We}return g}}const FB=new wh;class zB extends nA{interpolate_(e,t,a,d){const g=super.interpolate_(e,t,a,d);return FB.fromArray(g).normalize().toArray(g),g}}const Zo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Bd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},LE={9728:Oa,9729:Io,9984:vM,9985:ay,9986:ym,9987:_c},kE={33071:dh,33648:Ny,10497:Zd},fx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},uh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},BB={CUBICSPLINE:void 0,LINEAR:Lm,STEP:Pm},dx={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function UB(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new yb({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:xc})),l.DefaultMaterial}function of(l,e,t){for(const a in t.extensions)l[a]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[a]=t.extensions[a])}function gc(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function VB(l,e,t){let a=!1,d=!1,g=!1;for(let P=0,F=e.length;P<F;P++){const D=e[P];if(D.POSITION!==void 0&&(a=!0),D.NORMAL!==void 0&&(d=!0),D.COLOR_0!==void 0&&(g=!0),a&&d&&g)break}if(!a&&!d&&!g)return Promise.resolve(l);const _=[],c=[],I=[];for(let P=0,F=e.length;P<F;P++){const D=e[P];if(a){const N=D.POSITION!==void 0?t.getDependency("accessor",D.POSITION):l.attributes.position;_.push(N)}if(d){const N=D.NORMAL!==void 0?t.getDependency("accessor",D.NORMAL):l.attributes.normal;c.push(N)}if(g){const N=D.COLOR_0!==void 0?t.getDependency("accessor",D.COLOR_0):l.attributes.color;I.push(N)}}return Promise.all([Promise.all(_),Promise.all(c),Promise.all(I)]).then(function(P){const F=P[0],D=P[1],N=P[2];return a&&(l.morphAttributes.position=F),d&&(l.morphAttributes.normal=D),g&&(l.morphAttributes.color=N),l.morphTargetsRelative=!0,l})}function GB(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let t=0,a=e.weights.length;t<a;t++)l.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(l.morphTargetInfluences.length===t.length){l.morphTargetDictionary={};for(let a=0,d=t.length;a<d;a++)l.morphTargetDictionary[t[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function HB(l){let e;const t=l.extensions&&l.extensions[Ri.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+px(t.attributes):e=l.indices+":"+px(l.attributes)+":"+l.mode,l.targets!==void 0)for(let a=0,d=l.targets.length;a<d;a++)e+=":"+px(l.targets[a]);return e}function px(l){let e="";const t=Object.keys(l).sort();for(let a=0,d=t.length;a<d;a++)e+=t[a]+":"+l[t[a]]+";";return e}function A1(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function WB(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const qB=new xi;class $B{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new pB,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let a=!1,d=-1,g=!1,_=-1;if(typeof navigator<"u"){const c=navigator.userAgent;a=/^((?!chrome|android).)*safari/i.test(c)===!0;const I=c.match(/Version\/(\d+)/);d=a&&I?parseInt(I[1],10):-1,g=c.indexOf("Firefox")>-1,_=g?c.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||a&&d<17||g&&_<98?this.textureLoader=new eA(this.options.manager):this.textureLoader=new nB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new QM(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const a=this,d=this.json,g=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(_){return _._markDefs&&_._markDefs()}),Promise.all(this._invokeAll(function(_){return _.beforeRoot&&_.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation"),a.getDependencies("camera")])}).then(function(_){const c={scene:_[0][d.scene||0],scenes:_[0],animations:_[1],cameras:_[2],asset:d.asset,parser:a,userData:{}};return of(g,c,d),gc(c,d),Promise.all(a._invokeAll(function(I){return I.afterRoot&&I.afterRoot(c)})).then(function(){for(const I of c.scenes)I.updateMatrixWorld();e(c)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],a=this.json.meshes||[];for(let d=0,g=t.length;d<g;d++){const _=t[d].joints;for(let c=0,I=_.length;c<I;c++)e[_[c]].isBone=!0}for(let d=0,g=e.length;d<g;d++){const _=e[d];_.mesh!==void 0&&(this._addNodeRef(this.meshCache,_.mesh),_.skin!==void 0&&(a[_.mesh].isSkinnedMesh=!0)),_.camera!==void 0&&this._addNodeRef(this.cameraCache,_.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,a){if(e.refs[t]<=1)return a;const d=a.clone(),g=(_,c)=>{const I=this.associations.get(_);I!=null&&this.associations.set(c,I);for(const[P,F]of _.children.entries())g(F,c.children[P])};return g(a,d),d.name+="_instance_"+e.uses[t]++,d}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let a=0;a<t.length;a++){const d=e(t[a]);if(d)return d}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const a=[];for(let d=0;d<t.length;d++){const g=e(t[d]);g&&a.push(g)}return a}getDependency(e,t){const a=e+":"+t;let d=this.cache.get(a);if(!d){switch(e){case"scene":d=this.loadScene(t);break;case"node":d=this._invokeOne(function(g){return g.loadNode&&g.loadNode(t)});break;case"mesh":d=this._invokeOne(function(g){return g.loadMesh&&g.loadMesh(t)});break;case"accessor":d=this.loadAccessor(t);break;case"bufferView":d=this._invokeOne(function(g){return g.loadBufferView&&g.loadBufferView(t)});break;case"buffer":d=this.loadBuffer(t);break;case"material":d=this._invokeOne(function(g){return g.loadMaterial&&g.loadMaterial(t)});break;case"texture":d=this._invokeOne(function(g){return g.loadTexture&&g.loadTexture(t)});break;case"skin":d=this.loadSkin(t);break;case"animation":d=this._invokeOne(function(g){return g.loadAnimation&&g.loadAnimation(t)});break;case"camera":d=this.loadCamera(t);break;default:if(d=this._invokeOne(function(g){return g!=this&&g.getDependency&&g.getDependency(e,t)}),!d)throw new Error("Unknown type: "+e);break}this.cache.add(a,d)}return d}getDependencies(e){let t=this.cache.get(e);if(!t){const a=this,d=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(d.map(function(g,_){return a.getDependency(e,_)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],a=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ri.KHR_BINARY_GLTF].body);const d=this.options;return new Promise(function(g,_){a.load(Am.resolveURL(t.uri,d.path),g,void 0,function(){_(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(a){const d=t.byteLength||0,g=t.byteOffset||0;return a.slice(g,g+d)})}loadAccessor(e){const t=this,a=this.json,d=this.json.accessors[e];if(d.bufferView===void 0&&d.sparse===void 0){const _=fx[d.type],c=Bd[d.componentType],I=d.normalized===!0,P=new c(d.count*_);return Promise.resolve(new Fa(P,_,I))}const g=[];return d.bufferView!==void 0?g.push(this.getDependency("bufferView",d.bufferView)):g.push(null),d.sparse!==void 0&&(g.push(this.getDependency("bufferView",d.sparse.indices.bufferView)),g.push(this.getDependency("bufferView",d.sparse.values.bufferView))),Promise.all(g).then(function(_){const c=_[0],I=fx[d.type],P=Bd[d.componentType],F=P.BYTES_PER_ELEMENT,D=F*I,N=d.byteOffset||0,G=d.bufferView!==void 0?a.bufferViews[d.bufferView].byteStride:void 0,Z=d.normalized===!0;let re,$;if(G&&G!==D){const X=Math.floor(N/G),me="InterleavedBuffer:"+d.bufferView+":"+d.componentType+":"+X+":"+d.count;let le=t.cache.get(me);le||(re=new P(c,X*G,d.count*G/F),le=new Az(re,G/F),t.cache.add(me,le)),$=new mb(le,I,N%G/F,Z)}else c===null?re=new P(d.count*I):re=new P(c,N,d.count*I),$=new Fa(re,I,Z);if(d.sparse!==void 0){const X=fx.SCALAR,me=Bd[d.sparse.indices.componentType],le=d.sparse.indices.byteOffset||0,ye=d.sparse.values.byteOffset||0,Le=new me(_[1],le,d.sparse.count*X),Me=new P(_[2],ye,d.sparse.count*I);c!==null&&($=new Fa($.array.slice(),$.itemSize,$.normalized));for(let Te=0,We=Le.length;Te<We;Te++){const de=Le[Te];if($.setX(de,Me[Te*I]),I>=2&&$.setY(de,Me[Te*I+1]),I>=3&&$.setZ(de,Me[Te*I+2]),I>=4&&$.setW(de,Me[Te*I+3]),I>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return $})}loadTexture(e){const t=this.json,a=this.options,g=t.textures[e].source,_=t.images[g];let c=this.textureLoader;if(_.uri){const I=a.manager.getHandler(_.uri);I!==null&&(c=I)}return this.loadTextureImage(e,g,c)}loadTextureImage(e,t,a){const d=this,g=this.json,_=g.textures[e],c=g.images[t],I=(c.uri||c.bufferView)+":"+_.sampler;if(this.textureCache[I])return this.textureCache[I];const P=this.loadImageSource(t,a).then(function(F){F.flipY=!1,F.name=_.name||c.name||"",F.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(F.name=c.uri);const N=(g.samplers||{})[_.sampler]||{};return F.magFilter=LE[N.magFilter]||Io,F.minFilter=LE[N.minFilter]||_c,F.wrapS=kE[N.wrapS]||Zd,F.wrapT=kE[N.wrapT]||Zd,d.associations.set(F,{textures:e}),F}).catch(function(){return null});return this.textureCache[I]=P,P}loadImageSource(e,t){const a=this,d=this.json,g=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(D=>D.clone());const _=d.images[e],c=self.URL||self.webkitURL;let I=_.uri||"",P=!1;if(_.bufferView!==void 0)I=a.getDependency("bufferView",_.bufferView).then(function(D){P=!0;const N=new Blob([D],{type:_.mimeType});return I=c.createObjectURL(N),I});else if(_.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const F=Promise.resolve(I).then(function(D){return new Promise(function(N,G){let Z=N;t.isImageBitmapLoader===!0&&(Z=function(re){const $=new Hs(re);$.needsUpdate=!0,N($)}),t.load(Am.resolveURL(D,g.path),Z,void 0,G)})}).then(function(D){return P===!0&&c.revokeObjectURL(I),gc(D,_),D.userData.mimeType=_.mimeType||WB(_.uri),D}).catch(function(D){throw console.error("THREE.GLTFLoader: Couldn't load texture",I),D});return this.sourceCache[e]=F,F}assignTexture(e,t,a,d){const g=this;return this.getDependency("texture",a.index).then(function(_){if(!_)return null;if(a.texCoord!==void 0&&a.texCoord>0&&(_=_.clone(),_.channel=a.texCoord),g.extensions[Ri.KHR_TEXTURE_TRANSFORM]){const c=a.extensions!==void 0?a.extensions[Ri.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const I=g.associations.get(_);_=g.extensions[Ri.KHR_TEXTURE_TRANSFORM].extendTexture(_,c),g.associations.set(_,I)}}return d!==void 0&&(_.colorSpace=d),e[t]=_,_})}assignFinalMaterial(e){const t=e.geometry;let a=e.material;const d=t.attributes.tangent===void 0,g=t.attributes.color!==void 0,_=t.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+a.uuid;let I=this.cache.get(c);I||(I=new YM,xu.prototype.copy.call(I,a),I.color.copy(a.color),I.map=a.map,I.sizeAttenuation=!1,this.cache.add(c,I)),a=I}else if(e.isLine){const c="LineBasicMaterial:"+a.uuid;let I=this.cache.get(c);I||(I=new ZM,xu.prototype.copy.call(I,a),I.color.copy(a.color),I.map=a.map,this.cache.add(c,I)),a=I}if(d||g||_){let c="ClonedMaterial:"+a.uuid+":";d&&(c+="derivative-tangents:"),g&&(c+="vertex-colors:"),_&&(c+="flat-shading:");let I=this.cache.get(c);I||(I=a.clone(),g&&(I.vertexColors=!0),_&&(I.flatShading=!0),d&&(I.normalScale&&(I.normalScale.y*=-1),I.clearcoatNormalScale&&(I.clearcoatNormalScale.y*=-1)),this.cache.add(c,I),this.associations.set(I,this.associations.get(a))),a=I}e.material=a}getMaterialType(){return yb}loadMaterial(e){const t=this,a=this.json,d=this.extensions,g=a.materials[e];let _;const c={},I=g.extensions||{},P=[];if(I[Ri.KHR_MATERIALS_UNLIT]){const D=d[Ri.KHR_MATERIALS_UNLIT];_=D.getMaterialType(),P.push(D.extendParams(c,g,t))}else{const D=g.pbrMetallicRoughness||{};if(c.color=new _i(1,1,1),c.opacity=1,Array.isArray(D.baseColorFactor)){const N=D.baseColorFactor;c.color.setRGB(N[0],N[1],N[2],ia),c.opacity=N[3]}D.baseColorTexture!==void 0&&P.push(t.assignTexture(c,"map",D.baseColorTexture,Na)),c.metalness=D.metallicFactor!==void 0?D.metallicFactor:1,c.roughness=D.roughnessFactor!==void 0?D.roughnessFactor:1,D.metallicRoughnessTexture!==void 0&&(P.push(t.assignTexture(c,"metalnessMap",D.metallicRoughnessTexture)),P.push(t.assignTexture(c,"roughnessMap",D.metallicRoughnessTexture))),_=this._invokeOne(function(N){return N.getMaterialType&&N.getMaterialType(e)}),P.push(Promise.all(this._invokeAll(function(N){return N.extendMaterialParams&&N.extendMaterialParams(e,c)})))}g.doubleSided===!0&&(c.side=Al);const F=g.alphaMode||dx.OPAQUE;if(F===dx.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,F===dx.MASK&&(c.alphaTest=g.alphaCutoff!==void 0?g.alphaCutoff:.5)),g.normalTexture!==void 0&&_!==ph&&(P.push(t.assignTexture(c,"normalMap",g.normalTexture)),c.normalScale=new Pi(1,1),g.normalTexture.scale!==void 0)){const D=g.normalTexture.scale;c.normalScale.set(D,D)}if(g.occlusionTexture!==void 0&&_!==ph&&(P.push(t.assignTexture(c,"aoMap",g.occlusionTexture)),g.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=g.occlusionTexture.strength)),g.emissiveFactor!==void 0&&_!==ph){const D=g.emissiveFactor;c.emissive=new _i().setRGB(D[0],D[1],D[2],ia)}return g.emissiveTexture!==void 0&&_!==ph&&P.push(t.assignTexture(c,"emissiveMap",g.emissiveTexture,Na)),Promise.all(P).then(function(){const D=new _(c);return g.name&&(D.name=g.name),gc(D,g),t.associations.set(D,{materials:e}),g.extensions&&of(d,D,g),D})}createUniqueName(e){const t=fr.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,a=this.extensions,d=this.primitiveCache;function g(c){return a[Ri.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,t).then(function(I){return DE(I,c,t)})}const _=[];for(let c=0,I=e.length;c<I;c++){const P=e[c],F=HB(P),D=d[F];if(D)_.push(D.promise);else{let N;P.extensions&&P.extensions[Ri.KHR_DRACO_MESH_COMPRESSION]?N=g(P):N=DE(new Au,P,t),d[F]={primitive:P,promise:N},_.push(N)}}return Promise.all(_)}loadMesh(e){const t=this,a=this.json,d=this.extensions,g=a.meshes[e],_=g.primitives,c=[];for(let I=0,P=_.length;I<P;I++){const F=_[I].material===void 0?UB(this.cache):this.getDependency("material",_[I].material);c.push(F)}return c.push(t.loadGeometries(_)),Promise.all(c).then(function(I){const P=I.slice(0,I.length-1),F=I[I.length-1],D=[];for(let G=0,Z=F.length;G<Z;G++){const re=F[G],$=_[G];let X;const me=P[G];if($.mode===Zo.TRIANGLES||$.mode===Zo.TRIANGLE_STRIP||$.mode===Zo.TRIANGLE_FAN||$.mode===void 0)X=g.isSkinnedMesh===!0?new Cz(re,me):new io(re,me),X.isSkinnedMesh===!0&&X.normalizeSkinWeights(),$.mode===Zo.TRIANGLE_STRIP?X.geometry=RE(X.geometry,CM):$.mode===Zo.TRIANGLE_FAN&&(X.geometry=RE(X.geometry,b1));else if($.mode===Zo.LINES)X=new kz(re,me);else if($.mode===Zo.LINE_STRIP)X=new _b(re,me);else if($.mode===Zo.LINE_LOOP)X=new Dz(re,me);else if($.mode===Zo.POINTS)X=new Nz(re,me);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+$.mode);Object.keys(X.geometry.morphAttributes).length>0&&GB(X,g),X.name=t.createUniqueName(g.name||"mesh_"+e),gc(X,g),$.extensions&&of(d,X,$),t.assignFinalMaterial(X),D.push(X)}for(let G=0,Z=D.length;G<Z;G++)t.associations.set(D[G],{meshes:e,primitives:G});if(D.length===1)return g.extensions&&of(d,D[0],g),D[0];const N=new ff;g.extensions&&of(d,N,g),t.associations.set(N,{meshes:e});for(let G=0,Z=D.length;G<Z;G++)N.add(D[G]);return N})}loadCamera(e){let t;const a=this.json.cameras[e],d=a[a.type];if(!d){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return a.type==="perspective"?t=new no(pD.radToDeg(d.yfov),d.aspectRatio||1,d.znear||1,d.zfar||2e6):a.type==="orthographic"&&(t=new db(-d.xmag,d.xmag,d.ymag,-d.ymag,d.znear,d.zfar)),a.name&&(t.name=this.createUniqueName(a.name)),gc(t,a),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],a=[];for(let d=0,g=t.joints.length;d<g;d++)a.push(this._loadNodeShallow(t.joints[d]));return t.inverseBindMatrices!==void 0?a.push(this.getDependency("accessor",t.inverseBindMatrices)):a.push(null),Promise.all(a).then(function(d){const g=d.pop(),_=d,c=[],I=[];for(let P=0,F=_.length;P<F;P++){const D=_[P];if(D){c.push(D);const N=new xi;g!==null&&N.fromArray(g.array,P*16),I.push(N)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[P])}return new gb(c,I)})}loadAnimation(e){const t=this.json,a=this,d=t.animations[e],g=d.name?d.name:"animation_"+e,_=[],c=[],I=[],P=[],F=[];for(let D=0,N=d.channels.length;D<N;D++){const G=d.channels[D],Z=d.samplers[G.sampler],re=G.target,$=re.node,X=d.parameters!==void 0?d.parameters[Z.input]:Z.input,me=d.parameters!==void 0?d.parameters[Z.output]:Z.output;re.node!==void 0&&(_.push(this.getDependency("node",$)),c.push(this.getDependency("accessor",X)),I.push(this.getDependency("accessor",me)),P.push(Z),F.push(re))}return Promise.all([Promise.all(_),Promise.all(c),Promise.all(I),Promise.all(P),Promise.all(F)]).then(function(D){const N=D[0],G=D[1],Z=D[2],re=D[3],$=D[4],X=[];for(let me=0,le=N.length;me<le;me++){const ye=N[me],Le=G[me],Me=Z[me],Te=re[me],We=$[me];if(ye===void 0)continue;ye.updateMatrix&&ye.updateMatrix();const de=a._createAnimationTracks(ye,Le,Me,Te,We);if(de)for(let be=0;be<de.length;be++)X.push(de[be])}return new Gz(g,void 0,X)})}createNodeMesh(e){const t=this.json,a=this,d=t.nodes[e];return d.mesh===void 0?null:a.getDependency("mesh",d.mesh).then(function(g){const _=a._getNodeRef(a.meshCache,d.mesh,g);return d.weights!==void 0&&_.traverse(function(c){if(c.isMesh)for(let I=0,P=d.weights.length;I<P;I++)c.morphTargetInfluences[I]=d.weights[I]}),_})}loadNode(e){const t=this.json,a=this,d=t.nodes[e],g=a._loadNodeShallow(e),_=[],c=d.children||[];for(let P=0,F=c.length;P<F;P++)_.push(a.getDependency("node",c[P]));const I=d.skin===void 0?Promise.resolve(null):a.getDependency("skin",d.skin);return Promise.all([g,Promise.all(_),I]).then(function(P){const F=P[0],D=P[1],N=P[2];N!==null&&F.traverse(function(G){G.isSkinnedMesh&&G.bind(N,qB)});for(let G=0,Z=D.length;G<Z;G++)F.add(D[G]);return F})}_loadNodeShallow(e){const t=this.json,a=this.extensions,d=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const g=t.nodes[e],_=g.name?d.createUniqueName(g.name):"",c=[],I=d._invokeOne(function(P){return P.createNodeMesh&&P.createNodeMesh(e)});return I&&c.push(I),g.camera!==void 0&&c.push(d.getDependency("camera",g.camera).then(function(P){return d._getNodeRef(d.cameraCache,g.camera,P)})),d._invokeAll(function(P){return P.createNodeAttachment&&P.createNodeAttachment(e)}).forEach(function(P){c.push(P)}),this.nodeCache[e]=Promise.all(c).then(function(P){let F;if(g.isBone===!0?F=new XM:P.length>1?F=new ff:P.length===1?F=P[0]:F=new Jr,F!==P[0])for(let D=0,N=P.length;D<N;D++)F.add(P[D]);if(g.name&&(F.userData.name=g.name,F.name=_),gc(F,g),g.extensions&&of(a,F,g),g.matrix!==void 0){const D=new xi;D.fromArray(g.matrix),F.applyMatrix4(D)}else g.translation!==void 0&&F.position.fromArray(g.translation),g.rotation!==void 0&&F.quaternion.fromArray(g.rotation),g.scale!==void 0&&F.scale.fromArray(g.scale);return d.associations.has(F)||d.associations.set(F,{}),d.associations.get(F).nodes=e,F}),this.nodeCache[e]}loadScene(e){const t=this.extensions,a=this.json.scenes[e],d=this,g=new ff;a.name&&(g.name=d.createUniqueName(a.name)),gc(g,a),a.extensions&&of(t,g,a);const _=a.nodes||[],c=[];for(let I=0,P=_.length;I<P;I++)c.push(d.getDependency("node",_[I]));return Promise.all(c).then(function(I){for(let F=0,D=I.length;F<D;F++)g.add(I[F]);const P=F=>{const D=new Map;for(const[N,G]of d.associations)(N instanceof xu||N instanceof Hs)&&D.set(N,G);return F.traverse(N=>{const G=d.associations.get(N);G!=null&&D.set(N,G)}),D};return d.associations=P(g),g})}_createAnimationTracks(e,t,a,d,g){const _=[],c=e.name?e.name:e.uuid,I=[];uh[g.path]===uh.weights?e.traverse(function(N){N.morphTargetInfluences&&I.push(N.name?N.name:N.uuid)}):I.push(c);let P;switch(uh[g.path]){case uh.weights:P=ep;break;case uh.rotation:P=tp;break;case uh.position:case uh.scale:P=np;break;default:switch(a.itemSize){case 1:P=ep;break;case 2:case 3:default:P=np;break}break}const F=d.interpolation!==void 0?BB[d.interpolation]:Lm,D=this._getArrayFromAccessor(a);for(let N=0,G=I.length;N<G;N++){const Z=new P(I[N]+"."+uh[g.path],t.array,D,F);d.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(Z),_.push(Z)}return _}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const a=A1(t.constructor),d=new Float32Array(t.length);for(let g=0,_=t.length;g<_;g++)d[g]=t[g]*a;t=d}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(a){const d=this instanceof tp?zB:nA;return new d(this.times,this.values,this.getValueSize()/3,a)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function XB(l,e,t){const a=e.attributes,d=new wc;if(a.POSITION!==void 0){const c=t.json.accessors[a.POSITION],I=c.min,P=c.max;if(I!==void 0&&P!==void 0){if(d.set(new lt(I[0],I[1],I[2]),new lt(P[0],P[1],P[2])),c.normalized){const F=A1(Bd[c.componentType]);d.min.multiplyScalar(F),d.max.multiplyScalar(F)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const g=e.targets;if(g!==void 0){const c=new lt,I=new lt;for(let P=0,F=g.length;P<F;P++){const D=g[P];if(D.POSITION!==void 0){const N=t.json.accessors[D.POSITION],G=N.min,Z=N.max;if(G!==void 0&&Z!==void 0){if(I.setX(Math.max(Math.abs(G[0]),Math.abs(Z[0]))),I.setY(Math.max(Math.abs(G[1]),Math.abs(Z[1]))),I.setZ(Math.max(Math.abs(G[2]),Math.abs(Z[2]))),N.normalized){const re=A1(Bd[N.componentType]);I.multiplyScalar(re)}c.max(I)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}d.expandByVector(c)}l.boundingBox=d;const _=new Mu;d.getCenter(_.center),_.radius=d.min.distanceTo(d.max)/2,l.boundingSphere=_}function DE(l,e,t){const a=e.attributes,d=[];function g(_,c){return t.getDependency("accessor",_).then(function(I){l.setAttribute(c,I)})}for(const _ in a){const c=M1[_]||_.toLowerCase();c in l.attributes||d.push(g(a[_],c))}if(e.indices!==void 0&&!l.index){const _=t.getDependency("accessor",e.indices).then(function(c){l.setIndex(c)});d.push(_)}return Ki.workingColorSpace!==ia&&"COLOR_0"in a&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ki.workingColorSpace}" not supported.`),gc(l,e),XB(l,e,t),Promise.all(d).then(function(){return e.targets!==void 0?VB(l,e.targets,t):l})}function wb(l,e,t){l.prototype=e.prototype=t,t.constructor=l}function iA(l,e){var t=Object.create(l.prototype);for(var a in e)t[a]=e[a];return t}function Hm(){}var Dm=.7,Hy=1/Dm,Ud="\\s*([+-]?\\d+)\\s*",Nm="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",bu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",jB=/^#([0-9a-f]{3,8})$/,ZB=new RegExp(`^rgb\\(${Ud},${Ud},${Ud}\\)$`),YB=new RegExp(`^rgb\\(${bu},${bu},${bu}\\)$`),KB=new RegExp(`^rgba\\(${Ud},${Ud},${Ud},${Nm}\\)$`),JB=new RegExp(`^rgba\\(${bu},${bu},${bu},${Nm}\\)$`),QB=new RegExp(`^hsl\\(${Nm},${bu},${bu}\\)$`),eU=new RegExp(`^hsla\\(${Nm},${bu},${bu},${Nm}\\)$`),NE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};wb(Hm,Om,{copy(l){return Object.assign(new this.constructor,this,l)},displayable(){return this.rgb().displayable()},hex:OE,formatHex:OE,formatHex8:tU,formatHsl:nU,formatRgb:FE,toString:FE});function OE(){return this.rgb().formatHex()}function tU(){return this.rgb().formatHex8()}function nU(){return rA(this).formatHsl()}function FE(){return this.rgb().formatRgb()}function Om(l){var e,t;return l=(l+"").trim().toLowerCase(),(e=jB.exec(l))?(t=e[1].length,e=parseInt(e[1],16),t===6?zE(e):t===3?new ro(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?X_(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?X_(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ZB.exec(l))?new ro(e[1],e[2],e[3],1):(e=YB.exec(l))?new ro(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=KB.exec(l))?X_(e[1],e[2],e[3],e[4]):(e=JB.exec(l))?X_(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=QB.exec(l))?VE(e[1],e[2]/100,e[3]/100,1):(e=eU.exec(l))?VE(e[1],e[2]/100,e[3]/100,e[4]):NE.hasOwnProperty(l)?zE(NE[l]):l==="transparent"?new ro(NaN,NaN,NaN,0):null}function zE(l){return new ro(l>>16&255,l>>8&255,l&255,1)}function X_(l,e,t,a){return a<=0&&(l=e=t=NaN),new ro(l,e,t,a)}function iU(l){return l instanceof Hm||(l=Om(l)),l?(l=l.rgb(),new ro(l.r,l.g,l.b,l.opacity)):new ro}function I1(l,e,t,a){return arguments.length===1?iU(l):new ro(l,e,t,a??1)}function ro(l,e,t,a){this.r=+l,this.g=+e,this.b=+t,this.opacity=+a}wb(ro,I1,iA(Hm,{brighter(l){return l=l==null?Hy:Math.pow(Hy,l),new ro(this.r*l,this.g*l,this.b*l,this.opacity)},darker(l){return l=l==null?Dm:Math.pow(Dm,l),new ro(this.r*l,this.g*l,this.b*l,this.opacity)},rgb(){return this},clamp(){return new ro(gf(this.r),gf(this.g),gf(this.b),Wy(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:BE,formatHex:BE,formatHex8:rU,formatRgb:UE,toString:UE}));function BE(){return`#${df(this.r)}${df(this.g)}${df(this.b)}`}function rU(){return`#${df(this.r)}${df(this.g)}${df(this.b)}${df((isNaN(this.opacity)?1:this.opacity)*255)}`}function UE(){const l=Wy(this.opacity);return`${l===1?"rgb(":"rgba("}${gf(this.r)}, ${gf(this.g)}, ${gf(this.b)}${l===1?")":`, ${l})`}`}function Wy(l){return isNaN(l)?1:Math.max(0,Math.min(1,l))}function gf(l){return Math.max(0,Math.min(255,Math.round(l)||0))}function df(l){return l=gf(l),(l<16?"0":"")+l.toString(16)}function VE(l,e,t,a){return a<=0?l=e=t=NaN:t<=0||t>=1?l=e=NaN:e<=0&&(l=NaN),new Cl(l,e,t,a)}function rA(l){if(l instanceof Cl)return new Cl(l.h,l.s,l.l,l.opacity);if(l instanceof Hm||(l=Om(l)),!l)return new Cl;if(l instanceof Cl)return l;l=l.rgb();var e=l.r/255,t=l.g/255,a=l.b/255,d=Math.min(e,t,a),g=Math.max(e,t,a),_=NaN,c=g-d,I=(g+d)/2;return c?(e===g?_=(t-a)/c+(t<a)*6:t===g?_=(a-e)/c+2:_=(e-t)/c+4,c/=I<.5?g+d:2-g-d,_*=60):c=I>0&&I<1?0:_,new Cl(_,c,I,l.opacity)}function sU(l,e,t,a){return arguments.length===1?rA(l):new Cl(l,e,t,a??1)}function Cl(l,e,t,a){this.h=+l,this.s=+e,this.l=+t,this.opacity=+a}wb(Cl,sU,iA(Hm,{brighter(l){return l=l==null?Hy:Math.pow(Hy,l),new Cl(this.h,this.s,this.l*l,this.opacity)},darker(l){return l=l==null?Dm:Math.pow(Dm,l),new Cl(this.h,this.s,this.l*l,this.opacity)},rgb(){var l=this.h%360+(this.h<0)*360,e=isNaN(l)||isNaN(this.s)?0:this.s,t=this.l,a=t+(t<.5?t:1-t)*e,d=2*t-a;return new ro(mx(l>=240?l-240:l+120,d,a),mx(l,d,a),mx(l<120?l+240:l-120,d,a),this.opacity)},clamp(){return new Cl(GE(this.h),j_(this.s),j_(this.l),Wy(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const l=Wy(this.opacity);return`${l===1?"hsl(":"hsla("}${GE(this.h)}, ${j_(this.s)*100}%, ${j_(this.l)*100}%${l===1?")":`, ${l})`}`}}));function GE(l){return l=(l||0)%360,l<0?l+360:l}function j_(l){return Math.max(0,Math.min(1,l||0))}function mx(l,e,t){return(l<60?e+(t-e)*l/60:l<180?t:l<240?e+(t-e)*(240-l)/60:e)*255}const Sb=l=>()=>l;function aU(l,e){return function(t){return l+t*e}}function oU(l,e,t){return l=Math.pow(l,t),e=Math.pow(e,t)-l,t=1/t,function(a){return Math.pow(l+a*e,t)}}function lU(l){return(l=+l)==1?sA:function(e,t){return t-e?oU(e,t,l):Sb(isNaN(e)?t:e)}}function sA(l,e){var t=e-l;return t?aU(l,t):Sb(isNaN(l)?e:l)}const HE=function l(e){var t=lU(e);function a(d,g){var _=t((d=I1(d)).r,(g=I1(g)).r),c=t(d.g,g.g),I=t(d.b,g.b),P=sA(d.opacity,g.opacity);return function(F){return d.r=_(F),d.g=c(F),d.b=I(F),d.opacity=P(F),d+""}}return a.gamma=l,a}(1);function aA(l,e){e||(e=[]);var t=l?Math.min(e.length,l.length):0,a=e.slice(),d;return function(g){for(d=0;d<t;++d)a[d]=l[d]*(1-g)+e[d]*g;return a}}function oA(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)}function uU(l,e){return(oA(e)?aA:lA)(l,e)}function lA(l,e){var t=e?e.length:0,a=l?Math.min(t,l.length):0,d=new Array(a),g=new Array(t),_;for(_=0;_<a;++_)d[_]=Eb(l[_],e[_]);for(;_<t;++_)g[_]=e[_];return function(c){for(_=0;_<a;++_)g[_]=d[_](c);return g}}function cU(l,e){var t=new Date;return l=+l,e=+e,function(a){return t.setTime(l*(1-a)+e*a),t}}function C1(l,e){return l=+l,e=+e,function(t){return l*(1-t)+e*t}}function hU(l,e){var t={},a={},d;(l===null||typeof l!="object")&&(l={}),(e===null||typeof e!="object")&&(e={});for(d in e)d in l?t[d]=Eb(l[d],e[d]):a[d]=e[d];return function(g){for(d in t)a[d]=t[d](g);return a}}var R1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gx=new RegExp(R1.source,"g");function fU(l){return function(){return l}}function dU(l){return function(e){return l(e)+""}}function pU(l,e){var t=R1.lastIndex=gx.lastIndex=0,a,d,g,_=-1,c=[],I=[];for(l=l+"",e=e+"";(a=R1.exec(l))&&(d=gx.exec(e));)(g=d.index)>t&&(g=e.slice(t,g),c[_]?c[_]+=g:c[++_]=g),(a=a[0])===(d=d[0])?c[_]?c[_]+=d:c[++_]=d:(c[++_]=null,I.push({i:_,x:C1(a,d)})),t=gx.lastIndex;return t<e.length&&(g=e.slice(t),c[_]?c[_]+=g:c[++_]=g),c.length<2?I[0]?dU(I[0].x):fU(e):(e=I.length,function(P){for(var F=0,D;F<e;++F)c[(D=I[F]).i]=D.x(P);return c.join("")})}function Eb(l,e){var t=typeof e,a;return e==null||t==="boolean"?Sb(e):(t==="number"?C1:t==="string"?(a=Om(e))?(e=a,HE):pU:e instanceof Om?HE:e instanceof Date?cU:oA(e)?aA:Array.isArray(e)?lA:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?hU:C1)(l,e)}const mU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAKpJREFUOE9jZGBgYGagADDiM4B/WYo9yOyPUXMO4rIDpwFCK1Lr/jMx1oE0Mv773/QuYnYTNkOwGoCsGaYJlyEYBmDTjM8QFAPQnY3sBVzegRuAzc+Cq9L+gGx/HzaLBVn+359/zrCAhRsguDJ1LwMjoz2yX5ENABkEN+T//4Pvw2c7gwMYFo3YogzdAJghf//9P4jhAmxRhM0AdHV4E9KoAQwMFGUmYnM4AL/6fEGfm/JPAAAAAElFTkSuQmCC",uA=[{time:61797,distance:85.837,bbox:[114.111457,22.370669,114.111821,22.37097],instructions:[{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:13.651,heading:344.61,sign:0,interval:[0,1],text:"Enter building from outdoor",time:9828,floor_id:"2cdd6174730d4431b1aa730eda596ed4",ordinal:0,street_name:"",type:null},{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:29.86,heading:0,sign:2,interval:[1,2],text:"Turn Right and walk straight to the lift",time:21498,floor_id:"2cdd6174730d4431b1aa730eda596ed4",ordinal:0,street_name:"",type:null},{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:10.456,heading:0,sign:100,interval:[2,3],text:"Take lift from level 1 to level 3",time:7528,floor_id:"2cdd6174730d4431b1aa730eda596ed4",ordinal:0,street_name:"",type:null},{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:4.283,heading:0,sign:0,interval:[3,4],text:"Out from lift and walk straight",time:3083,floor_id:"2cdd6174730d4431b1aa730eda596ed4",ordinal:2,street_name:"",type:null},{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:2.241,heading:0,sign:2,interval:[4,5],text:"Turn Right and walk straight to the destination",time:1613,floor_id:"2cdd6174730d4431b1aa730eda596ed4",ordinal:2,street_name:"",type:null},{venue_id:"9f0af5f1758040008a7b112d041c0977",building_id:"tsuenwanplaza_hk_369d01",distance:0,heading:0,sign:4,interval:[5,5],text:"Arrive at destination",time:0,floor_id:"e7067d79ac7e47a7835965bb1e46ac6b",ordinal:2,street_name:"",type:null}],points:{coordinates:[[-87.61702191869324,41.865332260722425],[-87.61703942291355,41.866246675348975],[-87.61570479030358,41.8662492712956],[-87.61557591779658,41.86624606863293],[-87.61703942291355,41.866246675348975],[-87.61705742344037,41.86676639127796]],type:"LineString"},snapped_waypoints:{coordinates:[[114.111821,22.370669],[114.111457,22.37097]],type:"LineString"}}],{instructions:_x,points:{coordinates:xm}}=uA[0];async function gU(l){const e=_x.slice(0,_x.length-1).map((t,a)=>{const{interval:[d,g],ordinal:_,sign:c,text:I}=t,P=_x[a+1].ordinal,F=yu(xm.slice(d,g+1),{color:"#ea580c",height:cA(c)?P*100:_*100+.5,base_height:_*100});return pM(F,2,{units:"meters"})});_U(l,e),await yU(l,uA[0])}function _U(l,e){l.addLayer({id:"lift-extrusion",type:"fill-extrusion",source:{type:"geojson",data:{type:"FeatureCollection",features:e}},paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","base_height"],"fill-extrusion-opacity":.8}})}async function yU(l,e){const{instructions:t,points:{coordinates:a}}=e,g=K1($T(a)).geometry.coordinates,c=P1.MercatorCoordinate.fromLngLat(g,0),I={translateX:c.x,translateY:c.y,translateZ:c.z,scale:c.meterInMercatorCoordinateUnits()},P=new xi().makeTranslation(I.translateX,I.translateY,I.translateZ).scale(new lt(I.scale,-I.scale,I.scale)),F=await vU(),D=8;F.scale.set(D,D,D);const G=new eA().load(mU),Z=new io(new Vm(1,1),new ph({map:G,side:Al,transparent:!0})),re={id:"points-3d-model",type:"custom",renderingMode:"3d",onAdd($,X){this.map=$,this.scene=new Mz,this.scene.rotateX(Math.PI/2),this.scene.scale.multiply(new lt(1,1,-1)),this.camera=new hb,this.renderer=new Tz({canvas:$.getCanvas(),context:X,antialias:!0}),this.renderer.autoClear=!1;const me=xU(c,t,3);me.forEach(({coordinates:ye,identifier:Le},Me)=>{if(Me===0||Me===me.length-1){const Te=F.clone();Te.position.set(ye[0],ye[1]+4,ye[2]),this.scene.add(Te)}else{const Te=Z.clone(),We=Le==="connector"?[ye[0]-5,ye[1]+2,ye[2]-2]:[ye[0],ye[1]+1,ye[2]],de=me[Me+1].coordinates,be=Le==="connector"?[de[0]-5,de[1]+2,de[2]-2]:[de[0],de[1]+1,de[2]];Te.position.set(...We),Te.lookAt(new lt(...be)),Z.scale.set(D*.5,D*.5,D*.5),Te.rotateX(Math.PI/2),this.scene.add(Te)}});const le=new tB(16777215);this.scene.add(le)},render($,X){const me=new xi().fromArray(X);this.camera.projectionMatrix=me.multiply(P),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.map.triggerRepaint()}};l.addLayer(re)}async function vU(){return(await new dB().loadAsync("./assets/red-point.gltf")).scene}function xU(l,e,t=0){return hx.flatMap(e,(a,d)=>{const{interval:[g,_],ordinal:c,sign:I}=a,P=e[d+1],F=(P==null?void 0:P.ordinal)??c;if(g===_)return[{coordinates:Z_(l,xm[g],F*100),identifier:"end"}];const D=Eb(c*100,F*100),N=_-g,G=cA(I)?[{coordinates:Z_(l,xm[_],c*100),identifier:"connector"},{coordinates:Z_(l,xm[_],F*100),identifier:"connector"}]:xm.slice(g,_+1).map((Z,re)=>({coordinates:Z_(l,Z,D(re/N)),identifier:"path"}));return hx.flatMap(G,({coordinates:Z,identifier:re},$)=>{var ye;const X=(ye=G[$+1])==null?void 0:ye.coordinates;if(!X)return d===e.length-1?[Z]:[];const me=t+1,le=uU(Z,X);return hx.times(me,Le=>({coordinates:le(Le/me).slice(),identifier:re}))})})}function cA(l){return l===100||l===-100}function Z_(l,e,t){const a=P1.MercatorCoordinate.fromLngLat(e,t),d=1/a.meterInMercatorCoordinateUnits();return[(a.x-l.x)*d,(a.z-l.z)*d,-(a.y-l.y)*d]}async function bU(){const l=await fetch("./assets/indoor-3d-map.geojson.json");if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return await l.json()}async function wU(l){const e=await bU();l.addSource("floorplan",{type:"geojson",data:e}),l.addLayer({id:"room-extrusion",type:"fill-extrusion",source:"floorplan",paint:{"fill-extrusion-color":["get","color"],"fill-extrusion-height":["get","height"],"fill-extrusion-base":["get","base_height"]}})}const yx=window.map=new P1.Map({container:"map",style:"https://api.maptiler.com/maps/basic/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL",center:[-87.61578392215847,41.86784341172856],zoom:16,pitch:60,bearing:30,antialias:!0});yx.on("style.load",async()=>{await wU(yx),await gU(yx)});
